<!DOCTYPE html>
<html lang="el" class="light">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>MediRadar Pro - Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
Â  Â  <script src="https://unpkg.com/@phosphor-icons/web"></script>
Â  Â  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.10/dayjs.min.js"></script>
Â  Â Â 
Â  Â  <script>
Â  Â  Â  Â  const SB_URL = "https://qzerrisyowkfkmcyxmav.supabase.co";
Â  Â  Â  Â  const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF6ZXJyaXN5b3drZmttY3l4bWF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwMTcxODQsImV4cCI6MjA3NTU5MzE4NH0.alkvHkOQPBTwY3daUcKAEsf4nt0kizuU3rYI2c2InPk";
Â  Â  Â  Â Â 
Â  Â  Â  Â  tailwind.config = { darkMode: 'class', theme: { extend: { fontFamily: { sans: ['Inter', 'sans-serif'] }, colors: { primary: '#0f172a', secondary: '#0d9488' }, animation: { 'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite' } } } }
Â  Â  </script>
Â  Â  <style>
Â  Â  Â  Â  .glass-panel { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }Â 
Â  Â  Â  Â  .toast { animation: slideIn 0.3s ease-out forwards; }Â 
Â  Â  Â  Â  @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
Â  Â  Â  Â  /* Tab Transitions */
Â  Â  Â  Â  .tab-content { display: none; animation: fadeIn 0.2s ease-out; }
Â  Â  Â  Â  .tab-content.active { display: block; }
Â  Â  Â  Â  @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
Â  Â  </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col">

Â  Â  Â  Â  <nav class="bg-white shadow-sm border-b border-slate-200 p-4 sticky top-0 z-30">
Â  Â  Â  Â  <div class="max-w-6xl mx-auto flex justify-between items-center">
Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-3"><div class="w-10 h-10 bg-secondary rounded-xl flex items-center justify-center text-white shadow-lg"><i class="ph ph-first-aid-kit text-2xl"></i></div><div><h1 class="font-bold text-lg leading-tight">MediRadar <span class="text-secondary">Pro</span></h1><p class="text-xs text-slate-500">ÎšÎ­Î½Ï„ÏÎ¿ Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚</p></div></div>
Â  Â  Â  Â  Â  Â  <div class="flex gap-2 items-center">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="auth-section"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </nav>

Â  Â  Â  Â  <div id="login-overlay" class="fixed inset-0 z-50 bg-slate-900/95 backdrop-blur-sm flex items-center justify-center p-4 hidden">
Â  Â  Â  Â  <div class="bg-white w-full max-w-lg rounded-3xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-slate-50 p-2 flex border-b border-slate-200">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="switchAuthTab('login')" id="tab-btn-login" class="flex-1 py-3 rounded-xl text-sm font-bold text-secondary bg-white shadow-sm transition-all">Î£ÏÎ½Î´ÎµÏƒÎ·</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="switchAuthTab('register')" id="tab-btn-register" class="flex-1 py-3 rounded-xl text-sm font-bold text-slate-500 hover:bg-slate-100 transition-all">Î•Î³Î³ÏÎ±Ï†Î® Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï…</button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="p-8 overflow-y-auto">
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="auth-login" class="tab-content active">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center mb-8">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-20 h-20 bg-secondary/10 rounded-full flex items-center justify-center mx-auto mb-4 text-secondary"><i class="ph ph-lock-key text-4xl"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-slate-800">ÎšÎ±Î»ÏÏ‚ Î®ÏÎ¸Î±Ï„Îµ</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-slate-500">Î£Ï…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ ÏƒÎ±Ï‚.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form onsubmit="handleProLogin(event)" class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="text-xs font-bold text-slate-500 uppercase ml-1">Email</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" id="login-email" placeholder="pharmacy@example.com" required class="w-full bg-slate-50 border border-slate-300 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-secondary">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="w-full bg-secondary hover:bg-teal-700 text-white font-bold py-3.5 rounded-xl transition-all shadow-lg flex items-center justify-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-magic-wand"></i> Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® Magic Link
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-6 text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="demoLogin()" class="text-xs text-slate-400 hover:text-secondary underline">Î•Î¯ÏƒÎ¿Î´Î¿Ï‚ Î¼Îµ Demo Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="auth-register" class="tab-content">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold text-slate-800">Î‘Î¯Ï„Î·ÏƒÎ· Î•Î³Î³ÏÎ±Ï†Î®Ï‚</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-slate-500">Î£Ï…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Î³Î¹Î± Î­Î»ÎµÎ³Ï‡Î¿.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form onsubmit="handleRegistration(event)" class="space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><label class="text-[10px] font-bold text-slate-500 uppercase">Î•Ï€Ï‰Î½Ï…Î¼Î¹Î±</label><input id="reg-name" type="text" required class="w-full bg-slate-50 border border-slate-300 rounded-lg px-3 py-2.5 text-sm outline-none focus:border-secondary"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><label class="text-[10px] font-bold text-slate-500 uppercase">Î‘Î¦Îœ</label><input id="reg-afm" type="text" required class="w-full bg-slate-50 border border-slate-300 rounded-lg px-3 py-2.5 text-sm outline-none focus:border-secondary"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><label class="text-[10px] font-bold text-slate-500 uppercase">Î‘ÏÎ¹Î¸Î¼Î¿Ï‚ Î‘Î´ÎµÎ¹Î±Ï‚</label><input id="reg-license" type="text" required class="w-full bg-slate-50 border border-slate-300 rounded-lg px-3 py-2.5 text-sm outline-none focus:border-secondary"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><label class="text-[10px] font-bold text-slate-500 uppercase">Î”Î¹ÎµÏ…Î¸Ï…Î½ÏƒÎ· Î¦Î±ÏÎ¼Î±ÎºÎµÎ¹Î¿Ï…</label><input id="reg-address" type="text" required class="w-full bg-slate-50 border border-slate-300 rounded-lg px-3 py-2.5 text-sm outline-none focus:border-secondary"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="border-t border-dashed border-slate-200 my-2"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><label class="text-[10px] font-bold text-slate-500 uppercase">ÎŸÎ½Î¿Î¼Î±Ï„ÎµÏ€Ï‰Î½Ï…Î¼Î¿ Î¥Ï€ÎµÏ…Î¸Ï…Î½Î¿Ï…</label><input id="reg-contact" type="text" required class="w-full bg-slate-50 border border-slate-300 rounded-lg px-3 py-2.5 text-sm outline-none focus:border-secondary"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><label class="text-[10px] font-bold text-slate-500 uppercase">Email</label><input id="reg-email" type="email" required class="w-full bg-slate-50 border border-slate-300 rounded-lg px-3 py-2.5 text-sm outline-none focus:border-secondary"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><label class="text-[10px] font-bold text-slate-500 uppercase">Î¤Î·Î»ÎµÏ†Ï‰Î½Î¿</label><input id="reg-phone" type="tel" required class="w-full bg-slate-50 border border-slate-300 rounded-lg px-3 py-2.5 text-sm outline-none focus:border-secondary"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-3.5 rounded-xl transition-all shadow-lg mt-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Î¥Ï€Î¿Î²Î¿Î»Î® Î‘Î¯Ï„Î·ÏƒÎ·Ï‚
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <main class="max-w-6xl mx-auto p-4 w-full grid grid-cols-1 lg:grid-cols-4 gap-6 flex-grow">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="lg:col-span-1 space-y-6">
Â  Â  Â  Â  Â  Â  <div class="glass-panel p-5 rounded-2xl shadow-sm"><h3 class="font-bold text-xs uppercase text-slate-500 mb-4">ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</h3><label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" checked class="sr-only peer"><div class="w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-teal-300 rounded-full peer peer-checked:bg-secondary"></div><span class="ml-3 text-sm font-medium">Î‘Î½Î¿Î¹Ï‡Ï„ÏŒ Î¤ÏÏÎ±</span></label></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="lg:col-span-3">
Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-end mb-4"><h2 class="text-xl font-bold flex items-center gap-2"><i class="ph ph-bell-ringing text-secondary animate-pulse-slow"></i> Î•Î¹ÏƒÎµÏÏ‡ÏŒÎ¼ÎµÎ½Î± Î‘Î¹Ï„Î®Î¼Î±Ï„Î±</h2><button onclick="fetchRequests()" class="text-sm text-secondary font-semibold hover:underline"><i class="ph ph-arrows-clockwise"></i> Î‘Î½Î±Î½Î­Ï‰ÏƒÎ·</button></div>
Â  Â  Â  Â  Â  Â  <div id="loading-spinner" class="hidden text-center py-10"><i class="ph ph-spinner animate-spin text-3xl text-secondary"></i><p class="text-sm text-slate-500 mt-2">Î¦ÏŒÏÏ„Ï‰ÏƒÎ·...</p></div>
Â  Â  Â  Â  Â  Â  <div id="requests-container" class="space-y-4"></div>
Â  Â  Â  Â  </div>
Â  Â  </main>

Â  Â  <div id="toast-container" class="fixed bottom-5 right-5 z-50 flex flex-col gap-2"></div>

Â  Â  <script>
Â  Â  Â  Â  let currentUser = null;
Â  Â  Â  Â  let timers = {};Â 

Â  Â  Â  Â  window.db = window.supabase.createClient(SB_URL, SB_KEY);

Â  Â  Â  Â  window.onload = async function() {
Â  Â  Â  Â  Â  Â  const { data: { session } } = await window.db.auth.getSession();
Â  Â  Â  Â  Â  Â  if (session) { handleLoginSuccess(session.user); } else { document.getElementById('login-overlay').classList.remove('hidden'); }
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- UI LOGIC ---
Â  Â  Â  Â  function switchAuthTab(tab) {
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
Â  Â  Â  Â  Â  Â  document.getElementById(`auth-${tab}`).classList.add('active');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const btnLogin = document.getElementById('tab-btn-login');
Â  Â  Â  Â  Â  Â  const btnRegister = document.getElementById('tab-btn-register');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if(tab === 'login') {
Â  Â  Â  Â  Â  Â  Â  Â  btnLogin.className = "flex-1 py-3 rounded-xl text-sm font-bold text-secondary bg-white shadow-sm transition-all";
Â  Â  Â  Â  Â  Â  Â  Â  btnRegister.className = "flex-1 py-3 rounded-xl text-sm font-bold text-slate-500 hover:bg-slate-100 transition-all";
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  btnRegister.className = "flex-1 py-3 rounded-xl text-sm font-bold text-secondary bg-white shadow-sm transition-all";
Â  Â  Â  Â  Â  Â  Â  Â  btnLogin.className = "flex-1 py-3 rounded-xl text-sm font-bold text-slate-500 hover:bg-slate-100 transition-all";
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- AUTH LOGIC ---
Â  Â  Â  Â  async function handleProLogin(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  const email = document.getElementById('login-email').value;
Â  Â  Â  Â  Â  Â  const btn = e.target.querySelector('button');
Â  Â  Â  Â  Â  Â  const oldText = btn.innerHTML;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  btn.innerHTML = '<i class="ph ph-spinner animate-spin"></i>'; btn.disabled = true;

Â  Â  Â  Â  Â  Â  const { error } = await window.db.auth.signInWithOtp({ email: email, options: { emailRedirectTo: window.location.href } });

Â  Â  Â  Â  Â  Â  if (error) {
Â  Â  Â  Â  Â  Â  Â  Â  showToast("Î£Ï†Î¬Î»Î¼Î±: " + error.message, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  btn.innerHTML = oldText; btn.disabled = false;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  showToast("âœ… Î¤Î¿ Magic Link ÏƒÏ„Î¬Î»Î¸Î·ÎºÎµ ÏƒÏ„Î¿ email ÏƒÎ±Ï‚!", 'success');
Â  Â  Â  Â  Â  Â  Â  Â  btn.innerHTML = '<i class="ph ph-check"></i> Î•ÏƒÏ„Î¬Î»Î·';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function handleRegistration(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const formData = {
Â  Â  Â  Â  Â  Â  Â  Â  pharmacy_name: document.getElementById('reg-name').value,
Â  Â  Â  Â  Â  Â  Â  Â  afm: document.getElementById('reg-afm').value,
Â  Â  Â  Â  Â  Â  Â  Â  license_number: document.getElementById('reg-license').value,
Â  Â  Â  Â  Â  Â  Â  Â  address: document.getElementById('reg-address').value,
Â  Â  Â  Â  Â  Â  Â  Â  contact_person: document.getElementById('reg-contact').value,
Â  Â  Â  Â  Â  Â  Â  Â  email: document.getElementById('reg-email').value,
Â  Â  Â  Â  Â  Â  Â  Â  phone: document.getElementById('reg-phone').value,
Â  Â  Â  Â  Â  Â  Â  Â  status: 'pending' // Î‘ÏÏ‡Î¹ÎºÎ® ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const btn = e.target.querySelector('button');
Â  Â  Â  Â  Â  Â  const oldText = btn.innerHTML;
Â  Â  Â  Â  Â  Â  btn.innerHTML = 'Î¥Ï€Î¿Î²Î¿Î»Î®...'; btn.disabled = true;

Â  Â  Â  Â  Â  Â  // Insert into pharmacy_registrations table
Â  Â  Â  Â  Â  Â  const { error } = await window.db.from('pharmacy_registrations').insert([formData]);

Â  Â  Â  Â  Â  Â  if (error) {
Â  Â  Â  Â  Â  Â  Â  Â  showToast("Î£Ï†Î¬Î»Î¼Î±: " + error.message, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  btn.innerHTML = oldText; btn.disabled = false;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  showToast("âœ… Î— Î±Î¯Ï„Î·ÏƒÎ· ÎµÏƒÏ„Î¬Î»Î·! Î˜Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÎ¿Ï…Î¼Îµ Î¼Î±Î¶Î¯ ÏƒÎ±Ï‚.", 'success');
Â  Â  Â  Â  Â  Â  Â  Â  // Reset form & show message
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('auth-register').innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center py-10 animate-[fadeIn_0.5s]">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4 text-4xl"><i class="ph ph-check"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-bold text-slate-800">Î•Ï…Ï‡Î±ÏÎ¹ÏƒÏ„Î¿ÏÎ¼Îµ!</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-slate-500 mt-2">Î— Î±Î¯Ï„Î·ÏƒÎ® ÏƒÎ±Ï‚ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ®Î¸Î·ÎºÎµ.<br>Î˜Î± ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ email: <strong>${formData.email}</strong></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="window.location.reload()" class="mt-6 text-sm text-secondary font-bold underline">Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î®</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function handleLoginSuccess(user) {
Â  Â  Â  Â  Â  Â  currentUser = user;
Â  Â  Â  Â  Â  Â  document.getElementById('login-overlay').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('auth-section').innerHTML = `<span class="text-xs font-medium mr-2 hidden sm:inline">${user.email}</span><button onclick="handleLogout()" class="text-xs bg-slate-200 px-3 py-1 rounded-lg hover:bg-red-500 hover:text-white transition-colors">ÎˆÎ¾Î¿Î´Î¿Ï‚</button>`;
Â  Â  Â  Â  Â  Â  fetchRequests();
Â  Â  Â  Â  Â  Â  subscribeToEverything();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Fallback auto-refresh interval (every 30s)
Â  Â  Â  Â  Â  Â  setInterval(fetchRequests, 30000);
Â  Â  Â  Â  }

Â  Â  Â  Â  async function demoLogin() {
Â  Â  Â  Â  Â  Â  const { data, error } = await window.db.auth.signInAnonymously();
Â  Â  Â  Â  Â  Â  if (error) { showToast('Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚', 'error'); }Â 
Â  Â  Â  Â  Â  Â  else { handleLoginSuccess(data.user); }
Â  Â  Â  Â  }
Â  Â  Â  Â  async function handleLogout() { await window.db.auth.signOut(); window.location.reload(); }

Â  Â  Â  Â  // === Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ— fetchRequests() - Î£Ï‰ÏƒÏ„ÏŒ Ï†Î¹Î»Ï„ÏÎ¬ÏÎ¹ÏƒÎ¼Î± ===
Â  Â  Â  Â  async function fetchRequests() {
Â  Â  Â  Â  Â  Â  if(!currentUser) return;

Â  Â  Â  Â  Â  Â  const container = document.getElementById('requests-container');
Â  Â  Â  Â  Â  Â  const loadingSpinner = document.getElementById('loading-spinner');
Â  Â  Â  Â  Â  Â  loadingSpinner.classList.remove('hidden');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Î¦Î­ÏÎµ Ï„Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î± Ï€Î¿Ï… Î”Î•Î ÎµÎ¯Î½Î±Î¹ rejected/completed
Â  Â  Â  Â  Â  Â  // ÎšÎ‘Î™ (ÎµÎ¯Î½Î±Î¹ pending Î‰ (ÎµÎ¯Î½Î±Î¹ reserved ÎšÎ‘Î™ ÎµÎ¯Î¼Î±ÏƒÏ„Îµ ÎµÎ¼ÎµÎ¯Ï‚ Î¿ winner))
Â  Â  Â  Â  Â  Â  const { data, error } = await window.db.from('requests').select('*')
Â  Â  Â  Â  Â  Â  Â  Â  .neq('status', 'rejected')Â 
Â  Â  Â  Â  Â  Â  Â  Â  .neq('status', 'completed')Â 
Â  Â  Â  Â  Â  Â  Â  Â  .or(`status.eq.pending,and(status.eq.reserved,winner_pharmacy_id.eq.${currentUser.id})`)
Â  Â  Â  Â  Â  Â  Â  Â  .order('created_at', { ascending: false });

Â  Â  Â  Â  Â  Â  // Î¦Î­ÏÎµ Ï„Î± responses Î¼Î±Ï‚ Î³Î¹Î± Î½Î± Î¾Î­ÏÎ¿Ï…Î¼Îµ ÏƒÎµ Ï€Î¿Î¹Î± pending Î­Ï‡Î¿Ï…Î¼Îµ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹
Â  Â  Â  Â  Â  Â  const { data: myResponses } = await window.db.from('responses').select('request_id').eq('pharmacist_id', currentUser.id);
Â  Â  Â  Â  Â  Â  const myRespondedIds = new Set((myResponses || []).map(r => r.request_id));

Â  Â  Â  Â  Â  Â  loadingSpinner.classList.add('hidden'); // Î‘Ï€ÏŒÎºÏÏ…ÏˆÎ· Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚

Â  Â  Â  Â  Â  Â  if(error) return showToast("Î£Ï†Î¬Î»Î¼Î± Î±Î½Î¬ÎºÏ„Î·ÏƒÎ·Ï‚: " + error.message, 'error');Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  Â  Â  if(data && data.length > 0) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  data.forEach(req => container.innerHTML += createRequestCard(req, myRespondedIds.has(req.id)));Â 
Â  Â  Â  Â  Â  Â  Â  Â  data.forEach(req => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(req.status === 'reserved' && req.winner_pharmacy_id === currentUser.id) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Î— updated_at Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ Î· ÏƒÏ„Î¹Î³Î¼Î® Ï€Î¿Ï… Î­Î³Î¹Î½Îµ reserved
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const timeBase = req.updated_at || new Date().toISOString(); 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startCountdown(req.id, timeBase);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } else {Â 
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = `<div class="text-center py-16 bg-white/50 rounded-3xl border-2 border-dashed border-slate-300"><p class="text-slate-500">ÎšÎ±Î½Î­Î½Î± ÎµÎ½ÎµÏÎ³ÏŒ Î±Î¯Ï„Î·Î¼Î±.</p></div>`;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  // === Î¤Î•Î›ÎŸÎ£ Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ—Î£ fetchRequests() ===

Â  Â  Â  Â  // === Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ— createRequestCard() - Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· Î‘Ï€ÏŒÏƒÏ„Î±ÏƒÎ·Ï‚ ===
Â  Â  Â  Â  function createRequestCard(req, hasResponded) {
Â  Â  Â  Â  Â  Â  const timeAgo = new Date(req.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
Â  Â  Â  Â  Â  Â  let stateUI = '';
Â  Â  Â  Â  Â  Â  let borderClass = 'border-l-secondary';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Î•Î¹ÎºÎ¿Î½Î¹ÎºÎ® Ï„Î¹Î¼Î® Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ·Ï‚ Î³Î¹Î± ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ·
Â  Â  Â  Â  Â  Â  const displayDistance = (Math.random() * 5 + 1).toFixed(1) + ' Ï‡Î»Î¼';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î´Î­Ï‡ÎµÏ„Î±Î¹ Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿ (Î±Î½ ÎµÎ¯Î½Î±Î¹ null Î¸ÎµÏ‰ÏÎ¿ÏÎ¼Îµ Î½Î±Î¹)
Â  Â  Â  Â  Â  Â  const allowGeneric = req.accepts_generic !== false;Â 

Â  Â  Â  Â  Â  Â  if (req.status === 'reserved' && req.winner_pharmacy_id === currentUser.id) {
Â  Â  Â  Â  Â  Â  Â  Â  borderClass = 'border-l-green-500 ring-1 ring-green-500/20';
Â  Â  Â  Â  Â  Â  Â  Â  const verifyCode = req.id.substring(0, 6);Â 
Â  Â  Â  Â  Â  Â  Â  Â  stateUI = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-4 bg-green-50 border border-green-200 p-4 rounded-xl animate-[fadeIn_0.5s]">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-start mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="font-bold text-green-800 flex items-center gap-2"><i class="ph ph-check-circle text-xl"></i> ÎŸ Î ÎµÎ»Î¬Ï„Î·Ï‚ ÎˆÏÏ‡ÎµÏ„Î±Î¹!</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-green-700 mt-1">Î‘Ï€Î¿Î¼Î­Î½Î¿Ï…Î½: <span id="timer-${req.id}" class="font-mono font-bold text-lg">Loading...</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-right">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-[10px] uppercase text-slate-400 font-bold">ÎšÏ‰Î´Î¹ÎºÎ¿Ï‚</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-2xl font-mono font-bold text-slate-800 tracking-widest">${verifyCode}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white p-3 rounded-xl border border-green-100 flex gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="verify-input-${req.id}" placeholder="Î•Î¹ÏƒÎ±Î³Ï‰Î³Î® ÎšÏ‰Î´Î¹ÎºÎ¿Ï" class="flex-1 bg-transparent outline-none text-center font-bold tracking-widest uppercase">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="verifyOrder('${req.id}', '${verifyCode}')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-bold text-xs shadow-md">Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  else if (hasResponded) {
Â  Â  Â  Â  Â  Â  Â  Â  borderClass = 'border-l-yellow-400';
Â  Â  Â  Â  Â  Â  Â  Â  stateUI = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-4 bg-yellow-50 border border-yellow-200 p-3 rounded-xl flex items-center justify-between">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2 text-yellow-700 font-bold text-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="ph ph-hourglass-medium animate-spin"></i> Î‘Î½Î±Î¼Î¿Î½Î® Ï€ÎµÎ»Î¬Ï„Î·...
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs text-yellow-600 bg-yellow-100 px-2 py-1 rounded">Î‘Ï€Î±Î½Ï„Î®ÏƒÎ±Ï„Îµ</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Â  Â  // ÎšÎ¿Ï…Î¼Ï€Î¯ Î“ÎµÎ½ÏŒÏƒÎ·Î¼Î¿Ï…: Î•Î½ÎµÏÎ³ÏŒ Î® Î‘Î½ÎµÎ½ÎµÏÎ³ÏŒ Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î·Î½ ÎµÏ€Î¹Î»Î¿Î³Î® Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î·
Â  Â  Â  Â  Â  Â  Â  Â  const genericBtn = allowGenericÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? `<button onclick="sendResponse('${req.id}', 'generic')" class="col-span-1 bg-white border border-secondary text-secondary hover:bg-teal-50 py-3 rounded-xl font-bold text-sm transition-transform active:scale-95">ğŸ’Š Î¥Ï€Î¬ÏÏ‡ÎµÎ¹ (Î“ÎµÎ½ÏŒÏƒÎ·Î¼Î¿)</button>`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : `<button disabled class="col-span-1 bg-slate-100 border border-slate-200 text-slate-400 py-3 rounded-xl font-bold text-xs cursor-not-allowed" title="ÎŸ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î´ÎµÎ½ Î´Î­Ï‡ÎµÏ„Î±Î¹ Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿">ğŸš« Î“ÎµÎ½ÏŒÏƒÎ·Î¼Î¿ (ÎŒÏ‡Î¹)</button>`;

Â  Â  Â  Â  Â  Â  Â  Â  stateUI = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-3 mt-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="sendResponse('${req.id}', 'original')" class="col-span-1 bg-secondary hover:bg-teal-700 text-white py-3 rounded-xl font-bold text-sm shadow-md transition-transform active:scale-95">âœ… Î¥Ï€Î¬ÏÏ‡ÎµÎ¹ (Î ÏÏ‰Ï„ÏŒÏ„Ï…Ï€Î¿)</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${genericBtn}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="dismissRequest('${req.id}')" class="col-span-2 text-xs text-slate-400 hover:text-slate-600 py-2">Î‘Ï€ÏŒÏÏÎ¹ÏˆÎ·</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <div id="card-${req.id}" class="glass-panel p-5 rounded-2xl shadow-sm hover:shadow-md transition-all border-l-4 ${borderClass} relative mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-start mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="bg-slate-100 text-slate-600 text-[10px] font-bold px-2 py-1 rounded flex items-center gap-1"><i class="ph ph-clock"></i> ${timeAgo}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs font-bold text-slate-500 flex items-center gap-1"><i class="ph ph-map-pin"></i> ${displayDistance}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-bold text-slate-900 mb-1">${req.medicine_name} <span class="text-lg font-normal text-slate-500">x${req.quantity}</span></h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-slate-500 mb-2">${req.customer_name || 'Î ÎµÎ»Î¬Ï„Î·Ï‚'}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${req.notes ? `<div class="bg-slate-50 p-2 rounded text-xs italic border border-slate-100">"${req.notes}"</div>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${!allowGeneric ? '<span class="text-[10px] font-bold text-red-500 bg-red-50 px-2 py-1 rounded inline-block mb-2">âš ï¸ ÎœÏŒÎ½Î¿ Î ÏÏ‰Ï„ÏŒÏ„Ï…Ï€Î¿</span>' : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${stateUI}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }
Â  Â  Â  Â  // === Î¤Î•Î›ÎŸÎ£ Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ—Î£ createRequestCard() ===

Â  Â  Â  Â  // --- ACTIONS ---
Â  Â  Â  Â  // === Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ— sendResponse() - Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÎ®Ï‚ Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ·Ï‚ ===
Â  Â  Â  Â  async function sendResponse(requestId, type) {
Â  Â  Â  Â  Â  Â  const message = type === 'original' ? 'Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ (Î ÏÏ‰Ï„ÏŒÏ„Ï…Ï€Î¿)' : 'Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ (Î“ÎµÎ½ÏŒÏƒÎ·Î¼Î¿)';
Â  Â  Â  Â  Â  Â  // Î•Î¹ÎºÎ¿Î½Î¹ÎºÎ® Ï„Î¹Î¼Î® Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ·Ï‚
Â  Â  Â  Â  Â  Â  const virtualDistance = (Math.random() * 2 + 0.5).toFixed(1); // 0.5km - 2.5km
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const { error } = await window.db.from('responses').insert({Â 
Â  Â  Â  Â  Â  Â  Â  Â  request_id: requestId,Â 
Â  Â  Â  Â  Â  Â  Â  Â  pharmacist_id: currentUser.id,Â 
Â  Â  Â  Â  Â  Â  Â  Â  response_type: type,Â 
Â  Â  Â  Â  Â  Â  Â  Â  message: message,
Â  Â  Â  Â  Â  Â  Â  Â  price: 0.00, // Î¤Î¹Î¼Î® Î³Î¹Î± Ï„Î¿ response
Â  Â  Â  Â  Â  Â  Â  Â  distance: virtualDistance // Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÎ®Ï‚ Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ·Ï‚
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  if (!error) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  showToast('Î— Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· ÏƒÏ„Î¬Î»Î¸Î·ÎºÎµ!', 'success');Â 
Â  Â  Â  Â  Â  Â  Â  Â  fetchRequests();
Â  Â  Â  Â  Â  Â  } else {Â 
Â  Â  Â  Â  Â  Â  Â  Â  showToast('Î£Ï†Î¬Î»Î¼Î±: ' + error.message, 'error');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  // === Î¤Î•Î›ÎŸÎ£ Î”Î™ÎŸÎ¡Î˜Î©ÎœÎ•ÎÎ—Î£ sendResponse() ===

Â  Â  Â  Â  function verifyOrder(requestId, correctCode) {
Â  Â  Â  Â  Â  Â  const input = document.getElementById(`verify-input-${requestId}`);
Â  Â  Â  Â  Â  Â  if (input.value.trim() === correctCode) {
Â  Â  Â  Â  Â  Â  Â  Â  completeOrder(requestId);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  showToast('Î›Î¬Î¸Î¿Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚!', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  input.classList.add('ring-2', 'ring-red-500');
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => input.classList.remove('ring-2', 'ring-red-500'), 1000);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function completeOrder(requestId) {
Â  Â  Â  Â  Â  Â  const { error } = await window.db.from('requests').update({ status: 'completed' }).eq('id', requestId);
Â  Â  Â  Â  Â  Â  if(!error) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(`card-${requestId}`).remove();
Â  Â  Â  Â  Â  Â  Â  Â  showToast('Î— Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ!', 'success');
Â  Â  Â  Â  Â  Â  Â  Â  try { new Audio('https://cdn.freesound.org/previews/171/171671_2437358-lq.mp3').play().catch(e=>{}); } catch(e){}
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // FIX: Actual DB update for rejection
Â  Â  Â  Â  async function dismissRequest(id) {
Â  Â  Â  Â  Â  Â  document.getElementById(`card-${id}`).remove();
Â  Â  Â  Â  Â  Â  await window.db.from('requests').update({ status: 'rejected' }).eq('id', id);
Â  Â  Â  Â  }

Â  Â  Â  Â  function startCountdown(reqId, startTimeStr) {
Â  Â  Â  Â  Â  Â  if(timers[reqId]) clearInterval(timers[reqId]);
Â  Â  Â  Â  Â  Â  const safeStartTime = new Date(startTimeStr).getTime();
Â  Â  Â  Â  Â  Â  const duration = 60 * 60 * 1000; const endTime = safeStartTime + duration;
Â  Â  Â  Â  Â  Â  function update() {
Â  Â  Â  Â  Â  Â  Â  Â  const distance = endTime - new Date().getTime();
Â  Â  Â  Â  Â  Â  Â  Â  const el = document.getElementById(`timer-${reqId}`);
Â  Â  Â  Â  Â  Â  Â  Â  if (!el) { clearInterval(timers[reqId]); return; }
Â  Â  Â  Â  Â  Â  Â  Â  if (distance < 0) { clearInterval(timers[reqId]); el.innerHTML = "Î•Î›Î—ÎÎ•"; el.classList.add('text-red-600'); return; }
Â  Â  Â  Â  Â  Â  Â  Â  const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
Â  Â  Â  Â  Â  Â  Â  Â  const s = Math.floor((distance % (1000 * 60)) / 1000);
Â  Â  Â  Â  Â  Â  Â  Â  el.innerHTML = `${m}:${s < 10 ? '0' : ''}${s}`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  update(); timers[reqId] = setInterval(update, 1000);
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- REALTIME (NUCLEAR OPTION) ---
Â  Â  Â  Â  function subscribeToEverything() {
Â  Â  Â  Â  Â  Â  window.db.channel('pharmacy-global').on('postgres_changes', { event: '*', schema: 'public', table: 'requests' }, payload => {
Â  Â  Â  Â  Â  Â  Â  Â  if(payload.eventType === 'INSERT') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('ğŸ”” ÎÎ­Î¿ Î±Î¯Ï„Î·Î¼Î±!', 'info');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try { new Audio('https://cdn.freesound.org/previews/201/201159_866625-lq.mp3').play().catch(e=>{}); } catch(e){}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fetchRequests();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if(payload.eventType === 'UPDATE' && payload.new.status === 'reserved' && payload.new.winner_pharmacy_id === currentUser.id) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('âœ… ÎŸ Ï€ÎµÎ»Î¬Ï„Î·Ï‚ Î­ÎºÎ±Î½Îµ ÎºÏÎ¬Ï„Î·ÏƒÎ·!', 'success');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fetchRequests(); // Î‘Ï…Ï„ÏŒ Î¸Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ ÎºÎ±Î¹ Ï„Î¿Î½ timer
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }).subscribe();
Â  Â  Â  Â  }

Â  Â  Â  Â  function showToast(msg, type='info') { const c = document.getElementById('toast-container'); const el = document.createElement('div'); const bg = type === 'success' ? 'bg-green-500' : (type === 'error' ? 'bg-red-500' : 'bg-slate-800'); el.className = `toast ${bg} text-white px-4 py-3 rounded-xl shadow-lg text-sm font-semibold`; el.innerHTML = msg; c.appendChild(el); setTimeout(() => el.remove(), 3000); }
Â  Â  </script>
</body>
</html>
