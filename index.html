<!DOCTYPE html>
<html lang="el" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MediRadar App</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        primary: '#0d9488', // Teal-600
                        secondary: '#0f172a', // Slate-900
                    },
                    animation: {
                        'float': 'float 15s linear infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in': 'fadeIn 0.3s ease-out forwards',
                        'slide-up': 'slideUp 0.3s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        slideInUp: { /* Toast Entry */
                            '0%': { transform: 'translateY(100px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        slideOutDown: { /* Toast Exit */
                            '0%': { transform: 'translateY(0)', opacity: '1' },
                            '100%': { transform: 'translateY(100px)', opacity: '0' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Floating Emojis */
        .emoji-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            overflow: hidden; z-index: 0; pointer-events: none;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            transition: background 0.5s ease;
        }
        
        html.dark .emoji-bg {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        .emoji {
            position: absolute; bottom: -100px;
            font-size: 2rem; opacity: 0.4;
            animation: floatUp 15s linear infinite;
            z-index: 0;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            10% { opacity: 0.5; }
            90% { opacity: 0.5; }
            100% { transform: translateY(-110vh) rotate(360deg); opacity: 0; }
        }
        
        /* Glassmorphism Card - Stronger borders for visibility */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.1);
            position: relative; z-index: 10;
            transition: all 0.3s ease;
        }

        html.dark .glass-card {
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.3);
        }

        /* Modal Styles */
        .modal-backdrop {
            display: none;
            position: fixed; inset: 0; z-index: 50;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(4px);
            align-items: center; justify-content: center;
            padding: 1rem;
        }
        .modal-backdrop.active { display: flex; animation: fadeIn 0.2s ease-out; }

        .modal-content {
            width: 100%; max-width: 400px;
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            transform: scale(0.95); opacity: 0;
        }
        
        .modal-backdrop.active .modal-content {
            animation: slideUp 0.3s ease-out forwards;
        }
        
        /* Toast Animations */
        .toast-enter { animation: slideInUp 0.3s ease-out forwards; }
        .toast-exit { animation: slideOutDown 0.3s ease-in forwards; }
        
        body::-webkit-scrollbar { width: 0px; background: transparent; }

        /* Tab Animation */
        .tab-content { display: none; animation: fadeIn 0.3s ease-out; }
        .tab-content.active { display: block; }
        
        /* Pro Button */
        .pro-footer-btn {
            display: inline-flex; align-items: center; gap: 0.45rem;
            padding: 0.65rem 0.95rem; border-radius: 9999px;
            background: linear-gradient(90deg, #0f172a 0%, #1e293b 100%);
            color: white; border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 10px 25px -12px rgba(15, 23, 42, 0.5);
            transition: transform 0.2s ease, opacity 0.2s ease;
        }
        .pro-footer-btn:hover { transform: translateY(-1px); opacity: 0.95; }
        html.dark .pro-footer-btn {
            background: linear-gradient(90deg, #0d9488 0%, #14b8a6 100%);
            color: #0b172a;
        }
    </style>
</head>
<body class="text-slate-800 dark:text-slate-100 antialiased min-h-screen relative flex flex-col">

    <div id="emoji-container" class="emoji-bg"></div>

    <nav class="w-full max-w-lg mx-auto p-4 flex justify-between items-center z-20 relative">
        <div class="flex gap-2">
            <button onclick="openModal('user')" class="bg-white/90 dark:bg-slate-800/90 hover:bg-white dark:hover:bg-slate-700 px-3 py-2 rounded-xl text-xs font-bold text-primary border border-primary/20 transition-all flex items-center gap-1 shadow-sm backdrop-blur-md hover:shadow-md">
                <i class="ph ph-user text-lg"></i> Î•Î¯ÏƒÎ¿Î´Î¿Ï‚
            </button>
        </div>

        <div class="flex gap-2">
            <button onclick="toggleLang()" class="bg-white/60 dark:bg-slate-700/60 w-10 h-10 rounded-full flex items-center justify-center text-xl shadow-sm hover:scale-110 transition-transform border border-white/50" title="Î‘Î»Î»Î±Î³Î® Î“Î»ÏÏƒÏƒÎ±Ï‚">
                <span id="lang-flag">ğŸ‡¬ğŸ‡·</span>
            </button>
            
            <button onclick="toggleTheme()" class="bg-white/60 dark:bg-slate-700/60 w-10 h-10 rounded-full flex items-center justify-center text-slate-700 dark:text-yellow-300 shadow-sm hover:scale-110 transition-transform border border-white/50" title="Dark/Light Mode">
                <i id="theme-icon" class="ph ph-moon-stars text-xl"></i>
            </button>
        </div>
    </nav>

    <main class="w-full max-w-lg mx-auto p-4 pb-6 flex-grow z-10 relative">
        
        <header class="text-center mb-6">
            <div class="inline-flex items-center justify-center bg-white/70 dark:bg-slate-700/70 p-4 rounded-2xl mb-3 shadow-sm backdrop-blur-sm border border-white/50">
                <i class="ph ph-magnifying-glass text-4xl text-primary"></i>
            </div>
            <h1 class="text-3xl font-bold text-primary bg-clip-text text-transparent bg-gradient-to-r from-teal-600 to-cyan-500 drop-shadow-sm">
                MediRadar
            </h1>
            <p class="text-slate-500 dark:text-slate-400 text-sm mt-1 font-medium">Î’ÏÎµÏ‚ Ï„Î¿ Ï†Î¬ÏÎ¼Î±ÎºÏŒ ÏƒÎ¿Ï… Î¬Î¼ÎµÏƒÎ± & Ï„Î¿Ï€Î¹ÎºÎ¬.</p>
        </header>

        <div class="flex p-1.5 bg-slate-200/80 dark:bg-slate-800/80 rounded-2xl mb-6 glass-card">
            <button onclick="switchTab('search')" id="btn-search" class="flex-1 py-3 rounded-xl text-sm font-bold transition-all bg-white dark:bg-slate-700 shadow-sm text-primary dark:text-teal-300 ring-1 ring-black/5">
                Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·
            </button>
            <button onclick="switchTab('how')" id="btn-how" class="flex-1 py-3 rounded-xl text-sm font-bold text-slate-500 dark:text-slate-400 hover:bg-white/50 dark:hover:bg-slate-700/50 transition-all">
                Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯
            </button>
        </div>

        <div id="tab-search" class="tab-content active">
            <div class="glass-card rounded-3xl p-6 relative overflow-hidden">
                
                <form id="request-form" class="space-y-6">
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-slate-700 dark:text-slate-300 uppercase ml-1">ÎŸÎ½Î¿Î¼Î±</label>
                            <input id="full-name" type="text" placeholder="ÎœÎ±ÏÎ¯Î± Î ." oninput="saveUserData()"
                                   class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-2xl px-4 py-3.5 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-white placeholder-slate-400 font-medium shadow-sm" required>
                        </div>
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-slate-700 dark:text-slate-300 uppercase ml-1">Î¤Î·Î»ÎµÏ†Ï‰Î½Î¿</label>
                            <input id="phone" type="tel" placeholder="69..." oninput="saveUserData()"
                                   class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-2xl px-4 py-3.5 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-white placeholder-slate-400 font-medium shadow-sm" required>
                        </div>
                    </div>

                    <div class="space-y-2 relative">
                        <label class="text-xs font-bold text-slate-700 dark:text-slate-300 uppercase ml-1">Î ÎµÏÎ¹Î¿Ï‡Î·</label>
                        <div class="relative">
                            <input id="city" type="text" placeholder="Ï€.Ï‡. ÎšÎ¬Ï„Ï‰ Î¤Î¿ÏÎ¼Ï€Î±" oninput="saveUserData()"
                                   class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-2xl px-4 py-3.5 pr-32 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-white placeholder-slate-400 font-medium shadow-sm" required>
                            <button type="button" onclick="getLocation()" class="absolute right-2 top-2 bottom-2 px-3 bg-teal-100 dark:bg-teal-900/40 text-teal-800 dark:text-teal-200 border border-teal-200 dark:border-teal-700 rounded-xl text-xs font-bold hover:bg-teal-200 dark:hover:bg-teal-900/60 transition-colors flex items-center gap-1 shadow-sm">
                                <i class="ph ph-navigation-arrow text-sm"></i> ÎšÎ¿Î½Ï„Î¬ Î¼Î¿Ï…
                            </button>
                        </div>
                    </div>

                    <div class="border-t-2 border-dashed border-slate-200 dark:border-slate-700 my-2"></div>

                    <div class="space-y-4">
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-slate-700 dark:text-slate-300 uppercase ml-1">ÎŸÎ½Î¿Î¼Î± Î¦Î±ÏÎ¼Î±ÎºÎ¿Ï…</label>
                            <div class="relative">
                                <i class="ph ph-pill absolute left-4 top-4 text-slate-400 text-xl z-10"></i>
                                <input id="medicine" type="text" placeholder="Ï€.Ï‡. Depon Maximum" 
                                       class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-2xl pl-12 pr-12 py-3.5 text-lg font-semibold focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-white placeholder-slate-400 shadow-sm" required>
                                
                                <button type="button" onclick="startVoiceInput()" id="voice-btn" title="Î¦Ï‰Î½Î·Ï„Î¹ÎºÎ® Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…" class="absolute right-3 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full border-2 border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 shadow-sm flex items-center justify-center text-xl text-slate-500 hover:text-primary hover:border-primary focus:outline-none focus:ring-2 focus:ring-primary/40 transition-all">
                                    <i id="mic-icon" class="ph ph-microphone text-xl"></i>
                                </button>
                            </div>
                            <p class="text-right text-xs font-semibold text-slate-500 dark:text-slate-300 flex items-center justify-end gap-1 mt-2">
                                <i class="ph ph-microphone text-sm"></i> Î Î±Ï„Î®ÏƒÏ„Îµ Î½Î± Î¼Î¹Î»Î®ÏƒÎµÏ„Îµ
                            </p>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-2">
                                <label class="text-xs font-bold text-slate-700 dark:text-slate-300 uppercase ml-1">Î”ÏÎ±ÏƒÏ„Î¹ÎºÎ·</label>
                                <input id="substance" type="text" placeholder="Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬" 
                                       class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-2xl px-4 py-3.5 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-white placeholder-slate-400 font-medium shadow-sm text-sm">
                            </div>
                            <div class="space-y-2">
                                <label class="text-xs font-bold text-slate-700 dark:text-slate-300 uppercase ml-1">Î Î¿ÏƒÎ¿Ï„Î·Ï„Î±</label>
                                <input id="quantity" type="number" min="1" value="1" 
                                       class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-2xl px-4 py-3.5 text-center font-bold focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-white shadow-sm">
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label class="text-xs font-bold text-slate-700 dark:text-slate-300 uppercase ml-1">Î•Î¯Î´Î¿Ï‚ / ÎœÎ¿ÏÏ†Î®</label>
                            <div class="relative">
                                <select id="med-type" class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-2xl px-4 py-3.5 appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-white font-medium shadow-sm">
                                    <option value="">Î•Ï€Î¯Î»ÎµÎ¾Îµ ÎµÎ¯Î´Î¿Ï‚ (Ï€.Ï‡. Î§Î¬Ï€Î¹Î±)</option>
                                    <option value="pills">ğŸ’Š Î§Î¬Ï€Î¹Î± / ÎšÎ¬ÏˆÎ¿Ï…Î»ÎµÏ‚</option>
                                    <option value="syrup">ğŸ§´ Î£Î¹ÏÏŒÏ€Î¹ / Î ÏŒÏƒÎ¹Î¼Î¿</option>
                                    <option value="cream">ğŸ§´ Î‘Î»Î¿Î¹Ï†Î® / ÎšÏÎ­Î¼Î±</option>
                                    <option value="inhaler">ğŸ’¨ Î•Î¹ÏƒÏ€Î½ÎµÏŒÎ¼ÎµÎ½Î¿ / Î£Ï€ÏÎ­Î¹</option>
                                    <option value="injection">ğŸ’‰ Î•Î½Î­ÏƒÎ¹Î¼Î¿</option>
                                    <option value="powder">ğŸš Î£ÎºÏŒÎ½Î· / Î¦Î±ÎºÎµÎ»Î¬ÎºÎ¹Î±</option>
                                    <option value="suppository">ğŸ’Š Î¥Ï€ÏŒÎ¸ÎµÏ„Î¿</option>
                                </select>
                                <i class="ph ph-caret-down absolute right-4 top-4 text-slate-500 pointer-events-none text-lg"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-slate-50 dark:bg-slate-800/80 rounded-2xl p-4 border-2 border-dashed border-slate-300 dark:border-slate-600 hover:border-primary/50 transition-colors">
                        <label class="text-xs font-bold text-slate-600 dark:text-slate-300 uppercase mb-3 block text-center">ğŸ“¸ Î ÏÎ¿ÏƒÎ¸Î·ÎºÎ· Î¦Ï‰Ï„Î¿ / Barcode / Î£Ï…Î½Ï„Î±Î³Î·Ï‚</label>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <input id="request-image" type="file" accept="image/*" class="hidden" onchange="handleFileSelect(this)">
                            <button type="button" onclick="document.getElementById('request-image').click()" 
                                class="flex flex-col items-center justify-center bg-white dark:bg-slate-700 hover:bg-blue-50 dark:hover:bg-slate-600 border-2 border-slate-200 dark:border-slate-600 rounded-xl p-4 transition-all hover:shadow-md group relative overflow-hidden">
                                <div class="absolute inset-0 bg-blue-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                <i class="ph ph-camera text-3xl text-slate-600 dark:text-slate-300 mb-1 group-hover:scale-110 transition-transform group-hover:text-blue-600"></i>
                                <span class="text-xs font-semibold text-slate-600 dark:text-slate-300">Î¦Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î±</span>
                            </button>

                            <button type="button" onclick="toggleScanner()" 
                                class="flex flex-col items-center justify-center bg-white dark:bg-slate-700 hover:bg-teal-50 dark:hover:bg-slate-600 border-2 border-slate-200 dark:border-slate-600 rounded-xl p-4 transition-all hover:shadow-md group relative overflow-hidden">
                                <div class="absolute inset-0 bg-teal-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                <i class="ph ph-barcode text-3xl text-slate-600 dark:text-slate-300 mb-1 group-hover:scale-110 transition-transform group-hover:text-teal-600"></i>
                                <span class="text-xs font-semibold text-slate-600 dark:text-slate-300">Scan Barcode</span>
                            </button>
                        </div>

                        <div id="scanner-container" class="hidden mt-4 rounded-xl overflow-hidden relative bg-black border-2 border-primary shadow-lg">
                            <div id="reader" class="w-full h-64"></div>
                            <button type="button" onclick="stopScanner()" class="absolute top-2 right-2 bg-white/20 text-white p-1.5 rounded-full backdrop-blur-md hover:bg-white/40 transition-colors">
                                <i class="ph ph-x text-lg"></i>
                            </button>
                        </div>

                        <div id="media-preview" class="hidden mt-3 p-3 bg-teal-50 dark:bg-teal-900/30 border border-teal-100 dark:border-teal-800 rounded-xl flex items-center gap-3 animate-fade-in">
                            <div class="bg-teal-100 dark:bg-teal-800 p-2 rounded-lg text-xl">
                                <i class="ph ph-check-circle text-teal-600 dark:text-teal-300"></i>
                            </div>
                            <div class="flex-1 overflow-hidden">
                                <p class="text-xs text-teal-800 dark:text-teal-200 font-bold">Î•Ï€Î¹Ï„Ï…Ï‡Î¯Î±!</p>
                                <p id="preview-text" class="text-xs text-teal-600 dark:text-teal-400 truncate">Barcode: 123456</p>
                            </div>
                            <button type="button" onclick="clearMedia()" class="text-teal-400 hover:text-teal-700 dark:hover:text-teal-200 p-1">
                                <i class="ph ph-trash text-lg"></i>
                            </button>
                        </div>
                        
                        <input id="barcode-value" type="hidden">
                    </div>

                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-700 dark:text-slate-300 uppercase ml-1">Î£Î·Î¼ÎµÎ¹Ï‰ÏƒÎµÎ¹Ï‚ (Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¿)</label>
                        <textarea id="notes" rows="2" placeholder="Î .Ï‡. Î ÏÎ¿Ï„Î¹Î¼Ï ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· ÎµÏ„Î±Î¹ÏÎµÎ¯Î±..." 
                                  class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-2xl px-4 py-3.5 resize-none focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-white placeholder-slate-400 font-medium shadow-sm"></textarea>
                    </div>

                    <div class="space-y-3 pt-2">
                        <label class="flex items-start gap-3 p-3 rounded-xl bg-white/60 dark:bg-slate-700/40 border border-slate-200 dark:border-slate-600 hover:bg-white/80 transition-colors cursor-pointer">
                            <input type="checkbox" class="mt-1 w-4 h-4 text-primary rounded focus:ring-primary border-gray-300" checked>
                            <span class="text-xs text-slate-600 dark:text-slate-300 leading-tight">Î”Î­Ï‡Î¿Î¼Î±Î¹ Î½Î± Î¼Î¿Ï… Ï€ÏÎ¿Ï„ÎµÎ¯Î½Î¿Ï…Î½ <strong>Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿</strong> Î±Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Ï„Î¿ Ï€ÏÏ‰Ï„ÏŒÏ„Ï…Ï€Î¿.</span>
                        </label>

                        <label class="flex items-start gap-3 px-3 cursor-pointer group">
                            <input type="checkbox" id="gdpr-check" class="mt-0.5 w-4 h-4 text-primary rounded focus:ring-primary border-gray-300" required>
                            <span class="text-xs text-slate-500 dark:text-slate-400 leading-tight group-hover:text-primary transition-colors">
                                ÎˆÏ‡Ï‰ Î´Î¹Î±Î²Î¬ÏƒÎµÎ¹ ÎºÎ±Î¹ Î±Ï€Î¿Î´Î­Ï‡Î¿Î¼Î±Î¹ Ï„Î¿Ï…Ï‚ <a href="#" data-open-modal="terms" class="underline text-primary font-semibold">ÎŒÏÎ¿Ï…Ï‚ Î§ÏÎ®ÏƒÎ·Ï‚</a> ÎºÎ±Î¹ Ï„Î·Î½ <a href="#" data-open-modal="gdpr" class="underline text-primary font-semibold">Î Î¿Î»Î¹Ï„Î¹ÎºÎ® Î‘Ï€Î¿ÏÏÎ®Ï„Î¿Ï… (GDPR)</a>.
                            </span>
                        </label>
                    </div>

                    <button type="submit" class="w-full bg-gradient-to-r from-cyan-500 to-teal-500 hover:from-cyan-600 hover:to-teal-600 text-white text-lg font-bold py-4 rounded-2xl shadow-lg shadow-teal-500/30 transform active:scale-[0.98] transition-all flex items-center justify-center gap-2">
                        <i class="ph ph-paper-plane-right text-xl"></i>
                        Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® Î‘Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚
                    </button>

                </form>
            </div>
        </div>

        <div id="tab-how" class="tab-content">
            <div class="glass-card rounded-3xl p-6">
                <h3 class="text-xl font-bold mb-6 text-slate-800 dark:text-white flex items-center gap-2">
                    <i class="ph ph-info text-primary"></i> Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯;
                </h3>
                <ul class="space-y-6">
                    <li class="flex gap-4 items-start">
                        <div class="bg-teal-100 dark:bg-teal-900 text-teal-700 dark:text-teal-300 w-10 h-10 rounded-full flex items-center justify-center font-bold flex-shrink-0 text-lg shadow-sm">1</div>
                        <div>
                            <h4 class="font-bold text-slate-800 dark:text-slate-200">Î‘Î¯Ï„Î·Î¼Î±</h4>
                            <p class="text-slate-600 dark:text-slate-400 text-sm mt-1">Î£Ï…Î¼Ï€Î»Î·ÏÏÎ½ÎµÎ¹Ï‚ Ï„Î· Ï†ÏŒÏÎ¼Î±, Î±Î½ÎµÎ²Î¬Î¶ÎµÎ¹Ï‚ Ï†Ï‰Ï„ÏŒ Î® ÏƒÎ±ÏÏÎ½ÎµÎ¹Ï‚ Ï„Î¿ barcode/ÏƒÏ…Î½Ï„Î±Î³Î®.</p>
                        </div>
                    </li>
                    <li class="flex gap-4 items-start">
                        <div class="bg-teal-100 dark:bg-teal-900 text-teal-700 dark:text-teal-300 w-10 h-10 rounded-full flex items-center justify-center font-bold flex-shrink-0 text-lg shadow-sm">2</div>
                        <div>
                            <h4 class="font-bold text-slate-800 dark:text-slate-200">Î•Î¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ·</h4>
                            <p class="text-slate-600 dark:text-slate-400 text-sm mt-1">Î¤Î¿ MediRadar ÏˆÎ¬Ï‡Î½ÎµÎ¹ ÏƒÏ„Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± ÎºÎ¿Î½Ï„Î¬ ÏƒÏ„Î·Î½ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î± ÏƒÎ¿Ï….</p>
                        </div>
                    </li>
                    <li class="flex gap-4 items-start">
                        <div class="bg-teal-100 dark:bg-teal-900 text-teal-700 dark:text-teal-300 w-10 h-10 rounded-full flex items-center justify-center font-bold flex-shrink-0 text-lg shadow-sm">3</div>
                        <div>
                            <h4 class="font-bold text-slate-800 dark:text-slate-200">ÎšÏÎ¬Ï„Î·ÏƒÎ·</h4>
                            <p class="text-slate-600 dark:text-slate-400 text-sm mt-1">Î›Î±Î¼Î²Î¬Î½ÎµÎ¹Ï‚ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚, ÎµÏ€Î¹Î»Î­Î³ÎµÎ¹Ï‚ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ ÎºÎ±Î¹ Ï€Î±ÏÎ±Î»Î±Î¼Î²Î¬Î½ÎµÎ¹Ï‚!</p>
                        </div>
                    </li>
                </ul>
            </div>
        </div>

        <div id="pickup-view" class="hidden animate-fadeIn">
            <div class="glass-card rounded-3xl p-8 text-center border-teal-200 dark:border-teal-800">
                <div class="w-24 h-24 bg-teal-100 dark:bg-teal-900/50 rounded-full flex flex-col items-center justify-center mx-auto mb-6 shadow-xl ring-8 ring-teal-50 dark:ring-teal-900/20">
                    <i class="ph ph-hourglass-high text-4xl text-primary mb-1"></i>
                    <p class="text-xs font-bold text-primary">Pickup</p>
                </div>
                
                <h2 class="text-2xl font-bold text-slate-800 dark:text-white mb-2">Î§ÏÏŒÎ½Î¿Ï‚ Î Î±ÏÎ±Î»Î±Î²Î®Ï‚</h2>
                <p class="text-slate-500 dark:text-slate-400 mb-6">ÎšÏÎ±Ï„Î®Î¸Î·ÎºÎµ Î³Î¹Î± ÎµÏƒÎ¬Ï‚ ÏƒÏ„Î¿ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿! Î Î±ÏÎ±ÎºÎ±Î»Ï Ï€Î±ÏÎ±Î»Î¬Î²ÎµÏ„Îµ ÎµÎ½Ï„ÏŒÏ‚:</p>
                
                <div class="bg-white dark:bg-slate-700 rounded-2xl p-4 mb-6 shadow-inner border border-slate-200 dark:border-slate-700">
                    <p id="timer-display" class="text-5xl font-extrabold text-primary dark:text-teal-400 tracking-tighter">
                        --:--
                    </p>
                    <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Î›ÎµÏ€Ï„Î¬</p>
                </div>

                <div class="space-y-2 mb-4">
                    <button id="extend-btn" onclick="extendPickupTime()" disabled 
                        class="w-full bg-slate-200 dark:bg-slate-700 text-slate-500 font-bold py-3 rounded-xl transition-all flex items-center justify-center gap-2 text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="ph ph-timer text-lg"></i> Î Î±ÏÎ¬Ï„Î±ÏƒÎ· 15' (Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î·)
                    </button>
                    <p id="extend-info" class="text-xs text-slate-500 dark:text-slate-400">
                        ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€Î±ÏÎ¬Ï„Î±ÏƒÎ· Î¼ÏŒÎ½Î¿ Î¼Î¯Î± Ï†Î¿ÏÎ¬ ÎºÎ¬Î¸Îµ 24 ÏÏÎµÏ‚.
                    </p>
                </div>

                <button onclick="resetApp()" class="text-sm text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 font-medium flex items-center justify-center gap-1 mx-auto">
                    <i class="ph ph-x-circle"></i> ÎŸÎ»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ·/Î‘ÎºÏÏÏ‰ÏƒÎ· Ï€Î±ÏÎ±Î»Î±Î²Î®Ï‚
                </button>
            </div>
        </div>

    </main>

    <footer class="mt-auto py-6 bg-white/50 dark:bg-slate-900/50 backdrop-blur-md border-t border-slate-200 dark:border-slate-800 z-10">
        <div class="max-w-lg mx-auto px-4 text-center">
            <div class="flex justify-center mb-4">
                <button onclick="openModal('pro')" class="pro-footer-btn" aria-label="Î ÏÏŒÏƒÎ²Î±ÏƒÎ· Pro">
                    <i class="ph ph-briefcase text-lg"></i>
                    <span class="text-xs font-semibold tracking-wide uppercase">Pro</span>
                </button>
            </div>
            <div class="flex flex-wrap justify-center gap-x-6 gap-y-2 text-xs text-slate-500 dark:text-slate-400 font-medium mb-4">
                <a href="#" data-open-modal="terms" class="hover:text-primary transition-colors">ÎŒÏÎ¿Î¹ Î§ÏÎ®ÏƒÎ·Ï‚</a>
                <a href="#" data-open-modal="gdpr" class="hover:text-primary transition-colors">Î Î¿Î»Î¹Ï„Î¹ÎºÎ® Î‘Ï€Î¿ÏÏÎ®Ï„Î¿Ï… (GDPR)</a>
                <a href="#" class="hover:text-primary transition-colors">FAQ</a>
                <a href="#" class="hover:text-primary transition-colors">Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±</a>
            </div>
            <p class="text-xs text-slate-400 dark:text-slate-600">Â© 2023 MediRadar. All rights reserved.</p>
        </div>
    </footer>

    <div id="toast-container" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50 w-full max-w-sm px-4 space-y-2 pointer-events-none"></div>

    <div id="modal-terms" class="modal-backdrop">
        <div class="modal-content bg-white dark:bg-slate-800 relative glass-card !opacity-100 !transform-none max-h-[80vh] overflow-y-auto text-left space-y-4">
            <button onclick="closeModal('terms')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors"><i class="ph ph-x text-xl"></i></button>
            <h3 class="text-2xl font-bold text-slate-800 dark:text-white">ÎŒÏÎ¿Î¹ Î§ÏÎ®ÏƒÎ·Ï‚</h3>
            <p class="text-sm text-slate-600 dark:text-slate-300">Î¤Î¿ MediRadar Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï‰Ï‚ Î¼ÎµÏƒÎ¬Î¶Ï‰Î½ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯Î±Ï‚...</p>
        </div>
    </div>

    <div id="modal-gdpr" class="modal-backdrop">
        <div class="modal-content bg-white dark:bg-slate-800 relative glass-card !opacity-100 !transform-none max-h-[80vh] overflow-y-auto text-left space-y-4">
            <button onclick="closeModal('gdpr')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors"><i class="ph ph-x text-xl"></i></button>
            <h3 class="text-2xl font-bold text-slate-800 dark:text-white">GDPR & Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ¬ Î”ÎµÎ´Î¿Î¼Î­Î½Î±</h3>
            <p class="text-sm text-slate-600 dark:text-slate-300">Î£ÎµÎ²ÏŒÎ¼Î±ÏƒÏ„Îµ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏƒÎ±Ï‚...</p>
        </div>
    </div>

    <div id="modal-user" class="modal-backdrop">
        <div class="modal-content bg-white dark:bg-slate-800 text-center relative glass-card !opacity-100 !transform-none">
            <button onclick="closeModal('user')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors"><i class="ph ph-x text-xl"></i></button>
            <div class="w-16 h-16 bg-teal-100 dark:bg-teal-900/50 rounded-full flex items-center justify-center mx-auto mb-4 text-primary ring-4 ring-teal-50 dark:ring-teal-900/20">
                <i class="ph ph-user text-3xl"></i>
            </div>
            <h3 class="text-xl font-bold mb-1 text-slate-800 dark:text-white">Î•Î¯ÏƒÎ¿Î´Î¿Ï‚ Î§ÏÎ®ÏƒÏ„Î·</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400 mb-6">Î£Ï…Î½Î´Î­ÏƒÎ¿Ï… Î³Î¹Î± Î½Î± Î²Î»Î­Ï€ÎµÎ¹Ï‚ Ï„Î¿ Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ ÏƒÎ¿Ï….</p>
            <form id="magic-link-form" class="space-y-4">
                <input id="user-email" type="email" placeholder="example@email.com" class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-xl px-4 py-3.5 focus:outline-none focus:ring-primary/50 transition-all text-slate-900 dark:text-white">
                <button type="submit" onclick="handleMagicLink(event)" class="w-full bg-primary hover:bg-teal-700 text-white font-bold py-3 rounded-xl transition-all shadow-md">
                   <i class="ph ph-magic-wand text-lg"></i> Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Magic Link
                </button>
            </form>
        </div>
    </div>

    <div id="modal-pro" class="modal-backdrop">
        <div class="modal-content bg-white dark:bg-slate-800 text-center relative glass-card !opacity-100 !transform-none">
            <button onclick="closeModal('pro')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors"><i class="ph ph-x text-xl"></i></button>
            <div class="w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4 text-white shadow-lg shadow-slate-500/30 ring-4 ring-slate-200 dark:ring-slate-700">
                <i class="ph ph-briefcase text-3xl"></i>
            </div>
            <h3 class="text-xl font-bold mb-1 text-slate-800 dark:text-white">Î•Î¯ÏƒÎ¿Î´Î¿Ï‚ Pro</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400 mb-6">Î Î»Î±Ï„Ï†ÏŒÏÎ¼Î± Î¦Î±ÏÎ¼Î±ÎºÎ¿Ï€Î¿Î¹ÏÎ½</p>
            <button class="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-3 rounded-xl transition-all shadow-lg" onclick="window.location.href='pharmacy.html'">
                ÎœÎµÏ„Î¬Î²Î±ÏƒÎ· ÏƒÏ„Î¿ Pro Panel
            </button>
        </div>
    </div>

    <script src="env.js"></script>
    <script src="supabase.js"></script>
    
    <script>
        // --- 0. Global Variables ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition = null;
        let isListening = false;
        let timerInterval = null;
        let pickupDeadline = null;
        let currentUser = null;

        // --- 1. Init Logic & Auth ---
        window.onload = async function() {
            loadUserData();
            createEmojis();
            
            // Check auth status
            if(window.db) {
                const { data: { session } } = await window.db.auth.getSession();
                if(session) {
                    currentUser = session.user;
                    showToast('ÎšÎ±Î»Ï‰ÏƒÎ®ÏÎ¸Î±Ï„Îµ Ï€Î¯ÏƒÏ‰, ' + (currentUser.email || 'Î§ÏÎ®ÏƒÏ„Î·'), 'success');
                }
            } else {
                console.error("Database connection failed");
            }
        };

        // --- 2. Submit Request (SUPABASE CONNECTED) ---
        const form = document.getElementById('request-form');
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            if(!document.getElementById('gdpr-check').checked) {
                showToast("Î ÏÎ­Ï€ÎµÎ¹ Î½Î± Î±Ï€Î¿Î´ÎµÏ‡Ï„ÎµÎ¯Ï„Îµ Ï„Î¿Ï…Ï‚ ÏŒÏÎ¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÎ·Ï‚.", 'error'); return;
            }

            if (!window.db) { showToast("Î— Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î­Ï„Î¿Î¹Î¼Î·.", 'error'); return; }

            saveUserData();
            
            // 1. Upload Media (Optional)
            let mediaUrl = null;
            const fileInput = document.getElementById('request-image');
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const fileName = `req_${Date.now()}_${file.name.replace(/[^a-zA-Z0-9.]/g, '')}`;
                
                showToast("Î‘Î½Î­Î²Î±ÏƒÎ¼Î± Ï†Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î±Ï‚...", 'info');
                const { data, error } = await window.db.storage.from('requests-media').upload(fileName, file);
                
                if(error) {
                    console.error("Upload error:", error);
                } else {
                    const { data: { publicUrl } } = window.db.storage.from('requests-media').getPublicUrl(fileName);
                    mediaUrl = publicUrl;
                }
            }

            // 2. Insert to Database
            const requestData = {
                user_id: currentUser ? currentUser.id : null, // Null if guest
                medicine_name: document.getElementById('medicine').value,
                substance: document.getElementById('substance').value,
                quantity: document.getElementById('quantity').value,
                med_type: document.getElementById('med-type').value,
                notes: document.getElementById('notes').value,
                media_url: mediaUrl,
                barcode: document.getElementById('barcode-value').value,
                location: document.getElementById('city').value,
                status: 'pending',
                created_at: new Date()
            };

            const { error: dbError } = await window.db.from('requests').insert([requestData]);

            if (dbError) {
                console.error("DB Error:", dbError);
                showToast("Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Ï€Î¿ÏƒÏ„Î¿Î»Î®: " + dbError.message, 'error');
            } else {
                showToast("Î¤Î¿ Î±Î¯Ï„Î·Î¼Î± ÏƒÏ„Î¬Î»Î¸Î·ÎºÎµ Î¼Îµ ÎµÏ€Î¹Ï„Ï…Ï‡Î¯Î±! Î‘Î½Î±Î¼Î¿Î½Î® Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï…...", 'success');
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                
                // Hide search, show waiting (UI)
                // For this demo, we assume instant "waiting mode" but realistically you'd wait for a response
                subscribeToResponses();
            }
        });

        // --- 3. Realtime Listener for Responses ---
        function subscribeToResponses() {
             window.db.channel('public:responses')
            .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'responses' }, payload => {
                showToast("ğŸ”” ÎÎ­Î± Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Î±Ï€ÏŒ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿!", 'success');
                // Here you would trigger the UI update to show the pharmacist's offer
            })
            .subscribe();
        }

        // --- 4. Helper Functions (UI, Auth, Maps) ---
        
        async function handleMagicLink(e) {
            e.preventDefault();
            const email = document.getElementById('user-email').value;
            if(!window.db) return;
            
            const { error } = await window.db.auth.signInWithOtp({ email });
            if (error) showToast(error.message, 'error');
            else {
                showToast("Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î¿ email ÏƒÎ±Ï‚ Î³Î¹Î± Ï„Î¿ Magic Link!", 'success');
                closeModal('user');
            }
        }

        // --- [Standard UI Functions from your original code] ---
        // (Toggle Theme, Lang, Modal, Toast, Geolocation, Emojis, Tabs, Scanner, FileSelect, Preview, LocalStorage, Voice)
        
        function toggleTheme() {
            const html = document.documentElement; const icon = document.getElementById('theme-icon');
            if(html.classList.contains('dark')) { html.classList.remove('dark'); icon.classList.replace('ph-sun', 'ph-moon-stars'); } 
            else { html.classList.add('dark'); icon.classList.replace('ph-moon-stars', 'ph-sun'); }
        }
        function toggleLang() { document.getElementById('lang-flag').innerText = (document.getElementById('lang-flag').innerText === 'ğŸ‡¬ğŸ‡·') ? 'ğŸ‡¬ğŸ‡§' : 'ğŸ‡¬ğŸ‡·'; }
        function openModal(t) { document.getElementById(`modal-${t}`).classList.add('active'); }
        function closeModal(t) { document.getElementById(`modal-${t}`).classList.remove('active'); }
        document.querySelectorAll('.modal-backdrop').forEach(bg => bg.addEventListener('click', (e) => { if(e.target===bg) bg.classList.remove('active'); }));
        
        function showToast(msg, type='info') {
            const c = document.getElementById('toast-container'); const id = 't-'+Date.now();
            let ic = 'ph-info text-primary', cl = 'bg-teal-50 border-teal-200';
            if(type==='success') { ic='ph-check-circle text-green-500'; cl='bg-green-50 border-green-200'; }
            if(type==='error') { ic='ph-x-circle text-red-500'; cl='bg-red-50 border-red-200'; }
            const el = document.createElement('div'); el.id=id; el.className=`toast-enter p-4 rounded-xl shadow-lg flex items-center gap-3 ${cl} border border-opacity-50 dark:bg-opacity-20`;
            el.innerHTML = `<i class="ph ${ic} text-2xl"></i><p class="text-sm font-medium text-slate-800 dark:text-slate-100">${msg}</p>`;
            c.appendChild(el); setTimeout(() => el.remove(), 4000);
        }

        // Geo
        function getLocation() {
            const city = document.getElementById('city'); city.value = "Î•Î½Ï„Î¿Ï€Î¹ÏƒÎ¼ÏŒÏ‚...";
            if (navigator.geolocation) navigator.geolocation.getCurrentPosition(
                (p) => { city.value = `ğŸ“ ${p.coords.latitude.toFixed(4)}, ${p.coords.longitude.toFixed(4)}`; saveUserData(); },
                (e) => { city.value=""; showToast("Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±.", 'warning'); }
            );
        }

        // Scanner
        let html5QrcodeScanner = null;
        function toggleScanner() {
            const c = document.getElementById('scanner-container');
            if(!c.classList.contains('hidden')) { stopScanner(); return; }
            c.classList.remove('hidden');
            html5QrcodeScanner = new Html5Qrcode("reader");
            html5QrcodeScanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, 
                (t) => { stopScanner(); document.getElementById('barcode-value').value = t; document.getElementById('preview-text').textContent = `Barcode: ${t}`; document.getElementById('media-preview').classList.remove('hidden'); },
                (e) => {}
            );
        }
        function stopScanner() { if(html5QrcodeScanner) html5QrcodeScanner.stop().then(() => { document.getElementById('scanner-container').classList.add('hidden'); html5QrcodeScanner=null; }); }

        function handleFileSelect(input) { if(input.files[0]) { document.getElementById('preview-text').textContent = input.files[0].name; document.getElementById('media-preview').classList.remove('hidden'); } }
        function clearMedia() { document.getElementById('media-preview').classList.add('hidden'); document.getElementById('request-image').value=''; }

        // Tabs
        function switchTab(t) {
            document.querySelectorAll('.tab-content').forEach(e=>e.classList.remove('active'));
            document.getElementById(`tab-${t}`).classList.add('active');
            document.getElementById('pickup-view').classList.add('hidden');
        }

        // Voice
        function startVoiceInput() {
            if(!SpeechRecognition) return showToast("ÎœÎ· ÏƒÏ…Î¼Î²Î±Ï„ÏŒ.", 'error');
            const r = new SpeechRecognition(); r.lang='el-GR'; r.start();
            r.onstart = () => showToast("Î‘ÎºÎ¿ÏÏ‰...", 'info');
            r.onresult = (e) => { document.getElementById('medicine').value = e.results[0][0].transcript; };
        }

        // Local Storage
        const LS = { N:'mr_n', P:'mr_p', C:'mr_c' };
        function loadUserData() { 
            document.getElementById('full-name').value = localStorage.getItem(LS.N)||'';
            document.getElementById('phone').value = localStorage.getItem(LS.P)||'';
            document.getElementById('city').value = localStorage.getItem(LS.C)||'';
        }
        function saveUserData() {
            localStorage.setItem(LS.N, document.getElementById('full-name').value);
            localStorage.setItem(LS.P, document.getElementById('phone').value);
            localStorage.setItem(LS.C, document.getElementById('city').value);
        }

        // Background
        function createEmojis() {
            const c = document.getElementById('emoji-container'); const em = ['ğŸ’Š','ğŸ©º','ğŸ¥','ğŸ©¹'];
            for(let i=0;i<15;i++){
                const e=document.createElement('div'); e.innerText=em[Math.floor(Math.random()*em.length)];
                e.className='emoji'; e.style.left=Math.random()*100+'%'; e.style.animationDuration=(12+Math.random()*20)+'s';
                c.appendChild(e);
            }
        }
    </script>
</body>
</html>
