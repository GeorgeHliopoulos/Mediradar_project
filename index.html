<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MediRadar</title>
  <style>
    :root {
      font-family: 'Inter', 'Noto Sans', 'Noto Sans Greek', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color: #0f172a;
      background: #eef6f6;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at 20% 20%, rgba(41,163,163,0.25), transparent 55%),
                  radial-gradient(circle at 80% 0%, rgba(248,180,180,0.3), transparent 55%),
                  linear-gradient(180deg, #f4fbfb 0%, #f8fbff 100%);
      color: #0f172a;
    }
    .page {
      width: min(1080px, 96vw);
      margin: 0 auto;
      padding: 3rem 1.5rem 4rem;
      position: relative;
      z-index: 1;
    }
    .hero {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    .hero h1 {
      font-size: clamp(2rem, 5vw, 3rem);
      margin: 0 0 0.75rem;
      color: #0d9488;
    }
    .hero p {
      margin: 0;
      color: #475569;
      font-size: 1.1rem;
    }
    .tabs {
      margin-top: 1.75rem;
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    .tab-btn {
      flex: 1 1 240px;
      border-radius: 999px;
      padding: 0.9rem 1.5rem;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      border: 1px solid rgba(14,165,233,0.4);
      color: #0f172a;
      background: rgba(255,255,255,0.8);
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease, color 0.2s ease;
    }
    .tab-btn:hover {
      transform: translateY(-1px);
      background: rgba(14,165,233,0.08);
    }
    .tab-btn.active {
      background: linear-gradient(120deg, #0ea5e9, #14b8a6);
      color: #fff;
      border-color: transparent;
      box-shadow: 0 15px 35px rgba(14,165,233,0.25);
    }
    .card {
      background: rgba(255,255,255,0.9);
      border-radius: 2rem;
      padding: clamp(1.5rem, 4vw, 2.5rem);
      box-shadow: 0 25px 60px rgba(15, 23, 42, 0.12);
      border: 1px solid rgba(15, 118, 110, 0.08);
      backdrop-filter: blur(6px);
      margin-bottom: 2rem;
    }
    .how-it-works-card {
      display: none;
      opacity: 1;
      transform: translateY(0);
    }
    .how-it-works-card h3 {
      margin-top: 0;
      margin-bottom: 0.75rem;
      font-size: 1.3rem;
    }
    .how-it-works-card p {
      margin-top: 0;
      margin-bottom: 1rem;
      color: #475569;
      line-height: 1.5;
    }
    .how-it-works-list {
      margin: 0;
      padding-left: 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      color: #0f172a;
    }
    .how-it-works-list li {
      line-height: 1.45;
    }
    form .field-grid {
      display: grid;
      gap: 1rem;
    }
    @media (min-width: 700px) {
      form .field-grid.two-cols {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
    .field {
      background: rgba(255,255,255,0.75);
      border-radius: 1.5rem;
      padding: 1rem 1.25rem 1.25rem;
      border: 1px solid rgba(148,163,184,0.4);
    }
    label span.subtitle {
      font-weight: 500;
      color: #94a3b8;
      margin-left: 0.35rem;
      font-size: 0.9rem;
    }
    label {
      font-weight: 600;
      font-size: 0.95rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    input,
    textarea,
    select {
      width: 100%;
      margin-top: 0.75rem;
      border-radius: 1rem;
      border: 1px solid rgba(148,163,184,0.8);
      padding: 0.85rem 1rem;
      font-size: 1rem;
      font-family: inherit;
      background: #fff;
      color: inherit;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    textarea {
      min-height: 120px;
      resize: vertical;
    }
    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: #14b8a6;
      box-shadow: 0 0 0 4px rgba(20,184,166,0.15);
    }
    input[type="file"] {
      padding: 0.6rem;
      border: 1px dashed rgba(14,165,233,0.6);
      background: rgba(14,165,233,0.05);
      cursor: pointer;
    }
    .help-text {
      margin: 0.5rem 0 0;
      font-size: 0.85rem;
      color: #64748b;
    }
    .checkbox-field label {
      font-weight: 500;
      gap: 0.75rem;
    }
    .checkbox-field input[type="checkbox"] {
      width: 1.15rem;
      height: 1.15rem;
    }
    .primary-btn {
      margin-top: 1.5rem;
      width: 100%;
      padding: 1rem 1.5rem;
      border: none;
      border-radius: 999px;
      font-size: 1.05rem;
      font-weight: 700;
      color: #fff;
      cursor: pointer;
      background: linear-gradient(120deg, #0ea5e9, #14b8a6);
      box-shadow: 0 15px 30px rgba(14,165,233,0.25);
      transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease;
    }
    .primary-btn:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 20px 35px rgba(14,165,233,0.3);
    }
    .primary-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .status-section {
      scroll-margin-top: 2rem;
    }
    .status-card {
      background: rgba(255,255,255,0.95);
      border-radius: 2rem;
      padding: clamp(1.75rem, 4vw, 2.5rem);
      border: 1px solid rgba(15, 23, 42, 0.08);
      box-shadow: 0 22px 45px rgba(15, 23, 42, 0.12);
    }
    .status-header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .status-chip {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.45rem 1rem;
      border-radius: 999px;
      background: rgba(14,165,233,0.12);
      color: #0369a1;
      font-weight: 600;
      border: 1px solid rgba(14,165,233,0.25);
    }
    .status-chip.chip-success {
      background: rgba(134,239,172,0.35);
      color: #166534;
      border-color: transparent;
    }
    .response-count {
      margin: 0;
      font-weight: 600;
      color: #475569;
    }
    .waiting-message {
      display: flex;
      gap: 1rem;
      align-items: center;
      padding: 1rem;
      border-radius: 1.5rem;
      background: rgba(14,165,233,0.08);
      border: 1px solid rgba(14,165,233,0.2);
      margin-bottom: 1.25rem;
    }
    .waiting-icon {
      width: 3rem;
      height: 3rem;
      border-radius: 1rem;
      background: #0ea5e9;
      display: grid;
      place-items: center;
      font-size: 1.5rem;
      color: #fff;
    }
    .waiting-title {
      margin: 0;
      font-weight: 600;
      font-size: 1.05rem;
    }
    .waiting-subtitle {
      margin: 0.1rem 0 0;
      font-size: 0.95rem;
      color: #64748b;
    }
    .media-preview {
      display: flex;
      gap: 1rem;
      align-items: center;
      padding: 0.85rem;
      border-radius: 1.25rem;
      border: 1px solid rgba(15,23,42,0.1);
      background: rgba(241,245,249,0.8);
      margin-bottom: 0.75rem;
    }
    .media-preview img {
      width: auto;
      max-height: 80px;
      border-radius: 0.85rem;
      object-fit: cover;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.15);
    }
    .media-caption {
      margin: 0;
      font-weight: 600;
      color: #0f172a;
    }
    .barcode-line {
      font-size: 0.9rem;
      color: #475569;
      margin-bottom: 1rem;
    }
    .barcode-line span {
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
      background: #e2e8f0;
      border-radius: 0.5rem;
      padding: 0.1rem 0.5rem;
    }
    .placeholder-card {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.95rem 1.1rem;
      border-radius: 1.5rem;
      border: 1px dashed rgba(148,163,184,0.7);
      color: #94a3b8;
      margin-bottom: 1rem;
    }
    .response-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1rem;
    }
    .response-card {
      border-radius: 1.5rem;
      border: 1px solid rgba(148,163,184,0.35);
      padding: 1.2rem;
      background: #f8fafc;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.4);
    }
    .response-header {
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start;
      justify-content: space-between;
      gap: 0.8rem;
    }
    .pharmacy-name {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 700;
    }
    .response-meta {
      margin: 0.15rem 0 0;
      color: #64748b;
      font-size: 0.92rem;
    }
    .availability-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.35rem 0.9rem;
      border-radius: 999px;
      font-weight: 600;
      font-size: 0.85rem;
    }
    .availability-available {
      background: rgba(134,239,172,0.5);
      color: #166534;
    }
    .availability-generic {
      background: rgba(253,230,138,0.7);
      color: #92400e;
    }
    .availability-unavailable {
      background: rgba(248,180,180,0.65);
      color: #b91c1c;
    }
    .response-notes {
      margin: 0.85rem 0 0.5rem;
      font-size: 0.95rem;
      color: #334155;
      line-height: 1.4;
    }
    .reserve-btn {
      width: 100%;
      border: none;
      border-radius: 1rem;
      padding: 0.85rem 1rem;
      font-size: 1rem;
      font-weight: 600;
      background: linear-gradient(120deg, #10b981, #0ea5e9);
      color: #fff;
      cursor: pointer;
      transition: opacity 0.2s ease, transform 0.2s ease;
    }
    .reserve-btn:hover {
      opacity: 0.95;
      transform: translateY(-1px);
    }
    .reservation-box {
      margin-top: 1.5rem;
      border-radius: 1.75rem;
      border: 1px solid rgba(16,185,129,0.35);
      background: rgba(209,250,229,0.7);
      padding: 1.25rem 1.5rem;
    }
    .reservation-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }
    .reservation-label {
      margin: 0;
      font-weight: 600;
      color: #047857;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 0.8rem;
    }
    .reservation-name {
      margin: 0.2rem 0 0;
      font-size: 1.3rem;
      font-weight: 700;
    }
    .countdown {
      font-weight: 700;
      font-size: 2.5rem;
      color: #065f46;
    }
    .reservation-meta {
      margin: 0.75rem 0 0;
      color: #065f46;
      font-size: 0.95rem;
    }
    .reservation-expired {
      margin: 0.5rem 0 0;
      color: #b91c1c;
      font-weight: 600;
    }
    .reservation-actions {
      margin-top: 1rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }
    .extend-btn {
      border: none;
      border-radius: 999px;
      padding: 0.65rem 1.3rem;
      font-weight: 600;
      background: #0f766e;
      color: #fff;
      cursor: pointer;
      transition: opacity 0.2s ease;
    }
    .extend-btn:disabled,
    .extend-btn.used {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .hidden {
      display: none !important;
    }
    @media (max-width: 600px) {
      .tabs {
        flex-direction: column;
      }
      .tab-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <main class="page">
    <header class="hero">
      <h1>ğŸ” MediRadar</h1>
      <p>Î’ÏÎµÏ‚ Î³ÏÎ®Î³Î¿ÏÎ± Ï€Î¿Î¹Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± Î­Ï‡Î¿Ï…Î½ Ï„Î¿ Ï†Î¬ÏÎ¼Î±ÎºÏŒ ÏƒÎ¿Ï… Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿.</p>
      <div class="tabs">
        <button id="tab-search" type="button" class="tab-btn active">Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Ï†Î±ÏÎ¼Î¬ÎºÎ¿Ï…</button>
        <button id="tab-how" type="button" class="tab-btn">Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯</button>
      </div>
    </header>

    <section id="how-it-works-card" class="card how-it-works-card">
      <h3>Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï„Î¿ MediRadar</h3>
      <p>Î¤Î¿ MediRadar ÏƒÏ„Î­Î»Î½ÎµÎ¹ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î¬ ÏƒÎ¿Ï… ÏƒÎµ ÎºÎ¿Î½Ï„Î¹Î½Î¬ ÏƒÏ…Î½ÎµÏÎ³Î±Î¶ÏŒÎ¼ÎµÎ½Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± ÏÏƒÏ„Îµ Î½Î± ÎºÎ¬Î½ÎµÎ¹Ï‚ self pickup Ï‡Ï‰ÏÎ¯Ï‚ Î±Î½Î±Î¼Î¿Î½Î­Ï‚.</p>
      <ol class="how-it-works-list">
        <li>ğŸ’Š Î ÎµÏÎ¹Î³ÏÎ¬Ï†ÎµÎ¹Ï‚ Ï„Î¿ Ï†Î¬ÏÎ¼Î±ÎºÎ¿ Î® Ï„ÏÎ±Î²Î¬Ï‚ Î¼Î¹Î± Ï†Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î± Ï„Î¿Ï… ÎºÎ¿Ï…Ï„Î¹Î¿Ï / barcode.</li>
        <li>ğŸª Î£Ï„Î­Î»Î½Î¿Ï…Î¼Îµ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î± ÏƒÎµ ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± Ï€Î¿Ï… ÏƒÏ…Î½ÎµÏÎ³Î¬Î¶Î¿Î½Ï„Î±Î¹ Î¼Îµ Ï„Î¿ MediRadar.</li>
        <li>âœ… Î’Î»Î­Ï€ÎµÎ¹Ï‚ Ï€Î¿Î¹Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± Ï„Î¿ Î­Ï‡Î¿Ï…Î½ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Î® Î¼Îµ Î¹ÏƒÎ¿Î´ÏÎ½Î±Î¼Î¿ (Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿).</li>
        <li>â±ï¸ ÎšÎ¬Î½ÎµÎ¹Ï‚ ÎºÏÎ¬Ï„Î·ÏƒÎ· Î³Î¹Î± self pickup Î¼Î­ÏƒÎ± ÏƒÎµ 60' ÏƒÏ„Î¿ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ Ï€Î¿Ï… ÏƒÎµ Î²Î¿Î»ÎµÏÎµÎ¹.</li>
      </ol>
    </section>

    <section id="search-card">
      <div class="card">
        <form id="request-form">
        <div class="field-grid two-cols">
          <div class="field">
            <label for="full-name">ğŸ‘¤ ÎŸÎ½Î¿Î¼Î±Ï„ÎµÏ€ÏÎ½Ï…Î¼Î¿</label>
            <input id="full-name" type="text" autocomplete="name" placeholder="Ï€.Ï‡. ÎœÎ±ÏÎ¯Î± Î Î±Ï€Î±Î´Î¿Ï€Î¿ÏÎ»Î¿Ï…" required />
          </div>
          <div class="field">
            <label for="phone">ğŸ“ Î¤Î·Î»Î­Ï†Ï‰Î½Î¿ ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚</label>
            <input id="phone" type="tel" autocomplete="tel" placeholder="69XXXXXXXX" required />
          </div>
          <div class="field">
            <label for="city">ğŸ“ Î ÏŒÎ»Î· Î® Ï€ÎµÏÎ¹Î¿Ï‡Î®</label>
            <input id="city" type="text" placeholder="Ï€.Ï‡. Î˜ÎµÏƒÏƒÎ±Î»Î¿Î½Î¯ÎºÎ·" required />
          </div>
          <div class="field">
            <label for="medicine">ğŸ’Š Î¦Î¬ÏÎ¼Î±ÎºÎ¿</label>
            <input id="medicine" type="text" placeholder="Ï€.Ï‡. Augmentin 875mg" required />
          </div>
          <div class="field">
            <label for="quantity">ğŸ“¦ Î Î¿ÏƒÏŒÏ„Î·Ï„Î±</label>
            <input id="quantity" type="number" min="1" value="1" required />
          </div>
          <div class="field">
            <label for="active-substance">ğŸ§ª Î”ÏÎ±ÏƒÏ„Î¹ÎºÎ® Î¿Ï…ÏƒÎ¯Î± <span class="subtitle">(Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬)</span></label>
            <input id="active-substance" type="text" placeholder="Ï€.Ï‡. Î Î±ÏÎ±ÎºÎµÏ„Î±Î¼ÏŒÎ»Î·" />
          </div>
        </div>
        <div class="field">
          <label for="notes">ğŸ“ Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚ Ï€ÏÎ¿Ï‚ Ï„Î¿Î½ Ï†Î±ÏÎ¼Î±ÎºÎ¿Ï€Î¿Î¹ÏŒ <span class="subtitle">(Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬)</span></label>
          <textarea id="notes" placeholder="Î“ÏÎ¬ÏˆÎµ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î¿Î´Î·Î³Î¯ÎµÏ‚, ÏÏÎµÏ‚ Ï€Î±ÏÎ¬Î´Î¿ÏƒÎ·Ï‚ Îº.Î¬."></textarea>
        </div>
        <div class="field checkbox-field">
          <label>
            <input id="allow-generic" type="checkbox" checked />
            <span>Î”Î­Ï‡Î¿Î¼Î±Î¹ Î½Î± Î¼Î¿Ï… Ï€ÏÎ¿Ï„ÎµÎ¯Î½Î¿Ï…Î½ Î¹ÏƒÎ¿Î´ÏÎ½Î±Î¼Î¿ (Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿) ÎµÏ†ÏŒÏƒÎ¿Î½ Ï‡ÏÎµÎ¹Î±ÏƒÏ„ÎµÎ¯.</span>
          </label>
        </div>
        <div class="field">
          <label for="request-image">ğŸ“· Î¦Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î± Î® barcode <span class="subtitle">(Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬)</span></label>
          <input id="request-image" type="file" accept="image/*" />
          <p class="help-text">Î¤ÏÎ¬Î²Î± Î¼Î¹Î± ÎºÎ±Î¸Î±ÏÎ® Ï†Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î± Ï„Î¿Ï… ÎºÎ¿Ï…Ï„Î¹Î¿Ï Î® Ï„Î¿Ï… barcode Î³Î¹Î± Ï€Î¹Î¿ Î³ÏÎ®Î³Î¿ÏÎ· Ï„Î±Ï…Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ·.</p>
          <input id="barcode-input" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="Î Î»Î·ÎºÏ„ÏÎ¿Î»ÏŒÎ³Î·ÏƒÎµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ barcode (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬)" />
        </div>
        <div class="field checkbox-field">
          <label>
            <input id="consent" type="checkbox" required />
            <span>Î‘Ï€Î¿Î´Î­Ï‡Î¿Î¼Î±Î¹ Ï„Î·Î½ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Ï„Ï‰Î½ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Ï‰Î½ Î¼Î¿Ï… Î³Î¹Î± Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏ‰Î¸ÎµÎ¯ Î· Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·.</span>
          </label>
        </div>
        <button id="submit-btn" type="submit" class="primary-btn">Î–Î®Ï„Î± Î±Ï€ÏŒ Ï„Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±</button>
        </form>
      </div>

      <section id="status-section" class="status-section hidden">
        <div class="status-card">
          <div class="status-header">
            <span id="waiting-chip" class="status-chip">Î‘Î½Î±Î¼Î¿Î½Î® Î±Ï€Î±Î½Ï„Î®ÏƒÎµÏ‰Î½ Î±Ï€ÏŒ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± â³</span>
            <p id="response-count" class="response-count">0 Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚</p>
          </div>
          <div id="waiting-message" class="waiting-message">
            <div class="waiting-icon">ğŸ’¬</div>
            <div>
              <p class="waiting-title">Î•Î½Î·Î¼ÎµÏÏÎ½Î¿Ï…Î¼Îµ Ï„Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± ÏƒÏ„Î·Î½ Ï€ÎµÏÎ¹Î¿Ï‡Î® ÏƒÎ¿Ï…â€¦</p>
              <p class="waiting-subtitle">Î˜Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„Î¿ÏÎ½ ÎµÎ´Ï Î¼ÏŒÎ»Î¹Ï‚ Î±Ï€Î±Î½Ï„Î®ÏƒÎ¿Ï…Î½.</p>
            </div>
          </div>
          <div id="status-media" class="media-preview hidden">
            <img id="status-image" alt="Î¦Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î± Ï€Î¿Ï… Î­ÏƒÏ„ÎµÎ¹Î»ÎµÏ‚" />
            <div>
              <p class="media-caption">Î¦Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î± Ï€Î¿Ï… Î­ÏƒÏ„ÎµÎ¹Î»ÎµÏ‚</p>
            </div>
          </div>
          <div id="status-barcode-line" class="barcode-line hidden">
            Barcode: <span id="status-barcode-value"></span>
          </div>
          <div id="demo-placeholder" class="placeholder-card">
            <span>ğŸ’ </span>
            <p>Î ÎµÏÎ¹Î¼Î­Î½Î¿Ï…Î¼Îµ Ï„Î¹Ï‚ Ï€ÏÏÏ„ÎµÏ‚ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚â€¦</p>
          </div>
          <div id="response-list" class="response-list hidden"></div>
          <div id="reservation-box" class="reservation-box hidden">
            <div class="reservation-head">
              <div>
                <p class="reservation-label">ÎšÏÎ¬Ï„Î·ÏƒÎ· Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï…</p>
                <p id="reservation-name" class="reservation-name"></p>
              </div>
              <div class="countdown" id="countdown-timer">60:00</div>
            </div>
            <p id="reservation-meta" class="reservation-meta"></p>
            <p id="reservation-expired" class="reservation-expired hidden">ÎˆÎ»Î·Î¾Îµ â°</p>
            <div class="reservation-actions">
              <button id="extend-btn" type="button" class="extend-btn" disabled>+15' Ï€Î±ÏÎ¬Ï„Î±ÏƒÎ·</button>
            </div>
          </div>
        </div>
      </section>
    </section>
  </main>

  <script src="/env.js"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <script>
    const tabSearch = document.getElementById('tab-search');
    const tabHow = document.getElementById('tab-how');
    const searchCard = document.getElementById('search-card');
    const howCard = document.getElementById('how-it-works-card');

    function showSearchView() {
      if (!tabSearch || !tabHow || !searchCard || !howCard) return;
      tabSearch.classList.add('active');
      tabHow.classList.remove('active');
      searchCard.style.display = 'block';
      howCard.style.display = 'none';
    }

    function showHowView() {
      if (!tabSearch || !tabHow || !searchCard || !howCard) return;
      tabHow.classList.add('active');
      tabSearch.classList.remove('active');
      howCard.style.display = 'block';
      searchCard.style.display = 'none';
    }

    tabSearch?.addEventListener('click', showSearchView);
    tabHow?.addEventListener('click', showHowView);

    showSearchView();

    (() => {
      const state = {
        supabase: null,
        currentRequestId: null,
        pollingTimer: null,
        responses: [],
        reservation: { active: false, extendUsed: false, expiresAt: null, pharmacy: null },
        uploadedMedia: { imageUrl: null, barcodeText: null }
      };
      let countdownInterval = null;
      const form = document.getElementById('request-form');
      const submitBtn = document.getElementById('submit-btn');
      const extendBtn = document.getElementById('extend-btn');

      if (window.SUPABASE_URL && window.SUPABASE_ANON_KEY && window.supabase) {
        state.supabase = window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);
      } else {
        console.warn('Supabase configuration missing. Check env.js.');
      }

      form.addEventListener('submit', handleSubmit);
      extendBtn.addEventListener('click', extendReservation);

      async function handleSubmit(event) {
        event.preventDefault();
        if (!state.supabase) {
          alert('Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÏƒÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Ï„Î· Î²Î¬ÏƒÎ·. ÎˆÎ»ÎµÎ³Î¾Îµ Ï„Î¿ env.js.');
          return;
        }

        const fullName = document.getElementById('full-name').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const city = document.getElementById('city').value.trim();
        const medicine = document.getElementById('medicine').value.trim();
        const quantity = Number(document.getElementById('quantity').value) || 1;
        const notes = document.getElementById('notes').value.trim();
        const allowGeneric = document.getElementById('allow-generic').checked;
        const consent = document.getElementById('consent').checked;
        const activeSubstance = document.getElementById('active-substance').value.trim();
        const barcodeText = document.getElementById('barcode-input').value.trim();
        const imageInput = document.getElementById('request-image');
        const file = imageInput.files[0];

        if (!fullName || !phone || !city || !medicine) {
          alert('Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ ÏŒÎ»Î± Ï„Î± Ï…Ï€Î¿Ï‡ÏÎµÏ‰Ï„Î¹ÎºÎ¬ Ï€ÎµÎ´Î¯Î±.');
          return;
        }
        if (!consent) {
          alert('Î§ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î½Î± Î±Ï€Î¿Î´ÎµÏ‡Ï„ÎµÎ¯Ï‚ Ï„Î·Î½ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Ï„Ï‰Î½ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Ï‰Î½.');
          return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Î£Ï„Î­Î»Î½Î¿Ï…Î¼Îµ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î±â€¦';

        stopPolling();
        clearCountdown();
        resetStatusCard();

        const requestId = crypto.randomUUID();
        let imageUrl = null;

        try {
          if (file) {
            imageUrl = await uploadRequestImage(file, requestId);
          }
        } catch (error) {
          console.error('Image upload failed', error);
          alert('Î”ÎµÎ½ Î®Ï„Î±Î½ Î´Ï…Î½Î±Ï„Î® Î· Î±Ï€Î¿ÏƒÏ„Î¿Î»Î® Ï„Î·Ï‚ Ï†Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î±Ï‚. ÎœÏ€Î¿ÏÎµÎ¯Ï‚ Î½Î± Ï…Ï€Î¿Î²Î¬Î»ÎµÎ¹Ï‚ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î± Ï‡Ï‰ÏÎ¯Ï‚ ÎµÎ¹ÎºÏŒÎ½Î±.');
        }

        const payload = {
          id: requestId,
          customer_name: fullName,
          phone,
          city,
          medicine_name: medicine,
          quantity,
          notes: notes || null,
          allow_generic: allowGeneric,
          active_substance: activeSubstance || null,
          image_url: imageUrl,
          barcode_text: barcodeText || null,
          status: 'pending',
          created_at: new Date().toISOString()
        };

        try {
          const { data, error } = await state.supabase.from('requests').insert(payload).select().single();
          if (error) throw error;
          state.currentRequestId = data?.id || requestId;
          state.uploadedMedia = { imageUrl, barcodeText: barcodeText || null };
          updateMediaPreview();
          updateResponseCount(0);
          showStatusSection();
          startPolling(state.currentRequestId);
          fireConfetti();
          form.reset();
          imageInput.value = '';
        } catch (error) {
          console.error('Request insert failed', error);
          alert('ÎšÎ¬Ï„Î¹ Ï€Î®Î³Îµ ÏƒÏ„ÏÎ±Î²Î¬. Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿.');
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = 'Î–Î®Ï„Î± Î±Ï€ÏŒ Ï„Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±';
        }
      }

      async function uploadRequestImage(file, requestId) {
        const safeName = (file.name || 'photo.jpg').toLowerCase().replace(/[^a-z0-9.\-_]/g, '-');
        const path = `requests/${requestId}/${Date.now()}-${safeName}`;
        const storage = state.supabase.storage.from('request-images');
        const { error } = await storage.upload(path, file, {
          cacheControl: '3600',
          upsert: false,
          contentType: file.type || 'image/jpeg'
        });
        if (error) throw error;
        const { data } = storage.getPublicUrl(path);
        return data?.publicUrl || null;
      }

      function startPolling(requestId) {
        stopPolling();
        if (!requestId || !state.supabase) return;
        fetchResponses();
        state.pollingTimer = setInterval(fetchResponses, 5000);
      }

      function stopPolling() {
        if (state.pollingTimer) {
          clearInterval(state.pollingTimer);
          state.pollingTimer = null;
        }
      }

      async function fetchResponses() {
        if (!state.supabase || !state.currentRequestId || state.reservation.active) return;
        const { data, error } = await state.supabase
          .from('responses')
          .select('*')
          .eq('request_id', state.currentRequestId)
          .order('created_at', { ascending: true });
        if (error) {
          console.error('Responses fetch error', error);
          return;
        }
        state.responses = data || [];
        renderResponses();
      }

      function renderResponses() {
        const list = document.getElementById('response-list');
        list.innerHTML = '';
        const hasResponses = state.responses.length > 0;
        document.getElementById('waiting-message').classList.toggle('hidden', hasResponses);
        document.getElementById('demo-placeholder').classList.toggle('hidden', hasResponses);
        updateResponseCount(state.responses.length);
        list.classList.toggle('hidden', !hasResponses);
        if (!hasResponses) {
          updateChipState();
          return;
        }
        state.responses.forEach(resp => list.appendChild(createResponseCard(resp)));
        updateChipState();
      }

      function createResponseCard(resp) {
        const card = document.createElement('article');
        card.className = 'response-card';
        const availability = formatAvailability(resp.availability);
        const meta = formatMetaLine(resp);
        const notes = resp.notes?.trim() ? resp.notes.trim() : 'Î§Ï‰ÏÎ¯Ï‚ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚.';
        card.innerHTML = `
          <div class="response-header">
            <div>
              <p class="pharmacy-name">${resp.pharmacy_name || 'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿'}</p>
              ${meta ? `<p class="response-meta">${meta}</p>` : ''}
            </div>
            <span class="availability-pill ${availability.className}">${availability.label}</span>
          </div>
          <p class="response-notes">${notes}</p>
          <button type="button" class="reserve-btn">ÎšÏÎ¬Ï„Î·ÏƒÎ· ÏƒÎµ Î±Ï…Ï„ÏŒ Ï„Î¿ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿</button>
        `;
        card.querySelector('.reserve-btn').addEventListener('click', () => handleReservation(resp));
        return card;
      }

      async function handleReservation(resp) {
        const confirmed = confirm(`Î˜Î­Î»ÎµÎ¹Ï‚ Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏÏƒÎ¿Ï…Î¼Îµ Ï„Î·Î½ ÎºÏÎ¬Ï„Î·ÏƒÎ· ÏƒÏ„Î¿ ${resp.pharmacy_name || 'Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿'};`);
        if (!confirmed) return;
        stopPolling();
        const pickupUntil = new Date(Date.now() + 60 * 60 * 1000).toISOString();
        state.reservation = { active: true, extendUsed: false, expiresAt: pickupUntil, pharmacy: resp };
        try {
          if (state.supabase) {
            await state.supabase
              .from('requests')
              .update({
                status: 'reserved',
                chosen_pharmacy_id: resp.pharmacy_id ?? resp.id ?? null,
                chosen_pharmacy_name: resp.pharmacy_name ?? null,
                pickup_until: pickupUntil
              })
              .eq('id', state.currentRequestId);
          }
        } catch (error) {
          console.warn('Reservation update failed', error);
        }
        showReservationBox(resp, pickupUntil);
      }

      function showReservationBox(resp, pickupUntil) {
        const box = document.getElementById('reservation-box');
        document.getElementById('reservation-name').textContent = resp.pharmacy_name || 'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿';
        const meta = formatMetaLine(resp);
        const metaEl = document.getElementById('reservation-meta');
        if (meta) {
          metaEl.textContent = meta;
          metaEl.classList.remove('hidden');
        } else {
          metaEl.textContent = '';
          metaEl.classList.add('hidden');
        }
        document.getElementById('reservation-expired').classList.add('hidden');
        document.getElementById('response-list').classList.add('hidden');
        document.getElementById('demo-placeholder').classList.add('hidden');
        document.getElementById('waiting-message').classList.add('hidden');
        box.classList.remove('hidden');
        extendBtn.disabled = false;
        extendBtn.classList.remove('used');
        startCountdown(pickupUntil);
        updateChipState();
      }

      function startCountdown(isoString) {
        clearCountdown();
        const timerEl = document.getElementById('countdown-timer');
        const expiredEl = document.getElementById('reservation-expired');
        function tick() {
          const diff = new Date(isoString).getTime() - Date.now();
          if (diff <= 0) {
            timerEl.textContent = '00:00';
            expiredEl.classList.remove('hidden');
            clearCountdown();
            return;
          }
          const mins = Math.floor(diff / 1000 / 60);
          const secs = Math.floor((diff / 1000) % 60);
          timerEl.textContent = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }
        tick();
        countdownInterval = setInterval(tick, 1000);
      }

      function clearCountdown() {
        if (countdownInterval) {
          clearInterval(countdownInterval);
          countdownInterval = null;
        }
      }

      async function extendReservation() {
        if (!state.reservation.active || state.reservation.extendUsed) return;
        const newIso = new Date(new Date(state.reservation.expiresAt).getTime() + 15 * 60 * 1000).toISOString();
        state.reservation.extendUsed = true;
        state.reservation.expiresAt = newIso;
        extendBtn.disabled = true;
        extendBtn.classList.add('used');
        startCountdown(newIso);
        try {
          if (state.supabase && state.currentRequestId) {
            await state.supabase
              .from('requests')
              .update({ pickup_until: newIso })
              .eq('id', state.currentRequestId);
          }
        } catch (error) {
          console.warn('Extend update failed', error);
        }
      }

      function resetStatusCard() {
        state.responses = [];
        state.reservation = { active: false, extendUsed: false, expiresAt: null, pharmacy: null };
        document.getElementById('response-list').innerHTML = '';
        document.getElementById('response-list').classList.add('hidden');
        document.getElementById('reservation-box').classList.add('hidden');
        document.getElementById('waiting-message').classList.remove('hidden');
        document.getElementById('demo-placeholder').classList.remove('hidden');
        document.getElementById('waiting-chip').classList.remove('chip-success');
        document.getElementById('waiting-chip').textContent = 'Î‘Î½Î±Î¼Î¿Î½Î® Î±Ï€Î±Î½Ï„Î®ÏƒÎµÏ‰Î½ Î±Ï€ÏŒ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± â³';
        document.getElementById('reservation-expired').classList.add('hidden');
        extendBtn.disabled = true;
        extendBtn.classList.remove('used');
        state.uploadedMedia = { imageUrl: null, barcodeText: null };
        updateMediaPreview();
      }

      function updateMediaPreview() {
        const wrapper = document.getElementById('status-media');
        const barcodeLine = document.getElementById('status-barcode-line');
        const barcodeValue = document.getElementById('status-barcode-value');
        const img = document.getElementById('status-image');
        if (state.uploadedMedia.imageUrl) {
          wrapper.classList.remove('hidden');
          img.src = state.uploadedMedia.imageUrl;
        } else {
          wrapper.classList.add('hidden');
          img.removeAttribute('src');
        }
        if (state.uploadedMedia.barcodeText) {
          barcodeLine.classList.remove('hidden');
          barcodeValue.textContent = state.uploadedMedia.barcodeText;
        } else {
          barcodeLine.classList.add('hidden');
          barcodeValue.textContent = '';
        }
      }

      function updateResponseCount(count) {
        const label = count === 1 ? '1 Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·' : `${count} Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚`;
        document.getElementById('response-count').textContent = label;
      }

      function showStatusSection() {
        const section = document.getElementById('status-section');
        section.classList.remove('hidden');
        section.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }

      function updateChipState() {
        const chip = document.getElementById('waiting-chip');
        if (state.reservation.active) {
          chip.textContent = 'ÎšÏÎ¬Ï„Î·ÏƒÎ· Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï… âœ…';
          chip.classList.add('chip-success');
        } else if (state.responses.length) {
          chip.textContent = 'Î›Î¬Î²Î±Î¼Îµ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± âœ…';
          chip.classList.add('chip-success');
        } else {
          chip.textContent = 'Î‘Î½Î±Î¼Î¿Î½Î® Î±Ï€Î±Î½Ï„Î®ÏƒÎµÏ‰Î½ Î±Ï€ÏŒ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± â³';
          chip.classList.remove('chip-success');
        }
      }

      function formatAvailability(value) {
        switch (value) {
          case 'available':
            return { label: 'Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿', className: 'availability-available' };
          case 'generic':
            return { label: 'Î“ÎµÎ½ÏŒÏƒÎ·Î¼Î¿', className: 'availability-generic' };
          case 'unavailable':
            return { label: 'ÎŒÏ‡Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿', className: 'availability-unavailable' };
          default:
            return { label: 'Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ·', className: 'availability-available' };
        }
      }

      function formatMetaLine(resp) {
        const parts = [];
        if (resp.area) parts.push(resp.area);
        if (resp.distance_label) parts.push(resp.distance_label);
        return parts.join(' â€¢ ');
      }

      function fireConfetti() {
        if (typeof confetti === 'function') {
          confetti({
            particleCount: 80,
            spread: 60,
            origin: { y: 0.6 }
          });
        }
      }
    })();
  </script>
</body>
</html>
