<!DOCTYPE html>
<html lang="el" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MediRadar</title>

  <!-- Fonts: Inter (body) + Manrope (headings) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Manrope:wght@600;700&display=swap" rel="stylesheet">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter','ui-sans-serif','system-ui'], display:['Manrope','Inter','ui-sans-serif'] },
          colors: {
            brand: { 50:'#e6f6f6',200:'#a3e0df',300:'#79cfcf',400:'#4fbcbc',500:'#29a3a3',600:'#208181',700:'#196464',800:'#134b4b' },
            accent: { pink:'#F78DA7', blue:'#84C5F4', purple:'#C3A6F4', yellow:'#FFE08A', mint:'#9DE0D6' }
          },
          boxShadow: { soft:'0 12px 28px rgba(15,23,42,.10)'},
          spacing: { 1:'4px', 2:'8px', 3:'12px', 4:'16px', 6:'24px', 8:'32px', 10:'40px' }
        }
      }
    }
  </script>

  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#29a3a3" />
  <link rel="icon" href="/icons/icon-192.png" sizes="192x192">

  <style>
    :root{
      --fadeBg:#f7fbfb;
      --fadeDark:#0b1515;
    }

    /* Colorful, gradually fading background (LIGHT, πιο έντονο) */
    .app-bg{
      background-attachment: fixed;
      background-image:
        radial-gradient(900px 520px at 50% -10%, rgba(132,197,244,.45), transparent 60%),
        radial-gradient(800px 480px at 10% 10%,  rgba(199,166,244,.35), transparent 55%),
        radial-gradient(900px 520px at 90% 20%,  rgba(247,141,167,.30), transparent 60%),
        radial-gradient(800px 460px at 20% 120%, rgba(157,224,214,.30), transparent 60%),
        linear-gradient(180deg, var(--fadeBg), #f5fafc 40%, #f7fafc);
    }
    /* Dark variant (πιο έντονο) */
    .dark .app-bg{
      background-attachment: fixed;
      background-image:
        radial-gradient(900px 520px at 50% -10%, rgba(132,197,244,.35), transparent 60%),
        radial-gradient(800px 480px at 10% 10%,  rgba(199,166,244,.28), transparent 55%),
        radial-gradient(900px 520px at 90% 20%,  rgba(247,141,167,.24), transparent 60%),
        radial-gradient(800px 460px at 20% 120%, rgba(157,224,214,.22), transparent 60%),
        linear-gradient(180deg, var(--fadeDark), #091010 45%, #091010);
    }

    .icon-emoji{ filter: drop-shadow(0 1px 0 rgba(0,0,0,.06)); }
    /* Μόνο για SVG που δεν θέλουν σκιά (π.χ. γενόσημο) */
    .no-shadow{ filter:none !important; }

    /* Autocomplete dropdown */
    .ac-list{ position:absolute; inset-inline:0; top:100%; z-index:30; }
    .ac-item{ cursor:pointer; }

    /* Scanner overlay frame */
    .scan-frame::after{
      content:''; position:absolute; inset:8%; border:3px solid rgba(255,255,255,.85);
      border-radius:16px; box-shadow:0 0 0 100vmax rgba(0,0,0,.25); pointer-events:none;
    }

    /* Toast base animation */
    .toast-enter{ opacity:0; transform: translate(-50%,10px); }
    .toast-enter-active{ opacity:1; transform: translate(-50%,0); transition:.18s ease-out; }
    .toast-exit{ opacity:1; }
    .toast-exit-active{ opacity:0; transition:.25s ease-in; }
  </style>
</head>
<body class="app-bg text-slate-900 dark:text-slate-200 font-sans min-h-full selection:bg-brand-200/60">
  <!-- Header -->
  <header class="sticky top-0 z-40 bg-white/70 dark:bg-slate-900/70 backdrop-blur border-b border-slate-200/70 dark:border-slate-800">
    <div class="mx-auto max-w-4xl px-4 sm:px-6 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-2xl bg-brand-500 text-white grid place-items-center shadow-inner">
          <svg viewBox="0 0 24 24" class="w-5 h-5"><path fill="currentColor" d="M11 2h2v3.06A7 7 0 0 1 18.94 11H22v2h-3.06A7 7 0 0 1 13 18.94V22h-2v-3.06A7 7 0 0 1 5.06 13H2v-2h3.06A7 7 0 0 1 11 5.06V2Zm1 5a5 5 0 1 0 0 10a5 5 0 0 0 0-10Z"/></svg>
        </div>
        <span class="text-xl font-display font-bold tracking-tight">MediRadar</span>
      </div>

      <div class="flex items-center gap-2">
        <!-- Language -->
        <div class="flex items-center rounded-xl overflow-hidden bg-slate-900/5 dark:bg-white/10 border border-slate-200/60 dark:border-slate-700">
          <button id="lang-el" class="px-2 py-1.5 text-xs font-semibold bg-slate-900/5 dark:bg-white/10 flex items-center gap-1" title="Ελληνικά">
            <!-- Greek flag (accurate) -->
            <svg width="14" height="10" viewBox="0 0 27 18" class="icon-emoji" aria-hidden="true">
              <rect width="27" height="18" fill="#0D5EAF"/>
              <g fill="#fff"><rect y="2" width="27" height="2"/><rect y="6" width="27" height="2"/><rect y="10" width="27" height="2"/><rect y="14" width="27" height="2"/></g>
              <rect width="10" height="10" fill="#0D5EAF"/><rect x="4" width="2" height="10" fill="#fff"/><rect y="4" width="10" height="2" fill="#fff"/>
            </svg> EL
          </button>
          <button id="lang-en" class="px-2 py-1.5 text-xs font-semibold opacity-90 hover:opacity-100 flex items-center gap-1" title="English">
            <svg width="14" height="10" viewBox="0 0 28 20" class="icon-emoji" aria-hidden="true">
              <rect width="28" height="20" fill="#012169"/>
              <path d="M0,0 L28,20 M28,0 L0,20" stroke="#fff" stroke-width="5"/>
              <path d="M0,0 L28,20 M28,0 L0,20" stroke="#C8102E" stroke-width="3"/>
              <rect x="11" width="6" height="20" fill="#fff"/><rect y="7" width="28" height="6" fill="#fff"/>
              <rect x="12" width="4" height="20" fill="#C8102E"/><rect y="8" width="28" height="4" fill="#C8102E"/>
            </svg> EN
          </button>
        </div>

        <!-- Theme -->
        <button id="theme-toggle" class="px-2 py-1.5 rounded-xl hover:bg-slate-900/5 dark:hover:bg-white/10 flex items-center gap-1" title="Light / Dark">
          <svg id="icon-sun" viewBox="0 0 24 24" class="w-5 h-5 hidden icon-emoji" aria-hidden="true">
            <circle cx="12" cy="12" r="4.5" fill="#FFD064"/><g stroke="#FFD064" stroke-width="2" stroke-linecap="round">
              <path d="M12 2v3"/><path d="M12 19v3"/><path d="M2 12h3"/><path d="M19 12h3"/><path d="M4.2 4.2l2.2 2.2"/><path d="M17.6 17.6l2.2 2.2"/><path d="M19.8 4.2l-2.2 2.2"/><path d="M6.4 17.6l-2.2 2.2"/>
            </g>
          </svg>
          <svg id="icon-moon" viewBox="0 0 24 24" class="w-5 h-5 icon-emoji" aria-hidden="true"><path d="M12 2a9.5 9.5 0 1 0 8 15.5A8 8 0 0 1 12 2Z" fill="#C9D6FF"/></svg>
          <span class="sr-only">Theme</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="mx-auto max-w-4xl px-4 sm:px-6 pt-6 pb-24">
    <!-- Hero -->
    <section class="mb-6">
      <div class="rounded-2xl bg-gradient-to-br from-brand-500 to-brand-600 text-white shadow-soft p-5 sm:p-6">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-2xl bg-white/15 grid place-items-center">
            <svg viewBox="0 0 24 24" class="w-6 h-6 icon-emoji" aria-hidden="true">
              <circle cx="10.5" cy="10.5" r="6" fill="#B3E5FC" stroke="#ffffff" stroke-width="1.5"/>
              <path d="M14.5 14.5l4.7 4.7" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
          <div>
            <h1 id="t-title" class="font-display leading-[1.2] text-2xl sm:text-3xl font-bold">Αναζήτηση Φαρμάκου</h1>
            <p id="t-subtitle" class="mt-1 text-white/85 text-sm">Βρες άμεσα διαθεσιμότητα σε κοντινά φαρμακεία.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Form -->
    <section aria-labelledby="form-title">
      <form id="medicine-form" class="grid grid-cols-1 gap-4 sm:gap-5">
        <!-- Medicine name + autocomplete -->
        <div class="rounded-xl bg-white/90 dark:bg-slate-900/60 backdrop-blur shadow-soft border border-slate-200/70 dark:border-slate-800 p-4">
          <label for="medicine-name" class="text-sm font-semibold flex items-center gap-2">
            <svg class="w-6 h-6 icon-emoji" viewBox="0 0 24 24" aria-hidden="true">
              <rect x="2" y="9" width="20" height="6" rx="3" fill="#FFCDD2" stroke="#fff" stroke-width="1"/>
              <rect x="2" y="9" width="10" height="6" rx="3" fill="#E53935"/>
            </svg>
            <span id="t-medname">Όνομα Φαρμάκου</span>
          </label>
          <div class="mt-2 relative">
            <input id="medicine-name" type="text" autocomplete="off"
              class="w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-300 focus:border-brand-500 placeholder:text-slate-400 dark:placeholder:text-slate-400/80"
              placeholder="π.χ. Augmentin 875mg" />
            <div id="ac-medicine" class="ac-list hidden rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-lg">
              <!-- suggestions injected here -->
            </div>
          </div>
          <p class="mt-2 text-xs text-slate-500 dark:text-slate-400">Συμβουλή φορμάτ: <em>Εμπορική ονομασία + δοσολογία (π.χ. “500mg”)</em></p>
        </div>

        <!-- Active substance + autocomplete -->
        <div class="rounded-xl bg-white/90 dark:bg-slate-900/60 backdrop-blur shadow-soft border border-slate-200/70 dark:border-slate-800 p-4">
          <label for="active-substance" class="text-sm font-semibold flex items-center gap-2">
            <svg class="w-6 h-6 icon-emoji" viewBox="0 0 24 24" aria-hidden="true">
              <rect x="7" y="2" width="10" height="3" rx="1.5" fill="#80DEEA"/><rect x="9" y="5" width="6" height="12" rx="2" fill="#B2DFDB"/>
              <rect x="9" y="12" width="6" height="5" rx="2" fill="#26A69A"/>
            </svg>
            <span><span id="t-substance">Δραστική Ουσία</span> <span class="text-slate-400">(προαιρετικά)</span></span>
          </label>
          <div class="mt-2 relative">
            <input id="active-substance" type="text" autocomplete="off"
              class="w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-300 focus:border-brand-500 placeholder:text-slate-400 dark:placeholder:text-slate-400/80"
              placeholder="π.χ. Παρακεταμόλη" />
            <div id="ac-substance" class="ac-list hidden rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-lg"></div>
          </div>
          <p class="mt-2 text-xs text-slate-500 dark:text-slate-400">Παράδειγμα δοσολογίας: <em>Paracetamol 500mg</em></p>
        </div>

        <!-- Type -->
        <div class="rounded-xl bg-white/90 dark:bg-slate-900/60 backdrop-blur shadow-soft border border-slate-200/70 dark:border-slate-800 p-4">
          <label for="medicine-type" class="text-sm font-semibold flex items-center gap-2">
            <svg class="w-6 h-6 icon-emoji" viewBox="0 0 24 24" aria-hidden="true">
              <rect x="4" y="3" width="16" height="18" rx="3" fill="#90CAF9"/>
              <g fill="#fff"><circle cx="9" cy="8" r="1.6"/><circle cx="15" cy="8" r="1.6"/><circle cx="9" cy="13" r="1.6"/><circle cx="15" cy="13" r="1.6"/></g>
            </svg>
            <span id="t-type">Τύπος Φαρμάκου</span>
          </label>
          <select id="medicine-type" required class="mt-2 w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-300 focus:border-brand-500">
            <option value="">— Επιλογή —</option>
            <option>Σκόνη</option><option>Υγρό</option><option>Χάπι</option><option>Δερματική Κρέμα</option><option>Αλοιφή</option>
          </select>
        </div>

        <!-- Quantity -->
        <div class="rounded-xl bg-white/90 dark:bg-slate-900/60 backdrop-blur shadow-soft border border-slate-200/70 dark:border-slate-800 p-4">
          <label for="quantity" class="text-sm font-semibold flex items-center gap-2">
            <svg class="w-6 h-6 icon-emoji" viewBox="0 0 24 24" aria-hidden="true">
              <rect x="3" y="12" width="8" height="7" rx="2" fill="#FFCC80"/><rect x="13" y="12" width="8" height="7" rx="2" fill="#FFB74D"/><rect x="8" y="5" width="8" height="7" rx="2" fill="#FFA726"/>
            </svg>
            <span id="t-qty">Ποσότητα (τεμάχια/κουτιά)</span>
          </label>
          <input id="quantity" type="number" min="1" required
                 class="mt-2 w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-300 focus:border-brand-500"
                 placeholder="π.χ. 1" />
        </div>

        <!-- Generic (SVG χωρίς σκιά) -->
        <div class="rounded-xl bg-white/90 dark:bg-slate-900/60 backdrop-blur shadow-soft border border-slate-200/70 dark:border-slate-800 p-4">
          <p class="text-sm font-semibold flex items-center gap-2">
            <svg class="w-6 h-6 no-shadow" viewBox="0 0 24 24" aria-hidden="true">
              <defs>
                <linearGradient id="g-ok" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0%"  stop-color="#34D399"/>
                  <stop offset="100%" stop-color="#10B981"/>
                </linearGradient>
              </defs>
              <circle cx="12" cy="12" r="10" fill="url(#g-ok)"/>
              <path d="M7.5 12.5l3 3l6-6.5" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span id="t-genericQ">Αν δεν υπάρχει το φάρμακο, να προταθεί γενόσημο;</span>
          </p>
          <div class="mt-3 flex gap-4">
            <label class="inline-flex items-center gap-2"><input type="radio" name="allow-generic" value="ΝΑΙ" required class="size-4 accent-brand-600"><span id="t-yes">ΝΑΙ</span></label>
            <label class="inline-flex items-center gap-2"><input type="radio" name="allow-generic" value="ΟΧΙ" class="size-4 accent-brand-600"><span id="t-no">ΟΧΙ</span></label>
          </div>
        </div>

        <!-- City -->
        <div class="rounded-xl bg-white/90 dark:bg-slate-900/60 backdrop-blur shadow-soft border border-slate-200/70 dark:border-slate-800 p-4">
          <label for="city" class="text-sm font-semibold flex items-center gap-2">
            <svg class="w-6 h-6 icon-emoji" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 22s7-7.2 7-12a7 7 0 1 0-14 0c0 4.8 7 12 7 12Z" fill="#B39DDB"/><circle cx="12" cy="10" r="2.7" fill="#fff"/></svg>
            <span id="t-city">Πόλη</span>
          </label>
          <select id="city" required class="mt-2 w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-300 focus:border-brand-500">
            <option value="">— Επιλογή —</option>
            <option>Αθήνα</option><option>Θεσσαλονίκη</option><option>Πάτρα</option>
            <option>Ηράκλειο</option><option>Λάρισα</option><option>Βόλος</option>
            <option>Ιωάννινα</option><option>Χανιά</option><option>Καλαμάτα</option>
            <option>Καβάλα</option><option>Ξάνθη</option><option>Κομοτηνή</option>
            <option>Σέρρες</option><option>Ρόδος</option><option>Κέρκυρα</option>
            <option>Τρίκαλα</option><option>Λαμία</option><option>Αλεξανδρούπολη</option>
            <option>Αγρίνιο</option><option>Χαλκίδα</option>
          </select>
        </div>

        <!-- RX + scan (overlay + torch) -->
        <div class="rounded-xl bg-white/90 dark:bg-slate-900/60 backdrop-blur shadow-soft border border-slate-200/70 dark:border-slate-800 p-4">
          <label for="rx-number" class="text-sm font-semibold flex items-center gap-2">
            <svg class="w-6 h-6 icon-emoji" viewBox="0 0 24 24" aria-hidden="true">
              <rect x="3" y="5" width="18" height="14" rx="2" fill="#ECEFF1"/><g stroke="#263238" stroke-width="1.5"><path d="M6 7v10M9 7v10M11 7v10M14 7v10M16 7v10M18 7v10"/></g>
            </svg>
            <span id="t-rx">Προαιρετικά: Αριθμός Συνταγής</span>
          </label>
          <p id="t-rxHelp" class="mt-1 text-xs text-slate-500 dark:text-slate-400">Βοηθά το φαρμακείο να εντοπίσει γρήγορα σωστό σκεύασμα/δοσολογία.</p>
          <div class="mt-2 grid gap-2 sm:grid-cols-[1fr_auto_auto]">
            <input id="rx-number" type="text"
              class="w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-300 focus:border-brand-500 placeholder:text-slate-400 dark:placeholder:text-slate-400/80"
              placeholder="π.χ. 0123-456789-00" inputmode="numeric" />
            <button type="button" id="scan-barcode" class="px-4 py-3 rounded-xl bg-brand-600 text-white font-semibold hover:bg-brand-700"><span id="t-scan">Σάρωση barcode</span></button>
            <button type="button" id="toggle-torch" class="px-4 py-3 rounded-xl bg-slate-800/80 text-white font-semibold hover:bg-slate-800 hidden">🔦</button>
          </div>
          <div id="scan-area" class="mt-3 hidden relative">
            <video id="preview" playsinline class="w-full rounded-xl border border-slate-200 dark:border-slate-700"></video>
            <div class="absolute inset-0 scan-frame pointer-events-none"></div>
            <p id="t-scanHint" class="text-xs text-slate-500 dark:text-slate-400 mt-1">Στόχευσε τον γραμμωτό κώδικα της συνταγής.</p>
            <div class="mt-2 flex gap-2">
              <button type="button" id="stop-scan" class="px-3 py-2 rounded-xl bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-slate-100 text-sm font-semibold hover:bg-slate-300 dark:hover:bg-slate-600"><span id="t-stop">Τερματισμός</span></button>
            </div>
          </div>
        </div>

        <!-- GDPR -->
        <div class="rounded-xl bg-white/90 dark:bg-slate-900/60 backdrop-blur shadow-soft border border-slate-200/70 dark:border-slate-800 p-4">
          <label class="inline-flex items-start gap-3">
            <input id="gdpr-checkbox" type="checkbox" required class="mt-0.5 size-5 accent-brand-600">
            <span class="text-sm leading-6"><span id="t-gdprShort">Αποδέχομαι τους</span> <button type="button" id="gdpr-open" class="underline text-brand-700 dark:text-brand-300 hover:opacity-80">Όρους Αναζήτησης & GDPR</button>.</span>
          </label>
        </div>

        <!-- Submit -->
        <div class="flex justify-end">
          <button id="t-submit" type="submit" class="px-5 py-3 rounded-xl bg-gradient-to-r from-brand-500 to-brand-600 text-white font-semibold shadow-soft hover:opacity-95 focus:outline-none focus:ring-4 focus:ring-brand-300">Υποβολή Αναζήτησης</button>
        </div>
      </form>
    </section>

    <!-- Results (mock) + 1-tap reserve -->
    <section id="results" class="mt-6 hidden">
      <h2 class="font-display text-xl leading-[1.25] mb-3">Αποτελέσματα</h2>
      <div class="grid gap-3">
        <div class="rounded-xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200/70 dark:border-slate-800 p-4 flex items-center justify-between">
          <div class="flex items-center gap-3">
            <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f48a.png" alt="" class="w-10 h-10" />
            <div>
              <div class="font-semibold">Φαρμακείο Ιάκωβος</div>
              <div class="text-xs text-slate-500 dark:text-slate-400">2.1km · Έτοιμο σε 20’</div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-sm px-2 py-1 rounded-lg bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-200 hidden" id="hold-badge">Δεσμευμένο: <span id="hold-ttl">59:59</span></span>
            <button id="reserve-btn" class="px-4 py-2 rounded-xl bg-emerald-600 text-white font-semibold hover:bg-emerald-700">Κράτηση 60’</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- GDPR Modal -->
  <div id="gdpr-modal" class="fixed inset-0 hidden items-center justify-center bg-black/40 p-4">
    <div class="w-full max-w-3xl rounded-2xl bg-white dark:bg-slate-900 shadow-soft border border-slate-200 dark:border-slate-800">
      <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200 dark:border-slate-800">
        <h3 id="t-gdprTitle" class="text-lg font-display font-bold">Όροι Αναζήτησης & Ενημέρωση GDPR</h3>
        <button id="gdpr-close" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl" aria-label="Κλείσιμο">×</button>
      </div>
      <div class="p-5 max-h-[60vh] overflow-auto"><div id="gdpr-body" class="prose prose-sm dark:prose-invert max-w-none">
        <p><strong>Υπεύθυνος Επεξεργασίας:</strong> MediRadar (συμπλήρωσε στοιχεία).</p>
        <p><strong>Σκοπός:</strong> Διαβίβαση αναζήτησης σε φαρμακεία για ενημέρωση διαθεσιμότητας/τιμής/χρόνου παραλαβής.</p>
        <p><strong>Νομική βάση:</strong> GDPR 6(1)(b) και 6(1)(a) για προαιρετικά στοιχεία (αριθμός συνταγής/σάρωση).</p>
        <p><strong>Δεδομένα:</strong> Όνομα φαρμάκου, δραστική, τύπος, ποσότητα, γενόσημο, πόλη, (προαιρετικά) αριθμός συνταγής/ barcode.</p>
        <p><strong>Διατήρηση:</strong> Έως 30 ημέρες, έπειτα ανωνυμοποίηση/διαγραφή εκτός νόμιμης υποχρέωσης.</p>
        <p><strong>Δικαιώματα:</strong> Πρόσβαση, διόρθωση, διαγραφή, περιορισμός, φορητότητα, εναντίωση.</p>
        <p><strong>Ασφάλεια:</strong> HTTPS, έλεγχος πρόσβασης, καταγραφή συμβάντων. Εκτελούντες βάσει άρθρου 28.</p>
      </div></div>
      <div class="px-5 pb-5 flex justify-end"><button id="gdpr-accept" class="px-4 py-2 rounded-xl bg-brand-600 text-white font-semibold hover:bg-brand-700">ΟΚ</button></div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 hidden px-4 py-3 rounded-xl bg-slate-900 text-white text-sm shadow-xl" aria-live="polite"></div>

  <!-- ZXing (lazy) -->
  <script id="zxing-lib" type="text/plain" data-src="https://cdn.jsdelivr.net/npm/@zxing/library@0.20.0/umd/index.min.js"></script>

  <!-- Confetti canvas -->
  <canvas id="confetti" class="fixed inset-0 pointer-events-none" style="display:none"></canvas>

  <!-- App JS -->
  <script>
    /* ---------- Theme ---------- */
    const html = document.documentElement;
    const themeBtn = document.getElementById('theme-toggle');
    const iconSun = document.getElementById('icon-sun');
    const iconMoon = document.getElementById('icon-moon');
    function setTheme(mode){
      const dark = mode==='dark';
      html.classList.toggle('dark', dark);
      iconSun.classList.toggle('hidden', !dark);
      iconMoon.classList.toggle('hidden', dark);
      localStorage.setItem('mediradar-theme', dark?'dark':'light');
    }
    setTheme(localStorage.getItem('mediradar-theme') || (matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light'));
    themeBtn.addEventListener('click',()=> setTheme(html.classList.contains('dark')?'light':'dark'));

    /* ---------- i18n (EL/EN minimal) ---------- */
    const strings = {
      el:{ title:'Αναζήτηση Φαρμάκου', subtitle:'Βρες άμεσα διαθεσιμότητα σε κοντινά φαρμακεία.', medname:'Όνομα Φαρμάκου',
        substance:'Δραστική Ουσία', type:'Τύπος Φαρμάκου', qty:'Ποσότητα (τεμάχια/κουτιά)', genericQ:'Αν δεν υπάρχει το φάρμακο, να προταθεί γενόσημο;',
        yes:'ΝΑΙ', no:'ΟΧΙ', city:'Πόλη', rx:'Προαιρετικά: Αριθμός Συνταγής', rxHelp:'Βοηθά το φαρμακείο να εντοπίσει γρήγορα σωστό σκεύασμα/δοσολογία.',
        scan:'Σάρωση barcode', stop:'Τερματισμός', scanHint:'Στόχευσε τον γραμμωτό κώδικα της συνταγής.', gdprShort:'Αποδέχομαι τους',
        submit:'Υποβολή Αναζήτησης', reserved:'Δεσμευμένο', sent:'✅ Αναζήτηση στάλθηκε', neterr:'⚠️ Σφάλμα δικτύου — δοκίμασε ξανά' },
      en:{ title:'Medicine Search', subtitle:'Find availability at nearby pharmacies instantly.', medname:'Medicine Name',
        substance:'Active Substance', type:'Medicine Type', qty:'Quantity (units/boxes)', genericQ:'If unavailable, suggest a generic?',
        yes:'YES', no:'NO', city:'City', rx:'Optional: Prescription Number', rxHelp:'Helps the pharmacy locate the correct product/dosage quickly.',
        scan:'Scan barcode', stop:'Stop', scanHint:'Aim the camera at the prescription barcode.', gdprShort:'I accept the',
        submit:'Submit Search', reserved:'Reserved', sent:'✅ Search sent', neterr:'⚠️ Network error — try again' }
    };
    const langEL = document.getElementById('lang-el');
    const langEN = document.getElementById('lang-en');
    const state = { lang: localStorage.getItem('mediradar-lang') || 'el' };

    function t(k){ return strings[state.lang][k]; }
    function setText(id, txt){ const el=document.getElementById(id); if(el) el.textContent=txt; }

    function applyLang(){
      document.documentElement.lang = state.lang;
      setText('t-title', t('title')); setText('t-subtitle', t('subtitle'));
      setText('t-medname', t('medname')); setText('t-substance', t('substance'));
      setText('t-type', t('type')); setText('t-qty', t('qty'));
      setText('t-genericQ', t('genericQ')); setText('t-yes', t('yes')); setText('t-no', t('no'));
      setText('t-city', t('city')); setText('t-rx', t('rx')); setText('t-rxHelp', t('rxHelp'));
      setText('t-scan', t('scan')); setText('t-stop', t('stop')); setText('t-scanHint', t('scanHint'));
      setText('t-gdprShort', t('gdprShort')); setText('t-submit', t('submit'));
      document.getElementById('medicine-name').placeholder = state.lang==='el'?'π.χ. Augmentin 875mg':'e.g. Augmentin 875mg';
      document.getElementById('active-substance').placeholder = state.lang==='el'?'π.χ. Παρακεταμόλη':'e.g. Paracetamol';
      document.getElementById('quantity').placeholder = state.lang==='el'?'π.χ. 1':'e.g. 1';
      document.getElementById('rx-number').placeholder = state.lang==='el'?'π.χ. 0123-456789-00':'e.g. 0123-456789-00';
      langEL.classList.toggle('bg-slate-900/5', state.lang==='el');
      langEN.classList.toggle('bg-slate-900/5', state.lang==='en');
      localStorage.setItem('mediradar-lang', state.lang);
    }
    langEL.addEventListener('click', ()=>{ state.lang='el'; applyLang(); });
    langEN.addEventListener('click', ()=>{ state.lang='en'; applyLang(); });
    applyLang();

    /* ---------- Toasts ---------- */
    const toast = document.getElementById('toast');
    function showToast(msg){
      toast.textContent = msg;
      toast.classList.remove('hidden'); toast.classList.add('toast-enter');
      requestAnimationFrame(()=> toast.classList.add('toast-enter-active'));
      setTimeout(()=>{
        toast.classList.remove('toast-enter','toast-enter-active'); toast.classList.add('toast-exit');
        requestAnimationFrame(()=> toast.classList.add('toast-exit-active'));
        setTimeout(()=>{ toast.classList.add('hidden'); toast.classList.remove('toast-exit','toast-exit-active'); }, 260);
      }, 2200);
    }

    /* ---------- Form submit (mock) ---------- */
    const form = document.getElementById('medicine-form');
    const resultsSection = document.getElementById('results');
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      showToast(t('sent'));
      resultsSection.classList.remove('hidden');
      resultsSection.scrollIntoView({ behavior:'smooth', block:'start' });
    });

    /* ---------- Autocomplete (local demo) ---------- */
    const AC_MEDICINES = [
      'Augmentin 875mg/125mg','Depon 500mg','Panadol 500mg','Nurofen 400mg','Algofren 400mg','Zylapour 300mg','Salospir 100mg'
    ];
    const AC_SUBSTANCES = [
      'Paracetamol 500mg','Ibuprofen 400mg','Amoxicillin 500mg','Amoxicillin/Clavulanate 875/125mg','Aspirin 100mg'
    ];
    function attachAutocomplete(inputId, listId, data){
      const input = document.getElementById(inputId);
      const list = document.getElementById(listId);
      let idx = -1;
      function render(items){
        list.innerHTML = items.map((x,i)=>`
          <div class="ac-item px-3 py-2 text-sm hover:bg-brand-50 dark:hover:bg-slate-800 ${i===idx?'bg-brand-50 dark:bg-slate-800':''}" data-val="${x}">${x}</div>
        `).join('');
        list.classList.toggle('hidden', items.length===0);
      }
      function filter(q){
        if(!q) { render([]); return; }
        const res = data.filter(s => s.toLowerCase().includes(q.toLowerCase())).slice(0,5);
        render(res);
      }
      input.addEventListener('input', ()=>{ idx=-1; filter(input.value.trim()); });
      input.addEventListener('keydown', (e)=>{
        const items = [...list.querySelectorAll('.ac-item')];
        if(!items.length) return;
        if(e.key==='ArrowDown'){ idx = (idx+1)%items.length; render(items.map(x=>x.dataset.val)); e.preventDefault(); }
        else if(e.key==='ArrowUp'){ idx = (idx-1+items.length)%items.length; render(items.map(x=>x.dataset.val)); e.preventDefault(); }
        else if(e.key==='Enter'){ if(idx>=0){ input.value = items[idx].dataset.val; render([]); } }
        else if(e.key==='Escape'){ render([]); }
      });
      list.addEventListener('click', (e)=>{
        const item = e.target.closest('.ac-item'); if(!item) return;
        input.value = item.dataset.val; list.classList.add('hidden');
      });
      document.addEventListener('click', (e)=>{ if(!list.contains(e.target) && e.target!==input){ list.classList.add('hidden'); }});
    }
    attachAutocomplete('medicine-name','ac-medicine',AC_MEDICINES);
    attachAutocomplete('active-substance','ac-substance',AC_SUBSTANCES);

    /* ---------- Scanner with overlay + torch ---------- */
    const scanBtn = document.getElementById('scan-barcode');
    const stopBtn = document.getElementById('stop-scan');
    const scanArea = document.getElementById('scan-area');
    const videoEl = document.getElementById('preview');
    const rxInput = document.getElementById('rx-number');
    const torchBtn = document.getElementById('toggle-torch');
    let mediaStream=null, scanning=false, zxingReader=null, zxingInterval=null, videoTrack=null;

    async function startScan(){
      scanArea.classList.remove('hidden');
      try{
        mediaStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode:'environment' }, audio:false });
        videoEl.srcObject = mediaStream; await videoEl.play(); scanning=true;
        videoTrack = mediaStream.getVideoTracks()[0];
        const capabilities = videoTrack.getCapabilities ? videoTrack.getCapabilities() : {};
        if(capabilities.torch){ torchBtn.classList.remove('hidden'); } else { torchBtn.classList.add('hidden'); }

        if('BarcodeDetector' in window){
          const detector = new BarcodeDetector({ formats:['code_128','ean_13','qr_code','upc_a','upc_e','code_39','itf','codabar','data_matrix','pdf417','aztec'] });
          const loop = async ()=>{
            if(!scanning) return;
            try{
              const res = await detector.detect(videoEl);
              if(res && res.length){ rxInput.value = res[0].rawValue || ''; stopScan(); return; }
            }catch{}
            requestAnimationFrame(loop);
          }; loop();
        }else{
          await loadZXing();
          const { BrowserMultiFormatReader } = window.ZXing;
          zxingReader = new BrowserMultiFormatReader();
          zxingInterval = setInterval(async ()=>{
            if(!scanning) return;
            try{
              const r = await zxingReader.decodeOnceFromVideoDevice(undefined, videoEl);
              if(r && r.text){ rxInput.value = r.text; stopScan(); }
            }catch{}
          }, 800);
        }
      }catch(e){
        console.error(e); showToast('⚠️ ' + (state.lang==='el'?'Δεν ήταν δυνατή η πρόσβαση στην κάμερα.':'Camera access failed.'));
        stopScan();
      }
    }
    function stopScan(){
      scanning=false;
      if(zxingInterval){ clearInterval(zxingInterval); zxingInterval=null; }
      if(zxingReader){ try{zxingReader.reset();}catch{} zxingReader=null; }
      if(mediaStream){ mediaStream.getTracks().forEach(t=>t.stop()); mediaStream=null; }
      videoEl.pause(); videoEl.srcObject=null; scanArea.classList.add('hidden');
      torchBtn.classList.add('hidden');
    }
    async function loadZXing(){ if(window.ZXing) return;
      const src=document.getElementById('zxing-lib').getAttribute('data-src');
      await new Promise((res,rej)=>{ const s=document.createElement('script'); s.src=src; s.onload=res; s.onerror=rej; document.body.appendChild(s); });
    }
    let torchOn=false;
    torchBtn.addEventListener('click', async ()=>{
      if(!videoTrack || !videoTrack.applyConstraints) return;
      try{
        torchOn = !torchOn;
        await videoTrack.applyConstraints({ advanced:[{ torch: torchOn }] });
        torchBtn.textContent = torchOn ? '🔦 On' : '🔦';
      }catch(e){ console.warn('Torch not supported:', e); }
    });
    scanBtn.addEventListener('click', startScan);
    stopBtn.addEventListener('click', stopScan);

    /* ---------- Reserve 60’ + countdown + confetti ---------- */
    const reserveBtn = document.getElementById('reserve-btn');
    const holdBadge = document.getElementById('hold-badge');
    const holdTTL = document.getElementById('hold-ttl');
    let countdownTimer=null, remaining=3600; // seconds

    function startCountdown(seconds=3600){
      remaining = seconds;
      holdBadge.classList.remove('hidden');
      updateTTL();
      clearInterval(countdownTimer);
      countdownTimer = setInterval(()=>{
        remaining--; if(remaining<=0){ clearInterval(countdownTimer); holdBadge.classList.add('hidden'); return; }
        updateTTL();
      },1000);
    }
    function updateTTL(){
      const m = Math.floor(remaining/60).toString().padStart(2,'0');
      const s = (remaining%60).toString().padStart(2,'0');
      holdTTL.textContent = `${m}:${s}`;
    }
    reserveBtn?.addEventListener('click', ()=>{
      startCountdown(60*60);
      fireConfetti(800);
      showToast(state.lang==='el' ? `${t('reserved')}: 60’` : `Reserved: 60’`);
    });

    /* ---------- Confetti (tiny, dependency-free) ---------- */
    const confettiCanvas = document.getElementById('confetti');
    const ctx = confettiCanvas.getContext('2d');
    function fireConfetti(duration=800){
      confettiCanvas.width = innerWidth; confettiCanvas.height = innerHeight;
      confettiCanvas.style.display = 'block';
      const particles = Array.from({length: 120}, ()=> ({
        x: Math.random()*innerWidth,
        y: -20,
        vx: (Math.random()-.5)*2,
        vy: Math.random()*3+2,
        size: Math.random()*6+3,
        color: ['#F78DA7','#84C5F4','#C3A6F4','#FFE08A','#9DE0D6'][Math.floor(Math.random()*5)],
        rot: Math.random()*360, vr:(Math.random()-.5)*10
      }));
      let start = performance.now();
      function tick(ts){
        const elapsed = ts - start;
        ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
        particles.forEach(p=>{
          p.x += p.vx; p.y += p.vy; p.vy += 0.05; p.rot += p.vr;
          ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot*Math.PI/180);
          ctx.fillStyle = p.color; ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
          ctx.restore();
        });
        if(elapsed < duration){ requestAnimationFrame(tick); } else { confettiCanvas.style.display='none'; }
      }
      requestAnimationFrame(tick);
    }
  </script>
</body>
</html>
