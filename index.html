<!DOCTYPE html>
<html lang="el" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MediRadar</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Manrope:wght@700;800&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter','ui-sans-serif','system-ui'], display:['Manrope','Inter','ui-sans-serif'] },
          colors: {
            brand: { 50:'#e6f6f6',200:'#a3e0df',300:'#79cfcf',400:'#4fbcbc',500:'#29a3a3',600:'#208181',700:'#196464',800:'#134b4b' }
          },
          boxShadow: { soft:'0 12px 28px rgba(15,23,42,.10)'},
        }
      }
    }
  </script>

  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#29a3a3">

  <!-- Favicons / OG -->
  <link rel="icon" type="image/svg+xml" href="/assets/logo/mediradar-symbol.svg">
  <link rel="icon" type="image/png" sizes="192x192" href="/assets/logo/mediradar-192.png">
  <meta property="og:title" content="MediRadar â€” Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…">
  <meta property="og:description" content="Î’ÏÎµÏ‚ Î¬Î¼ÎµÏƒÎ± Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î± ÏƒÎµ ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± ÎºÎ±Î¹ ÎºÎ¬Î½Îµ ÎºÏÎ¬Ï„Î·ÏƒÎ· 60â€™ Î¼Îµ Î­Î½Î± Ï€Î¬Ï„Î·Î¼Î±.">
  <meta property="og:image" content="https://www.mediradar.gr/assets/mediradar-og.png">

  <style>
    :root{ --fadeBg:#f7fbfb; --fadeDark:#0b1515; }
    .app-bg{
      background-attachment: fixed;
      background-image:
        radial-gradient(900px 520px at 50% -10%, rgba(132,197,244,.45), transparent 60%),
        radial-gradient(800px 480px at 10% 10%,  rgba(199,166,244,.35), transparent 55%),
        radial-gradient(900px 520px at 90% 20%,  rgba(247,141,167,.30), transparent 60%),
        radial-gradient(800px 460px at 20% 120%, rgba(157,224,214,.30), transparent 60%),
        linear-gradient(180deg, var(--fadeBg), #f5fafc 40%, #f7fafc);
    }
    .dark .app-bg{
      background-attachment: fixed;
      background-image:
        radial-gradient(900px 520px at 50% -10%, rgba(132,197,244,.35), transparent 60%),
        radial-gradient(800px 480px at 10% 10%,  rgba(199,166,244,.28), transparent 55%),
        radial-gradient(900px 520px at 90% 20%,  rgba(247,141,167,.24), transparent 60%),
        radial-gradient(800px 460px at 20% 120%, rgba(157,224,214,.22), transparent 60%),
        linear-gradient(180deg, var(--fadeDark), #091010 45%, #091010);
    }
    .screen{ display:none; }
    .screen.active{ display:block; animation: fadeIn .28s ease-out; }
    @keyframes fadeIn{ from{opacity:0; transform:translateY(6px);} to{opacity:1; transform:translateY(0);} }
    .ac-list{ position:absolute; inset-inline:0; top:100%; z-index:30; }
    .ac-item{ cursor:pointer; }
    .match b{ font-weight:700; }
    .scan-frame::after{
      content:''; position:absolute; inset:8%; border:3px solid rgba(255,255,255,.85);
      border-radius:16px; box-shadow:0 0 0 100vmax rgba(0,0,0,.25); pointer-events:none;
    }
    .toast-enter{ opacity:0; transform: translate(-50%,10px); }
    .toast-enter-active{ opacity:1; transform: translate(-50%,0); transition:.18s ease-out; }
    .toast-exit{ opacity:1; }
    .toast-exit-active{ opacity:0; transition:.25s ease-in; }

    /* Pending (orange) */
    .pulse-dot { animation: pulse 1.6s ease-in-out infinite; }
    @keyframes pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.12)} }
    .hourglass { animation: hg 1.2s linear infinite; transform-origin:center; }
    @keyframes hg { 0%{ transform: rotate(0deg);} 50%{ transform: rotate(180deg);} 100%{ transform: rotate(360deg);} }
  </style>
</head>
<body class="app-bg text-slate-900 dark:text-slate-200 font-sans min-h-full">

  <!-- Header -->
  <header class="sticky top-0 z-40 bg-white/70 dark:bg-slate-900/70 backdrop-blur border-b border-slate-200/70 dark:border-slate-800">
    <div class="mx-auto max-w-4xl px-4 sm:px-6 py-3 flex items-center justify-between">
      <a href="#" class="flex items-center gap-3" aria-label="MediRadar" onclick="goTo('screen-splash')">
        <svg class="h-8 w-auto sm:h-9" viewBox="0 0 220 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <text x="2" y="28" font-family="Manrope, Inter, ui-sans-serif, system-ui" font-weight="800" font-size="24" letter-spacing="-0.4" fill="currentColor">MediRadar</text>
        </svg>
      </a>

      <div class="flex items-center gap-2">
        <div class="flex items-center rounded-xl overflow-hidden bg-slate-900/5 dark:bg-white/10 border border-slate-200/60 dark:border-slate-700">
          <button id="lang-el" class="px-2 py-1.5 text-xs font-semibold bg-slate-900/5 dark:bg-white/10">EL</button>
          <button id="lang-en" class="px-2 py-1.5 text-xs font-semibold opacity-90 hover:opacity-100">EN</button>
        </div>
        <button id="theme-toggle" class="px-2 py-1.5 rounded-xl hover:bg-slate-900/5 dark:hover:bg-white/10" title="Light / Dark">
          <svg id="icon-sun" viewBox="0 0 24 24" class="w-5 h-5 hidden"><circle cx="12" cy="12" r="4.5" fill="#FFD064"/><g stroke="#FFD064" stroke-width="2" stroke-linecap="round"><path d="M12 2v3"/><path d="M12 19v3"/><path d="M2 12h3"/><path d="M19 12h3"/><path d="M4.2 4.2l2.2 2.2"/><path d="M17.6 17.6l2.2 2.2"/><path d="M19.8 4.2l-2.2 2.2"/><path d="M6.4 17.6l-2.2 2.2"/></g></svg>
          <svg id="icon-moon" viewBox="0 0 24 24" class="w-5 h-5"><path d="M12 2a9.5 9.5 0 1 0 8 15.5A8 8 0 0 1 12 2Z" fill="#C9D6FF"/></svg>
        </button>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-4xl px-4 sm:px-6 pt-6 pb-24">

    <!-- Screen 1: Splash Î¼Îµ 3 ÎºÎ¿Ï…Î¼Ï€Î¹Î¬ -->
    <section id="screen-splash" class="screen active">
      <div class="min-h-[70vh] grid place-items-center">
        <div class="text-center max-w-md mx-auto">
          <div class="mx-auto rounded-[28px] w-40 h-40 sm:w-48 sm:h-48 bg-gradient-to-br from-brand-500 to-brand-600 shadow-soft grid place-items-center">
            <img src="/assets/logo/mediradar-symbol.svg" alt="" class="w-24 h-24 sm:w-28 sm:h-28" onerror="this.style.display='none'">
            <div class="text-white font-display text-3xl sm:text-4xl font-extrabold select-none">M</div>
          </div>

          <h1 class="font-display text-3xl sm:text-4xl mt-5 tracking-tight">MediRadar</h1>
          <p class="text-slate-600 dark:text-slate-400 mt-1">Î’ÏÎµÏ‚ Î¬Î¼ÎµÏƒÎ± Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î± ÏƒÎµ ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±.</p>

          <div class="mt-6 grid gap-3">
            <button class="px-5 py-3 rounded-xl bg-gradient-to-r from-brand-500 to-brand-600 text-white font-semibold shadow-soft hover:opacity-95"
                    onclick="goTo('screen-search')">
              Î£Ï…Î½Î­Ï‡ÎµÎ¹Î± ÏƒÏ„Î·Î½ Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·
            </button>

            <button class="px-5 py-3 rounded-xl bg-white/90 dark:bg-slate-900/70 border border-slate-200/70 dark:border-slate-700 font-semibold hover:bg-white"
                    onclick="openHow()">
              Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯
            </button>

            <button class="px-5 py-3 rounded-xl bg-slate-900/85 dark:bg-white/10 text-white font-semibold hover:opacity-95"
                    onclick="openAuth()">
              Î£ÏÎ½Î´ÎµÏƒÎ· (Google / Apple)
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Screen 2: Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· -->
    <section id="screen-search" class="screen">
      <div class="rounded-2xl bg-gradient-to-br from-brand-500 to-brand-600 text-white shadow-soft p-5 sm:p-6 mb-6">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-2xl bg-white/15 grid place-items-center">
            <svg viewBox="0 0 24 24" class="w-6 h-6"><circle cx="10.5" cy="10.5" r="6" fill="#B3E5FC" stroke="#ffffff" stroke-width="1.5"/><path d="M14.5 14.5l4.7 4.7" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg>
          </div>
          <div>
            <h2 class="font-display leading-[1.2] text-2xl sm:text-3xl font-bold">Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…</h2>
            <p class="mt-1 text-white/85 text-sm">Î’ÏÎµÏ‚ Î¬Î¼ÎµÏƒÎ± Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î± ÏƒÎµ ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±.</p>
          </div>
        </div>
      </div>

      <form id="medicine-form" class="grid grid-cols-1 gap-4 sm:gap-5">
        <!-- Medicine name + AC -->
        <div class="rounded-xl bg-white/90 dark:bg-slate-900/60 backdrop-blur shadow-soft border border-slate-200/70 dark:border-slate-800 p-4">
          <label for="medicine-name" class="text-sm font-semibold flex items-center gap-2">
            <svg class="w-6 h-6" viewBox="0 0 24 24"><rect x="2" y="9" width="20" height="6" rx="3" fill="#FFCDD2" stroke="#fff" stroke-width="1"/><rect x="2" y="9" width="10" height="6" rx="3" fill="#E53935"/></svg>
            ÎŒÎ½Î¿Î¼Î± Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…
          </label>
          <div class="mt-2 relative">
            <input id="medicine-name" type="text" autocomplete="off"
              class="w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-300 focus:border-brand-500 placeholder:text-slate-400"
              placeholder="Ï€.Ï‡. Augmentin 875mg" />
            <div id="ac-medicine" class="ac-list hidden rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-lg"></div>
          </div>
          <p class="mt-2 text-xs text-slate-500">Î Î»Î·ÎºÏ„ÏÎ¿Î»ÏŒÎ³Î·ÏƒÎµ 2+ Î³ÏÎ¬Î¼Î¼Î±Ï„Î± Î³Î¹Î± Ï€ÏÎ¿Ï„Î¬ÏƒÎµÎ¹Ï‚.</p>
        </div>

        <!-- Active substance -->
        <div class="rounded-xl bg-white/90 dark:bg-slate-900/60 backdrop-blur shadow-soft border border-slate-200/70 dark:border-slate-800 p-4">
          <label for="active-substance" class="text-sm font-semibold flex items-center gap-2">
            <svg class="w-6 h-6" viewBox="0 0 24 24"><rect x="7" y="2" width="10" height="3" rx="1.5" fill="#80DEEA"/><rect x="9" y="5" width="6" height="12" rx="2" fill="#B2DFDB"/><rect x="9" y="12" width="6" height="5" rx="2" fill="#26A69A"/></svg>
            Î”ÏÎ±ÏƒÏ„Î¹ÎºÎ® ÎŸÏ…ÏƒÎ¯Î± <span class="text-slate-400">(Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬)</span>
          </label>
          <div class="mt-2 relative">
            <input id="active-substance" type="text" autocomplete="off"
              class="w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-300 focus:border-brand-500 placeholder:text-slate-400"
              placeholder="Ï€.Ï‡. Î Î±ÏÎ±ÎºÎµÏ„Î±Î¼ÏŒÎ»Î·" />
            <div id="ac-substance" class="ac-list hidden rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-lg"></div>
          </div>
        </div>

        <!-- Type -->
        <div class="rounded-xl bg-white/90 dark:bg-slate-900/60 backdrop-blur shadow-soft border border-slate-200/70 dark:border-slate-800 p-4">
          <label for="medicine-type" class="text-sm font-semibold flex items-center gap-2">
            <svg class="w-6 h-6" viewBox="0 0 24 24"><rect x="4" y="3" width="16" height="18" rx="3" fill="#90CAF9"/><g fill="#fff"><circle cx="9" cy="8" r="1.6"/><circle cx="15" cy="8" r="1.6"/><circle cx="9" cy="13" r="1.6"/><circle cx="15" cy="13" r="1.6"/></g></svg>
            Î¤ÏÏ€Î¿Ï‚ Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…
          </label>
          <select id="medicine-type" required class="mt-2 w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-300 focus:border-brand-500">
            <option value="">â€” Î•Ï€Î¹Î»Î¿Î³Î® â€”</option>
            <option>Î£ÎºÏŒÎ½Î·</option><option>Î¥Î³ÏÏŒ</option><option>Î§Î¬Ï€Î¹</option><option>Î”ÎµÏÎ¼Î±Ï„Î¹ÎºÎ® ÎšÏÎ­Î¼Î±</option><option>Î‘Î»Î¿Î¹Ï†Î®</option>
          </select>
        </div>

        <!-- Quantity -->
        <div class="rounded-xl bg-white/90 dark:bg-slate-900/60 backdrop-blur shadow-soft border border-slate-200/70 dark:border-slate-800 p-4">
          <label for="quantity" class="text-sm font-semibold flex items-center gap-2">
            <svg class="w-6 h-6" viewBox="0 0 24 24"><rect x="3" y="12" width="8" height="7" rx="2" fill="#FFCC80"/><rect x="13" y="12" width="8" height="7" rx="2" fill="#FFB74D"/><rect x="8" y="5" width="8" height="7" rx="2" fill="#FFA726"/></svg>
            Î Î¿ÏƒÏŒÏ„Î·Ï„Î± (Ï„ÎµÎ¼Î¬Ï‡Î¹Î±/ÎºÎ¿Ï…Ï„Î¹Î¬)
          </label>
          <input id="quantity" type="number" min="1" required
                 class="mt-2 w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-300 focus:border-brand-500"
                 placeholder="Ï€.Ï‡. 1" />
        </div>

        <!-- Generic -->
        <div class="rounded-xl bg-white/90 dark:bg-slate-900/60 backdrop-blur shadow-soft border border-slate-200/70 dark:border-slate-800 p-4">
          <p class="text-sm font-semibold flex items-center gap-2">
            <svg class="w-6 h-6" viewBox="0 0 24 24"><defs><linearGradient id="g-ok" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#34D399"/><stop offset="100%" stop-color="#10B981"/></linearGradient></defs><circle cx="12" cy="12" r="10" fill="url(#g-ok)"/><path d="M7.5 12.5l3 3l6-6.5" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Î‘Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Ï„Î¿ Ï†Î¬ÏÎ¼Î±ÎºÎ¿, Î½Î± Ï€ÏÎ¿Ï„Î±Î¸ÎµÎ¯ Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿;
          </p>
          <div class="mt-3 flex gap-4">
            <label class="inline-flex items-center gap-2"><input type="radio" name="allow-generic" value="ÎÎ‘Î™" required class="size-4 accent-brand-600"><span>ÎÎ‘Î™</span></label>
            <label class="inline-flex items-center gap-2"><input type="radio" name="allow-generic" value="ÎŸÎ§Î™" class="size-4 accent-brand-600"><span>ÎŸÎ§Î™</span></label>
          </div>
        </div>

        <!-- City -->
        <div class="rounded-xl bg-white/90 dark:bg-slate-900/60 backdrop-blur shadow-soft border border-slate-200/70 dark:border-slate-800 p-4">
          <label for="city" class="text-sm font-semibold flex items-center gap-2">
            <svg class="w-6 h-6" viewBox="0 0 24 24"><path d="M12 22s7-7.2 7-12a7 7 0 1 0-14 0c0 4.8 7 12 7 12Z" fill="#B39DDB"/><circle cx="12" cy="10" r="2.7" fill="#fff"/></svg>
            Î ÏŒÎ»Î·
          </label>
          <select id="city" required class="mt-2 w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-300 focus:border-brand-500">
            <option value="">â€” Î•Ï€Î¹Î»Î¿Î³Î® â€”</option>
          </select>
        </div>

        <!-- RX + scan -->
        <div class="rounded-xl bg-white/90 dark:bg-slate-900/60 backdrop-blur shadow-soft border border-slate-200/70 dark:border-slate-800 p-4">
          <label for="rx-number" class="text-sm font-semibold flex items-center gap-2">
            <svg class="w-6 h-6" viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="14" rx="2" fill="#ECEFF1"/><g stroke="#263238" stroke-width="1.5"><path d="M6 7v10M9 7v10M11 7v10M14 7v10M16 7v10M18 7v10"/></g></svg>
            Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬: Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î£Ï…Î½Ï„Î±Î³Î®Ï‚
          </label>
          <p class="mt-1 text-xs text-slate-500">Î’Î¿Î·Î¸Î¬ Ï„Î¿ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ Î½Î± ÎµÎ½Ï„Î¿Ï€Î¯ÏƒÎµÎ¹ Î³ÏÎ®Î³Î¿ÏÎ± ÏƒÏ‰ÏƒÏ„ÏŒ ÏƒÎºÎµÏÎ±ÏƒÎ¼Î±/Î´Î¿ÏƒÎ¿Î»Î¿Î³Î¯Î±.</p>
          <div class="mt-2 grid gap-2 sm:grid-cols-[1fr_auto_auto]">
            <input id="rx-number" type="text"
              class="w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-300 focus:border-brand-500 placeholder:text-slate-400"
              placeholder="Ï€.Ï‡. 0123-456789-00" inputmode="numeric" />
            <button type="button" id="scan-barcode" class="px-4 py-3 rounded-xl bg-brand-600 text-white font-semibold hover:bg-brand-700">Î£Î¬ÏÏ‰ÏƒÎ· barcode</button>
            <button type="button" id="toggle-torch" class="px-4 py-3 rounded-xl bg-slate-800/80 text-white font-semibold hover:bg-slate-800 hidden">ğŸ”¦</button>
          </div>
          <div id="scan-area" class="mt-3 hidden relative">
            <video id="preview" playsinline muted autoplay class="w-full rounded-xl border border-slate-200 dark:border-slate-700"></video>
            <div class="absolute inset-0 scan-frame pointer-events-none"></div>
            <p class="text-xs text-slate-500 mt-1">Î£Ï„ÏŒÏ‡ÎµÏ…ÏƒÎµ Ï„Î¿Î½ Î³ÏÎ±Î¼Î¼Ï‰Ï„ÏŒ ÎºÏÎ´Î¹ÎºÎ± Ï„Î·Ï‚ ÏƒÏ…Î½Ï„Î±Î³Î®Ï‚.</p>
            <div class="mt-2"><button type="button" id="stop-scan" class="px-3 py-2 rounded-xl bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-slate-100 text-sm font-semibold hover:bg-slate-300 dark:hover:bg-slate-600">Î¤ÎµÏÎ¼Î±Ï„Î¹ÏƒÎ¼ÏŒÏ‚</button></div>
          </div>
        </div>

        <!-- GDPR -->
        <div class="rounded-xl bg-white/90 dark:bg-slate-900/60 backdrop-blur shadow-soft border border-slate-200/70 dark:border-slate-800 p-4">
          <label class="inline-flex items-start gap-3">
            <input id="gdpr-checkbox" type="checkbox" required class="mt-0.5 size-5 accent-brand-600">
            <span class="text-sm leading-6">Î‘Ï€Î¿Î´Î­Ï‡Î¿Î¼Î±Î¹ Ï„Î¿Ï…Ï‚ <button type="button" id="gdpr-open" class="underline text-brand-700 dark:text-brand-300 hover:opacity-80">ÎŒÏÎ¿Ï…Ï‚ Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚ & GDPR</button>.</span>
          </label>
        </div>

        <!-- Submit -->
        <div class="flex justify-end">
          <button type="submit" class="px-5 py-3 rounded-xl bg-gradient-to-r from-brand-500 to-brand-600 text-white font-semibold shadow-soft hover:opacity-95 focus:outline-none focus:ring-4 focus:ring-brand-300">
            Î¥Ï€Î¿Î²Î¿Î»Î® Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚
          </button>
        </div>
      </form>
    </section>

    <!-- Screen 2.5: Pending (Î±Î½Î±Î¼Î¿Î½Î® Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·Ï‚ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Ï‰Î½) -->
    <section id="screen-pending" class="screen">
      <div class="rounded-2xl bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 p-6 shadow-soft">
        <div class="flex items-start gap-4">
          <div class="w-12 h-12 rounded-2xl bg-orange-500 text-white grid place-items-center pulse-dot">
            <!-- SVG hourglass -->
            <svg viewBox="0 0 24 24" class="w-7 h-7 hourglass" aria-hidden="true">
              <path d="M7 2h10a2 2 0 0 1 2 2v2a5 5 0 0 1-1.46 3.54L15 12l2.54 2.46A5 5 0 0 1 19 18v2a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-2a5 5 0 0 1 1.46-3.54L9 12 6.46 9.54A5 5 0 0 1 5 6V4a2 2 0 0 1 2-2Z" fill="currentColor"/>
            </svg>
          </div>
          <div>
            <h3 class="font-display text-xl">Î‘Î½Î±Î¼Î¿Î½Î® Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·Ï‚ Î±Ï€ÏŒ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿â€¦</h3>
            <p class="mt-1 text-slate-700 dark:text-slate-300">Î— Î±Î¯Ï„Î·ÏƒÎ® ÏƒÎ¿Ï… ÏƒÏ„Î¬Î»Î¸Î·ÎºÎµ. Î£ÏÎ½Ï„Î¿Î¼Î± Î¸Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„Î¿ÏÎ½ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± Î¼Îµ <strong>Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±</strong>.</p>
            <p id="pending-hint" class="mt-1 text-xs text-slate-500">ÎœÏ€Î¿ÏÎµÎ¯Ï‚ Î½Î± Ï€Î±ÏÎ±Î¼ÎµÎ¯Î½ÎµÎ¹Ï‚ ÏƒÎµ Î±Ï…Ï„Î® Ï„Î·Î½ Î¿Î¸ÏŒÎ½Î· â€” Î¸Î± ÎµÎ½Î·Î¼ÎµÏÏ‰Î¸ÎµÎ¯ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î±.</p>
          </div>
        </div>

        <div class="mt-4 flex items-center gap-3">
          <button class="px-4 py-2 rounded-xl bg-slate-200 dark:bg-slate-800 text-slate-800 dark:text-slate-100" onclick="goTo('screen-search')">â† Î‘Î»Î»Î±Î³Î® ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Ï‰Î½</button>
        </div>
      </div>

      <div class="mt-6">
        <h4 class="text-sm font-semibold text-slate-600 dark:text-slate-300">ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·:</h4>
        <div id="pending-status" class="mt-2 text-sm text-orange-700 dark:text-orange-300">Pendingâ€¦</div>
      </div>
    </section>

    <!-- Screen 3: Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î± (Ï‡Ï‰ÏÎ¯Ï‚ Ï„Î¹Î¼Î­Ï‚) -->
    <section id="screen-results" class="screen">
      <div class="mb-4 flex items-center justify-between">
        <h2 class="font-display text-xl leading-[1.25]">Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±</h2>
        <button class="text-sm underline opacity-80 hover:opacity-100" onclick="goTo('screen-search')">â† Î Î¯ÏƒÏ‰</button>
      </div>
      <div id="results-list" class="grid gap-3"></div>
      <div class="mt-5">
        <button class="text-sm underline opacity-80 hover:opacity-100" onclick="goTo('screen-search')">â† ÎÎ­Î± Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·</button>
      </div>
    </section>

    <!-- Screen 4: ÎšÏÎ¬Ï„Î·ÏƒÎ· (full focus) -->
    <section id="screen-hold" class="screen">
      <div class="mb-4 flex items-center justify-between">
        <h2 class="font-display text-xl leading-[1.25]">ÎšÏÎ¬Ï„Î·ÏƒÎ· 60â€™</h2>
        <button class="text-sm underline opacity-80 hover:opacity-100" onclick="goTo('screen-results')">â† Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±</button>
      </div>

      <div id="hold-card" class="rounded-2xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200/70 dark:border-slate-800 p-5 shadow-soft">
        <div class="flex items-start justify-between gap-4">
          <div class="flex items-center gap-3">
            <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f48a.png" class="w-12 h-12" alt="">
            <div>
              <div id="hold-name" class="font-semibold text-lg">Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿</div>
              <div id="hold-meta" class="text-xs text-slate-500 dark:text-slate-400">â€”</div>
            </div>
          </div>
          <span class="text-sm px-2 py-1 rounded-lg bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-200">
            Î”ÎµÏƒÎ¼ÎµÏ…Î¼Î­Î½Î¿: <span id="hold-ttl">59:59</span>
          </span>
        </div>

        <div class="mt-4 grid sm:grid-cols-3 gap-3">
          <a id="hold-call" href="#" class="text-center px-4 py-3 rounded-xl bg-slate-900/85 dark:bg-white/10 text-white font-semibold hover:opacity-95">ğŸ“ ÎšÎ»Î®ÏƒÎ·</a>
          <a id="hold-directions" target="_blank" rel="noopener" href="#" class="text-center px-4 py-3 rounded-xl bg-brand-600 text-white font-semibold hover:bg-brand-700">ğŸ§­ ÎŸÎ´Î·Î³Î¯ÎµÏ‚</a>
          <button id="hold-done" class="px-4 py-3 rounded-xl bg-emerald-600 text-white font-semibold hover:bg-emerald-700">ÎŸÎ»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ</button>
        </div>
      </div>
    </section>
  </main>

  <!-- GDPR Modal -->
  <div id="gdpr-modal" class="fixed inset-0 hidden items-center justify-center bg-black/40 p-4">
    <div class="w-full max-w-3xl rounded-2xl bg-white dark:bg-slate-900 shadow-soft border border-slate-200 dark:border-slate-800">
      <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200 dark:border-slate-800">
        <h3 class="text-lg font-display font-bold">ÎŒÏÎ¿Î¹ Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚ & Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· GDPR</h3>
        <button id="gdpr-close" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl" aria-label="ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿">Ã—</button>
      </div>
      <div class="p-5 max-h-[60vh] overflow-auto"><div class="prose prose-sm dark:prose-invert max-w-none">
        <p><strong>Î¥Ï€ÎµÏÎ¸Ï…Î½Î¿Ï‚ Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚:</strong> MediRadar (ÏƒÏ…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î±).</p>
        <p><strong>Î£ÎºÎ¿Ï€ÏŒÏ‚:</strong> Î”Î¹Î±Î²Î¯Î²Î±ÏƒÎ· Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚ ÏƒÎµ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± Î³Î¹Î± ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚/Ï‡ÏÏŒÎ½Î¿Ï… Ï€Î±ÏÎ±Î»Î±Î²Î®Ï‚.</p>
        <p><strong>ÎÎ¿Î¼Î¹ÎºÎ® Î²Î¬ÏƒÎ·:</strong> GDPR 6(1)(b) ÎºÎ±Î¹ 6(1)(a) Î³Î¹Î± Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± (Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ ÏƒÏ…Î½Ï„Î±Î³Î®Ï‚/ÏƒÎ¬ÏÏ‰ÏƒÎ·).</p>
        <p><strong>Î”ÎµÎ´Î¿Î¼Î­Î½Î±:</strong> ÎŒÎ½Î¿Î¼Î± Ï†Î±ÏÎ¼Î¬ÎºÎ¿Ï…, Î´ÏÎ±ÏƒÏ„Î¹ÎºÎ®, Ï„ÏÏ€Î¿Ï‚, Ï€Î¿ÏƒÏŒÏ„Î·Ï„Î±, Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿, Ï€ÏŒÎ»Î·, (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬) Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ ÏƒÏ…Î½Ï„Î±Î³Î®Ï‚/ barcode.</p>
        <p><strong>Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎ·:</strong> ÎˆÏ‰Ï‚ 30 Î·Î¼Î­ÏÎµÏ‚, Î­Ï€ÎµÎ¹Ï„Î± Î±Î½Ï‰Î½Ï…Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎ·/Î´Î¹Î±Î³ÏÎ±Ï†Î® ÎµÎºÏ„ÏŒÏ‚ Î½ÏŒÎ¼Î¹Î¼Î·Ï‚ Ï…Ï€Î¿Ï‡ÏÎ­Ï‰ÏƒÎ·Ï‚.</p>
        <p><strong>Î”Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±:</strong> Î ÏÏŒÏƒÎ²Î±ÏƒÎ·, Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·, Î´Î¹Î±Î³ÏÎ±Ï†Î®, Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚, Ï†Î¿ÏÎ·Ï„ÏŒÏ„Î·Ï„Î±, ÎµÎ½Î±Î½Ï„Î¯Ï‰ÏƒÎ·.</p>
        <p><strong>Î‘ÏƒÏ†Î¬Î»ÎµÎ¹Î±:</strong> HTTPS, Î­Î»ÎµÎ³Ï‡Î¿Ï‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚, ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î® ÏƒÏ…Î¼Î²Î¬Î½Ï„Ï‰Î½. Î•ÎºÏ„ÎµÎ»Î¿ÏÎ½Ï„ÎµÏ‚ Î²Î¬ÏƒÎµÎ¹ Î¬ÏÎ¸ÏÎ¿Ï… 28.</p>
      </div></div>
      <div class="px-5 pb-5 flex justify-end"><button id="gdpr-accept" class="px-4 py-2 rounded-xl bg-brand-600 text-white font-semibold hover:bg-brand-700">ÎŸÎš</button></div>
    </div>
  </div>

  <!-- How it works Modal -->
  <div id="how-modal" class="fixed inset-0 hidden items-center justify-center bg-black/40 p-4">
    <div class="w-full max-w-lg rounded-2xl bg-white dark:bg-slate-900 shadow-soft border border-slate-200 dark:border-slate-800">
      <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200 dark:border-slate-800">
        <h3 class="text-lg font-display font-bold">Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯</h3>
        <button id="how-close" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl">Ã—</button>
      </div>
      <div class="p-5 space-y-3 text-sm text-slate-700 dark:text-slate-300">
        <p>1) Î Î»Î·ÎºÏ„ÏÎ¿Î»Î¿Î³ÎµÎ¯Ï‚ Ï„Î¿ Ï†Î¬ÏÎ¼Î±ÎºÎ¿ & Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬ Ï„Î· Î´ÏÎ±ÏƒÏ„Î¹ÎºÎ®/ÏƒÏ…Î½Ï„Î±Î³Î®.</p>
        <p>2) Î£Ï„Î­Î»Î½Î¿Ï…Î¼Îµ Î±Î¯Ï„Î·Î¼Î± ÏƒÏ„Î± ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±.</p>
        <p>3) Î ÎµÏÎ¹Î¼Î­Î½ÎµÎ¹Ï‚ <strong>Î»Î¯Î³Î¿</strong> (pending) Î³Î¹Î± Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚.</p>
        <p>4) Î’Î»Î­Ï€ÎµÎ¹Ï‚ Ï€Î¿Î¹Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± Î­Ï‡Î¿Ï…Î½ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ & ÎºÎ¬Î½ÎµÎ¹Ï‚ <strong>ÎºÏÎ¬Ï„Î·ÏƒÎ· 60â€™</strong> Î® Ï€Î±Î¯ÏÎ½ÎµÎ¹Ï‚ Î¿Î´Î·Î³Î¯ÎµÏ‚/ÎºÎ»Î®ÏƒÎ·.</p>
      </div>
      <div class="px-5 pb-5 flex justify-end">
        <button class="px-4 py-2 rounded-xl bg-brand-600 text-white font-semibold hover:bg-brand-700" onclick="closeHow()">Î£Ï…Î½Î­Ï‡ÎµÎ¹Î±</button>
      </div>
    </div>
  </div>

  <!-- Auth Modal (stub) -->
  <div id="auth-modal" class="fixed inset-0 hidden items-center justify-center bg-black/40 p-4">
    <div class="w-full max-w-sm rounded-2xl bg-white dark:bg-slate-900 shadow-soft border border-slate-200 dark:border-slate-800">
      <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200 dark:border-slate-800">
        <h3 class="text-lg font-display font-bold">Î£ÏÎ½Î´ÎµÏƒÎ·</h3>
        <button id="auth-close" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl">Ã—</button>
      </div>
      <div class="p-5 grid gap-3">
        <button class="px-4 py-3 rounded-xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 font-semibold">ğŸ”µ Î£Ï…Î½Î­Ï‡ÎµÎ¹Î± Î¼Îµ Google</button>
        <button class="px-4 py-3 rounded-xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 font-semibold">âšª Î£Ï…Î½Î­Ï‡ÎµÎ¹Î± Î¼Îµ Apple</button>
        <p class="text-xs text-slate-500">* Demo placeholder â€“ Ï€ÏÎ¿Ï„ÎµÎ¯Î½Ï‰ Firebase Auth (ÎºÎ±Î¸ÏÏ‚ Ï„Î¿ Netlify Identity ÏƒÏ„Î±Î¼Î±Ï„Î¬).</p>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 hidden px-4 py-3 rounded-xl bg-slate-900 text-white text-sm shadow-xl" aria-live="polite"></div>

  <!-- ZXing (lazy) -->
  <script id="zxing-lib" type="text/plain" data-src="https://cdn.jsdelivr.net/npm/@zxing/library@0.20.0/umd/index.min.js"></script>

  <!-- Confetti canvas -->
  <canvas id="confetti" class="fixed inset-0 pointer-events-none" style="display:none"></canvas>

  <!-- App JS -->
  <script>
    /* Routing */
    function goTo(id){ document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); window.scrollTo({top:0, behavior:'smooth'}); }

    /* Theme */
    const html = document.documentElement, themeBtn = document.getElementById('theme-toggle'), iconSun=document.getElementById('icon-sun'), iconMoon=document.getElementById('icon-moon');
    function setTheme(mode){ const dark = mode==='dark'; html.classList.toggle('dark', dark); iconSun.classList.toggle('hidden', !dark); iconMoon.classList.toggle('hidden', dark); localStorage.setItem('mediradar-theme', dark?'dark':'light'); }
    setTheme(localStorage.getItem('mediradar-theme') || (matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light'));
    themeBtn.addEventListener('click',()=> setTheme(html.classList.contains('dark')?'light':'dark'));

    /* i18n (Î¼Î¯Î½Î¹) */
    document.getElementById('lang-el').onclick=()=>{ document.documentElement.lang='el'; localStorage.setItem('mediradar-lang','el'); };
    document.getElementById('lang-en').onclick=()=>{ document.documentElement.lang='en'; localStorage.setItem('mediradar-lang','en'); };

    /* Modals */
    const how = document.getElementById('how-modal'), auth = document.getElementById('auth-modal');
    function openHow(){ how.classList.remove('hidden'); how.classList.add('flex'); }
    function closeHow(){ how.classList.add('hidden'); how.classList.remove('flex'); }
    function openAuth(){ auth.classList.remove('hidden'); auth.classList.add('flex'); }
    function closeAuth(){ auth.classList.add('hidden'); auth.classList.remove('flex'); }
    document.getElementById('how-close').onclick = closeHow;
    document.getElementById('auth-close').onclick = closeAuth;
    how.addEventListener('click', e=>{ if(e.target===how) closeHow(); });
    auth.addEventListener('click', e=>{ if(e.target===auth) closeAuth(); });

    /* Toasts */
    const toast = document.getElementById('toast');
    function showToast(msg){ toast.textContent = msg; toast.classList.remove('hidden'); toast.classList.add('toast-enter'); requestAnimationFrame(()=> toast.classList.add('toast-enter-active')); setTimeout(()=>{ toast.classList.remove('toast-enter','toast-enter-active'); toast.classList.add('toast-exit'); requestAnimationFrame(()=> toast.classList.add('toast-exit-active')); setTimeout(()=>{ toast.classList.add('hidden'); toast.classList.remove('toast-exit','toast-exit-active'); }, 260); }, 2200); }

    /* Cities (alphabetical, locale el) */
    const CITIES_GR = [
      "Î‘Î³ÏÎ¯Î½Î¹Î¿","Î†Î³Î¹Î¿Ï‚ ÎÎ¹ÎºÏŒÎ»Î±Î¿Ï‚","Î‘Î¸Î®Î½Î±","Î‘Î¯Î³Î¹Î¿","Î‘Î»ÎµÎ¾Î±Î½Î´ÏÎ¿ÏÏ€Î¿Î»Î·","Î‘Î»ÏŒÎ½Î½Î·ÏƒÎ¿Ï‚","Î‘Î¼Î±Î»Î¹Î¬Î´Î±","Î‘Î¼Ï†Î¹Î»Î¿Ï‡Î¯Î±","Î†Î¼Ï†Î¹ÏƒÏƒÎ±","Î†Î½Î´ÏÎ¿Ï‚","Î‘ÏÎ³Î¿ÏƒÏ„ÏŒÎ»Î¹",
      "Î†ÏÏ„Î±","Î’Î­ÏÎ¿Î¹Î±","Î’ÏŒÎ»Î¿Ï‚","Î“Î±Î»Î¬Ï„ÏƒÎ¹","Î“Î»Ï…Ï†Î¬Î´Î±","Î“ÏÎµÎ²ÎµÎ½Î¬","Î”ÏÎ¬Î¼Î±","ÎˆÎ´ÎµÏƒÏƒÎ±","Î•Î»ÎµÏ…ÏƒÎ¯Î½Î±","Î–Î¬ÎºÏ…Î½Î¸Î¿Ï‚","Î—Î³Î¿Ï…Î¼ÎµÎ½Î¯Ï„ÏƒÎ±","Î—ÏÎ¬ÎºÎ»ÎµÎ¹Î¿",
      "Î˜Î®Î²Î±","Î˜ÎµÏƒÏƒÎ±Î»Î¿Î½Î¯ÎºÎ·","Î™ÎµÏÎ¬Ï€ÎµÏ„ÏÎ±","Î™ÏƒÏ„Î¹Î±Î¯Î±","Î™Ï‰Î¬Î½Î½Î¹Î½Î±","ÎšÎ±Î²Î¬Î»Î±","ÎšÎ±Î»Î±Î¼Î¬Ï„Î±","ÎšÎ±Î»Î±Î¼Î±ÏÎ¹Î¬","ÎšÎ±Î»Î±Î¼Ï€Î¬ÎºÎ±","ÎšÎ±ÏÎ´Î¯Ï„ÏƒÎ±","ÎšÎ±ÏÏ€ÎµÎ½Î®ÏƒÎ¹",
      "ÎšÎ±ÏƒÏ„Î¿ÏÎ¹Î¬","ÎšÎ±Ï„ÎµÏÎ¯Î½Î·","ÎšÎµÏÎ±Ï„ÏƒÎ¯Î½Î¹","ÎšÎ­ÏÎºÏ…ÏÎ±","ÎšÎ¹Î»ÎºÎ¯Ï‚","ÎšÎ¿Î¶Î¬Î½Î·","ÎšÎ¿Î¼Î¿Ï„Î·Î½Î®","ÎšÏŒÏÎ¹Î½Î¸Î¿Ï‚","ÎšÏ‰Ï‚","ÎšÏÎ¼Î·","Î›Î±Î¼Î¯Î±","Î›Î¬ÏÎ¹ÏƒÎ±","Î›ÎµÏ…ÎºÎ¬Î´Î±",
      "Î›Î¹Î²Î±Î´ÎµÎ¹Î¬","Î›Î¿Ï…Ï„ÏÎ¬ÎºÎ¹","ÎœÎ±ÏÎ¿ÏÏƒÎ¹","ÎœÎ¬ÏÎºÎ¿Ï€Î¿Ï…Î»Î¿","ÎœÎµÏƒÎ¿Î»ÏŒÎ³Î³Î¹","ÎœÎ®Î»Î¿Ï‚","ÎœÏ…Ï„Î¹Î»Î®Î½Î·","ÎÎ¬Î¾Î¿Ï‚","ÎÎ±ÏÏ€Î»Î¹Î¿","ÎÎ­Î± Î™Ï‰Î½Î¯Î±","ÎÎ­Î± Î£Î¼ÏÏÎ½Î·",
      "ÎÎµÎ¬Ï€Î¿Î»Î·","ÎÎ¯ÎºÎ±Î¹Î±","ÎÎ¬Î½Î¸Î·","ÎŸÏÎµÏƒÏ„Î¹Î¬Î´Î±","Î Î¬ÏÎ¿Ï‚","Î Î±Î»Î»Î®Î½Î·","Î Î¬Ï„ÏÎ±","Î ÎµÏÎ¹ÏƒÏ„Î­ÏÎ¹","Î Î¿Î»ÏÎ³Ï…ÏÎ¿Ï‚","Î ÏÎ­Î²ÎµÎ¶Î±","Î ÏÏÎ³Î¿Ï‚","Î¡Î±Ï†Î®Î½Î±","Î¡Î­Î¸Ï…Î¼Î½Î¿",
      "Î¡ÏŒÎ´Î¿Ï‚","Î£Î±Î½Ï„Î¿ÏÎ¯Î½Î·","Î£Î­ÏÏÎµÏ‚","Î£Î·Ï„ÎµÎ¯Î±","Î£Î¯Ï†Î½Î¿Ï‚","Î£ÎºÎ¬Î»Î±","Î£ÎºÎ¹Î¬Î¸Î¿Ï‚","Î£ÎºÏŒÏ€ÎµÎ»Î¿Ï‚","Î£Ï€Î¬Ï„Î±","Î£Ï€Î¬ÏÏ„Î·","Î£ÏÎ¼Î·","Î£ÏÏÎ¿Ï‚ (Î•ÏÎ¼Î¿ÏÏ€Î¿Î»Î·)","Î¤Î®Î½Î¿Ï‚",
      "Î¤ÏÎ¯ÎºÎ±Î»Î±","Î¤ÏÎ¯Ï€Î¿Î»Î·","Î¦Î»ÏÏÎ¹Î½Î±","Î§Î±Î»Î¬Î½Î´ÏÎ¹","Î§Î±Î»ÎºÎ¯Î´Î±","Î§Î±Î½Î¹Î¬","Î§Î¯Î¿Ï‚","Î©ÏÎ±Î¹ÏŒÎºÎ±ÏƒÏ„ÏÎ¿"
    ].sort((a,b)=>a.localeCompare(b,'el'));
    (function fillCities(){ const sel=document.getElementById('city'); CITIES_GR.forEach(c=>{ const o=document.createElement('option'); o.value=c; o.textContent=c; sel.appendChild(o); }); })();

    /* Autocomplete (remote meds.txt + local substances) */
    let MEDS=[], medsLoaded=false; const FALLBACK=['Depon 500mg','Panadol 500mg','Augmentin 875mg/125mg','Nurofen 400mg','Algofren 400mg'];
    async function loadMeds(){ if(medsLoaded) return; try{ const r=await fetch('/data/meds.txt',{cache:'no-store'}); if(!r.ok) throw 0; const txt=await r.text(); MEDS = txt.split(/\r?\n/).map(s=>s.trim()).filter(Boolean); }catch{ MEDS=FALLBACK; } finally{ medsLoaded=true; } }
    const strip = s=>s.normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase();
    const debounce = (fn,ms)=>{let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),ms);};};
    function highlight(text,q){ const A=strip(text), B=strip(q); const i=A.indexOf(B); if(i<0||!q) return text; return text.substring(0,i)+'<b>'+text.substring(i,i+q.length)+'</b>'+text.substring(i+q.length); }

    function attachRemoteAutocomplete(inputId,listId){
      const input=document.getElementById(inputId), list=document.getElementById(listId);
      let idx=-1, current=[];
      function render(items,q){ list.innerHTML = items.map((x,i)=>`<div class="ac-item px-3 py-2 text-sm hover:bg-brand-50 dark:hover:bg-slate-800 ${i===idx?'bg-brand-50 dark:bg-slate-800':''}" data-val="${x}"><span class="match">${highlight(x,q)}</span></div>`).join(''); list.classList.toggle('hidden',items.length===0); }
      const filter = debounce(q=>{ if(q.length<2){ render([],q); return; } const Q=strip(q); current=(MEDS||[]).filter(s=>strip(s).includes(Q)).slice(0,8); render(current,q); },120);
      input.addEventListener('focus', loadMeds);
      input.addEventListener('input', ()=>{ idx=-1; filter(input.value.trim()); });
      input.addEventListener('keydown',(e)=>{ const items=[...list.querySelectorAll('.ac-item')]; if(e.key==='ArrowDown'&&items.length){ idx=(idx+1)%items.length; render(current,input.value.trim()); e.preventDefault(); } else if(e.key==='ArrowUp'&&items.length){ idx=(idx-1+items.length)%items.length; render(current,input.value.trim()); e.preventDefault(); } else if(e.key==='Enter'&&idx>=0){ input.value=items[idx].dataset.val; list.classList.add('hidden'); e.preventDefault(); } else if(e.key==='Escape'){ list.classList.add('hidden'); }});
      list.addEventListener('click',(e)=>{ const it=e.target.closest('.ac-item'); if(!it) return; input.value=it.dataset.val; list.classList.add('hidden'); });
      document.addEventListener('click', (e)=>{ if(!list.contains(e.target)&&e.target!==input){ list.classList.add('hidden'); }});
    }
    attachRemoteAutocomplete('medicine-name','ac-medicine');

    function attachLocalAutocomplete(inputId,listId,data){
      const input=document.getElementById(inputId), list=document.getElementById(listId);
      let idx=-1;
      const filter=debounce(q=>{ if(!q){ list.classList.add('hidden'); list.innerHTML=''; return; } const Q=strip(q); const r=data.filter(x=>strip(x).includes(Q)).slice(0,5); list.innerHTML=r.map((x,i)=>`<div class="ac-item px-3 py-2 text-sm hover:bg-brand-50 dark:hover:bg-slate-800 ${i===idx?'bg-brand-50 dark:bg-slate-800':''}" data-val="${x}"><span class="match">${highlight(x,q)}</span></div>`).join(''); list.classList.toggle('hidden',r.length===0); },120);
      input.addEventListener('input',()=>{ idx=-1; filter(input.value.trim()); });
      list.addEventListener('click',(e)=>{ const it=e.target.closest('.ac-item'); if(!it) return; input.value=it.dataset.val; list.classList.add('hidden'); });
      document.addEventListener('click',(e)=>{ if(!list.contains(e.target)&&e.target!==input){ list.classList.add('hidden'); }});
    }
    attachLocalAutocomplete('active-substance','ac-substance',['Paracetamol 500mg','Ibuprofen 400mg','Amoxicillin 500mg','Aspirin 100mg']);

    /* Submit â†’ Pending â†’ (poll) â†’ Results */
    const form = document.getElementById('medicine-form');
    const resultsList = document.getElementById('results-list');
    const pendingStatus = document.getElementById('pending-status');

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      showToast('âœ… Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· ÏƒÏ„Î¬Î»Î¸Î·ÎºÎµ');
      // Î”Î·Î¼Î¹Î¿ÏÏÎ³Î·ÏƒÎµ requestId (client-side demo)
      const requestId = 'req_'+Date.now();
      // Î•Î´Ï ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¬ Î¸Î± ÎºÎ±Î»Î¿ÏÏƒÎµÏ‚ function Ï€.Ï‡. /.netlify/functions/send-request Î¼Îµ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î±.
      startPending(requestId);
    });

    let pollTimer=null, demoTimer=null;
    function startPending(requestId){
      goTo('screen-pending');
      pendingStatus.textContent = 'Pendingâ€¦';
      clearInterval(pollTimer); clearTimeout(demoTimer);

      // --- Î ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ polling Ï€ÏÎ¿Ï‚ backend (ÏŒÏ„Î±Î½ ÎµÎ¯Î½Î±Î¹ Î­Ï„Î¿Î¹Î¼Î¿Ï‚) ---
      async function poll(){
        try{
          const r = await fetch(`/.netlify/functions/request-status?id=${encodeURIComponent(requestId)}`, { cache:'no-store' });
          if(!r.ok) throw 0;
          const data = await r.json(); // {status:'pending'|'ready', items:[...] }
          if(data.status === 'ready' && Array.isArray(data.items)){
            onPharmacyReply(data.items);
            return;
          }
          pendingStatus.textContent = 'Pendingâ€¦ (ÎºÎ±Î¼Î¯Î± Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Î±ÎºÏŒÎ¼Î·)';
        }catch{
          pendingStatus.textContent = 'Pendingâ€¦';
        }
      }
      pollTimer = setInterval(poll, 5000);

      // --- Demo fallback (Ï‡Ï‰ÏÎ¯Ï‚ backend) Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ 8s ---
      demoTimer = setTimeout(()=>{
        const med = (document.getElementById('medicine-name').value || 'Paracetamol 500mg');
        const demoItems = [
          {name:'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ Î™Î¬ÎºÏ‰Î²Î¿Ï‚', dist:'2.1km', eta:'ÎˆÏ„Î¿Î¹Î¼Î¿ ÏƒÎµ 20â€™', phone:'+302103001234', addr:'Î‘Î¸Î®Î½Î±', avail:true, q:med, lat:37.98, lng:23.73},
          {name:'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ Î•Î»Î­Î½Î·',   dist:'1.3km', eta:'Î Î±ÏÎ±Î»Î±Î²Î® ÏƒÎµ 35â€™', phone:'+302103009876', addr:'Î‘Î¸Î®Î½Î±', avail:true, q:med, lat:37.98, lng:23.75}
        ];
        onPharmacyReply(demoItems);
      }, 8000);
    }

    function onPharmacyReply(items){
      clearInterval(pollTimer); clearTimeout(demoTimer);
      // Î¦Ï„Î¹Î¬Î¾Îµ Î»Î¯ÏƒÏ„Î± Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î¬Ï„Ï‰Î½ (Ï‡Ï‰ÏÎ¯Ï‚ Ï„Î¹Î¼Î­Ï‚)
      resultsList.innerHTML = (items||[]).map((p,i)=>`
        <article class="rounded-xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200/70 dark:border-slate-800 p-4 flex items-center justify-between">
          <div class="flex items-center gap-3">
            <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f48a.png" class="w-10 h-10" alt="">
            <div>
              <div class="font-semibold">${p.name}</div>
              <div class="text-xs text-slate-500 dark:text-slate-400">${p.dist || ''} Â· ${p.eta || 'Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿'} Â· ${p.q || ''}</div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-xs px-2 py-1 rounded-lg bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-200">${p.avail ? 'Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿' : 'ÎœÎ· Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿'}</span>
            <button class="reserve px-4 py-2 rounded-xl bg-emerald-600 text-white font-semibold hover:bg-emerald-700" data-idx="${i}">ÎšÏÎ¬Ï„Î·ÏƒÎ· 60â€™</button>
          </div>
        </article>`).join('');
      goTo('screen-results');
      // Attach reserve handlers
      resultsList.querySelectorAll('.reserve').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const p = items[btn.dataset.idx];
          openHold(p);
        });
      });
      showToast('Î‰ÏÎ¸Î±Î½ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Ï‰Î½');
    }

    /* Hold screen + countdown + actions */
    let countdownTimer=null, remaining=0;
    const holdTTL = document.getElementById('hold-ttl');
    function startCountdown(seconds=3600){
      remaining = seconds; updateTTL();
      clearInterval(countdownTimer);
      countdownTimer = setInterval(()=>{ remaining--; if(remaining<=0){ clearInterval(countdownTimer); } updateTTL(); }, 1000);
    }
    function updateTTL(){ const m=String(Math.floor(remaining/60)).padStart(2,'0'); const s=String(remaining%60).padStart(2,'0'); holdTTL.textContent=`${m}:${s}`; }

    function openHold(p){
      document.getElementById('hold-name').textContent = p.name;
      document.getElementById('hold-meta').textContent = `${p.addr || ''} Â· ${p.q || ''}`;
      document.getElementById('hold-call').href = p.phone ? `tel:${p.phone}` : '#';
      const q = encodeURIComponent((p.name||'')+' '+(p.addr||''));
      const maps = (p.lat && p.lng) ? `https://www.google.com/maps/search/?api=1&query=${p.lat},${p.lng}` : `https://www.google.com/maps/search/?api=1&query=${q}`;
      document.getElementById('hold-directions').href = maps;

      goTo('screen-hold');
      startCountdown(60*60);
      fireConfetti(1600);
      showToast('Î”ÎµÏƒÎ¼ÎµÏÏ„Î·ÎºÎµ Î³Î¹Î± 60â€™');
    }
    document.getElementById('hold-done').addEventListener('click', ()=>{ showToast('ÎšÎ±Î»Î® ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±!'); goTo('screen-results'); });

    /* Scanner */
    const scanBtn = document.getElementById('scan-barcode'), stopBtn=document.getElementById('stop-scan'), scanArea=document.getElementById('scan-area'), videoEl=document.getElementById('preview'), rxInput=document.getElementById('rx-number'), torchBtn=document.getElementById('toggle-torch');
    let mediaStream=null, scanning=false, zxingReader=null, zxingInterval=null, videoTrack=null;

    async function loadZXing(){ if(window.ZXing) return; const src=document.getElementById('zxing-lib').getAttribute('data-src'); await new Promise((res,rej)=>{ const s=document.createElement('script'); s.src=src; s.onload=res; s.onerror=rej; document.body.appendChild(s); }); }

    async function startScan(){
      if (!window.isSecureContext || location.protocol !== 'https:') { showToast('âš ï¸ Î— ÎºÎ¬Î¼ÎµÏÎ± Î±Ï€Î±Î¹Ï„ÎµÎ¯ HTTPS.'); return; }
      scanArea.classList.remove('hidden');
      try{
        const c1={ video:{ facingMode:{ideal:'environment'} }, audio:false }, c2={ video:true, audio:false };
        mediaStream=await navigator.mediaDevices.getUserMedia(c1).catch(()=>null); if(!mediaStream) mediaStream=await navigator.mediaDevices.getUserMedia(c2);
        videoEl.srcObject=mediaStream; videoEl.muted=true; videoEl.setAttribute('playsinline','true'); await videoEl.play(); scanning=true;
        videoTrack=mediaStream.getVideoTracks()[0]; const caps=videoTrack.getCapabilities?videoTrack.getCapabilities():{};
        if(caps && 'torch' in caps){ torchBtn.classList.remove('hidden'); } else { torchBtn.classList.add('hidden'); }

        if('BarcodeDetector' in window){
          const detector = new BarcodeDetector({ formats:['code_128','ean_13','qr_code','upc_a','upc_e','code_39','itf','codabar','data_matrix','pdf417','aztec'] });
          const loop=async()=>{ if(!scanning) return; try{ const res=await detector.detect(videoEl); if(res && res.length){ rxInput.value=res[0].rawValue||''; stopScan(); return; } }catch{} requestAnimationFrame(loop); }; loop();
        }else{
          await loadZXing(); const { BrowserMultiFormatReader } = window.ZXing; zxingReader=new BrowserMultiFormatReader();
          zxingInterval=setInterval(async()=>{ if(!scanning) return; try{ const r=await zxingReader.decodeOnceFromVideoDevice(undefined, videoEl); if(r && r.text){ rxInput.value=r.text; stopScan(); } }catch{} }, 700);
        }
      }catch(e){ console.error('Camera error:', e); showToast('âš ï¸ Î‘Ï€Î¿Ï„Ï…Ï‡Î¯Î± Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÏ„Î·Î½ ÎºÎ¬Î¼ÎµÏÎ±.'); stopScan(); }
    }
    function stopScan(){ scanning=false; if(zxingInterval){clearInterval(zxingInterval); zxingInterval=null;} if(zxingReader){try{zxingReader.reset();}catch{} zxingReader=null; } if(mediaStream){ mediaStream.getTracks().forEach(t=>t.stop()); mediaStream=null; } videoEl.pause(); videoEl.srcObject=null; scanArea.classList.add('hidden'); torchBtn.classList.add('hidden'); }
    let torchOn=false; torchBtn.addEventListener('click', async ()=>{ if(!videoTrack||!videoTrack.applyConstraints) return; try{ torchOn=!torchOn; await videoTrack.applyConstraints({advanced:[{torch:torchOn}]}); torchBtn.textContent = torchOn ? 'ğŸ”¦ On' : 'ğŸ”¦'; }catch(e){ console.warn('Torch not supported:', e); }});
    scanBtn.addEventListener('click', startScan); stopBtn.addEventListener('click', stopScan);

    /* Confetti */
    const confettiCanvas=document.getElementById('confetti'); const ctx=confettiCanvas.getContext('2d');
    function fireConfetti(duration=1600){
      confettiCanvas.width=innerWidth; confettiCanvas.height=innerHeight; confettiCanvas.style.display='block';
      const particles = Array.from({length: 180}, ()=> ({ x:Math.random()*innerWidth, y:-20, vx:(Math.random()-.5)*3, vy:Math.random()*3+2.5, size:Math.random()*6+3, color:['#F78DA7','#84C5F4','#C3A6F4','#FFE08A','#9DE0D6'][Math.floor(Math.random()*5)], rot:Math.random()*360, vr:(Math.random()-.5)*12 }));
      let start=performance.now(); function tick(ts){ const elapsed=ts-start; ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); particles.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; p.vy+=0.04; p.rot+=p.vr; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot*Math.PI/180); ctx.fillStyle=p.color; ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size); ctx.restore(); }); if(elapsed<duration){ requestAnimationFrame(tick); } else { confettiCanvas.style.display='none'; } } requestAnimationFrame(tick);
    }

    /* GDPR modal */
    const gdprModal=document.getElementById('gdpr-modal'), gdprOpen=document.getElementById('gdpr-open'), gdprClose=document.getElementById('gdpr-close'), gdprAccept=document.getElementById('gdpr-accept');
    function closeGDPR(){ gdprModal.classList.add('hidden'); gdprModal.classList.remove('flex'); }
    gdprOpen.addEventListener('click', ()=>{ gdprModal.classList.remove('hidden'); gdprModal.classList.add('flex'); });
    gdprClose.addEventListener('click', closeGDPR); gdprAccept.addEventListener('click', closeGDPR); gdprModal.addEventListener('click', (e)=>{ if(e.target===gdprModal) closeGDPR(); });
  </script>
</body>
</html>
