<!DOCTYPE html>
<html lang="el" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>MediRadar</title>

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/icons/mediradar-mark.svg">

  <!-- Android/Chrome PWA -->
  <meta name="mobile-web-app-capable" content="yes">
  <!-- iOS PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">

  <!-- Tailwind (dev Î¼Îµ CDN). Î“Î¹Î± production build Î¸Î± Ï„Î¿ Î±Î»Î»Î¬Î¾Î¿Ï…Î¼Îµ ÏƒÎµ PostCSS/CLI. -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter','ui-sans-serif','system-ui'] },
          colors: { brand: { 500:'#29a3a3', 600:'#208181', 700:'#196464' } },
          boxShadow: { soft:'0 16px 40px rgba(2,6,23,.12)' }
        }
      }
    }
  </script>

  <style>
    .app-bg{
      background:
        radial-gradient(1100px 600px at 0% -10%, rgba(132,197,244,.30), transparent 60%),
        radial-gradient(900px 540px at 110% 0%, rgba(199,166,244,.22), transparent 58%),
        radial-gradient(1000px 600px at 25% 120%, rgba(247,141,167,.18), transparent 62%),
        radial-gradient(800px 520px at 120% 120%, rgba(157,224,214,.20), transparent 60%),
        linear-gradient(180deg, #f6fbfb 0%, #f8fafc 40%, #fbfcfe 100%);
    }
    .dark .app-bg{
      background:
        radial-gradient(1100px 600px at 0% -10%, rgba(132,197,244,.16), transparent 60%),
        radial-gradient(900px 540px at 110% 0%, rgba(199,166,244,.14), transparent 58%),
        radial-gradient(1000px 600px at 25% 120%, rgba(247,141,167,.12), transparent 62%),
        radial-gradient(800px 520px at 120% 120%, rgba(157,224,214,.12), transparent 60%),
        linear-gradient(180deg, #0b1515, #0b1515 45%, #0b1515 100%);
    }
    .ac-list { position:absolute; inset-inline:0; top:100%; z-index:40 }
    .ac-item { cursor:pointer }
    .badge { display:inline-flex; align-items:center; gap:6px; padding:.25rem .5rem; border-radius:999px; font-size:.75rem; }
    /* Î¼Î¹ÎºÏÏŒ, Î´Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÏŒ toast Î³Î¹Î± ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ */
    #push-toast { transition: transform .25s ease, opacity .25s ease; }
    #push-toast.hidden { opacity:0; pointer-events:none; transform: translateY(6px); }
    .lang-btn { transition: all .2s ease; }
    .lang-btn[data-active="true"] {
      background: linear-gradient(135deg, #29a3a3, #208181);
      color: #fff;
      box-shadow: 0 12px 24px rgba(32,129,129,.25);
    }
    .dark .lang-btn[data-active="true"] {
      background: linear-gradient(135deg, #7edbd9, #4cc2c1);
      color: #062322;
    }
    .flag-icon { display:inline-flex; align-items:center; justify-content:center; }
    .flag-icon svg { width:24px; height:16px; border-radius:2px; box-shadow:0 0 0 1px rgba(15,23,42,.15); }
    .dark .flag-icon svg { box-shadow:0 0 0 1px rgba(148,163,184,.4); }
    .barcode-highlight { box-shadow:0 0 0 3px rgba(16,185,129,.45); }
    #celebration-overlay { transition: opacity .35s ease; opacity:0; }
    #celebration-overlay.flex { opacity:1; }
    #celebration-overlay.hiding { opacity:0; }
    #celebration-overlay .success-mark { transform:scale(.85); opacity:0; }
    #celebration-overlay .success-mark.animate-in { animation: successPop .6s ease forwards, successFade .5s ease forwards 2.4s; }
    @keyframes successPop { to { transform:scale(1); opacity:1; } }
    @keyframes successFade { to { transform:scale(.92); opacity:0; } }
    .floating-emoji { position:absolute; bottom:-12%; font-size:2.5rem; opacity:0; animation: floatUp 3s ease-in forwards; }
    @keyframes floatUp { 0%{ transform:translateY(40px) scale(.85); opacity:0; } 15%{ opacity:1; } 70%{ opacity:1; } 100%{ transform:translateY(-120%) scale(1.1); opacity:0; } }
  </style>

  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#29a3a3" />
</head>
<body class="min-h-full app-bg text-slate-900 dark:text-slate-200 font-sans">

  <!-- Success celebration overlay -->
  <div id="celebration-overlay" class="fixed inset-0 hidden pointer-events-none z-[60] items-center justify-center">
    <div class="absolute inset-0 bg-gradient-to-b from-transparent via-white/70 to-transparent dark:via-slate-900/60"></div>
    <div data-emoji-container class="absolute inset-0 overflow-hidden"></div>
    <div class="relative flex flex-col items-center gap-4 pointer-events-auto" role="status" aria-live="assertive">
      <div class="success-mark w-28 h-28 rounded-full bg-white/95 dark:bg-slate-900/90 border-4 border-emerald-400/70 shadow-2xl flex items-center justify-center text-emerald-500">
        <svg viewBox="0 0 48 48" class="w-16 h-16" aria-hidden="true">
          <circle cx="24" cy="24" r="22" fill="none" stroke="currentColor" stroke-opacity="0.18" stroke-width="4" />
          <path d="M16 24l6 6 12-12" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="5" />
        </svg>
      </div>
      <p id="celebration-message" class="text-lg font-semibold text-slate-700 dark:text-slate-100 drop-shadow">Î— Î±Î¯Ï„Î·ÏƒÎ· ÏƒÏ„Î¬Î»Î¸Î·ÎºÎµ!</p>
    </div>
  </div>

  <!-- Top bar -->
  <div class="absolute top-3 left-3 right-3 z-50">
    <div class="flex flex-wrap items-center justify-between gap-3 sm:gap-4">
      <button id="pro-trigger" data-open-pro type="button" class="flex items-center gap-2 px-3 py-1.5 text-sm font-semibold rounded-2xl bg-white/80 dark:bg-white/10 border border-slate-200 dark:border-slate-700 backdrop-blur shadow-sm hover:bg-white dark:hover:bg-white/20">
        <span aria-hidden="true">ğŸ’¼</span>
        <span id="t-pro">Î“Î¹Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±</span>
      </button>

      <div class="flex items-center gap-2 rounded-2xl bg-white/80 dark:bg-white/10 border border-slate-200 dark:border-slate-700 backdrop-blur px-2 py-1 shadow-sm">
        <div class="flex items-center gap-1">
          <button id="lang-el" type="button" class="lang-btn px-3 py-1.5 text-xs sm:text-sm font-semibold rounded-xl flex items-center gap-2 bg-white/60 dark:bg-white/10 text-slate-800 dark:text-slate-200 hover:bg-white dark:hover:bg-white/20">
            <span aria-hidden="true" class="flag-icon">
              <svg viewBox="0 0 28 20" role="presentation" focusable="false" xmlns="http://www.w3.org/2000/svg">
                <rect width="28" height="20" fill="#0d5eaf"></rect>
                <g fill="#ffffff">
                  <rect y="2" width="28" height="2"></rect>
                  <rect y="6" width="28" height="2"></rect>
                  <rect y="10" width="28" height="2"></rect>
                  <rect y="14" width="28" height="2"></rect>
                  <rect y="18" width="28" height="2"></rect>
                </g>
                <rect width="10" height="10" fill="#0d5eaf"></rect>
                <rect x="4" width="2" height="10" fill="#ffffff"></rect>
                <rect y="4" width="10" height="2" fill="#ffffff"></rect>
              </svg>
            </span>
            <span id="t-langElLabel" class="hidden sm:inline">Î•Î»Î»Î·Î½Î¹ÎºÎ¬</span>
            <span class="sm:hidden">EL</span>
          </button>
          <button id="lang-en" type="button" class="lang-btn px-3 py-1.5 text-xs sm:text-sm font-semibold rounded-xl flex items-center gap-2 bg-white/60 dark:bg-white/10 text-slate-800 dark:text-slate-200 hover:bg-white dark:hover:bg-white/20">
            <span aria-hidden="true" class="flag-icon">
              <svg viewBox="0 0 30 20" role="presentation" focusable="false" xmlns="http://www.w3.org/2000/svg">
                <rect width="30" height="20" fill="#012169"></rect>
                <path d="M0 0L30 20M30 0L0 20" stroke="#ffffff" stroke-width="6" stroke-linecap="square"></path>
                <path d="M0 0L30 20M30 0L0 20" stroke="#c8102e" stroke-width="2.5" stroke-linecap="square"></path>
                <rect x="13" width="4" height="20" fill="#ffffff"></rect>
                <rect y="8" width="30" height="4" fill="#ffffff"></rect>
                <rect x="14" width="2" height="20" fill="#c8102e"></rect>
                <rect y="9" width="30" height="2" fill="#c8102e"></rect>
              </svg>
            </span>
            <span id="t-langEnLabel" class="hidden sm:inline">Î‘Î³Î³Î»Î¹ÎºÎ¬</span>
            <span class="sm:hidden">EN</span>
          </button>
        </div>

        <button id="theme-toggle" type="button" class="px-2.5 py-1.5 rounded-xl hover:bg-white dark:hover:bg-white/20">
          <span id="icon-sun" class="hidden">ğŸŒ</span><span id="icon-moon">ğŸŒ™</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Pending full overlay -->
  <div id="pending-overlay" class="fixed inset-0 hidden z-[70] items-center justify-center px-4">
    <div class="w-full max-w-2xl">
      <div class="relative overflow-hidden rounded-3xl border border-amber-400/70 bg-gradient-to-br from-amber-400 via-amber-500 to-orange-500 text-white shadow-soft">
        <div class="absolute -right-20 -top-20 h-60 w-60 rounded-full bg-white/10 blur-2xl"></div>
        <div class="absolute -left-16 bottom-[-60px] h-56 w-56 rounded-full bg-white/5 blur-3xl"></div>
        <div class="relative flex flex-col items-center gap-6 px-8 py-10 text-center sm:px-10">
          <div class="space-y-3">
            <h3 id="pending-overlay-headline" class="text-2xl font-bold leading-tight sm:text-3xl">Î¤Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± ÎµÎ½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎ±Î½!</h3>
            <p id="pending-overlay-message" class="text-sm text-white/90 sm:text-base">ÎŸÎ¹ ÏƒÏ…Î½ÎµÏÎ³Î¬Ï„ÎµÏ‚ Î¼Î±Ï‚ Î¾ÎµÎºÎ¹Î½Î¿ÏÎ½ Ï„Î·Î½ Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ· ÎºÎ±Î¹ Î¸Î± ÎµÎ½Î·Î¼ÎµÏÏÏƒÎ¿Ï…Î½ ÏƒÏÎ½Ï„Î¿Î¼Î±.</p>
          </div>
          <div id="loading-message" class="text-sm text-white/90 sm:text-base" aria-live="polite"></div>
          <div id="pending-overlay-status" class="flex items-center gap-2 rounded-full bg-black/25 px-4 py-2 text-xs font-semibold uppercase tracking-wide sm:text-sm" role="status" aria-live="polite">
            <span id="pending-overlay-status-text">Î‘Î½Î±Î¼Î¿Î½Î® Î±Ï€Î±Î½Ï„Î®ÏƒÎµÏ‰Î½</span>
            <span id="pending-overlay-elapsed" class="text-white/80">0s</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Î¼Î¹ÎºÏÏŒ push toast -->
  <div id="push-toast" class="hidden fixed bottom-4 left-1/2 -translate-x-1/2 z-40 w-[min(680px,94vw)]">
    <div class="rounded-2xl p-4 border border-sky-300/70 bg-sky-50 text-sky-900 dark:bg-sky-900/30 dark:text-sky-100 dark:border-sky-800 shadow-soft flex items-center justify-between gap-3">
      <div class="text-sm">
        ğŸ”” Î˜ÎµÏ‚ Î½Î± Î»Î±Î¼Î²Î¬Î½ÎµÎ¹Ï‚ ÎµÎ¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÏŒÏ„Î±Î½ Î±Ï€Î±Î½Ï„Î¬ Î­Î½Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿;
      </div>
      <div class="flex gap-2">
        <button id="push-deny" class="px-3 py-1.5 rounded-xl border hover:bg-white/70 dark:hover:bg-white/10 text-sm">ÎŒÏ‡Î¹ Ï„ÏÏÎ±</button>
        <button id="push-allow" class="px-3 py-1.5 rounded-xl bg-brand-600 text-white font-semibold text-sm">Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ·</button>
      </div>
    </div>
  </div>

  <!-- SPLASH -->
  <section id="splash" class="min-h-[100svh] grid place-items-center relative px-4">
    <div class="w-full max-w-4xl text-center">
      <div class="mx-auto w-52 sm:w-64">
        <svg class="w-full h-auto drop-shadow-xl" viewBox="0 0 300 200" role="img" aria-labelledby="hero-logo-title hero-logo-desc">
          <title id="hero-logo-title">Î›Î¿Î³ÏŒÏ„Ï…Ï€Î¿ MediRadar</title>
          <desc id="hero-logo-desc">Î ÎµÏ„Î±Î»Î¿ÏÎ´Î± Î¼Îµ Ï‡Î¬Ï€Î¹ ÎºÎ±Î¹ ÏÎ±Î½Ï„Î¬Ï Ï€Î¿Ï… ÏƒÏ‡Î·Î¼Î±Ï„Î¯Î¶Î¿Ï…Î½ Ï„Î¿ MediRadar</desc>
          <style>
            .wing {
              transition: transform 0.4s ease;
              transform-origin: center;
            }
            svg:hover .left-wing,
            svg:active .left-wing {
              transform: rotate(-5deg);
            }
            svg:hover .right-wing,
            svg:active .right-wing {
              transform: rotate(5deg);
            }
            @media (prefers-reduced-motion: reduce) {
              .wing {
                transition: none;
                transform: none !important;
              }
            }
          </style>

          <g class="wing left-wing">
            <path d="M80 100 C60 60, 60 140, 80 100" fill="#4A90E2" stroke="#1A2A4F" stroke-width="4"/>
            <path d="M80 100 C100 140, 100 60, 80 100" fill="#C0C0C0" stroke="#1A2A4F" stroke-width="4"/>
            <circle cx="75" cy="85" r="4" fill="#1A2A4F"/>
            <circle cx="85" cy="85" r="4" fill="#1A2A4F"/>
            <path d="M75 95 Q80 100, 85 95" stroke="#1A2A4F" stroke-width="2" fill="none"/>
          </g>

          <g class="wing right-wing">
            <path d="M220 100 C240 60, 240 140, 220 100" fill="#A0E57A" stroke="#1A2A4F" stroke-width="4"/>
            <path d="M220 100 C200 140, 200 60, 220 100" fill="#FFFFFF" stroke="#1A2A4F" stroke-width="4"/>
            <circle cx="220" cy="100" r="8" stroke="#1A2A4F" stroke-width="2" fill="none"/>
            <circle cx="220" cy="100" r="16" stroke="#1A2A4F" stroke-width="2" fill="none"/>
            <circle cx="220" cy="100" r="24" stroke="#1A2A4F" stroke-width="2" fill="none"/>
            <circle cx="220" cy="76" r="4" fill="#1A2A4F"/>
            <circle cx="240" cy="100" r="4" fill="#1A2A4F"/>
            <circle cx="220" cy="124" r="4" fill="#1A2A4F"/>
          </g>

          <text x="90" y="180" font-family="Arial, sans-serif" font-size="24" fill="#1A2A4F">MediRadar</text>
        </svg>
      </div>
      <h1 class="sr-only">MediRadar</h1>
      <p id="t-hero" class="mt-6 text-lg text-slate-600 dark:text-slate-400">Î†Î¼ÎµÏƒÎ· ÎµÏÏÎµÏƒÎ· Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚ Ï†Î±ÏÎ¼Î¬ÎºÏ‰Î½ ÏƒÎµ ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±.</p>

      <div class="mt-8 flex flex-col items-center gap-4 max-w-3xl mx-auto">
        <button id="cta-search" class="w-full sm:max-w-xl px-6 py-4 sm:py-5 sm:px-7 rounded-2xl bg-gradient-to-r from-brand-500 to-brand-600 text-white font-semibold shadow-soft hover:opacity-95 transform scale-[1.05] sm:scale-[1.1] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500">
          <span id="t-searchBTN">Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…</span>
        </button>
        <button id="cta-how" class="w-full sm:max-w-lg px-6 py-4 rounded-2xl bg-white/85 backdrop-blur border border-slate-200 hover:bg-white font-semibold focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500">
          <span id="t-howBTN">Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯</span>
        </button>
      </div>

      <button id="cta-install" class="mt-4 inline-flex items-center gap-2 px-4 py-2 rounded-xl border border-brand-600 text-brand-700 font-semibold bg-white/80 backdrop-blur hover:bg-white hidden">
        ğŸ“² <span id="t-installBTN">Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</span>
      </button>

      
    </div>
  </section>

  <!-- APP -->
  <main id="app" class="hidden mx-auto max-w-3xl px-4 pb-16">
    <header class="sticky top-0 z-30 -mt-3 mb-4">
      <div class="flex items-center justify-between px-2 py-3 rounded-2xl bg-white/80 dark:bg-slate-900/70 backdrop-blur border border-slate-200 dark:border-slate-800">
        <div class="flex items-center gap-2">
          <button id="backHome" type="button" data-go-home class="px-3 py-1.5 rounded-lg border text-sm hover:bg-slate-50 dark:hover:bg-slate-800">â† <span id="t-home">Î‘ÏÏ‡Î¹ÎºÎ®</span></button>
          <span id="t-searchTitle" class="font-semibold">Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…</span>
        </div>
      </div>
    </header>

    <section class="grid grid-cols-1 gap-4 sm:gap-5">
      <!-- City -->
      <div class="rounded-2xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4 shadow-soft">
        <label class="text-sm font-semibold flex items-center gap-2">
          <span class="w-6 h-6 grid place-items-center">ğŸ“</span>
          <span id="t-city">Î ÏŒÎ»Î·</span>
        </label>
        <div class="mt-2 relative">
          <input id="city" type="text" required autocomplete="off" placeholder="Ï€.Ï‡. Î‘Î¸Î®Î½Î±"
                 class="w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-500/30" />
          <div id="ac-city" class="ac-list hidden rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-lg"></div>
        </div>
      </div>

      <!-- Medicine -->
      <div class="rounded-2xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4 shadow-soft">
        <label class="text-sm font-semibold flex items-center gap-2">
          <span class="w-6 h-6 grid place-items-center">ğŸ”</span>
          <span id="t-medname">ÎŒÎ½Î¿Î¼Î± Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…</span>
        </label>
        <div class="mt-2 relative">
          <input id="medicine-name" type="text" autocomplete="off"
                 class="w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-500/30 placeholder:text-slate-400"
                 placeholder="Ï€.Ï‡. Augmentin 875mg" />
          <div id="ac-medicine" class="ac-list hidden rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-lg"></div>
        </div>
        <p class="mt-2 text-xs text-slate-500 dark:text-slate-400" id="t-formatTip">Î£Ï…Î¼Î²Î¿Ï…Î»Î®: Î•Î¼Ï€Î¿ÏÎ¹ÎºÎ® Î¿Î½Î¿Î¼Î±ÏƒÎ¯Î± + Î´Î¿ÏƒÎ¿Î»Î¿Î³Î¯Î± (Ï€.Ï‡. â€œ500mgâ€).</p>
        <div class="mt-4 rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-900/40 p-4">
          <div class="flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
            <div class="space-y-1">
              <div class="text-sm font-semibold flex items-center gap-2">
                <span class="w-6 h-6 grid place-items-center">ğŸ“·</span>
                <span id="t-barcodeTitle">Î£Î¬ÏÏ‰ÏƒÎ· barcode ÏƒÏ…Î½Ï„Î±Î³Î®Ï‚ Î® ÎºÎ¿Ï…Ï„Î¹Î¿Ï</span>
                <span id="t-barcodeOptional" class="text-xs font-normal text-slate-400">(Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬)</span>
              </div>
              <p id="t-barcodeHelp" class="text-xs text-slate-500 dark:text-slate-400">Î£Î¬ÏÏ‰ÏƒÎµ Ï„Î¿Î½ Î³ÏÎ±Î¼Î¼Ï‰Ï„ÏŒ ÎºÏ‰Î´Î¹ÎºÏŒ Î³Î¹Î± Î½Î± ÏƒÏ…Î¼Ï€Î»Î·ÏÏ‰Î¸ÎµÎ¯ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î±.</p>
            </div>
            <button id="barcode-start" type="button" class="inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-slate-900 text-white text-xs sm:text-sm font-semibold shadow-soft hover:bg-slate-700 dark:bg-slate-100 dark:text-slate-900 dark:hover:bg-slate-200">
              <span aria-hidden="true">ğŸ“¸</span>
              <span id="t-barcodeStart">Î†Î½Î¿Î¹Î³Î¼Î± ÎºÎ¬Î¼ÎµÏÎ±Ï‚</span>
            </button>
          </div>
          <input id="barcode-value" type="text" inputmode="numeric" pattern="[0-9]*" class="mt-3 w-full px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 bg-white/95 dark:bg-slate-900 focus:outline-none focus:ring-4 focus:ring-brand-500/30 placeholder:text-slate-400" placeholder="ÎŸ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ Î¸Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„ÎµÎ¯ ÎµÎ´Ï" autocomplete="off" />
        </div>
      </div>

      <!-- Quantity + Type -->
      <div class="grid sm:grid-cols-2 gap-4">
        <div class="rounded-2xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4 shadow-soft">
          <label class="text-sm font-semibold flex items-center gap-2">
            <span class="w-6 h-6 grid place-items-center">ğŸ“¦</span>
            <span id="t-qty">Î Î¿ÏƒÏŒÏ„Î·Ï„Î± (Ï„ÎµÎ¼Î¬Ï‡Î¹Î±/ÎºÎ¿Ï…Ï„Î¹Î¬)</span>
          </label>
          <input id="quantity" type="number" min="1" value="1" required
                 class="mt-2 w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-500/30" />
        </div>

        <div class="rounded-2xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4 shadow-soft">
          <label class="text-sm font-semibold flex items-center gap-2">
            <span class="w-6 h-6 grid place-items-center">ğŸ’Š</span>
            <span id="t-type">Î¤ÏÏ€Î¿Ï‚ Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…</span>
          </label>
          <select id="medicine-type"
                  class="mt-2 w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-500/30">
            <option value="">â€” Î•Ï€Î¹Î»Î¿Î³Î® â€”</option>
            <option>Î§Î¬Ï€Î¹</option><option>ÎšÎ¬ÏˆÎ¿Ï…Î»Î±</option><option>Î£ÎºÏŒÎ½Î·</option>
            <option>Î¥Î³ÏÏŒ</option><option>Î£Î¹ÏÏŒÏ€Î¹</option><option>Î£Ï„Î±Î³ÏŒÎ½ÎµÏ‚</option>
            <option>Î•Î¹ÏƒÏ€Î½ÎµÏŒÎ¼ÎµÎ½Î¿</option><option>Î£Ï€ÏÎ­Î¹</option><option>Î¡Î¹Î½Î¹ÎºÏŒ ÏƒÏ€ÏÎ­Î¹</option>
            <option>ÎŸÏ†Î¸Î±Î»Î¼Î¹ÎºÎ­Ï‚ ÏƒÏ„Î±Î³ÏŒÎ½ÎµÏ‚</option><option>Î‘Î»Î¿Î¹Ï†Î®</option><option>Î”ÎµÏÎ¼Î±Ï„Î¹ÎºÎ® ÎšÏÎ­Î¼Î±</option>
            <option>Î–ÎµÎ»Î­</option><option>Î•Ï€Î¯Î¸ÎµÎ¼Î±</option><option>Î¥Ï€ÏŒÎ¸ÎµÏ„Î¿</option>
            <option>Î Î­Î½Î± (Ï€ÏÎ¿Î³ÎµÎ¼Î¹ÏƒÎ¼Î­Î½Î·)</option><option>Î”Î¹Î¬Î»Ï…Î¼Î± Î­Î³Ï‡Ï…ÏƒÎ·Ï‚</option>
          </select>
        </div>
      </div>

      <!-- Substance -->
      <div class="rounded-2xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4 shadow-soft">
        <label class="text-sm font-semibold flex items-center gap-2">
          <span class="w-6 h-6 grid place-items-center">ğŸ§ª</span>
          <span id="t-substance">Î”ÏÎ±ÏƒÏ„Î¹ÎºÎ® ÎŸÏ…ÏƒÎ¯Î±</span> <span class="text-slate-400 ml-1" id="t-optional">(Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬)</span>
        </label>
        <div class="mt-2 relative">
          <input id="active-substance" type="text" autocomplete="off"
                 class="w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-500/30 placeholder:text-slate-400"
                 placeholder="Ï€.Ï‡. Î Î±ÏÎ±ÎºÎµÏ„Î±Î¼ÏŒÎ»Î·" />
          <div id="ac-substance" class="ac-list hidden rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-lg"></div>
        </div>
        <p class="mt-2 text-xs text-slate-500 dark:text-slate-400" id="t-doseEx">Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î´Î¿ÏƒÎ¿Î»Î¿Î³Î¯Î±Ï‚: Paracetamol 500mg.</p>
      </div>

      <!-- Generic -->
      <div class="rounded-2xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4 shadow-soft">
        <p class="text-sm font-semibold flex items-center gap-2">
          <span class="w-6 h-6 grid place-items-center">âœ…</span>
          <span id="t-genericQ">Î‘Î½ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Ï„Î¿ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ ÎµÎ¼Ï€Î¿ÏÎ¹ÎºÏŒ, ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹Ï‚ Î½Î± ÏƒÎ¿Ï… Ï€ÏÎ¿Ï„ÎµÎ¯Î½Î¿Ï…Î¼Îµ Î¹ÏƒÎ¿Î´ÏÎ½Î±Î¼Î¿ (Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿);</span>
        </p>
        <div class="mt-3 flex gap-4">
          <label class="inline-flex items-center gap-2"><input type="radio" name="allow-generic" value="YES" class="size-4 accent-brand-600" checked><span id="t-yes">ÎÎ‘Î™</span></label>
          <label class="inline-flex items-center gap-2"><input type="radio" name="allow-generic" value="NO" class="size-4 accent-brand-600"><span id="t-no">ÎŸÎ§Î™</span></label>
        </div>
      </div>

      <!-- GDPR + Submit -->
      <div class="rounded-2xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4 shadow-soft">
        <label class="inline-flex items-start gap-3">
          <input id="gdpr-checkbox" type="checkbox" required class="mt-0.5 size-5 accent-brand-600">
          <span class="text-sm"><span id="t-accept">Î‘Ï€Î¿Î´Î­Ï‡Î¿Î¼Î±Î¹ Ï„Î¿Ï…Ï‚</span> <button type="button" id="gdpr-open" class="underline text-brand-700"><span id="t-gdprLink">ÎŒÏÎ¿Ï…Ï‚ Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚ & GDPR</span></button>.</span>
        </label>
        <div class="mt-4 flex justify-end">
          <button id="submitBtn" class="px-5 py-3 rounded-2xl bg-gradient-to-r from-brand-500 to-brand-600 text-white font-semibold shadow-soft hover:opacity-95">
            <span id="t-submit">Î¥Ï€Î¿Î²Î¿Î»Î® Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚</span>
          </button>
        </div>
      </div>
    </section>

    <!-- Results & status flow -->
    <section id="results" class="hidden mt-6">
      <div class="rounded-3xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 shadow-soft overflow-hidden">
        <div class="flex items-center gap-3 px-5 py-4 border-b border-slate-200 dark:border-slate-800">
          <button type="button" data-go-home class="flex items-center gap-2 text-sm font-semibold px-3 py-1.5 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800">
            â† <span id="t-statusHome">Î‘ÏÏ‡Î¹ÎºÎ®</span>
          </button>
          <h3 id="t-statusHeading" class="flex-1 text-center text-base sm:text-lg font-semibold">ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚</h3>
        </div>
        <div class="p-6 space-y-8">
          <div id="results-pending" class="flex flex-col items-center gap-4 text-center py-10">
            <div class="relative">
              <div class="h-16 w-16 rounded-full border-4 border-brand-500/30 border-t-brand-600 animate-spin"></div>
            </div>
            <div class="space-y-2">
              <h4 id="t-statusPendingTitle" class="text-xl font-bold tracking-tight">Î‘Î½Î±Î¶Î·Ï„Î¿ÏÎ¼Îµ Ï„Î¿ Ï†Î±ÏÎ¼Î±ÎºÏŒ ÏƒÎ¿Ï…â€¦</h4>
              <p id="t-statusPendingDesc" class="text-sm text-slate-500 dark:text-slate-400">Î˜Î± ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯Ï‚ Î¼ÏŒÎ»Î¹Ï‚ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹ Î­Î½Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿.</p>
            </div>
          </div>

          <div id="results-list" class="hidden space-y-4">
            <div class="space-y-1">
              <h4 id="t-statusListTitle" class="text-lg font-semibold">Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î± Î¼Îµ Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±</h4>
              <p id="t-statusListDesc" class="text-sm text-slate-500 dark:text-slate-400">Î•Ï€Î¯Î»ÎµÎ¾Îµ Ï„Î¿ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ Ï€Î¿Ï… ÏƒÎµ ÎµÎ¾Ï…Ï€Î·ÏÎµÏ„ÎµÎ¯ Î³Î¹Î± self pick-up.</p>
            </div>
            <div id="resultsList" class="space-y-3"></div>
          </div>

          <div id="pickup-box" class="hidden flex flex-col items-center gap-5 text-center py-8 px-4 rounded-2xl bg-emerald-50/80 dark:bg-emerald-900/20 border border-emerald-300 dark:border-emerald-800">
            <div id="t-statusReservedTitle" class="text-sm font-semibold uppercase tracking-widest text-emerald-700 dark:text-emerald-200">Î¤Î¿ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ ÏƒÎµ Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÎ¹</div>
            <div class="space-y-2">
              <h4 id="status-reserved-name" class="text-2xl sm:text-3xl font-bold tracking-tight">City Pharmacy</h4>
              <p id="status-reserved-address" class="text-sm text-slate-600 dark:text-slate-300">Î™Ï€Ï€Î¿ÎºÏÎ¬Ï„Î¿Ï…Ï‚ 12, Î‘Î¸Î®Î½Î±</p>
            </div>
            <div class="flex items-baseline gap-3">
              <span id="pickup-timer" class="text-5xl font-extrabold tracking-tight">60:00</span>
              <span id="t-statusReservedHint" class="text-sm text-emerald-700 dark:text-emerald-200">Î§ÏÏŒÎ½Î¿Ï‚ ÎºÏÎ¬Ï„Î·ÏƒÎ·Ï‚</span>
            </div>
            <div id="status-reserved-generic" class="hidden px-3 py-1 rounded-full bg-emerald-100/70 dark:bg-emerald-800/40 text-xs font-semibold text-emerald-700 dark:text-emerald-200">ğŸ§¬ <span id="t-statusGenericBadge">Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿</span></div>
            <div class="flex flex-wrap justify-center gap-3">
              <button id="extend-btn" class="px-4 py-2 rounded-xl border border-emerald-500 text-emerald-700 dark:text-emerald-200 hover:bg-emerald-100/70 dark:hover:bg-emerald-800/40 text-sm font-semibold flex flex-col items-center leading-tight">
                <span id="t-statusExtendMain">+15 Î»ÎµÏ€Ï„Î¬</span>
                <span id="t-statusExtendNote" class="text-xs font-normal text-emerald-600 dark:text-emerald-200/80">1 Ï†Î¿ÏÎ¬/Î·Î¼Î­ÏÎ±</span>
              </button>
              <a id="status-directions" class="px-4 py-2 rounded-xl bg-sky-600 text-white text-sm font-semibold hover:bg-sky-700 opacity-60 pointer-events-none" href="#" target="_blank" rel="noopener">
                ğŸ§­ <span id="t-statusDirections">ÎŸÎ´Î·Î³Î¯ÎµÏ‚</span>
              </a>
            </div>
            <button id="status-done" data-go-home type="button" class="px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-white dark:hover:bg-slate-800 text-sm font-semibold">
              <span id="t-statusBackHome">Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ®</span>
            </button>
          </div>

          <div id="results-empty" class="hidden flex flex-col items-center gap-4 text-center py-10 px-4">
            <div class="w-16 h-16 rounded-full bg-rose-100 text-rose-600 grid place-items-center text-2xl">âš ï¸</div>
            <h4 id="t-statusEmptyTitle" class="text-xl font-bold tracking-tight">Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±</h4>
            <p id="t-statusEmptyBody" class="text-sm text-slate-500 dark:text-slate-400 max-w-md">Î”ÎµÎ½ ÎµÎ½Ï„Î¿Ï€Î¯ÏƒÎ±Î¼Îµ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± Î±Ï…Ï„Î® Ï„Î· ÏƒÏ„Î¹Î³Î¼Î®. Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿ Î® Î¬Î»Î»Î±Î¾Îµ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Ï„Î·Ï‚ Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚.</p>
            <button id="status-empty-btn" type="button" class="px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm font-semibold">
              <span id="t-statusEmptyCta">Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î¾Î±Î½Î¬</span>
            </button>
          </div>
        </div>
        <div class="px-6 pb-6 pt-4 border-t border-slate-200 dark:border-slate-800 flex justify-end">
          <button id="newSearch" class="px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800">
            <span id="t-newSearch">ÎÎ­Î± Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·</span>
          </button>
        </div>
      </div>
    </section>
  </main>

  <!-- RESULTS DRAWER -->
  <div id="results-modal" class="fixed inset-0 hidden z-[80] items-center justify-center md:items-end">
    <div class="absolute inset-0 bg-slate-950/50" data-results-close="true"></div>
    <div class="relative w-full max-w-3xl md:w-[min(720px,92vw)] mx-auto md:mb-6 rounded-3xl md:rounded-t-3xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 shadow-soft max-h-[92svh] overflow-hidden flex flex-col">
      <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200 dark:border-slate-800">
        <div>
          <h3 id="results-modal-title" class="text-lg font-bold">Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±</h3>
          <p id="results-modal-subtitle" class="mt-1 text-sm text-slate-500 dark:text-slate-400">Î•Ï€Î¯Î»ÎµÎ¾Îµ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ Î³Î¹Î± Ï€Î±ÏÎ±Î»Î±Î²Î®.</p>
        </div>
        <button id="results-modal-close" type="button" class="p-2 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500">
          <span id="results-modal-close-label" class="sr-only">ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿</span>âœ•
        </button>
      </div>
      <div id="results-location-alert" class="hidden px-5 py-3 text-sm flex items-center gap-2 border-b border-slate-200 dark:border-slate-800" aria-live="polite">
        <span aria-hidden="true">ğŸ“</span>
        <span id="results-location-text">Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶Î¿Ï…Î¼Îµ Î±Ï€Î¿ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚â€¦</span>
      </div>
      <div id="results-modal-body" class="flex-1 overflow-y-auto px-5 py-5 space-y-4">
        <div id="results-loading" class="flex items-center justify-center py-8 text-sm text-slate-500 dark:text-slate-400">
          <span id="results-loading-text">Î¦ÏŒÏÏ„Ï‰ÏƒÎ·â€¦</span>
        </div>
        <div id="results-empty-modal" class="hidden text-center py-8 text-sm text-slate-500 dark:text-slate-400">
          <p id="results-empty-text">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± Î±Ï…Ï„Î® Ï„Î· ÏƒÏ„Î¹Î³Î¼Î®.</p>
        </div>
        <div id="results-error" class="hidden text-center py-8 text-sm text-rose-500">
          <p id="results-error-text">Î Î±ÏÎ¿Ï…ÏƒÎ¹Î¬ÏƒÏ„Î·ÎºÎµ ÏƒÏ†Î¬Î»Î¼Î±. Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î¾Î±Î½Î¬.</p>
        </div>
        <div id="results-modal-list" class="space-y-4" role="list"></div>
      </div>
    </div>
  </div>

  <!-- AUTH GATE MODAL -->
  <div id="auth-modal" class="fixed inset-0 hidden z-[90] items-center justify-center p-4">
    <div class="absolute inset-0 bg-slate-950/60" data-auth-close="true"></div>
    <div class="relative w-full max-w-2xl mx-auto rounded-3xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 shadow-soft p-6 sm:p-8 max-h-[92svh] overflow-y-auto">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h3 id="auth-title" class="text-2xl font-bold">Î¤Î±Ï…Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î³Î¹Î± Î´Î­ÏƒÎ¼ÎµÏ…ÏƒÎ·</h3>
          <p id="auth-subtitle" class="mt-1 text-sm text-slate-500 dark:text-slate-400">Î•Ï€Î¯Î»ÎµÎ¾Îµ Ï€ÏÏ‚ Î¸Î­Î»ÎµÎ¹Ï‚ Î½Î± Ï€ÏÎ¿Ï‡Ï‰ÏÎ®ÏƒÎµÎ¹Ï‚.</p>
        </div>
        <button id="auth-close" type="button" class="p-2 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500">
          <span id="auth-close-label" class="sr-only">ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿</span>âœ•
        </button>
      </div>

      <div class="mt-5 space-y-4">
        <div class="flex flex-wrap gap-2" role="group" aria-label="Î•Ï€Î¹Î»Î¿Î³Î­Ï‚ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï">
          <button id="auth-option-login" class="auth-option-btn px-4 py-2 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white/70 dark:bg-white/5 font-semibold text-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500" data-auth-option="login" aria-pressed="true">Î£ÏÎ½Î´ÎµÏƒÎ·</button>
          <button id="auth-option-register" class="auth-option-btn px-4 py-2 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white/40 dark:bg-white/5 font-semibold text-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500" data-auth-option="register" aria-pressed="false">Î•Î³Î³ÏÎ±Ï†Î®</button>
          <button id="auth-option-guest" class="auth-option-btn px-4 py-2 rounded-2xl border border-slate-200 dark:border-slate-700 bg-white/40 dark:bg-white/5 font-semibold text-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500" data-auth-option="guest" aria-pressed="false">Î•Ï€Î¹ÏƒÎºÎ­Ï€Ï„Î·Ï‚</button>
        </div>
        <p id="auth-option-description" class="text-sm text-slate-600 dark:text-slate-300">Î£Ï…Î½Î­Ï‡Î¹ÏƒÎµ Î¼Îµ Ï„Î¿Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ ÏƒÎ¿Ï… Î® ÎµÏ€Î¯Î»ÎµÎ¾Îµ Ï„Î±Ï‡ÎµÎ¯Î± ÎµÏ€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·.</p>

        <div class="rounded-2xl bg-slate-100/70 dark:bg-white/5 p-1 flex gap-1" role="tablist" aria-label="ÎœÎ­Î¸Î¿Î´Î¿Î¹ ÎµÏ€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ·Ï‚">
          <button id="auth-tab-sms" class="auth-tab-btn flex-1 rounded-2xl px-4 py-2 text-sm font-semibold bg-white dark:bg-slate-800 shadow-soft focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500" data-auth-tab="sms" aria-selected="true">SMS</button>
          <button id="auth-tab-email" class="auth-tab-btn flex-1 rounded-2xl px-4 py-2 text-sm font-semibold text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500" data-auth-tab="email" aria-selected="false">Email</button>
          <button id="auth-tab-sso" class="auth-tab-btn flex-1 rounded-2xl px-4 py-2 text-sm font-semibold text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500" data-auth-tab="sso" aria-selected="false">SSO</button>
        </div>

        <div id="auth-view-sms" class="space-y-4" role="tabpanel" aria-labelledby="auth-tab-sms">
          <p id="auth-sms-hint" class="text-sm text-slate-600 dark:text-slate-300">Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎµ Ï„Î¿Î½ Î±ÏÎ¹Î¸Î¼ÏŒ ÏƒÎ¿Ï… Î³Î¹Î± Î½Î± ÏƒÏ…Î½ÎµÏ‡Î¯ÏƒÎµÎ¹Ï‚ Ï‰Ï‚ ÎµÏ€Î¹ÏƒÎºÎ­Ï€Ï„Î·Ï‚.</p>
          <label class="flex flex-col gap-2 text-sm font-semibold">
            <span id="auth-sms-phone-label">Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ ÎºÎ¹Î½Î·Ï„Î¿Ï</span>
            <input id="auth-sms-phone" type="tel" class="rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="69XXXXXXXX">
          </label>
          <div class="flex flex-wrap gap-2">
            <button id="auth-sms-send" type="button" class="px-4 py-2 rounded-xl bg-brand-600 text-white font-semibold hover:bg-brand-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500">Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® ÎºÏ‰Î´Î¹ÎºÎ¿Ï</button>
            <button id="auth-sms-resend" type="button" class="hidden px-4 py-2 rounded-xl border border-brand-500 text-brand-700 dark:text-brand-200 hover:bg-brand-50 dark:hover:bg-brand-900/30 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500">Î•Ï€Î±Î½Î±Ï€Î¿ÏƒÏ„Î¿Î»Î®</button>
          </div>
          <label class="flex flex-col gap-2 text-sm font-semibold">
            <span id="auth-sms-code-label">ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ OTP</span>
            <input id="auth-sms-code" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="6" class="rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="123456">
          </label>
          <button id="auth-sms-verify" type="button" class="px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm font-semibold focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500">Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ·</button>
          <p id="auth-sms-status" class="text-sm text-slate-500 dark:text-slate-300" role="status" aria-live="polite"></p>
        </div>

        <div id="auth-view-email" class="hidden space-y-4" role="tabpanel" aria-labelledby="auth-tab-email">
          <p id="auth-email-hint" class="text-sm text-slate-600 dark:text-slate-300">Î›Î¬Î²Îµ magic link Î³Î¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ· Î® ÎµÎ³Î³ÏÎ±Ï†Î®.</p>
          <label class="flex flex-col gap-2 text-sm font-semibold">
            <span id="auth-email-label">Email</span>
            <input id="auth-email-input" type="email" class="rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="name@email.com">
          </label>
          <div class="flex flex-wrap gap-2">
            <button id="auth-email-login" type="button" class="px-4 py-2 rounded-xl bg-brand-600 text-white font-semibold hover:bg-brand-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500">Î£ÏÎ½Î´ÎµÏƒÎ·</button>
            <button id="auth-email-register" type="button" class="px-4 py-2 rounded-xl border border-brand-500 text-brand-700 dark:text-brand-200 hover:bg-brand-50 dark:hover:bg-brand-900/30 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500">Î•Î³Î³ÏÎ±Ï†Î®</button>
          </div>
          <button id="auth-email-confirm" type="button" class="px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm font-semibold focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500">ÎˆÎºÎ±Î½Î± ÎºÎ»Î¹Îº ÏƒÏ„Î¿ link</button>
          <p id="auth-email-status" class="text-sm text-slate-500 dark:text-slate-300" role="status" aria-live="polite"></p>
        </div>

        <div id="auth-view-sso" class="hidden space-y-4" role="tabpanel" aria-labelledby="auth-tab-sso">
          <p id="auth-sso-hint" class="text-sm text-slate-600 dark:text-slate-300">Î£Ï…Î½Î´Î­ÏƒÎ¿Ï… Î¼Îµ Ï„Î¿Î½ Î±Î³Î±Ï€Î·Î¼Î­Î½Î¿ ÏƒÎ¿Ï… Ï€Î¬ÏÎ¿Ï‡Î¿.</p>
          <div class="grid gap-2 sm:grid-cols-3">
            <button class="auth-sso-btn px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center gap-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500" data-provider="Google">ğŸŸ¢ Google</button>
            <button class="auth-sso-btn px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center gap-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500" data-provider="Apple">ğŸ Apple</button>
            <button class="auth-sso-btn px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center gap-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500" data-provider="Microsoft">ğŸªŸ Microsoft</button>
          </div>
          <p id="auth-sso-status" class="text-sm text-slate-500 dark:text-slate-300" role="status" aria-live="polite"></p>
        </div>

        <div id="auth-global-status" class="hidden rounded-2xl border border-emerald-400/70 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-200 text-sm px-4 py-3 flex items-center gap-2" role="status" aria-live="polite">
          <span aria-hidden="true">âœ…</span>
          <span id="auth-global-status-text">Î•Ï€Î¹Ï„Ï…Ï‡Î®Ï‚ ÎµÏ€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ·.</span>
        </div>
      </div>
    </div>
  </div>

  <!-- PRO PORTAL MODAL -->
  <div id="pro-modal" class="fixed inset-0 hidden items-center justify-center bg-slate-950/60 backdrop-blur-sm px-4 py-6 z-[70]">
    <div class="relative w-full max-w-3xl max-h-[90svh] overflow-y-auto rounded-3xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 shadow-soft p-6 sm:p-8">
      <button id="pro-close" type="button" class="absolute top-4 right-4 p-2 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800" aria-label="ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿">âœ•</button>
      <div class="space-y-6">
        <div class="flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between">
          <div class="space-y-1">
            <h2 id="t-proModalTitle" class="text-2xl font-bold">Î ÏÏŒÏƒÎ²Î±ÏƒÎ· Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Ï‰Î½</h2>
            <p id="t-proModalSubtitle" class="text-sm text-slate-600 dark:text-slate-400">Î£Ï…Î½Î´Î­ÏƒÎ¿Ï… Î® ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎµ Ï„Î¿ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ ÏƒÎ¿Ï… Î³Î¹Î± Î½Î± Î±Ï€Î±Î½Ï„Î¬Ï‚ ÏƒÎµ Î±Î¹Ï„Î®Î¼Î±Ï„Î± Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚.</p>
          </div>
        </div>

        <div class="flex items-center gap-1 rounded-2xl bg-slate-100/80 dark:bg-white/5 p-1">
          <button id="pro-tab-signin" type="button" class="flex-1 rounded-2xl px-4 py-2 text-sm font-semibold bg-white dark:bg-slate-800 shadow-soft" aria-selected="true">
            <span id="t-proSigninTab">Î£ÏÎ½Î´ÎµÏƒÎ·</span>
          </button>
          <button id="pro-tab-register" type="button" class="flex-1 rounded-2xl px-4 py-2 text-sm font-semibold text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200" aria-selected="false">
            <span id="t-proRegisterTab">Î•Î³Î³ÏÎ±Ï†Î®</span>
          </button>
        </div>

        <div id="pro-view-signin" class="space-y-5">
          <div class="grid gap-4 sm:grid-cols-2">
            <label class="text-sm font-semibold flex flex-col gap-2">
              <span id="t-proSigninEmailLabel">Email Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï…</span>
              <input id="pro-signin-email" type="email" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="pharmacy@example.gr">
            </label>
            <label class="text-sm font-semibold flex flex-col gap-2">
              <span id="t-proSigninPasswordLabel">ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚</span>
              <input id="pro-signin-password" type="password" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </label>
          </div>
          <button id="pro-signin-submit" class="w-full sm:w-auto px-5 py-3 rounded-2xl bg-brand-600 text-white font-semibold shadow-soft hover:bg-brand-700" type="button">
            <span id="t-proSigninSubmit">Î£ÏÎ½Î´ÎµÏƒÎ·</span>
          </button>
          <button id="pro-forgot" type="button" class="text-sm underline text-slate-600 dark:text-slate-300 hover:opacity-80 w-fit">
            <span id="t-proForgot">ÎÎ­Ï‡Î±ÏƒÎµÏ‚ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ;</span>
          </button>

          <div class="space-y-3">
            <div class="flex items-center gap-2 text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400">
              <div class="h-px flex-1 bg-slate-200 dark:bg-slate-700"></div>
              <span id="t-proSSO">Î‰ ÏƒÏ…Î½Î­Ï‡Î¹ÏƒÎµ Î¼Îµ</span>
              <div class="h-px flex-1 bg-slate-200 dark:bg-slate-700"></div>
            </div>
            <div class="grid gap-2 sm:grid-cols-3">
              <button class="pro-sso-btn px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center gap-2" type="button" data-provider="Google">
                <span aria-hidden="true">ğŸŸ¢</span> Google
              </button>
              <button class="pro-sso-btn px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center gap-2" type="button" data-provider="Microsoft">
                <span aria-hidden="true">ğŸªŸ</span> Microsoft
              </button>
              <button class="pro-sso-btn px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center gap-2" type="button" data-provider="Apple">
                <span aria-hidden="true">ğŸ</span> Apple
              </button>
            </div>
          </div>

        </div>

        <div id="pro-view-register" class="space-y-5 hidden">
          <div class="space-y-3">
            <div class="flex items-center gap-2 text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400">
              <div class="h-px flex-1 bg-slate-200 dark:bg-slate-700"></div>
              <span id="t-proSSO2">Î‰ ÏƒÏ…Î½Î­Ï‡Î¹ÏƒÎµ Î¼Îµ</span>
              <div class="h-px flex-1 bg-slate-200 dark:bg-slate-700"></div>
            </div>
            <div class="grid gap-2 sm:grid-cols-3">
              <button class="pro-sso-btn px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center gap-2" type="button" data-provider="Google">
                <span aria-hidden="true">ğŸŸ¢</span> Google
              </button>
              <button class="pro-sso-btn px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center gap-2" type="button" data-provider="Microsoft">
                <span aria-hidden="true">ğŸªŸ</span> Microsoft
              </button>
              <button class="pro-sso-btn px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center gap-2" type="button" data-provider="Apple">
                <span aria-hidden="true">ğŸ</span> Apple
              </button>
            </div>
          </div>

          <div>
            <h3 id="t-proRegisterHeading" class="text-lg font-semibold">Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï…</h3>
            <p id="t-proRegisterDesc" class="mt-1 text-sm text-slate-600 dark:text-slate-400">Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Ï„Î¿Ï… Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï… Î³Î¹Î± Î½Î± Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚.</p>
          </div>

          <form id="pro-register-form" class="grid gap-4 sm:grid-cols-2">
            <label class="text-sm font-semibold flex flex-col gap-2 sm:col-span-2">
              <span id="t-proFieldBusinessName">Î•Ï€Ï‰Î½Ï…Î¼Î¯Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï…</span>
              <input id="pro-field-business" type="text" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ ÎšÎµÎ½Ï„ÏÎ¹ÎºÎ®Ï‚ Î Î»Î±Ï„ÎµÎ¯Î±Ï‚">
            </label>
            <label class="text-sm font-semibold flex flex-col gap-2">
              <span id="t-proFieldVat">Î‘Î¦Îœ</span>
              <input id="pro-field-vat" type="text" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="123456789">
            </label>
            <label class="text-sm font-semibold flex flex-col gap-2">
              <span id="t-proFieldRegistrationNumber">Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î¬Î´ÎµÎ¹Î±Ï‚</span>
              <input id="pro-field-license" type="text" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="12345">
            </label>
            <label class="text-sm font-semibold flex flex-col gap-2">
              <span id="t-proFieldContact">Î¥Ï€ÎµÏÎ¸Ï…Î½Î¿Ï‚ ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚</span>
              <input id="pro-field-contact" type="text" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="ÎœÎ±ÏÎ¯Î± Î Î±Ï€Î±Î´Î¿Ï€Î¿ÏÎ»Î¿Ï…">
            </label>
            <label class="text-sm font-semibold flex flex-col gap-2">
              <span id="t-proFieldEmail">Email ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚</span>
              <input id="pro-field-email" type="email" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="pharmacy@example.gr">
            </label>
            <label class="text-sm font-semibold flex flex-col gap-2">
              <span id="t-proFieldPhone">Î¤Î·Î»Î­Ï†Ï‰Î½Î¿</span>
              <input id="pro-field-phone" type="tel" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="2101234567">
            </label>
            <label class="text-sm font-semibold flex flex-col gap-2 sm:col-span-2">
              <span id="t-proFieldAddress">Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·</span>
              <input id="pro-field-address" type="text" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="Î™Ï€Ï€Î¿ÎºÏÎ¬Ï„Î¿Ï…Ï‚ 12">
            </label>
            <label class="text-sm font-semibold flex flex-col gap-2">
              <span id="t-proFieldCity">Î ÏŒÎ»Î·</span>
              <input id="pro-field-city" type="text" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="Î‘Î¸Î®Î½Î±">
            </label>
            <div class="sm:col-span-2">
              <button id="pro-register-submit" type="submit" class="w-full sm:w-auto px-5 py-3 rounded-2xl bg-brand-600 text-white font-semibold shadow-soft hover:bg-brand-700">
                <span id="t-proRegisterSubmit">Î‘Î¯Ï„Î·ÏƒÎ· ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚</span>
              </button>
            </div>
          </form>

          <div class="text-sm text-slate-600 dark:text-slate-300">
            <span id="t-proHaveAccount">ÎˆÏ‡ÎµÎ¹Ï‚ Î®Î´Î· Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ;</span>
            <button id="t-proGoSignin" data-pro-switch="signin" type="button" class="ml-1 font-semibold underline decoration-2">Î£ÏÎ½Î´ÎµÏƒÎ·</button>
          </div>
        </div>

        <div class="flex flex-wrap items-center justify-between gap-3 pt-2">
          <button id="pro-back-home" type="button" data-go-home data-close-pro="true" class="inline-flex items-center gap-2 px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm font-semibold">
            <span aria-hidden="true">â†</span>
            <span id="t-proBackHome">Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ®</span>
          </button>
          <p class="text-xs text-slate-500 dark:text-slate-400">MediRadar Â©</p>
        </div>
      </div>
    </div>
  </div>

  <!-- HOW -->
  <div id="modal-how" class="fixed inset-0 hidden items-center justify-center bg-black/40 p-4">
    <div class="w-full max-w-2xl rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 shadow-soft">
      <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200 dark:border-slate-800">
        <h3 class="text-lg font-bold" id="t-howTitle">Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï„Î¿ MediRadar</h3>
        <button id="how-close" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl">âœ•</button>
      </div>
      <div id="how-body" class="p-5 leading-relaxed text-slate-700 dark:text-slate-300"></div>
      <div class="px-5 pb-5 flex justify-end">
        <button id="how-ok" class="px-4 py-2 rounded-xl bg-brand-600 text-white font-semibold hover:opacity-95"><span id="t-continue">Î£Ï…Î½Î­Ï‡ÎµÎ¹Î±</span></button>
      </div>
    </div>
  </div>

  <!-- GDPR -->
  <div id="gdpr-modal" class="fixed inset-0 hidden items-center justify-center bg-black/40 p-4">
    <div class="w-full max-w-3xl rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 shadow-soft">
      <div class="flex items-center justify-between px-5 py-4 border-b">
        <h3 class="text-lg font-bold" id="t-gdprTitle">Î Î¿Î»Î¹Ï„Î¹ÎºÎ® Î ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚ Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ & ÎŒÏÎ¿Î¹ Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚</h3>
        <button id="gdpr-close" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl">âœ•</button>
      </div>
      <div id="gdpr-body" class="p-5 text-sm text-slate-700 dark:text-slate-300 space-y-3" style="max-height:62vh; overflow:auto"></div>
      <div class="px-5 pb-5 flex justify-end">
        <button id="gdpr-ok" class="px-4 py-2 rounded-xl bg-brand-600 text-white font-semibold hover:opacity-95"><span id="t-gdprAccept">OK</span></button>
      </div>
    </div>
  </div>

  <!-- Pharmacy details modal -->
  <div id="pharm-modal" class="fixed inset-0 hidden items-center justify-center bg-black/40 p-4">
    <div class="w-full max-w-lg rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 shadow-soft">
      <div class="flex items-center justify-between px-5 py-4 border-b">
        <h3 class="text-lg font-bold" id="pm-title">Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿</h3>
        <button id="pm-close" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl">âœ•</button>
      </div>
      <div class="p-5 space-y-2 text-sm">
        <div id="pm-address">Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·:</div>
      </div>
      <div id="pm-auth-message" class="px-5 pb-3 text-xs text-slate-500 dark:text-slate-400">Î— Î´Î­ÏƒÎ¼ÎµÏ…ÏƒÎ· Î±Ï€Î±Î¹Ï„ÎµÎ¯ Ï„Î±Ï…Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ·.</div>
      <div class="px-5 pb-5 flex gap-2 justify-between flex-wrap items-center">
        <div class="flex gap-2 flex-wrap">
          <a id="pm-maps" target="_blank" rel="noopener" class="px-4 py-2 rounded-xl bg-sky-600 text-white font-semibold hover:bg-sky-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-500" aria-label="Î ÏÎ¿Î²Î¿Î»Î® ÏƒÎµ Ï‡Î¬ÏÏ„Î·">Î†Î½Î¿Î¹Î³Î¼Î± ÏƒÎµ Î§Î¬ÏÏ„ÎµÏ‚</a>
        </div>
        <button id="pm-confirm" class="px-4 py-2 rounded-2xl bg-brand-600 text-white font-semibold hover:bg-brand-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500">Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ· & ÎˆÎ½Î±ÏÎ¾Î· 60â€™</button>
      </div>
    </div>
  </div>

  <!-- BARCODE MODAL -->
  <div id="barcode-modal" class="fixed inset-0 hidden items-center justify-center bg-black/50 backdrop-blur-sm px-4 py-6 z-[70]">
    <div class="w-full max-w-md rounded-3xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 shadow-soft overflow-hidden">
      <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200 dark:border-slate-800">
        <h3 id="t-barcodeModalTitle" class="text-lg font-bold">Î£Î¬ÏÏ‰ÏƒÎ· barcode</h3>
        <button id="barcode-close" type="button" class="p-2 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800" aria-label="ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿">âœ•</button>
      </div>
      <div class="p-5 space-y-4">
        <div id="barcode-status" class="text-sm text-slate-600 dark:text-slate-300">Î£Ï„ÏŒÏ‡ÎµÏ…ÏƒÎµ Ï„Î¿Î½ Î³ÏÎ±Î¼Î¼Ï‰Ï„ÏŒ ÎºÏ‰Î´Î¹ÎºÏŒ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Ï€Î»Î±Î¯ÏƒÎ¹Î¿.</div>
        <div class="rounded-2xl overflow-hidden border border-slate-200 dark:border-slate-800 bg-black">
          <video id="barcode-video" class="w-full aspect-video" autoplay muted playsinline></video>
        </div>
        <div class="flex justify-end">
          <button id="barcode-stop" type="button" class="hidden px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-700 text-sm font-semibold hover:bg-slate-100 dark:hover:bg-slate-800">
            <span id="t-barcodeStop">Î”Î¹Î±ÎºÎ¿Ï€Î®</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== ENV (INLINE â€” Ï‡Ï‰ÏÎ¯Ï‚ /env.js) ===== -->
  <script>
    window.ENV = window.ENV || {
      SUPABASE_URL: 'https://qzerrisyowkfkmcyxmav.supabase.co',
      SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF6ZXJyaXN5b3drZmttY3l4bWF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwMTcxODQsImV4cCI6MjA3NTU5MzE4NH0.alkvHkOQPBTwY3daUcKAEsf4nt0kizuU3rYI2c2InPk',
      VAPID_PUBLIC_KEY: 'BGS8pCF76A6Es7XAu3hcTAEE8vcRDl1JlWQ7Hym7m5WK63gIHqbuuSJl_xfC4l7729H5ClVqysTjnShnJwviHgo'
    };
  </script>

  <!-- Supabase client -->
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
    const { SUPABASE_URL, SUPABASE_ANON_KEY } = window.ENV || {};
    if(!SUPABASE_URL || !SUPABASE_ANON_KEY){
      console.error('Missing Supabase ENV');
    }
    window.supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    console.log('Supabase ready:', !!window.supabase);
  </script>

  <!-- App JS -->
  <script>
    /* ========== Theme ========== */
    const html = document.documentElement;
    const bodyEl = document.body;
    const themeBtn = document.getElementById('theme-toggle');
    const iconSun = document.getElementById('icon-sun');
    const iconMoon = document.getElementById('icon-moon');
    function setTheme(mode){
      const dark = mode==='dark';
      html.classList.toggle('dark', dark);
      iconSun.classList.toggle('hidden', !dark);
      iconMoon.classList.toggle('hidden', dark);
      localStorage.setItem('mediradar-theme', dark?'dark':'light');
    }
    setTheme(localStorage.getItem('mediradar-theme') || (matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light'));
    themeBtn.addEventListener('click',()=> setTheme(html.classList.contains('dark')?'light':'dark'));

    /* ========== i18n ========== */
    const strings = {
      el:{
        hero:'Î†Î¼ÎµÏƒÎ· ÎµÏÏÎµÏƒÎ· Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚ Ï†Î±ÏÎ¼Î¬ÎºÏ‰Î½ ÏƒÎµ ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±.',
        searchBTN:'Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…', howBTN:'Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯', signinBTN:'Î£ÏÎ½Î´ÎµÏƒÎ·', installBTN:'Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·',
        searchTitle:'Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…', home:'Î‘ÏÏ‡Î¹ÎºÎ®', medname:'ÎŒÎ½Î¿Î¼Î± Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…', formatTip:'Î£Ï…Î¼Î²Î¿Ï…Î»Î®: Î•Î¼Ï€Î¿ÏÎ¹ÎºÎ® Î¿Î½Î¿Î¼Î±ÏƒÎ¯Î± + Î´Î¿ÏƒÎ¿Î»Î¿Î³Î¯Î± (Ï€.Ï‡. â€œ500mgâ€).',
        substance:'Î”ÏÎ±ÏƒÏ„Î¹ÎºÎ® ÎŸÏ…ÏƒÎ¯Î±', optional:'(Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬)', doseEx:'Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î´Î¿ÏƒÎ¿Î»Î¿Î³Î¯Î±Ï‚: Paracetamol 500mg.', type:'Î¤ÏÏ€Î¿Ï‚ Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…',
        qty:'Î Î¿ÏƒÏŒÏ„Î·Ï„Î± (Ï„ÎµÎ¼Î¬Ï‡Î¹Î±/ÎºÎ¿Ï…Ï„Î¹Î¬)', select:'Î•Ï€Î¹Î»Î¿Î³Î®', genericQ:'Î‘Î½ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Ï„Î¿ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ ÎµÎ¼Ï€Î¿ÏÎ¹ÎºÏŒ, ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹Ï‚ Î½Î± ÏƒÎ¿Ï… Ï€ÏÎ¿Ï„ÎµÎ¯Î½Î¿Ï…Î¼Îµ Î¹ÏƒÎ¿Î´ÏÎ½Î±Î¼Î¿ (Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿);',
        yes:'ÎÎ‘Î™', no:'ÎŸÎ§Î™', city:'Î ÏŒÎ»Î·', accept:'Î‘Ï€Î¿Î´Î­Ï‡Î¿Î¼Î±Î¹ Ï„Î¿Ï…Ï‚', submit:'Î¥Ï€Î¿Î²Î¿Î»Î® Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚', results:'Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±', newSearch:'ÎÎ­Î± Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·',
        pro:'Î“Î¹Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±', howTitle:'Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï„Î¿ MediRadar', continue:'Î£Ï…Î½Î­Ï‡ÎµÎ¹Î±', pending:'Î ÎµÏÎ¹Î¼Î­Î½Î¿Ï…Î¼Îµ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ Ï„Î± ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±â€¦', pharmLogin:'Î•Î¯ÏƒÎ¿Î´Î¿Ï‚ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Ï‰Î½',
        pendingOverlayHeadline:'Î¤Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± ÎµÎ½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎ±Î½!', pendingOverlayMessage:'ÎŸÎ¹ ÏƒÏ…Î½ÎµÏÎ³Î±Î¶ÏŒÎ¼ÎµÎ½Î¿Î¹ Ï†Î±ÏÎ¼Î±ÎºÎ¿Ï€Î¿Î¹Î¿Î¯ Î¾ÎµÎºÎ¹Î½Î¿ÏÎ½ Ï„ÏÏÎ± Ï„Î·Î½ Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ· ÎºÎ±Î¹ Î¸Î± Î±Ï€Î±Î½Ï„Î®ÏƒÎ¿Ï…Î½ Î¸ÎµÏ„Î¹ÎºÎ¬ ÏƒÏÎ½Ï„Î¿Î¼Î±.',
        pendingOverlayStatus:'Î‘Î½Î±Î¼Î¿Î½Î® Î±Ï€Î±Î½Ï„Î®ÏƒÎµÏ‰Î½',
        loadingMessages:[
          'Î¤Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± ÎµÎ½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎ±Î½ â€” Ï„Î¿ Î±Î¯Ï„Î·Î¼Î¬ ÏƒÎ¿Ï… Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ ÏƒÎµ ÎµÎ¾Î­Î»Î¹Î¾Î·.',
          'Î‘Î½Î±Î¶Î·Ï„Î¿ÏÎ¼Îµ Ï„Î¿ Ï†Î±ÏÎ¼Î±ÎºÏŒ ÏƒÎ¿Ï… â€” ÎµÏ…Ï‡Î±ÏÎ¹ÏƒÏ„Î¿ÏÎ¼Îµ Î³Î¹Î± Ï„Î·Î½ Ï…Ï€Î¿Î¼Î¿Î½Î®.',
          'Î£Ï…Î½Ï„Î¿Î½Î¹Î¶ÏŒÎ¼Î±ÏƒÏ„Îµ Î¼Îµ Ï„Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± Î³Î¹Î± Ï„Î·Î½ ÎºÎ±Î»ÏÏ„ÎµÏÎ· ÎµÏ€Î¹Î»Î¿Î³Î® Î³Î¹Î± ÎµÏƒÎ­Î½Î±.',
          'Î¤Î¿ Î±Î¯Ï„Î·Î¼Î¬ ÏƒÎ¿Ï… Î­Ï†Ï„Î±ÏƒÎµ ÏƒÏ„Î¿Ï…Ï‚ ÏƒÏ…Î½ÎµÏÎ³Î¬Ï„ÎµÏ‚ Î¼Î±Ï‚ â€” ÎµÏÎ³Î±Î¶ÏŒÎ¼Î±ÏƒÏ„Îµ Ï€Î¬Î½Ï‰ ÏƒÎµ Î±Ï…Ï„ÏŒ.',
          'ÎŸÎ¹ Ï†Î±ÏÎ¼Î±ÎºÎ¿Ï€Î¿Î¹Î¿Î¯ ÎµÎ»Î­Î³Ï‡Î¿Ï…Î½ Ï„Î· Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î± â€” Î¼ÎµÎ¯Î½Îµ ÏƒÏ…Î½Ï„Î¿Î½Î¹ÏƒÎ¼Î­Î½Î¿Ï‚.',
          'Î•Î¯Î¼Î±ÏƒÏ„Îµ ÎºÎ¿Î½Ï„Î¬ ÏƒÎµ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· â€” Î»Î¯Î³Î¿ Î±ÎºÏŒÎ¼Î·.',
          'Î¤Î¿ Ï†Î±ÏÎ¼Î±ÎºÏŒ ÏƒÎ¿Ï… ÎµÎ¯Î½Î±Î¹ ÎºÎ±Î¸â€™ Î¿Î´ÏŒÎ½ â€” ÏƒÏ‡ÎµÎ´ÏŒÎ½ Î­Ï„Î¿Î¹Î¼Î¿.',
          'Î•Ï„Î¿Î¹Î¼Î¬Î¶Î¿Ï…Î¼Îµ Ï„Î·Î½ ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ® ÏƒÎ¿Ï… â€” Î¼ÎµÎ¯Î½Îµ ÏƒÎµ Î±Î½Î±Î¼Î¿Î½Î®.',
          'Î— Ï…Î³ÎµÎ¯Î± ÏƒÎ¿Ï… ÎµÎ¯Î½Î±Î¹ Ï€ÏÎ¿Ï„ÎµÏÎ±Î¹ÏŒÏ„Î·Ï„Î± â€” Ï„Î¿ Ï‡ÎµÎ¹ÏÎ¹Î¶ÏŒÎ¼Î±ÏƒÏ„Îµ.',
          'Î•Î»Î­Î³Ï‡Î¿Ï…Î¼Îµ ÎµÎ½ÎµÏÎ³Î¬ Ï„Î· Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î± â€” ÎµÏ…Ï‡Î±ÏÎ¹ÏƒÏ„Î¿ÏÎ¼Îµ Ï€Î¿Ï… Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÎ¹Ï‚.'
        ],
        celebrationMessage:'Î— Î±Î¯Ï„Î·ÏƒÎ· ÏƒÏ„Î¬Î»Î¸Î·ÎºÎµ!',
        langGreek:'Î•Î»Î»Î·Î½Î¹ÎºÎ¬', langEnglish:'Î‘Î³Î³Î»Î¹ÎºÎ¬',
        gdprLink:'ÎŒÏÎ¿Ï…Ï‚ Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚ & GDPR',
        gdprTitle:'Î Î¿Î»Î¹Ï„Î¹ÎºÎ® Î ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚ Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ & ÎŒÏÎ¿Î¹ Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚',
        gdprBody:`<p>Î— MediRadar ÎµÏ€ÎµÎ¾ÎµÏÎ³Î¬Î¶ÎµÏ„Î±Î¹ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Ï€Î¿Ï… ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎµÎ¯Ï‚ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ Î³Î¹Î± Ï„Î·Î½ ÎµÎ¾Ï…Ï€Î·ÏÎ­Ï„Î·ÏƒÎ· Ï„Î¿Ï… Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚ Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚.</p>
          <ul class="list-disc pl-5 space-y-2">
            <li>Î£Ï…Î»Î»Î­Î³Î¿Ï…Î¼Îµ Ï„Î¿ Ï†Î¬ÏÎ¼Î±ÎºÎ¿, Ï„Î·Î½ Ï€ÏŒÎ»Î·, Ï„Î·Î½ ÎµÏ€Î¹Î¸Ï…Î¼Î·Ï„Î® Ï€Î¿ÏƒÏŒÏ„Î·Ï„Î± ÎºÎ±Î¹ Ï„Ï…Ï‡ÏŒÎ½ Ï€ÏÏŒÏƒÎ¸ÎµÏ„ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Ï€Î¿Ï… Î´Î¯Î½ÎµÎ¹Ï‚ (Î´ÏÎ±ÏƒÏ„Î¹ÎºÎ® Î¿Ï…ÏƒÎ¯Î±, barcode).</li>
            <li>Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ¼Îµ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î³Î¹Î± Î½Î± ÎµÎ½Î·Î¼ÎµÏÏÏƒÎ¿Ï…Î¼Îµ Ï„Î± ÏƒÏ…Î½ÎµÏÎ³Î±Î¶ÏŒÎ¼ÎµÎ½Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± ÎºÎ±Î¹ Î½Î± ÏƒÎµ ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î¼Îµ Î³Î¹Î± Ï„Î¹Ï‚ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ Ï„Î¿Ï…Ï‚.</li>
            <li>Î”Î¹Î±Ï„Î·ÏÎ¿ÏÎ¼Îµ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Î¼ÏŒÎ½Î¿ ÏŒÏƒÎ¿ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î³Î¹Î± Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏ‰Î¸ÎµÎ¯ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î± Î® Î­Ï‰Ï‚ 30 Î·Î¼Î­ÏÎµÏ‚, ÎµÎºÏ„ÏŒÏ‚ Î±Î½ Î¶Î·Ï„Î®ÏƒÎµÎ¹Ï‚ Î½Ï‰ÏÎ¯Ï„ÎµÏÎ± Ï„Î· Î´Î¹Î±Î³ÏÎ±Ï†Î® Ï„Î¿Ï…Ï‚.</li>
          </ul>
          <p>Î”ÎµÎ½ Î´Î¹Î±Î²Î¹Î²Î¬Î¶Î¿Ï…Î¼Îµ Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏƒÎµ Ï„ÏÎ¯Ï„Î¿Ï…Ï‚ ÎºÎ±Î¹ ÎµÏ†Î±ÏÎ¼ÏŒÎ¶Î¿Ï…Î¼Îµ Ï„ÎµÏ‡Î½Î¹ÎºÎ¬ Î¼Î­Ï„ÏÎ± Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±Ï‚ ÏƒÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ Ï„Î¿Î½ GDPR.</p>
          <p>ÎˆÏ‡ÎµÎ¹Ï‚ Î´Î¹ÎºÎ±Î¯Ï‰Î¼Î± Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚, Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·Ï‚ Î® Î´Î¹Î±Î³ÏÎ±Ï†Î®Ï‚ ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½ÏÎ½Ï„Î±Ï‚ ÏƒÏ„Î¿ <a class="text-brand-700 underline" href="mailto:privacy@mediradar.gr">privacy@mediradar.gr</a>.</p>`,
        barcodeTitle:'Î£Î¬ÏÏ‰ÏƒÎ· barcode ÏƒÏ…Î½Ï„Î±Î³Î®Ï‚ Î® ÎºÎ¿Ï…Ï„Î¹Î¿Ï', barcodeHelp:'Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎµ Ï„Î·Î½ ÎºÎ¬Î¼ÎµÏÎ± Î³Î¹Î± Î½Î± ÏƒÎ±ÏÏÏƒÎµÎ¹Ï‚ Ï„Î¿Î½ Î³ÏÎ±Î¼Î¼Ï‰Ï„ÏŒ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ ÏƒÏ…Î½Ï„Î±Î³Î®Ï‚ Î® Ï„Î¿Ï… ÎºÎ¿Ï…Ï„Î¹Î¿Ï.',
        barcodeStart:'Î†Î½Î¿Î¹Î³Î¼Î± ÎºÎ¬Î¼ÎµÏÎ±Ï‚', barcodePlaceholder:'ÎŸ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ Î¸Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„ÎµÎ¯ ÎµÎ´Ï', barcodeModalTitle:'Î£Î¬ÏÏ‰ÏƒÎ· barcode',
        barcodeStatusInit:'Î£Ï„ÏŒÏ‡ÎµÏ…ÏƒÎµ Ï„Î¿Î½ Î³ÏÎ±Î¼Î¼Ï‰Ï„ÏŒ ÎºÏ‰Î´Î¹ÎºÏŒ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Ï€Î»Î±Î¯ÏƒÎ¹Î¿.', barcodeStatusScanning:'Î£Î¬ÏÏ‰ÏƒÎ· ÏƒÎµ ÎµÎ¾Î­Î»Î¹Î¾Î·â€¦',
        barcodeStatusSuccess:'Î•Î½Ï„Î¿Ï€Î¯ÏƒÏ„Î·ÎºÎµ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚: %s', barcodeStatusNoApi:'ÎŸ Ï€ÎµÏÎ¹Î·Î³Î·Ï„Î®Ï‚ Î´ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î±Î½Î¬Î³Î½Ï‰ÏƒÎ· barcode. Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï‡ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î±.',
        barcodeStatusNoCamera:'Î”ÎµÎ½ ÎµÎ½Ï„Î¿Ï€Î¯ÏƒÏ„Î·ÎºÎµ ÎºÎ¬Î¼ÎµÏÎ± ÏƒÏ„Î· ÏƒÏ…ÏƒÎºÎµÏ…Î®.', barcodeStatusDenied:'Î— Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î·Î½ ÎºÎ¬Î¼ÎµÏÎ± Î±Ï€Î¿ÏÏÎ¯Ï†Î¸Î·ÎºÎµ. ÎˆÎ»ÎµÎ³Î¾Îµ Ï„Î¹Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚.',
        barcodeStatusStopped:'Î— ÏƒÎ¬ÏÏ‰ÏƒÎ· Î´Î¹Î±ÎºÏŒÏ€Î·ÎºÎµ. ÎœÏ€Î¿ÏÎµÎ¯Ï‚ Î½Î± ÎºÎ»ÎµÎ¯ÏƒÎµÎ¹Ï‚ Ï„Î¿ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ¿.', barcodeStop:'Î”Î¹Î±ÎºÎ¿Ï€Î®',
        proModalTitle:'Î ÏÏŒÏƒÎ²Î±ÏƒÎ· Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Ï‰Î½', proModalSubtitle:'Î£Ï…Î½Î´Î­ÏƒÎ¿Ï… Î® ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎµ Ï„Î¿ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ ÏƒÎ¿Ï… Î³Î¹Î± Î½Î± Î±Ï€Î±Î½Ï„Î¬Ï‚ ÏƒÎµ Î±Î¹Ï„Î®Î¼Î±Ï„Î± Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚.',
        proSigninTab:'Î£ÏÎ½Î´ÎµÏƒÎ·', proRegisterTab:'Î•Î³Î³ÏÎ±Ï†Î®',
        proSigninEmailLabel:'Email Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï…', proSigninPasswordLabel:'ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚', proSigninSubmit:'Î£ÏÎ½Î´ÎµÏƒÎ·',
        proForgot:'ÎÎ­Ï‡Î±ÏƒÎµÏ‚ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ;', proSSO:'Î‰ ÏƒÏ…Î½Î­Ï‡Î¹ÏƒÎµ Î¼Îµ',
        proHaveAccount:'ÎˆÏ‡ÎµÎ¹Ï‚ Î®Î´Î· Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ;', proGoSignin:'Î£ÏÎ½Î´ÎµÏƒÎ·',
        proRegisterHeading:'Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï…', proRegisterDesc:'Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Ï„Î¿Ï… Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï… Î³Î¹Î± Î½Î± Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚.',
        proFieldBusinessName:'Î•Ï€Ï‰Î½Ï…Î¼Î¯Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï…', proFieldVat:'Î‘Î¦Îœ', proFieldContact:'Î¥Ï€ÎµÏÎ¸Ï…Î½Î¿Ï‚ ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚',
        proFieldEmail:'Email ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚', proFieldPhone:'Î¤Î·Î»Î­Ï†Ï‰Î½Î¿', proFieldAddress:'Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·', proFieldCity:'Î ÏŒÎ»Î·',
        proFieldRegistrationNumber:'Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î¬Î´ÎµÎ¹Î±Ï‚', proRegisterSubmit:'Î‘Î¯Ï„Î·ÏƒÎ· ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚', proBackHome:'Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ®',
        resultsDrawerTitle:'Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±', resultsDrawerSubtitle:'Î•Ï€Î¯Î»ÎµÎ¾Îµ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ Î³Î¹Î± Ï€Î±ÏÎ±Î»Î±Î²Î®.',
        resultsLoading:'Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Ï‰Î½ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Ï‰Î½â€¦', resultsEmpty:'Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± Î±Ï…Ï„Î® Ï„Î· ÏƒÏ„Î¹Î³Î¼Î®.',
        resultsError:'Î Î±ÏÎ¿Ï…ÏƒÎ¹Î¬ÏƒÏ„Î·ÎºÎµ ÏƒÏ†Î¬Î»Î¼Î±. Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î¾Î±Î½Î¬.', resultsLocationPending:'Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶Î¿Ï…Î¼Îµ Î±Ï€Î¿ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î· Î¸Î­ÏƒÎ· ÏƒÎ¿Ï…â€¦',
        resultsLocationGranted:'ÎŸÎ¹ Î±Ï€Î¿ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ Î²Î±ÏƒÎ¯Î¶Î¿Î½Ï„Î±Î¹ ÏƒÏ„Î·Î½ Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎ± Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î± ÏƒÎ¿Ï….',
        resultsLocationDenied:'Î”ÎµÎ½ Î´ÏŒÎ¸Î·ÎºÎµ Î¬Î´ÎµÎ¹Î± Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±Ï‚ â€” ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ· Ï‡Ï‰ÏÎ¯Ï‚ Î±Ï€ÏŒÏƒÏ„Î±ÏƒÎ·.',
        resultsLocationUnsupported:'Î— ÏƒÏ…ÏƒÎºÎµÏ…Î® Î´ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Î³ÎµÏ‰ÎµÎ½Ï„Î¿Ï€Î¹ÏƒÎ¼ÏŒ.', resultsLocationUnknown:'Î§Ï‰ÏÎ¯Ï‚ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±',
        availabilityExact:'Î‘ÎºÏÎ¹Î²ÏÏ‚ Ï„Î¿ Î¶Î·Ï„Î¿ÏÎ¼ÎµÎ½Î¿', availabilityGeneric:'Î“ÎµÎ½ÏŒÏƒÎ·Î¼Î¿ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿',
        distanceKm:'%s km', distanceUnknown:'Î§Ï‰ÏÎ¯Ï‚ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±',
        statusExtendMain:'+15 Î»ÎµÏ€Ï„Î¬', statusExtendNote:'Î§ÏÎ®ÏƒÎ· 1 Ï†Î¿ÏÎ¬/Î·Î¼Î­ÏÎ±',
        actionMap:'Î ÏÎ¿Î²Î¿Î»Î® ÏƒÏ„Î¿ Ï‡Î¬ÏÏ„Î·', actionReserve:'Î”Î­ÏƒÎ¼ÎµÏ…ÏƒÎ· 60â€™',
        authTitle:'Î¤Î±Ï…Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î³Î¹Î± Î´Î­ÏƒÎ¼ÎµÏ…ÏƒÎ·', authSubtitle:'Î•Ï€Î¯Î»ÎµÎ¾Îµ Ï€ÏÏ‚ Î¸Î­Î»ÎµÎ¹Ï‚ Î½Î± Ï€ÏÎ¿Ï‡Ï‰ÏÎ®ÏƒÎµÎ¹Ï‚.',
        authOptionLogin:'Î£ÏÎ½Î´ÎµÏƒÎ·', authOptionRegister:'Î•Î³Î³ÏÎ±Ï†Î®', authOptionGuest:'Î•Ï€Î¹ÏƒÎºÎ­Ï€Ï„Î·Ï‚',
        authOptionHint:'Î£Ï…Î½Î­Ï‡Î¹ÏƒÎµ Î¼Îµ Ï„Î¿Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ ÏƒÎ¿Ï… Î® ÎµÏ€Î¯Î»ÎµÎ¾Îµ Ï„Î±Ï‡ÎµÎ¯Î± ÎµÏ€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ·.',
        authOptionLoginDesc:'Î£Ï…Î½Î´Î­ÏƒÎ¿Ï… Ï‰Ï‚ Ï…Ï€Î¬ÏÏ‡Ï‰Î½ Ï€ÎµÎ»Î¬Ï„Î·Ï‚ Î³Î¹Î± Î½Î± ÏƒÏ…Î½ÎµÏ‡Î¯ÏƒÎµÎ¹Ï‚ Î¼Îµ Ï„Î¿ Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ ÏƒÎ¿Ï….',
        authOptionRegisterDesc:'Î”Î·Î¼Î¹Î¿ÏÏÎ³Î·ÏƒÎµ Î½Î­Î¿ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ Î¼Îµ email Î® SSO.',
        authOptionGuestDesc:'Î£Ï…Î½Î­Ï‡Î¹ÏƒÎµ Ï‰Ï‚ ÎµÏ€Î¹ÏƒÎºÎ­Ï€Ï„Î·Ï‚ (Ï‡Ï‰ÏÎ¯Ï‚ Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ) Î¼Îµ ÎµÏ€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ· SMS Î® email.',
        authTabSms:'SMS', authTabEmail:'Email', authTabSso:'SSO',
        authSmsHint:'Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎµ Ï„Î¿Î½ Î±ÏÎ¹Î¸Î¼ÏŒ ÏƒÎ¿Ï… Î³Î¹Î± Î½Î± ÏƒÏ…Î½ÎµÏ‡Î¯ÏƒÎµÎ¹Ï‚ Ï‰Ï‚ ÎµÏ€Î¹ÏƒÎºÎ­Ï€Ï„Î·Ï‚.',
        authSmsPhoneLabel:'Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ ÎºÎ¹Î½Î·Ï„Î¿Ï', authSmsSend:'Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® ÎºÏ‰Î´Î¹ÎºÎ¿Ï', authSmsResend:'Î•Ï€Î±Î½Î±Ï€Î¿ÏƒÏ„Î¿Î»Î®',
        authSmsCodeLabel:'ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ OTP', authSmsVerify:'Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ·',
        authSmsStatusSent:'Î£Ï„Î¬Î»Î¸Î·ÎºÎµ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ ÏƒÏ„Î¿ %s (demo: %s).', authSmsStatusExpired:'ÎŸ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ Î­Î»Î·Î¾ÎµÂ· Î¶Î®Ï„Î·ÏƒÎµ Î½Î­Î¿.',
        authSmsStatusMismatch:'ÎŸ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÏƒÏ‰ÏƒÏ„ÏŒÏ‚.', authSmsStatusMissing:'Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ Ï„Î¿Î½ Î±ÏÎ¹Î¸Î¼ÏŒ Ï„Î·Î»ÎµÏ†ÏÎ½Î¿Ï….',
        authSmsStatusVerified:'Î— ÎµÏ€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ· Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ.',
        authEmailHint:'Î›Î¬Î²Îµ magic link Î³Î¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ· Î® ÎµÎ³Î³ÏÎ±Ï†Î®.', authEmailLabel:'Email',
        authEmailLogin:'Î£ÏÎ½Î´ÎµÏƒÎ·', authEmailRegister:'Î•Î³Î³ÏÎ±Ï†Î®', authEmailConfirm:'ÎˆÎºÎ±Î½Î± ÎºÎ»Î¹Îº ÏƒÏ„Î¿ link',
        authEmailStatusSentLogin:'Î£Ï„Î¬Î»Î¸Î·ÎºÎµ magic link Î³Î¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ· ÏƒÏ„Î¿ %s.',
        authEmailStatusSentRegister:'Î£Ï„Î¬Î»Î¸Î·ÎºÎµ magic link Î³Î¹Î± ÎµÎ³Î³ÏÎ±Ï†Î® ÏƒÏ„Î¿ %s.',
        authEmailStatusMissing:'Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ Î­Î³ÎºÏ…ÏÎ¿ email.', authEmailStatusExpired:'Î¤Î¿ link Î­Î»Î·Î¾Îµ â€” Î¶Î®Ï„Î·ÏƒÎµ Î½Î­Î¿.',
        authEmailStatusPending:'Î ÏÏÏ„Î± ÎµÏ€Î­Î»ÎµÎ¾Îµ ÏƒÏÎ½Î´ÎµÏƒÎ· Î® ÎµÎ³Î³ÏÎ±Ï†Î®.', authEmailStatusVerified:'Î— ÎµÏ€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ· email Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ.',
        authSsoHint:'Î£Ï…Î½Î´Î­ÏƒÎ¿Ï… Î¼Îµ Ï„Î¿Î½ Î±Î³Î±Ï€Î·Î¼Î­Î½Î¿ ÏƒÎ¿Ï… Ï€Î¬ÏÎ¿Ï‡Î¿.', authSsoStatusSuccess:'Î— ÏƒÏÎ½Î´ÎµÏƒÎ· Î¼Îµ %s Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ (demo).',
        authGlobalSuccess:'Î— Ï„Î±Ï…Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ â€” Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± ÏƒÏ…Î½ÎµÏ‡Î¯ÏƒÎµÎ¹Ï‚ Î¼Îµ Ï„Î· Î´Î­ÏƒÎ¼ÎµÏ…ÏƒÎ·.', authClose:'ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿',
        resultsModalClose:'ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿', pmAuthRequired:'Î— Î´Î­ÏƒÎ¼ÎµÏ…ÏƒÎ· 60â€™ Î±Ï€Î±Î¹Ï„ÎµÎ¯ Ï„Î±Ï…Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ·.',
        pmAuthReady:'Î¤Î±Ï…Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ â€” ÎµÎ¯ÏƒÎ±Î¹ Î­Ï„Î¿Î¹Î¼Î¿Ï‚ Î³Î¹Î± Î´Î­ÏƒÎ¼ÎµÏ…ÏƒÎ·.'
      },
      en:{
        hero:'Instant availability check at nearby pharmacies.',
        searchBTN:'Medicine Search', howBTN:'How it works', signinBTN:'Sign in', installBTN:'Install',
        searchTitle:'Medicine Search', home:'Home', medname:'Medicine Name', formatTip:'Tip: Brand name + dosage (e.g. â€œ500mgâ€).',
        substance:'Active Substance', optional:'(optional)', doseEx:'Dosage example: Paracetamol 500mg.', type:'Medicine Type',
        qty:'Quantity (units/boxes)', select:'Select', genericQ:'If the specific brand is unavailable, may we suggest an equivalent (generic)?',
        yes:'YES', no:'NO', city:'City', accept:'I accept the', submit:'Submit Search', results:'Results', newSearch:'New search',
        pro:'For pharmacies', howTitle:'How MediRadar works', continue:'Continue', pending:'Waiting for responses from nearby pharmaciesâ€¦', pharmLogin:'Pharmacy login',
        pendingOverlayHeadline:'Pharmacies notified!', pendingOverlayMessage:'Partner pharmacists are now looking for your medicine and will confirm availability shortly.',
        pendingOverlayStatus:'Awaiting confirmations',
        loadingMessages:[
          'The pharmacies have been notified â€” your request is in motion.',
          'Your medicine is being searched for â€” thank you for your patience.',
          'We\'re coordinating with pharmacies to find the best option for you.',
          'Your request has reached our partners â€” we\'re working on it.',
          'Pharmacists are reviewing availability â€” please hold on.',
          'We\'re close to an answer â€” just a little more time.',
          'Your medicine is on its way â€” almost there.',
          'We\'re preparing your response â€” stay tuned.',
          'Your health request is a priority â€” we\'re on it.',
          'We\'re actively checking for availability â€” thank you for waiting.'
        ],
        celebrationMessage:'Request sent successfully!',
        langGreek:'Greek', langEnglish:'English',
        gdprLink:'Search Terms & GDPR',
        gdprTitle:'Data Protection & Search Terms',
        gdprBody:`<p>MediRadar processes the details you provide solely to fulfil your medicine availability request.</p>
          <ul class="list-disc pl-5 space-y-2">
            <li>We collect the medicine, city, desired quantity and any optional details you share (active substance, barcode).</li>
            <li>Your data is used to notify participating pharmacies and relay their responses back to you.</li>
            <li>Information is retained only for the time needed to complete the request or up to 30 days, unless you ask for earlier deletion.</li>
          </ul>
          <p>We do not pass data to third parties and apply security safeguards in line with GDPR requirements.</p>
          <p>You may request access, correction or deletion by emailing <a class="text-brand-700 underline" href="mailto:privacy@mediradar.gr">privacy@mediradar.gr</a>.</p>`,
        barcodeTitle:'Scan prescription or box barcode', barcodeHelp:'Use your camera to capture the prescription or medicine box barcode.',
        barcodeStart:'Open camera', barcodePlaceholder:'The code will appear here', barcodeModalTitle:'Barcode scan',
        barcodeStatusInit:'Align the barcode inside the frame.', barcodeStatusScanning:'Scanningâ€¦',
        barcodeStatusSuccess:'Detected code: %s', barcodeStatusNoApi:'Your browser does not support automatic barcode reading. Enter the code manually.',
        barcodeStatusNoCamera:'No camera was found on this device.', barcodeStatusDenied:'Camera access was denied. Check your permission settings.',
        barcodeStatusStopped:'Scanning stopped. You can close this window.', barcodeStop:'Stop',
        proModalTitle:'Pharmacy access', proModalSubtitle:'Sign in or register your pharmacy to respond to availability requests.',
        proSigninTab:'Sign in', proRegisterTab:'Register',
        proSigninEmailLabel:'Pharmacy email', proSigninPasswordLabel:'Password', proSigninSubmit:'Sign in',
        proForgot:'Forgot password?', proSSO:'Or continue with',
        proHaveAccount:'Already have an account?', proGoSignin:'Sign in',
        proRegisterHeading:'Pharmacy details', proRegisterDesc:'Share your business information to get started.',
        proFieldBusinessName:'Pharmacy name', proFieldVat:'VAT number', proFieldContact:'Primary contact',
        proFieldEmail:'Contact email', proFieldPhone:'Phone', proFieldAddress:'Address', proFieldCity:'City',
        proFieldRegistrationNumber:'License number', proRegisterSubmit:'Submit registration', proBackHome:'Back to home',
        resultsDrawerTitle:'Available pharmacies', resultsDrawerSubtitle:'Choose a pharmacy for pickup.',
        resultsLoading:'Loading nearby pharmaciesâ€¦', resultsEmpty:'No pharmacies are available right now.',
        resultsError:'Something went wrong. Please try again.',
        resultsLocationPending:'Calculating distances from your locationâ€¦',
        resultsLocationGranted:'Distances are based on your current location.',
        resultsLocationDenied:'Location permission denied â€” showing results without distance.',
        resultsLocationUnsupported:'Geolocation is not supported on this device.', resultsLocationUnknown:'No location',
        availabilityExact:'Exact match', availabilityGeneric:'Generic available',
        distanceKm:'%s km', distanceUnknown:'No location',
        statusExtendMain:'+15 minutes', statusExtendNote:'Use once per day',
        actionMap:'View on map', actionReserve:'Hold for 60 min',
        authTitle:'Verification required', authSubtitle:'Choose how you want to continue.',
        authOptionLogin:'Sign in', authOptionRegister:'Register', authOptionGuest:'Guest',
        authOptionHint:'Continue with your account or choose a quick verification.',
        authOptionLoginDesc:'Sign in as a returning user to access your history.',
        authOptionRegisterDesc:'Create a new account via email or SSO.',
        authOptionGuestDesc:'Continue as a guest (no history saved) with SMS or email verification.',
        authTabSms:'SMS', authTabEmail:'Email', authTabSso:'SSO',
        authSmsHint:'Verify your phone number to continue as a guest.',
        authSmsPhoneLabel:'Mobile number', authSmsSend:'Send code', authSmsResend:'Resend',
        authSmsCodeLabel:'OTP code', authSmsVerify:'Verify',
        authSmsStatusSent:'Code sent to %s (demo: %s).', authSmsStatusExpired:'The code expired â€” request a new one.',
        authSmsStatusMismatch:'The code is incorrect.', authSmsStatusMissing:'Enter your phone number first.',
        authSmsStatusVerified:'Phone verification complete.',
        authEmailHint:'Receive a magic link for sign in or sign up.', authEmailLabel:'Email',
        authEmailLogin:'Sign in', authEmailRegister:'Register', authEmailConfirm:'I clicked the link',
        authEmailStatusSentLogin:'Magic link sent to %s for sign in.',
        authEmailStatusSentRegister:'Magic link sent to %s for registration.',
        authEmailStatusMissing:'Enter a valid email.', authEmailStatusExpired:'The link expired â€” request a new one.',
        authEmailStatusPending:'Send yourself a link first.', authEmailStatusVerified:'Email verification complete.',
        authSsoHint:'Use your preferred provider to continue.', authSsoStatusSuccess:'Signed in with %s (demo).',
        authGlobalSuccess:'Verification complete â€” you can proceed with the 60 min hold.', authClose:'Close',
        resultsModalClose:'Close', pmAuthRequired:'A verified account is required before starting the 60 min hold.',
        pmAuthReady:'Verification complete â€” you are ready to hold.'
      }
    };
    const state = { lang: localStorage.getItem('mediradar-lang') || 'el' };
    const citySuggestions = (() => {
      const raw = `
Î†Î³Î¹Î¿Î¹ Î˜ÎµÏŒÎ´Ï‰ÏÎ¿Î¹
Î†Î³Î¹Î¿Ï‚ Î‘Î¸Î±Î½Î¬ÏƒÎ¹Î¿Ï‚
Î†Î³Î¹Î¿Ï‚ ÎÎ¹ÎºÏŒÎ»Î±Î¿Ï‚
Î†Î³Î¹Î¿Ï‚ ÎÎ¹ÎºÏŒÎ»Î±Î¿Ï‚ ÎšÏÎ®Ï„Î·Ï‚
Î†Î³Î¹Î¿Ï‚ Î£Ï„Î­Ï†Î±Î½Î¿Ï‚
Î†Î½Î´ÏÎ¿Ï‚
Î†Î½Î¿Î¹Î¾Î·
Î†ÏÏ„Î±
Î‘Î³Î¯Î± Î’Î±ÏÎ²Î¬ÏÎ±
Î‘Î³Î¯Î± ÎœÎ±ÏÎ¯Î½Î± ÎšÎ¿ÏÏ‰Ï€Î¯Î¿Ï…
Î‘Î³Î¯Î± ÎœÎ±ÏÎ¯Î½Î± Î›Î­ÏÎ¿Ï…
Î‘Î³Î¯Î± ÎœÎ±ÏÎ¯Î½Î± Î§Î±Î½Î¯Ï‰Î½
Î‘Î³Î¯Î± Î Î±ÏÎ±ÏƒÎºÎµÏ…Î®
Î‘Î³Î¯Î± Î Î±ÏÎ±ÏƒÎºÎµÏ…Î® (Î˜ÎµÏƒÏƒÎ±Î»Î¿Î½Î¯ÎºÎ·Ï‚)
Î‘Î³Î¯Î± Î Î±ÏÎ±ÏƒÎºÎµÏ…Î® (Î›Î­ÏƒÎ²Î¿Ï…)
Î‘Î³Î¯Î± Î¤ÏÎ¹Î¬Î´Î±
Î‘Î³Î¹Î¬
Î‘Î³Î¹Î¬ÏƒÎ¿Ï‚
Î‘Î³Î¹Î¿Î¹ Î‘Î½Î¬ÏÎ³Ï…ÏÎ¿Î¹
Î‘Î³ÏÎ¯Î½Î¹Î¿
Î‘Î¸Î®Î½Î±
Î‘Î¯Î³Î¹Î¿
Î‘Î¹Î³Î¬Î»ÎµÏ‰
Î‘Î»ÎµÎ¾Î±Î½Î´ÏÎ¿ÏÏ€Î¿Î»Î·
Î‘Î»Î¼Ï…ÏÏŒÏ‚
Î‘Î¼Î±Î»Î¹Î¬Î´Î±
Î‘Î¼Ï€ÎµÎ»ÏÎ½Î±Ï‚
Î‘Î¼ÏÎ½Ï„Î±Î¹Î¿
Î‘Î¼Ï†Î¯ÎºÎ»ÎµÎ¹Î±
Î‘Î½Ï„Î¯ÎºÏ…ÏÎ±
Î‘ÏÎºÎ±Î»Î¿Ï‡ÏÏÎ¹
Î‘ÏÎ¼Î­Î½Î¿Î¹
Î‘ÏÏ„Î­Î¼Î¹Î´Î±
Î‘ÏÏ‡Î¬Î½ÎµÏ‚
Î‘Ï‡Î±ÎÎ±
Î‘Ï‡Î±ÏÎ½Î­Ï‚
Î’Î¬ÏÎ·
Î’Î±ÏÎ¸Î¿Î»Î¿Î¼Î¹ÏŒ
Î’Î±ÏƒÎ¹Î»Î¹ÎºÎ¬
Î’Î±ÏƒÎ¹Î»Î¹ÎºÏŒ Î•Ï…Î²Î¿Î¯Î±Ï‚
Î’Î­Î»Î¿
Î’Î­ÏÎ¿Î¹Î±
Î’ÎµÎ»Î²ÎµÎ½Ï„ÏŒÏ‚
Î’ÏŒÎ»Î¿Ï‚
Î’ÏŒÏÎµÎ¹Î± ÎšÏ…Î½Î¿Ï…ÏÎ¯Î±
Î’Î¿ÏÎ»Î±
Î’Î¿Ï…Î»Î¹Î±Î³Î¼Î­Î½Î·
Î’ÏÎ±Ï‡Î¬Ï„Î¹
Î’ÏÎ±Ï‡Î½Î­Î¹ÎºÎ±
Î’ÏÎ¹Î»Î®ÏƒÏƒÎ¹Î±
Î“Î±Î»Î¬Ï„ÏƒÎ¹
Î“Î±Î»Î±Ï„Î¬Ï‚
Î“Î±ÏÎ³Î±Î»Î¹Î¬Î½Î¿Î¹
Î“Î±ÏƒÏ„Î¿ÏÎ½Î·
Î“Î±ÏÎ´Î¿Ï‚
Î“Î¹Î±Î½Î½Î¹Ï„ÏƒÎ¬
Î“Î»Ï…Ï†Î¬Î´Î±
Î“Î¿ÏÎ¼ÎµÎ½Î¹ÏƒÏƒÎ±
Î“ÏÎµÎ²ÎµÎ½Î¬
Î”ÎµÎ»Î²Î¹Î½Î¬ÎºÎ¹
Î”ÎµÏƒÎºÎ¬Ï„Î·
Î”Î¹ÏŒÎ½Ï…ÏƒÎ¿Ï‚
Î”Î¿Î¼Î¿ÎºÏŒÏ‚
Î”ÏÎ¬Î¼Î±
Î”ÏÎ±Ï€ÎµÏ„ÏƒÏÎ½Î±
ÎˆÎ´ÎµÏƒÏƒÎ±
Î•ÎºÎ¬Î»Î·
Î•Î»Î±ÏƒÏƒÏŒÎ½Î±
Î•Î»ÎµÏ…Î¸ÎµÏÎ¿ÏÏ€Î¿Î»Î·
Î•ÏÏ…Î¸ÏÎ­Ï‚
Î–Î¬ÎºÏ…Î½Î¸Î¿Ï‚
Î–Î¬ÏÎ±ÎºÎµÏ‚
Î–Î±ÏÏŒÏ‚
Î–ÎµÏ†ÏÏÎ¹
Î–Î¯Ï„ÏƒÎ±
Î–Ï‰Î³ÏÎ¬Ï†Î¿Ï…
Î—Î³Î¿Ï…Î¼ÎµÎ½Î¯Ï„ÏƒÎ±
Î—Î»Î¹Î¿ÏÏ€Î¿Î»Î·
Î—ÏÎ¬ÎºÎ»ÎµÎ¹Î¿
Î—ÏÎ¬ÎºÎ»ÎµÎ¹Î¿ Î‘Ï„Ï„Î¹ÎºÎ®Ï‚
Î˜Î¬ÏƒÎ¿Ï‚
Î˜Î­ÏÎ¼Î·
Î˜ÎµÏÎ¼Î¿Ï€ÏÎ»ÎµÏ‚
Î˜ÎµÏƒÏƒÎ±Î»Î¿Î½Î¯ÎºÎ·
Î˜Î®Î²Î±
Î˜Î®ÏÎ±
ÎŠÎ»Î¹Î¿Î½
Î™ÎµÏÎ¬Ï€ÎµÏ„ÏÎ±
Î™ÎµÏÎ¹ÏƒÏƒÏŒÏ‚
Î™ÎºÎ±ÏÎ¯Î±
Î™ÏƒÏ„Î¹Î±Î¯Î±
Î™Ï‰Î¬Î½Î½Î¹Î½Î±
ÎšÎ¬Î»Ï…Î¼Î½Î¿Ï‚
ÎšÎ¬Ï„Ï‰ Î‘Ï‡Î±ÎÎ±
ÎšÎ±Î²Î¬Î»Î±
ÎšÎ±Î»Î±Î²ÏÏÏ„Î±
ÎšÎ±Î»Î±Î¼Î¬Ï„Î±
ÎšÎ±Î»Î±Î¼Ï€Î¬ÎºÎ±
ÎšÎ±Î»Î»Î¹Î¸Î­Î±
ÎšÎ±Î¼Î­Î½Î± Î’Î¿ÏÏÎ»Î±
ÎšÎ±Î½Î±Î»Î»Î¬ÎºÎ¹
ÎšÎ±ÏÎ´Î¯Ï„ÏƒÎ±
ÎšÎ±ÏÎ»ÏŒÎ²Î±ÏƒÎ¹
ÎšÎ±ÏÏ€ÎµÎ½Î®ÏƒÎ¹
ÎšÎ±ÏƒÏ„Î­Î»Î»Î¹
ÎšÎ±ÏƒÏ„Î¿ÏÎ¹Î¬
ÎšÎ±ÏƒÏ„ÏÎ¯
ÎšÎ±Ï„ÎµÏÎ¯Î½Î·
ÎšÎ­ÏÎºÏ…ÏÎ±
ÎšÎµÏÎ±Î¼Ï‰Ï„Î®
ÎšÎµÏÎ±Ï„Î­Î±
ÎšÎµÏÎ±Ï„ÏƒÎ¯Î½Î¹
ÎšÎ·Ï†Î¹ÏƒÎ¹Î¬
ÎšÎ¯ÏƒÏƒÎ±Î¼Î¿Ï‚
ÎšÎ¹Î»ÎºÎ¯Ï‚
ÎšÏŒÎ½Î¹Ï„ÏƒÎ±
ÎšÏŒÏÎ¹Î½Î¸Î¿Ï‚
ÎšÎ¿Î¶Î¬Î½Î·
ÎšÎ¿ÎºÎºÎ¹Î½Î¹Î¬
ÎšÎ¿Î¼Î¿Ï„Î·Î½Î®
ÎšÎ¿ÏÏ…Î´Î±Î»Î»ÏŒÏ‚
ÎšÎ¿ÏÏ‰Ï€Î¯
ÎšÏÎ±Î½Î¯Î´Î¹
ÎšÏÎ±Î½Î¹Î¬
ÎšÏÎµÎ¼Î±ÏƒÏ„Î®
ÎšÏÏ…Î¿Î½Î­ÏÎ¹
ÎšÏÏ‰Ï€Î¯Î±
ÎšÏÎ¼Î·
ÎšÏ…Ï€Î±ÏÎ¹ÏƒÏƒÎ¯Î±
ÎšÏ‰Ï‚
Î›Î¬ÏÎ¹ÏƒÎ±
Î›Î±Î³ÎºÎ±Î´Î¬Ï‚
Î›Î±Î¼Î¯Î±
Î›ÎµÎ¹Î²Î±Î¸Ï
Î›ÎµÏ€Ï„Î¿ÎºÎ±ÏÏ…Î¬
Î›ÎµÏ…ÎºÎ¬Î´Î±
Î›Î®Î¼Î½Î¿Ï‚
Î›Î¹Î²Î±Î´ÎµÎ¹Î¬
Î›Î¹Ï„ÏŒÏ‡Ï‰ÏÎ¿
Î›Î¿Ï…Ï„ÏÎ¬ Î•Î´Î­ÏƒÏƒÎ·Ï‚
Î›Î¿Ï…Ï„ÏÎ¬ÎºÎ¹
Î›Ï…ÎºÏŒÎ²ÏÏ…ÏƒÎ·
ÎœÎ±ÎºÏÎ±ÎºÏÎ¼Î·
ÎœÎ±Î»ÎµÎ²Î¯Î¶Î¹
ÎœÎ±Î½Ï„Î¿ÏÎ´Î¹
ÎœÎ±ÏÎ±Î¸ÏÎ½Î±Ï‚
ÎœÎ±ÏÎºÏŒÏ€Î¿Ï…Î»Î¿ ÎœÎµÏƒÎ¿Î³Î±Î¯Î±Ï‚
ÎœÎ±ÏÎ¿ÏÏƒÎ¹
ÎœÎµÎ³Î±Î»ÏŒÏ€Î¿Î»Î·
ÎœÎµÎ³Î±Î½Î®ÏƒÎ¹
ÎœÎµÎ¸ÏÎ½Î·
ÎœÎµÎ»Î¯ÏƒÏƒÎ¹Î±
ÎœÎµÎ½ÎµÎ¼Î­Î½Î·
ÎœÎµÎ½Î¯Î´Î¹
ÎœÎµÏƒÎ¿Î»ÏŒÎ³Î³Î¹
ÎœÎµÏƒÏƒÎ®Î½Î·
ÎœÎµÏ„Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ·
ÎœÎ®Î»Î¿Ï‚
ÎœÎ¿Î»Î¬Î¿Î¹
ÎœÎ¿ÏƒÏ‡Î¬Ï„Î¿
ÎœÎ¿Ï…Î¶Î¬ÎºÎ¹
ÎœÏÏ„Î¹ÎºÎ±Ï‚
ÎœÏ…ÎºÏŒÎ½Î¿Ï‚
ÎœÏ…ÏÎ¯Î½Î±
ÎœÏ…Ï„Î¹Î»Î®Î½Î·
ÎÎ¬Î¾Î¿Ï‚
ÎÎ¬Î¿Ï…ÏƒÎ±
ÎÎ±ÏÏ€Î»Î¹Î¿
ÎÎ­Î± Î‘Î³Ï‡Î¯Î±Î»Î¿Ï‚
ÎÎ­Î± Î‘ÏÏ„Î¬ÎºÎ·
ÎÎ­Î± Î•ÏÏ…Î¸ÏÎ±Î¯Î±
ÎÎ­Î± Î™Ï‰Î½Î¯Î±
ÎÎ­Î± Î™Ï‰Î½Î¯Î± ÎœÎ±Î³Î½Î·ÏƒÎ¯Î±Ï‚
ÎÎ­Î± ÎšÎ±Î»Î»Î¹ÎºÏÎ¬Ï„ÎµÎ¹Î±
ÎÎ­Î± ÎœÎ¬ÎºÏÎ·
ÎÎ­Î± ÎœÎ¿Ï…Î´Î±Î½Î¹Î¬
ÎÎ­Î± Î Î­ÏÎ±Î¼Î¿Ï‚
ÎÎ­Î± Î£Î¼ÏÏÎ½Î·
ÎÎ­Î± Î¦Î¹Î»Î±Î´Î­Î»Ï†ÎµÎ¹Î±
ÎÎ­Î± Î§Î±Î»ÎºÎ·Î´ÏŒÎ½Î±
ÎÎµÎ¬Ï€Î¿Î»Î·
ÎÎµÎ¬Ï€Î¿Î»Î· Î›Î±ÎºÏ‰Î½Î¯Î±Ï‚
ÎÎµÎ¿Ï‡ÏÏÎ¹
ÎÎµÏÎ¬Î¹Î´Î±
ÎÎµÏƒÏ„ÏŒÏÎ¹Î¿
ÎÎ·ÏƒÎ¯
ÎÎ¯ÎºÎ±Î¹Î±
ÎÎ¹ÎºÎ®Ï„Î·
ÎÏŒÏ„Î¹Î± ÎšÏ…Î½Î¿Ï…ÏÎ¯Î±
ÎÏ…Î´ÏÎ¯
ÎÎ¬Î½Î¸Î·
ÎÏ…Î»ÏŒÎºÎ±ÏƒÏ„ÏÎ¿
ÎŸÎ¹Î½ÏŒÏ†Ï…Ï„Î±
ÎŸÏÎµÏƒÏ„Î¹Î¬Î´Î±
Î Î¬ÏÎ³Î±
Î Î¬ÏÎ¿Ï‚
Î Î¬Ï„ÏÎ±
Î Î±Î»Î±Î¹ÏŒ Î¦Î¬Î»Î·ÏÎ¿
Î Î±Î»Î±Î¹ÏŒÏ‡Ï‰ÏÎ±
Î Î±Î»Î»Î®Î½Î·
Î Î±Î½Î±Î³Î¹Î¬
Î Î±Ï€Î¬Î³Î¿Ï…
Î Î±ÏÎ±Î¼Ï…Î¸Î¹Î¬
Î ÎµÎ¹ÏÎ±Î¹Î¬
Î ÎµÎ¹ÏÎ±Î¹Î¬Ï‚
Î ÎµÎ½Ï„Î­Î»Î·
Î ÎµÏÎ¹ÏƒÏ„Î­ÏÎ¹
Î ÎµÏ„ÏÎ¿ÏÏ€Î¿Î»Î·
Î ÎµÏÎºÎ·
Î Î¹ÎºÎ­ÏÎ¼Î¹
Î Î»Î±Ï„Î±Î¼ÏÎ½Î±Ï‚
Î ÏŒÏÎ¿Ï‚
Î ÏŒÏÏ„Î¿ Î¡Î¬Ï†Ï„Î·
Î Î¿Î»ÏÎ³Ï…ÏÎ¿Ï‚
Î Î¿Î»ÏÎºÎ±ÏƒÏ„ÏÎ¿
Î ÏÎ­Î²ÎµÎ¶Î±
Î Ï„Î¿Î»ÎµÎ¼Î±ÎÎ´Î±
Î ÏÎ»Î¿Ï‚
Î ÏÏÎ³Î¿Ï‚
Î¡Î±Ï†Î®Î½Î±
Î¡Î­Î¸Ï…Î¼Î½Î¿
Î¡ÏŒÎ´Î¿Ï‚
Î£Î¬Î¼Î¿Ï‚
Î£Î±Î»Î±Î¼Î¯Î½Î±
Î£Î±Î½Ï„Î¿ÏÎ¯Î½Î·
Î£Î­ÏÎ²Î¹Î±
Î£Î­ÏÏÎµÏ‚
Î£Î·Ï„ÎµÎ¯Î±
Î£Î¯Î½Î´Î¿Ï‚
Î£Î¹Î¬Ï„Î¹ÏƒÏ„Î±
Î£Î¹Î´Î·ÏÏŒÎºÎ±ÏƒÏ„ÏÎ¿
Î£ÎºÎ¹Î¬Î¸Î¿Ï‚
Î£ÎºÏŒÏ€ÎµÎ»Î¿Ï‚
Î£ÎºÏÎ´ÏÎ±
Î£Î¿ÏÎ´Î±
Î£Ï€Î¬ÏÏ„Î·
Î£Ï€Î¬Ï„Î±
Î£Ï„Î±Î¼Î¬Ï„Î±
Î£Ï„Ï…Î»Î¯Î´Î±
Î£ÏÏÎ¿Ï‚
Î¤Î±ÏÏÎ¿Ï‚
Î¤Î®Î½Î¿Ï‚
Î¤ÏÎ¯ÎºÎ±Î»Î±
Î¤ÏÎ¯Ï€Î¿Î»Î·
Î¤Ï…Î¼Ï€Î¬ÎºÎ¹
Î¦Î±Î¹ÏƒÏ„ÏŒÏ‚
Î¦Î¹Î»Î¹Î±Ï„ÏÎ¬
Î¦Î¹Î»Î¹Ï€Ï€Î¹Î¬Î´Î±
Î¦Î¹Î»Î¿Î¸Î­Î·
Î¦Î»ÏÏÎ¹Î½Î±
Î§Î±ÏŠÎ´Î¬ÏÎ¹
Î§Î±Î»ÎºÎ¯Î´Î±
Î§Î±Î½Î¹Î¬
Î§ÎµÏÏƒÏŒÎ½Î·ÏƒÎ¿Ï‚
Î§Î¯Î¿Ï‚
Î§Î¿Î»Î±ÏÎ³ÏŒÏ‚
Î§ÏÏÎ± ÎœÎµÏƒÏƒÎ·Î½Î¯Î±Ï‚
Î¨Ï…Ï‡Î¹ÎºÏŒ
Î©ÏÎ±Î¹ÏŒÎºÎ±ÏƒÏ„ÏÎ¿`
      return Array.from(new Set(raw.split('\n').map(v => v.trim()).filter(Boolean)))
        .sort((a, b) => a.localeCompare(b, 'el', { sensitivity: 'base' }));
    })();
    const cityInputEl = document.getElementById('city');
    if(cityInputEl){
      const normalizeCity = () => {
        const val = cityInputEl.value.trim();
        if(!val) return;
        const match = citySuggestions.find(name => name.toLowerCase() === val.toLowerCase());
        if(match) cityInputEl.value = match;
      };
      cityInputEl.addEventListener('blur', normalizeCity);
      cityInputEl.addEventListener('change', normalizeCity);
    }
    let selectedPharmacy = null;
    let authState = { option:'login', activeTab:'email', verified:false, method:null, sms:null, email:null, payload:null };
    function t(k){ return strings[state.lang][k]; }
    function setText(id, txt){ const el=document.getElementById(id); if(el) el.textContent=txt; }
    function setHTML(id, html){ const el=document.getElementById(id); if(el) el.innerHTML=html; }
    function applyLang(){
      document.documentElement.lang = state.lang;
      setText('t-hero', t('hero'));
      setText('t-searchBTN', t('searchBTN')); setText('t-howBTN', t('howBTN')); setText('t-signinBTN', t('signinBTN')); setText('t-installBTN', t('installBTN'));
      setText('t-searchTitle', t('searchTitle')); setText('t-home', t('home'));
      setText('t-medname', t('medname')); setText('t-formatTip', t('formatTip'));
      setText('t-city', t('city'));
      if(cityInputEl){ cityInputEl.placeholder = state.lang==='el'?'Ï€.Ï‡. Î‘Î¸Î®Î½Î±':'e.g. Athens'; }
      setText('t-qty', t('qty'));
      setText('t-type', t('type'));
      setText('t-substance', t('substance'));
      setText('t-doseEx', t('doseEx'));
      setText('t-genericQ', t('genericQ'));
      setText('t-yes', t('yes'));
      setText('t-no', t('no'));
      setText('t-accept', t('accept'));
      setText('t-gdprLink', t('gdprLink'));
      setText('t-submit', t('submit'));
      setText('t-results', t('results')); setText('t-newSearch', t('newSearch')); setText('t-pending', t('pending'));
      setText('t-statusExtendMain', t('statusExtendMain'));
      setText('t-statusExtendNote', t('statusExtendNote'));
      setText('pending-overlay-headline', t('pendingOverlayHeadline'));
      setText('pending-overlay-message', t('pendingOverlayMessage'));
      setText('pending-overlay-status-text', t('pendingOverlayStatus'));
      refreshLoadingMessageForLang();
      setText('celebration-message', t('celebrationMessage'));
      setText('t-pro', t('pro')); setText('t-pro-m', t('pro'));
      setText('t-howTitle', t('howTitle')); setText('t-continue', t('continue'));
      setText('t-langElLabel', t('langGreek')); setText('t-langEnLabel', t('langEnglish'));
      setText('t-barcodeTitle', t('barcodeTitle'));
      setText('t-barcodeOptional', t('optional'));
      setText('t-barcodeHelp', t('barcodeHelp'));
      setText('t-barcodeStart', t('barcodeStart'));
      setText('t-barcodeModalTitle', t('barcodeModalTitle'));
      setText('t-barcodeStop', t('barcodeStop'));
      setText('t-gdprTitle', t('gdprTitle'));
      setHTML('gdpr-body', t('gdprBody'));
      setText('t-proModalTitle', t('proModalTitle')); setText('t-proModalSubtitle', t('proModalSubtitle'));
      setText('t-proSigninTab', t('proSigninTab')); setText('t-proRegisterTab', t('proRegisterTab'));
      setText('t-proSigninEmailLabel', t('proSigninEmailLabel')); setText('t-proSigninPasswordLabel', t('proSigninPasswordLabel'));
      setText('t-proSigninSubmit', t('proSigninSubmit')); setText('t-proForgot', t('proForgot'));
      setText('t-proSSO', t('proSSO')); setText('t-proSSO2', t('proSSO'));
      setText('t-proRegisterHeading', t('proRegisterHeading')); setText('t-proRegisterDesc', t('proRegisterDesc'));
      setText('t-proFieldBusinessName', t('proFieldBusinessName')); setText('t-proFieldVat', t('proFieldVat'));
      setText('t-proFieldRegistrationNumber', t('proFieldRegistrationNumber'));
      setText('t-proFieldContact', t('proFieldContact')); setText('t-proFieldEmail', t('proFieldEmail'));
      setText('t-proFieldPhone', t('proFieldPhone')); setText('t-proFieldAddress', t('proFieldAddress'));
      setText('t-proFieldCity', t('proFieldCity'));
      setText('t-proRegisterSubmit', t('proRegisterSubmit'));
      setText('t-proHaveAccount', t('proHaveAccount')); setText('t-proGoSignin', t('proGoSignin'));
      setText('t-proBackHome', t('proBackHome'));
      setText('results-modal-title', t('resultsDrawerTitle'));
      setText('results-modal-subtitle', t('resultsDrawerSubtitle'));
      setText('results-loading-text', t('resultsLoading'));
      setText('results-empty-text', t('resultsEmpty'));
      setText('results-error-text', t('resultsError'));
      setText('auth-title', t('authTitle'));
      setText('auth-subtitle', t('authSubtitle'));
      document.getElementById('auth-option-login').textContent = t('authOptionLogin');
      document.getElementById('auth-option-register').textContent = t('authOptionRegister');
      document.getElementById('auth-option-guest').textContent = t('authOptionGuest');
      document.getElementById('auth-tab-sms').textContent = t('authTabSms');
      document.getElementById('auth-tab-email').textContent = t('authTabEmail');
      document.getElementById('auth-tab-sso').textContent = t('authTabSso');
      setText('auth-sms-hint', t('authSmsHint'));
      setText('auth-sms-phone-label', t('authSmsPhoneLabel'));
      setText('auth-sms-send', t('authSmsSend'));
      setText('auth-sms-resend', t('authSmsResend'));
      setText('auth-sms-code-label', t('authSmsCodeLabel'));
      setText('auth-sms-verify', t('authSmsVerify'));
      setText('auth-email-hint', t('authEmailHint'));
      setText('auth-email-label', t('authEmailLabel'));
      setText('auth-email-login', t('authEmailLogin'));
      setText('auth-email-register', t('authEmailRegister'));
      setText('auth-email-confirm', t('authEmailConfirm'));
      setText('auth-sso-hint', t('authSsoHint'));
      setText('auth-global-status-text', t('authGlobalSuccess'));
      setText('pm-auth-message', t('pmAuthRequired'));
      document.getElementById('results-modal-close').setAttribute('aria-label', t('resultsModalClose'));
      document.getElementById('results-modal-close-label').textContent = t('resultsModalClose');
      document.getElementById('auth-close').setAttribute('aria-label', t('authClose'));
      document.getElementById('auth-close-label').textContent = t('authClose');
      setText('t-optional', t('optional'));
      document.getElementById('medicine-name').placeholder = state.lang==='el'?'Ï€.Ï‡. Augmentin 875mg':'e.g. Augmentin 875mg';
      document.getElementById('active-substance').placeholder = state.lang==='el'?'Ï€.Ï‡. Paracetamol':'e.g. Paracetamol';
      document.getElementById('barcode-value').placeholder = t('barcodePlaceholder');
      document.getElementById('pro-signin-email').placeholder = state.lang==='el'?'Ï€.Ï‡. pharmacy@domain.gr':'e.g. pharmacy@domain.com';
      document.getElementById('pro-signin-password').placeholder = state.lang==='el'?'ÎŸ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ ÏƒÎ¿Ï…':'Your password';
      document.getElementById('pro-field-business').placeholder = state.lang==='el'?'Ï€.Ï‡. Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ ÎšÎµÎ½Ï„ÏÎ¹ÎºÎ®Ï‚ Î Î»Î±Ï„ÎµÎ¯Î±Ï‚':'e.g. Central Square Pharmacy';
      document.getElementById('pro-field-vat').placeholder = state.lang==='el'?'Ï€.Ï‡. 123456789':'e.g. 123456789';
      document.getElementById('pro-field-license').placeholder = state.lang==='el'?'Ï€.Ï‡. 12345':'e.g. 12345';
      document.getElementById('pro-field-contact').placeholder = state.lang==='el'?'Ï€.Ï‡. ÎœÎ±ÏÎ¯Î± Î Î±Ï€Î±Î´Î¿Ï€Î¿ÏÎ»Î¿Ï…':'e.g. Maria Papadopoulou';
      document.getElementById('pro-field-email').placeholder = state.lang==='el'?'Ï€.Ï‡. pharmacy@domain.gr':'e.g. pharmacy@domain.com';
      document.getElementById('pro-field-phone').placeholder = state.lang==='el'?'Ï€.Ï‡. 2101234567':'e.g. +30 2101234567';
      document.getElementById('pro-field-address').placeholder = state.lang==='el'?'Ï€.Ï‡. Î™Ï€Ï€Î¿ÎºÏÎ¬Ï„Î¿Ï…Ï‚ 12':'e.g. 12 Ippokratous St';
      document.getElementById('pro-field-city').placeholder = state.lang==='el'?'Ï€.Ï‡. Î‘Î¸Î®Î½Î±':'e.g. Athens';
      document.getElementById('auth-sms-phone').placeholder = state.lang==='el'?'69XXXXXXXX':'+30 69XXXXXXX';
      document.getElementById('auth-email-input').placeholder = state.lang==='el'?'ÏŒÎ½Î¿Î¼Î±@email.com':'name@email.com';
      themeBtn.setAttribute('aria-label', state.lang==='el'?'Î‘Î»Î»Î±Î³Î® Î¸Î­Î¼Î±Ï„Î¿Ï‚':'Toggle theme');
      const proTriggerEl = document.getElementById('pro-trigger');
      if(proTriggerEl){
        proTriggerEl.setAttribute('aria-label', state.lang==='el'?'Î§ÏÏÎ¿Ï‚ Î³Î¹Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±':'Pharmacies area');
      }
      const proTriggerMobile = document.getElementById('pro-trigger-mobile');
      if(proTriggerMobile){
        proTriggerMobile.setAttribute('aria-label', state.lang==='el'?'Î§ÏÏÎ¿Ï‚ Î³Î¹Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±':'Pharmacies area');
      }
      document.getElementById('pro-close').setAttribute('aria-label', state.lang==='el'?'ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ Ï€Î±ÏÎ±Î¸ÏÏÎ¿Ï…':'Close window');
      document.getElementById('barcode-start').setAttribute('aria-label', state.lang==='el'?'Î£Î¬ÏÏ‰ÏƒÎ· barcode':'Scan barcode');
      document.getElementById('barcode-close').setAttribute('aria-label', state.lang==='el'?'ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ Ï€Î±ÏÎ±Î¸ÏÏÎ¿Ï…':'Close window');
      if(document.getElementById('barcode-modal').classList.contains('hidden')){
        document.getElementById('barcode-status').textContent = t('barcodeStatusInit');
      }
      setAuthOption(authState.option || 'login', true);
      refreshAuthMessage();
      updateResultLists();
      const langElBtn = document.getElementById('lang-el');
      const langEnBtn = document.getElementById('lang-en');
      langElBtn.dataset.active = state.lang==='el';
      langEnBtn.dataset.active = state.lang==='en';
      langElBtn.setAttribute('aria-pressed', state.lang==='el');
      langEnBtn.setAttribute('aria-pressed', state.lang==='en');
      localStorage.setItem('mediradar-lang', state.lang);
    }
    document.getElementById('lang-el').addEventListener('click', ()=>{ state.lang='el'; applyLang(); });
    document.getElementById('lang-en').addEventListener('click', ()=>{ state.lang='en'; applyLang(); });

    /* ========== Navigation ========== */
    const splash = document.getElementById('splash');
    const app = document.getElementById('app');
    function goHome(){
      stopPickupTimer();
      app.classList.add('hidden');
      splash.classList.remove('hidden');
      hidePending();
      document.getElementById('results').classList.add('hidden');
      document.getElementById('pickup-box').classList.add('hidden');
      closeResultsModal();
      resetAuthState();
      window.scrollTo({ top: 0, behavior:'smooth' });
    }
    document.getElementById('cta-search').addEventListener('click', ()=>{ splash.classList.add('hidden'); app.classList.remove('hidden'); window.scrollTo({ top: 0, behavior:'smooth' }); });
    document.querySelectorAll('[data-go-home]').forEach(btn => {
      btn.addEventListener('click', (event) => {
        event.preventDefault();
        if (btn.dataset.closePro === 'true') {
          closeProModal();
        }
        goHome();
      });
    });

    /* ========== Modals (How/GDPR/Login) ========== */
    const modalHow = document.getElementById('modal-how');
    document.getElementById('cta-how').onclick = ()=> {
      modalHow.classList.remove('hidden'); modalHow.classList.add('flex');
      const body = state.lang==='el' ? `<ol class="list-decimal pl-5 space-y-2">
          <li>Î Î»Î·ÎºÏ„ÏÎ¿Î»ÏŒÎ³Î·ÏƒÎµ Ï„Î¹ ÏˆÎ¬Ï‡Î½ÎµÎ¹Ï‚ (ÎµÎ¼Ï€Î¿ÏÎ¹ÎºÎ® Î¿Î½Î¿Î¼Î±ÏƒÎ¯Î± Î®/ÎºÎ±Î¹ Î´ÏÎ±ÏƒÏ„Î¹ÎºÎ® Î¿Ï…ÏƒÎ¯Î±).</li>
          <li>Î— Î±Î¯Ï„Î·ÏƒÎ· ÏƒÏ„Î­Î»Î½ÎµÏ„Î±Î¹ ÏƒÏ„Î± ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±.</li>
          <li>ÎŒÏ€Î¿Î¹Î¿ Î­Ï‡ÎµÎ¹ <strong>Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±</strong> Î±Ï€Î±Î½Ï„Î¬ Î¸ÎµÏ„Î¹ÎºÎ¬Â· Î±Î½ Î­Ï‡ÎµÎ¹ Î¼ÏŒÎ½Î¿ Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿, Î¸Î± Ï„Î¿ Î´ÎµÎ¹Ï‚ Î¼Îµ ÎµÎ¹Î´Î¹ÎºÏŒ ÏƒÎ®Î¼Î±.</li>
          <li>Î•Ï€Î¹Î»Î­Î³ÎµÎ¹Ï‚ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ ÎºÎ±Î¹ Ï€Î±Ï‚ Î³Î¹Î± <strong>self pick-up</strong>.</li>
          <li>Î”ÎµÎ½ ÏƒÏ…Î»Î»Î­Î³Î¿Ï…Î¼Îµ Ï„Î¹Î¼Î­Ï‚Â· Î¼ÏŒÎ½Î¿ Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±.</li></ol>`
        : `<ol class="list-decimal pl-5 space-y-2">
          <li>Type what you need (brand / active).</li>
          <li>Your request goes to nearby pharmacies.</li>
          <li>Those with <strong>availability</strong> reply â€œAvailableâ€; if generic only, youâ€™ll see a badge.</li>
          <li>Pick a pharmacy and go for <strong>self pick-up</strong>.</li>
          <li>No prices collectedâ€”availability only.</li></ol>`;
      document.getElementById('how-body').innerHTML = body;
    };
    document.getElementById('how-close').onclick = ()=> modalHow.classList.add('hidden');
    document.getElementById('how-ok').onclick    = ()=> modalHow.classList.add('hidden');

    const modalGdpr = document.getElementById('gdpr-modal');
    document.getElementById('gdpr-open').onclick = ()=> { modalGdpr.classList.remove('hidden'); modalGdpr.classList.add('flex'); };
    document.getElementById('gdpr-close').onclick= ()=> modalGdpr.classList.add('hidden');
    document.getElementById('gdpr-ok').onclick   = ()=> modalGdpr.classList.add('hidden');

    /* ========== Barcode scanning ========== */
    const barcodeModal = document.getElementById('barcode-modal');
    const barcodeStartBtn = document.getElementById('barcode-start');
    const barcodeCloseBtn = document.getElementById('barcode-close');
    const barcodeStopBtn = document.getElementById('barcode-stop');
    const barcodeStatus = document.getElementById('barcode-status');
    const barcodeVideo = document.getElementById('barcode-video');
    const barcodeInput = document.getElementById('barcode-value');
    let barcodeStream = null;
    let barcodeDetector = null;
    let barcodeActive = false;
    const barcodeFormats = ['ean_13','ean_8','code_128','code_39','qr_code','upc_a','upc_e','itf','data_matrix','pdf417'];

    function setBarcodeStatus(key, value){
      if(!barcodeStatus) return;
      const txt = t(key);
      barcodeStatus.textContent = (value !== undefined && txt.includes('%s')) ? txt.replace('%s', value) : txt;
    }

    async function ensureBarcodeDetector(){
      if(barcodeDetector) return barcodeDetector;
      if(!('BarcodeDetector' in window)) return null;
      try{
        barcodeDetector = new BarcodeDetector({ formats: barcodeFormats });
      }catch(err){
        console.warn('BarcodeDetector init error', err);
        try{ barcodeDetector = new BarcodeDetector(); }
        catch(err2){ console.warn('BarcodeDetector fallback failed', err2); barcodeDetector = null; }
      }
      return barcodeDetector;
    }

    function openBarcodeModal(){
      setBarcodeStatus('barcodeStatusInit');
      barcodeModal.classList.remove('hidden');
      barcodeModal.classList.add('flex');
      bodyEl.classList.add('overflow-hidden');
    }

    function stopBarcodeScan(keepStatus=false){
      barcodeActive = false;
      if(barcodeStream){
        barcodeStream.getTracks().forEach(track=>track.stop());
        barcodeStream = null;
      }
      if(barcodeVideo){
        barcodeVideo.pause?.();
        barcodeVideo.srcObject = null;
      }
      barcodeStopBtn.classList.add('hidden');
      if(!keepStatus){
        setBarcodeStatus('barcodeStatusInit');
      }
    }

    function closeBarcodeModal(){
      stopBarcodeScan();
      barcodeModal.classList.add('hidden');
      barcodeModal.classList.remove('flex');
      bodyEl.classList.remove('overflow-hidden');
    }

    async function startBarcodeScan(){
      if(!navigator.mediaDevices?.getUserMedia){
        setBarcodeStatus('barcodeStatusNoCamera');
        barcodeStopBtn.classList.add('hidden');
        return;
      }
      try{
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: { ideal: 'environment' } }});
        barcodeStream = stream;
        barcodeVideo.srcObject = stream;
        await barcodeVideo.play();
        barcodeStopBtn.classList.remove('hidden');
        const detector = await ensureBarcodeDetector();
        if(!detector){
          setBarcodeStatus('barcodeStatusNoApi');
          return;
        }
        barcodeActive = true;
        setBarcodeStatus('barcodeStatusScanning');
        requestAnimationFrame(scanLoop);
      }catch(err){
        console.warn('Barcode camera error', err);
        if(err && (err.name === 'NotAllowedError' || err.name === 'SecurityError')){
          setBarcodeStatus('barcodeStatusDenied');
        }else{
          setBarcodeStatus('barcodeStatusNoCamera');
        }
        stopBarcodeScan(true);
      }
    }

    async function scanLoop(){
      if(!barcodeActive || !barcodeDetector) return;
      try{
        const barcodes = await barcodeDetector.detect(barcodeVideo);
        if(barcodes && barcodes.length){
          const code = String(barcodes[0].rawValue || '').trim();
          if(code){
            barcodeInput.value = code;
            barcodeInput.focus();
            barcodeInput.classList.add('barcode-highlight');
            setTimeout(()=> barcodeInput.classList.remove('barcode-highlight'), 1400);
            setBarcodeStatus('barcodeStatusSuccess', code);
            stopBarcodeScan(true);
            setTimeout(()=> closeBarcodeModal(), 900);
            return;
          }
        }
      }catch(err){
        console.warn('Barcode detect error', err);
      }
      if(barcodeActive) requestAnimationFrame(scanLoop);
    }

    barcodeStartBtn?.addEventListener('click', ()=>{ openBarcodeModal(); startBarcodeScan(); });
    barcodeCloseBtn?.addEventListener('click', closeBarcodeModal);
    barcodeModal?.addEventListener('click', (event)=>{ if(event.target === barcodeModal){ closeBarcodeModal(); }});
    barcodeStopBtn?.addEventListener('click', ()=>{ stopBarcodeScan(true); setBarcodeStatus('barcodeStatusStopped'); });
    document.addEventListener('keydown', (event)=>{ if(event.key === 'Escape' && !barcodeModal.classList.contains('hidden')) closeBarcodeModal(); });

    /* ========== Pro modal (pharmacies) ========== */
    const proModal = document.getElementById('pro-modal');
    const proClose = document.getElementById('pro-close');
    const proTabSignin = document.getElementById('pro-tab-signin');
    const proTabRegister = document.getElementById('pro-tab-register');
    const proSigninView = document.getElementById('pro-view-signin');
    const proRegisterView = document.getElementById('pro-view-register');
    const proOpeners = document.querySelectorAll('[data-open-pro]');
    const proSwitchers = document.querySelectorAll('[data-pro-switch]');
    const proSigninBtn = document.getElementById('pro-signin-submit');
    const proForgotBtn = document.getElementById('pro-forgot');
    const proRegisterForm = document.getElementById('pro-register-form');

    function setProMode(mode='signin'){
      const isSignin = mode==='signin';
      proSigninView.classList.toggle('hidden', !isSignin);
      proRegisterView.classList.toggle('hidden', isSignin);
      proTabSignin.classList.toggle('bg-white', isSignin);
      proTabSignin.classList.toggle('dark:bg-slate-800', isSignin);
      proTabSignin.classList.toggle('text-slate-900', isSignin);
      proTabSignin.classList.toggle('dark:text-slate-100', isSignin);
      proTabSignin.classList.toggle('text-slate-600', !isSignin);
      proTabSignin.classList.toggle('dark:text-slate-400', !isSignin);
      proTabSignin.classList.toggle('shadow-soft', isSignin);
      proTabSignin.setAttribute('aria-selected', isSignin);
      proTabRegister.classList.toggle('bg-white', !isSignin);
      proTabRegister.classList.toggle('dark:bg-slate-800', !isSignin);
      proTabRegister.classList.toggle('text-slate-900', !isSignin);
      proTabRegister.classList.toggle('dark:text-slate-100', !isSignin);
      proTabRegister.classList.toggle('text-slate-600', isSignin);
      proTabRegister.classList.toggle('dark:text-slate-400', isSignin);
      proTabRegister.classList.toggle('shadow-soft', !isSignin);
      proTabRegister.setAttribute('aria-selected', !isSignin);
    }

    function openProModal(mode='signin'){
      setProMode(mode);
      proModal.classList.remove('hidden');
      proModal.classList.add('flex');
      bodyEl.classList.add('overflow-hidden');
    }

    function closeProModal(){
      proModal.classList.add('hidden');
      proModal.classList.remove('flex');
      bodyEl.classList.remove('overflow-hidden');
      setProMode('signin');
    }

    proOpeners.forEach(btn=>{
      btn.addEventListener('click', (e)=>{
        e.preventDefault();
        openProModal(btn.dataset.mode || 'signin');
      });
    });
    proTabSignin.addEventListener('click', ()=> setProMode('signin'));
    proTabRegister.addEventListener('click', ()=> setProMode('register'));
    proSwitchers.forEach(btn=> btn.addEventListener('click', ()=> setProMode(btn.dataset.proSwitch || 'signin')));
    proClose.addEventListener('click', closeProModal);
    proModal.addEventListener('click', (event)=>{ if(event.target === proModal){ closeProModal(); }});
    document.addEventListener('keydown', (event)=>{ if(event.key === 'Escape' && !proModal.classList.contains('hidden')) closeProModal(); });

    document.querySelectorAll('.pro-sso-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const provider = btn.dataset.provider;
        alert(state.lang==='el'
          ? `Î— ÏƒÏÎ½Î´ÎµÏƒÎ· Î¼Îµ ${provider} Î¸Î± ÎµÎ¯Î½Î±Î¹ ÏƒÏÎ½Ï„Î¿Î¼Î± Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î·.`
          : `${provider} sign-in is coming soon.`);
      });
    });

    proSigninBtn.addEventListener('click', ()=>{
      alert(state.lang==='el'
        ? 'Î— ÏƒÏÎ½Î´ÎµÏƒÎ· Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï… Î¸Î± ÎµÎ¯Î½Î±Î¹ ÏƒÏÎ½Ï„Î¿Î¼Î± Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î·.'
        : 'Pharmacy sign-in will be available soon.');
    });

    proForgotBtn.addEventListener('click', ()=>{
      alert(state.lang==='el'
        ? 'Î˜Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎ¿Ï…Î¼Îµ ÏÎ¿Î® Î±Î½Î¬ÎºÏ„Î·ÏƒÎ·Ï‚ ÎºÏ‰Î´Î¹ÎºÎ¿Ï ÏƒÏÎ½Ï„Î¿Î¼Î±.'
        : 'Password recovery will be added soon.');
    });

    proRegisterForm.addEventListener('submit', (e)=>{
      e.preventDefault();
      alert(state.lang==='el'
        ? 'Î•Ï…Ï‡Î±ÏÎ¹ÏƒÏ„Î¿ÏÎ¼Îµ! Î— Î¿Î¼Î¬Î´Î± MediRadar Î¸Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÎµÎ¹ Î¼Î±Î¶Î¯ ÏƒÎ¿Ï… Î³Î¹Î± Ï„Î·Î½ Î¿Î»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ· Ï„Î·Ï‚ ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚.'
        : 'Thanks! The MediRadar team will reach out to finish your registration.');
      closeProModal();
    });

    /* ========== Autocomplete (demo) ========== */
    const AC_MEDICINES = [
      'Algofren 400mg',
      'Apotel 500mg',
      'Augmentin 875mg/125mg',
      'Bepanthene 5% Cream',
      'Betadine 10%',
      'Canesten 1% Cream',
      'Clavulin 875/125mg',
      'Daktarin Gel',
      'Depon 500mg',
      'Efferalgan 500mg',
      'Fucidin 2%',
      'Gaviscon Double Action',
      'Humira 40mg Pen',
      'Imodium 2mg',
      'Losec 20mg',
      'Nurofen Express 400mg',
      'Otrivin 0.1% Spray',
      'Panadol 500mg',
      'Plavix 75mg',
      'Prospan Syrup',
      'Salospir 100mg',
      'Synagis 100mg',
      'Voltaren 50mg',
      'Xanax 0.5mg',
      'Zylapour 300mg',
      'Zyrtec 10mg'
    ];
    const AC_SUBSTANCES = [
      'Acetylcysteine 600mg',
      'Acetylsalicylic Acid 100mg',
      'Acyclovir 400mg',
      'Allopurinol 300mg',
      'Amlodipine 5mg',
      'Amoxicillin 500mg',
      'Amoxicillin + Clavulanic Acid 875/125mg',
      'Atorvastatin 20mg',
      'Azithromycin 500mg',
      'Cetirizine 10mg',
      'Doxycycline 100mg',
      'Ibuprofen 400mg',
      'Levocetirizine 5mg',
      'Metformin 1000mg',
      'Metoprolol 50mg',
      'Omeprazole 20mg',
      'Paracetamol 500mg',
      'Rivaroxaban 20mg',
      'Rosuvastatin 10mg',
      'Salbutamol 2mg/5ml',
      'Valsartan 160mg'
    ];
    const DEMO_PHARMACIES = [
      {
        pharmacy:{ name:'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ Î™Î¬ÎºÏ‰Î²Î¿Ï‚', address:'Î™Ï€Ï€Î¿ÎºÏÎ¬Ï„Î¿Ï…Ï‚ 12, Î‘Î¸Î®Î½Î±', phone:'+30 210 1234567', lat:37.9841, lng:23.7356 },
        is_generic:false
      },
      {
        pharmacy:{ name:'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ ÎÎ¯ÎºÎ·', address:'Î£ÏŒÎ»Ï‰Î½Î¿Ï‚ 90, Î‘Î¸Î®Î½Î±', phone:'+30 210 7654321', lat:37.9832, lng:23.7321 },
        is_generic:false
      },
      {
        pharmacy:{ name:'PharmaPlus Î•Î¾Î¬ÏÏ‡ÎµÎ¹Î±', address:'Î¤Î¶Î±Î²Î­Î»Î»Î± 15, Î‘Î¸Î®Î½Î±', phone:'+30 210 5556677', lat:37.9817, lng:23.7339 },
        is_generic:true
      },
      {
        pharmacy:{ name:'CityCare Pharmacy', address:'Î‘ÎºÎ±Î´Î·Î¼Î¯Î±Ï‚ 52, Î‘Î¸Î®Î½Î±', phone:'+30 210 9988776', lat:37.9799, lng:23.7348 },
        is_generic:false
      },
      {
        pharmacy:{ name:'GreenCross Clinic', address:'Î§Î±ÏÎ¹Î»Î¬Î¿Ï… Î¤ÏÎ¹ÎºÎ¿ÏÏ€Î· 120, Î‘Î¸Î®Î½Î±', phone:'+30 210 4433221', lat:37.9882, lng:23.735 },
        is_generic:true
      },
      {
        pharmacy:{ name:'HealthFirst Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿', address:'Î£ÎºÎ¿Ï…Ï†Î¬ 37, Î‘Î¸Î®Î½Î±', phone:'+30 210 3344556', lat:37.9812, lng:23.7413 },
        is_generic:false
      }
    ];
    function sampleDemoPharmacies(allowGeneric=true){
      const pool = DEMO_PHARMACIES.filter(item => allowGeneric || !item.is_generic);
      const effectivePool = pool.length ? pool : DEMO_PHARMACIES.filter(item => !item.is_generic);
      const shuffled = [...effectivePool];
      for(let i=shuffled.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [shuffled[i],shuffled[j]]=[shuffled[j],shuffled[i]]; }
      const desired = Math.min(4, Math.max(3, shuffled.length));
      const takeCount = Math.min(desired, shuffled.length);
      const selection = shuffled.slice(0, takeCount);
      if(allowGeneric && !selection.some(item => item.is_generic)){
        const generics = DEMO_PHARMACIES.filter(item => item.is_generic);
        if(generics.length){
          selection[selection.length-1] = generics[Math.floor(Math.random()*generics.length)];
        }
      }
      return selection;
    }
    function attachAutocomplete(inputId, listId, data){
      const input = document.getElementById(inputId);
      const list = document.getElementById(listId);
      let idx = -1;
      function render(items){
        list.innerHTML = items.map((x,i)=>`<div class="ac-item px-3 py-2 text-sm hover:bg-brand-50 dark:hover:bg-slate-800 ${i===idx?'bg-brand-50 dark:bg-slate-800':''}" data-val="${x}">${x}</div>`).join('');
        list.classList.toggle('hidden', items.length===0);
      }
      function filter(q){ if(!q){ render([]); return; } render(data.filter(s=>s.toLowerCase().includes(q.toLowerCase())).slice(0,10)); }
      input.addEventListener('input', ()=>{ idx=-1; filter(input.value.trim()); });
      input.addEventListener('keydown', (e)=>{
        const items = [...list.querySelectorAll('.ac-item')]; if(!items.length) return;
        if(e.key==='ArrowDown'){ idx=(idx+1)%items.length; render(items.map(n=>n.dataset.val)); e.preventDefault(); }
        else if(e.key==='ArrowUp'){ idx=(idx-1+items.length)%items.length; render(items.map(n=>n.dataset.val)); e.preventDefault(); }
        else if(e.key==='Enter'){ if(idx>=0){ input.value = items[idx].dataset.val; render([]); } }
        else if(e.key==='Escape'){ render([]); }
      });
      list.addEventListener('click', (e)=>{ const item = e.target.closest('.ac-item'); if(!item) return; input.value = item.dataset.val; list.classList.add('hidden'); });
      document.addEventListener('click', (e)=>{ if(!list.contains(e.target) && e.target!==input){ list.classList.add('hidden'); }});
    }
    attachAutocomplete('city','ac-city',citySuggestions);
    attachAutocomplete('medicine-name','ac-medicine',AC_MEDICINES);
    attachAutocomplete('active-substance','ac-substance',AC_SUBSTANCES);

    /* ========== Pending + Celebration ========== */
    const pendingOverlay=document.getElementById('pending-overlay');
    const pendingOverlayElapsed=document.getElementById('pending-overlay-elapsed');
    const loadingMessageEl=document.getElementById('loading-message');
    let waitT=null, waitStart=0;
    let celebrationTimer=null;
    let demoFallbackTimer=null;
    let demoFallbackAllowGeneric=true;
    let demoFallbackBarcode='';
    let loadingMessageTimer=null;
    let loadingMessageIndex=0;
    function getLoadingMessages(){
      const messages = strings[state.lang]?.loadingMessages;
      return Array.isArray(messages) ? messages : [];
    }
    function startLoadingMessageCycle(){
      if(!loadingMessageEl) return;
      const messages = getLoadingMessages();
      if(loadingMessageTimer){ clearInterval(loadingMessageTimer); loadingMessageTimer=null; }
      if(!messages.length){
        loadingMessageEl.textContent='';
        loadingMessageEl.classList.add('hidden');
        return;
      }
      loadingMessageEl.classList.remove('hidden');
      loadingMessageIndex = 0;
      loadingMessageEl.textContent = messages[loadingMessageIndex];
      if(messages.length <= 1) return;
      loadingMessageTimer = setInterval(()=>{
        const pool = getLoadingMessages();
        if(!pool.length){
          loadingMessageEl.textContent='';
          loadingMessageEl.classList.add('hidden');
          clearInterval(loadingMessageTimer);
          loadingMessageTimer=null;
          return;
        }
        loadingMessageIndex = (loadingMessageIndex + 1) % pool.length;
        loadingMessageEl.textContent = pool[loadingMessageIndex];
      }, 3000);
    }
    function stopLoadingMessageCycle(clear=false){
      if(loadingMessageTimer){
        clearInterval(loadingMessageTimer);
        loadingMessageTimer=null;
      }
      if(clear && loadingMessageEl){
        loadingMessageEl.textContent='';
        loadingMessageEl.classList.add('hidden');
      }
    }
    function refreshLoadingMessageForLang(){
      if(!loadingMessageEl) return;
      const messages = getLoadingMessages();
      if(!messages.length){
        loadingMessageEl.textContent='';
        loadingMessageEl.classList.add('hidden');
        return;
      }
      loadingMessageEl.classList.remove('hidden');
      if(loadingMessageIndex >= messages.length){ loadingMessageIndex = 0; }
      loadingMessageEl.textContent = messages[loadingMessageIndex];
    }
    function clearDemoFallback(){
      if(demoFallbackTimer){
        clearTimeout(demoFallbackTimer);
        demoFallbackTimer=null;
      }
      demoFallbackBarcode='';
    }
    function scheduleDemoFallback(allowGeneric=true, barcode=''){
      clearDemoFallback();
      demoFallbackAllowGeneric = allowGeneric;
      demoFallbackBarcode = barcode || '';
      demoFallbackTimer = setTimeout(()=>{
        demoFallbackTimer=null;
        const allowGen = demoFallbackAllowGeneric;
        const barcodeValue = demoFallbackBarcode;
        demoFallbackBarcode='';
        hidePending();
        if(barcodeValue){
          console.info('Submitted barcode:', barcodeValue);
        }
        renderResults(sampleDemoPharmacies(allowGen));
      }, 12000);
    }
    function showPending(){
      waitStart=Date.now();
      clearDemoFallback();
      if(pendingOverlay){
        pendingOverlay.classList.remove('hidden');
        pendingOverlay.classList.add('flex');
      }
      if(results){
        results.classList.add('hidden');
      }
      resultsPending?.classList.remove('hidden');
      resultsListWrap?.classList.add('hidden');
      resultsEmpty?.classList.add('hidden');
      pickupBox?.classList.add('hidden');
      if(resultsList){ resultsList.innerHTML=''; }
      if(resultsModalList){ resultsModalList.innerHTML=''; }
      if(statusDirectionsLink){
        statusDirectionsLink.href = '#';
        setLinkAvailability(statusDirectionsLink, false);
      }
      statusReservedGeneric?.classList.add('hidden');
      selectedPharmacy = null;
      if(pendingOverlayElapsed){ pendingOverlayElapsed.textContent='0s'; }
      stopLoadingMessageCycle();
      startLoadingMessageCycle();
      if(waitT) clearInterval(waitT);
      waitT=setInterval(()=>{
        const secs=Math.floor((Date.now()-waitStart)/1000)+'s';
        if(pendingOverlayElapsed) pendingOverlayElapsed.textContent=secs;
      },500);
      window.scrollTo({top:0,behavior:'smooth'});
    }
    function hidePending(){
      clearDemoFallback();
      if(pendingOverlay){
        pendingOverlay.classList.add('hidden');
        pendingOverlay.classList.remove('flex');
      }
      stopLoadingMessageCycle(true);
      if(waitT){clearInterval(waitT); waitT=null;}
    }
    function playCelebration(duration=3200){
      const overlay = document.getElementById('celebration-overlay');
      if(!overlay) return;
      const emojiWrap = overlay.querySelector('[data-emoji-container]');
      const successMark = overlay.querySelector('.success-mark');
      overlay.classList.remove('hidden','hiding');
      overlay.classList.add('flex');
      overlay.style.opacity = '1';
      if(emojiWrap){
        emojiWrap.innerHTML = '';
        const emojis = ['ğŸ‰','ğŸŠ','âœ¨','ğŸ’Š','ğŸ§¡'];
        const total = 14;
        for(let i=0;i<total;i++){
          const span = document.createElement('span');
          span.className = 'floating-emoji';
          span.textContent = emojis[i % emojis.length];
          span.style.left = `${Math.random()*80 + 10}%`;
          span.style.animationDelay = `${Math.random()*0.8}s`;
          span.style.animationDuration = `${2.2 + Math.random()*1.3}s`;
          emojiWrap.appendChild(span);
        }
      }
      if(successMark){
        successMark.classList.remove('animate-in');
        void successMark.offsetWidth;
        successMark.classList.add('animate-in');
      }
      if(celebrationTimer){
        clearTimeout(celebrationTimer);
        celebrationTimer=null;
      }
      celebrationTimer = setTimeout(()=>{
        overlay.classList.add('hiding');
        overlay.style.opacity = '0';
        setTimeout(()=>{
          overlay.classList.add('hidden');
          overlay.classList.remove('flex','hiding');
          overlay.style.opacity = '';
          if(emojiWrap){ emojiWrap.innerHTML=''; }
        }, 360);
      }, duration);
    }

    /* ========== Supabase helpers ========== */
    function sb(){ return window.supabase; }
    function hasSupabase(){ return !!(window.supabase && window.ENV && window.ENV.SUPABASE_URL); }
    const LS_REQ = 'mr:lastRequest';

    async function apiFetch(path, { method = 'GET', body, headers } = {}) {
      const url = `${API_BASE}/${path.replace(/^\//,'')}`;
      const opts = { method, headers: { 'Content-Type': 'application/json', ...(headers || {}) } };
      if (body !== undefined) {
        opts.body = typeof body === 'string' ? body : JSON.stringify(body);
      }
      const res = await fetch(url, opts);
      const txt = await res.text().catch(()=> '');
      if (!res.ok) {
        throw new Error(`API ${path} ${res.status}: ${txt}`);
      }
      return txt ? JSON.parse(txt) : {};
    }

    /* ========== Results + Pharmacy modal + Pickup timer ========== */
    const results = document.getElementById('results');
    const resultsList = document.getElementById('resultsList');
    const resultsPending = document.getElementById('results-pending');
    const resultsListWrap = document.getElementById('results-list');
    const resultsEmpty = document.getElementById('results-empty');
    const pickupBox = document.getElementById('pickup-box');
    const pickupTimerEl = document.getElementById('pickup-timer');
    const extendBtn = document.getElementById('extend-btn');
    const statusReservedName = document.getElementById('status-reserved-name');
    const statusReservedAddress = document.getElementById('status-reserved-address');
    const statusReservedGeneric = document.getElementById('status-reserved-generic');
    const statusDirectionsLink = document.getElementById('status-directions');
    const statusEmptyBtn = document.getElementById('status-empty-btn');
    const resultsModalEl = document.getElementById('results-modal');
    const resultsModalList = document.getElementById('results-modal-list');
    const resultsModalClose = document.getElementById('results-modal-close');
    const resultsModalOverlay = document.querySelector('#results-modal [data-results-close]');
    const resultsLocationAlert = document.getElementById('results-location-alert');
    const resultsLocationText = document.getElementById('results-location-text');
    const resultsLoadingEl = document.getElementById('results-loading');
    const resultsEmptyModal = document.getElementById('results-empty-modal');
    const resultsErrorEl = document.getElementById('results-error');
    const authModalEl = document.getElementById('auth-modal');
    const authModalOverlay = document.querySelector('#auth-modal [data-auth-close]');
    const authCloseBtn = document.getElementById('auth-close');
    const authOptionButtons = document.querySelectorAll('.auth-option-btn');
    const authOptionDescription = document.getElementById('auth-option-description');
    const authTabButtons = document.querySelectorAll('.auth-tab-btn');
    const authViews = {
      sms: document.getElementById('auth-view-sms'),
      email: document.getElementById('auth-view-email'),
      sso: document.getElementById('auth-view-sso')
    };
    const authSmsSendBtn = document.getElementById('auth-sms-send');
    const authSmsResendBtn = document.getElementById('auth-sms-resend');
    const authSmsVerifyBtn = document.getElementById('auth-sms-verify');
    const authSmsStatus = document.getElementById('auth-sms-status');
    const authSmsPhoneInput = document.getElementById('auth-sms-phone');
    const authSmsCodeInput = document.getElementById('auth-sms-code');
    const authEmailInput = document.getElementById('auth-email-input');
    const authEmailStatus = document.getElementById('auth-email-status');
    const authEmailLoginBtn = document.getElementById('auth-email-login');
    const authEmailRegisterBtn = document.getElementById('auth-email-register');
    const authEmailConfirmBtn = document.getElementById('auth-email-confirm');
    const authSsoStatus = document.getElementById('auth-sso-status');
    const authSsoButtons = document.querySelectorAll('.auth-sso-btn');
    const authGlobalStatus = document.getElementById('auth-global-status');
    const authGlobalStatusText = document.getElementById('auth-global-status-text');
    const LS_PICKUP = 'mr:lastPickup';
    const API_BASE = '/.netlify/functions';
    let pInt=null, remaining=0, pollInt=null;
    let latestResults = [];
    let userLocation = { status:'idle', coords:null };
    let locationPromise = null;
    let afterAuthCallback = null;

    function showResultsWrapper(){ results.classList.remove('hidden'); }
    function setResultsState(state){
      showResultsWrapper();
      resultsPending?.classList.toggle('hidden', state!=='pending');
      resultsListWrap?.classList.toggle('hidden', state!=='list');
      resultsEmpty?.classList.toggle('hidden', state!=='empty');
      pickupBox?.classList.toggle('hidden', state!=='reserved');
      if(state==='pending'){
        resultsList.innerHTML='';
        if(statusDirectionsLink){ statusDirectionsLink.href = '#'; setLinkAvailability(statusDirectionsLink, false); }
        statusReservedGeneric?.classList.add('hidden');
      }
      if(state==='empty'){
        if(statusDirectionsLink){ statusDirectionsLink.href = '#'; setLinkAvailability(statusDirectionsLink, false); }
        statusReservedGeneric?.classList.add('hidden');
      }
      if(state==='pending' || state==='empty'){ selectedPharmacy = null; }
      if(state!=='pending'){
        results.scrollIntoView({ behavior:'smooth', block:'start' });
      }
    }
    function setLinkAvailability(el, enabled){
      if(!el) return;
      el.classList.toggle('opacity-60', !enabled);
      el.classList.toggle('pointer-events-none', !enabled);
    }

    function parseCoordinate(value){
      if(value === null || value === undefined || value === '') return null;
      const num = Number.parseFloat(value);
      return Number.isFinite(num) ? num : null;
    }

    function haversineKm(lat1, lon1, lat2, lon2){
      const toRad = (deg)=> deg * Math.PI / 180;
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a = Math.sin(dLat/2) ** 2 + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon/2) ** 2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return 6371 * c;
    }

    function updateLocationAlert(){
      if(!resultsLocationAlert) return;
      const status = userLocation.status;
      let message = '';
      let show = false;
      if(status === 'loading'){
        message = t('resultsLocationPending');
        show = true;
      }else if(status === 'granted'){
        message = t('resultsLocationGranted');
        show = true;
      }else if(status === 'denied' || status === 'error'){
        message = t('resultsLocationDenied');
        show = true;
      }else if(status === 'unsupported'){
        message = t('resultsLocationUnsupported');
        show = true;
      }
      resultsLocationAlert.classList.toggle('hidden', !show);
      if(show && resultsLocationText){ resultsLocationText.textContent = message; }
    }

    function openResultsModal(){
      if(!resultsModalEl) return;
      resultsModalEl.classList.remove('hidden');
      resultsModalEl.classList.add('flex');
      bodyEl.classList.add('overflow-hidden');
    }

    function closeResultsModal(){
      if(!resultsModalEl) return;
      resultsModalEl.classList.add('hidden');
      resultsModalEl.classList.remove('flex');
      const proHidden = typeof proModal === 'undefined' || !proModal || proModal.classList.contains('hidden');
      const barcodeHidden = typeof barcodeModal === 'undefined' || !barcodeModal || barcodeModal.classList.contains('hidden');
      if((!authModalEl || authModalEl.classList.contains('hidden')) && proHidden && barcodeHidden){
        bodyEl.classList.remove('overflow-hidden');
      }
    }

    function buildMapsHref(pharmacy){
      const base = encodeURIComponent(pharmacy.address || pharmacy.name || '');
      if(pharmacy.lat !== null && pharmacy.lng !== null){
        return `https://www.google.com/maps?q=${base}@${pharmacy.lat},${pharmacy.lng},17z`;
      }
      return `https://www.google.com/maps?q=${base}`;
    }

    function formatDistanceLabel(distanceKm){
      if(distanceKm === null || Number.isNaN(distanceKm)){
        return t('distanceUnknown');
      }
      const value = Math.max(distanceKm, 0).toFixed(1);
      return t('distanceKm').replace('%s', value);
    }

    function updateResultLists(){
      if(!resultsList || !resultsModalList) return;
      resultsList.innerHTML = '';
      resultsModalList.innerHTML = '';
      if(!latestResults.length){
        return;
      }
      const decorated = latestResults.map(item => {
        let distance = null;
        if(userLocation.status === 'granted' && userLocation.coords && item.pharmacy.lat !== null && item.pharmacy.lng !== null){
          distance = haversineKm(userLocation.coords.lat, userLocation.coords.lng, item.pharmacy.lat, item.pharmacy.lng);
        }
        return { ...item, distanceKm: distance };
      }).sort((a,b)=>{
        if(a.is_generic !== b.is_generic){ return a.is_generic ? 1 : -1; }
        const da = a.distanceKm ?? Number.POSITIVE_INFINITY;
        const db = b.distanceKm ?? Number.POSITIVE_INFINITY;
        return da - db;
      });

      decorated.forEach(item => {
        resultsList.appendChild(buildResultCard(item, 'inline'));
        resultsModalList.appendChild(buildResultCard(item, 'modal'));
      });
    }

    function buildResultCard(item, context='modal'){
      const ph = item.pharmacy || {};
      const card = document.createElement('article');
      card.setAttribute('role', 'listitem');
      card.className = 'result-card flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/85 dark:bg-slate-900/50 px-4 py-4 shadow-soft';
      if(context === 'inline'){ card.classList.add('w-full'); }
      card.dataset.name = ph.name || (state.lang==='el'?'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿':'Pharmacy');
      card.dataset.addr = ph.address || '';
      card.dataset.lat = ph.lat !== null && ph.lat !== undefined ? String(ph.lat) : '';
      card.dataset.lng = ph.lng !== null && ph.lng !== undefined ? String(ph.lng) : '';
      card.dataset.generic = item.is_generic ? 'true' : 'false';

      const topRow = document.createElement('div');
      topRow.className = 'flex items-start gap-4 w-full';
      const iconWrap = document.createElement('div');
      iconWrap.className = 'w-12 h-12 rounded-2xl bg-brand-500/10 text-brand-600 grid place-items-center shrink-0';
      iconWrap.innerHTML = '<span aria-hidden="true">ğŸ’Š</span>';
      topRow.appendChild(iconWrap);

      const info = document.createElement('div');
      info.className = 'flex-1 min-w-0';
      const nameEl = document.createElement('p');
      nameEl.className = 'font-semibold text-slate-900 dark:text-slate-100 truncate';
      nameEl.textContent = ph.name || (state.lang==='el'?'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿':'Pharmacy');
      const addrEl = document.createElement('p');
      addrEl.className = 'text-sm text-slate-500 dark:text-slate-400 truncate';
      addrEl.textContent = ph.address || 'â€”';
      info.append(nameEl, addrEl);

      const meta = document.createElement('div');
      meta.className = 'mt-2 flex flex-wrap gap-2 text-xs';
      const avail = document.createElement('span');
      avail.className = `badge ${item.is_generic ? 'bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-200' : 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-200'} font-semibold`;
      avail.textContent = item.is_generic ? t('availabilityGeneric') : t('availabilityExact');
      const distanceBadge = document.createElement('span');
      distanceBadge.className = 'badge bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-300 flex items-center gap-1';
      const distanceIcon = document.createElement('span');
      distanceIcon.setAttribute('aria-hidden', 'true');
      distanceIcon.textContent = item.distanceKm !== null && item.distanceKm !== undefined ? 'ğŸ“' : 'ğŸš«';
      const distanceLabel = document.createElement('span');
      distanceLabel.textContent = formatDistanceLabel(item.distanceKm);
      distanceBadge.append(distanceIcon, distanceLabel);
      meta.append(avail, distanceBadge);
      info.appendChild(meta);
      topRow.appendChild(info);
      card.appendChild(topRow);

      const actionsWrap = document.createElement('div');
      actionsWrap.className = 'flex flex-col sm:items-end gap-2 w-full sm:w-auto';
      const actionsRow = document.createElement('div');
      actionsRow.className = 'flex flex-wrap gap-2';

      const mapLink = document.createElement('a');
      mapLink.className = 'px-3 py-2 rounded-xl border border-slate-200 dark:border-slate-700 text-xs sm:text-sm font-semibold hover:bg-slate-100 dark:hover:bg-slate-800 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500';
      mapLink.textContent = t('actionMap');
      mapLink.setAttribute('aria-label', t('actionMap'));
      const hasMap = !!(ph.address || (ph.lat !== null && ph.lng !== null));
      if(hasMap){
        mapLink.href = buildMapsHref(ph);
        mapLink.target = '_blank';
        mapLink.rel = 'noopener';
      }else{
        mapLink.href = '#';
        mapLink.setAttribute('aria-disabled', 'true');
        mapLink.tabIndex = -1;
        mapLink.classList.add('opacity-50','pointer-events-none');
      }
      actionsRow.appendChild(mapLink);

      const selectBtn = document.createElement('button');
      selectBtn.type = 'button';
      selectBtn.className = 'select-pharm px-4 py-2 rounded-xl bg-brand-600 text-white text-sm font-semibold hover:bg-brand-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500';
      selectBtn.textContent = t('actionReserve');

      actionsWrap.append(actionsRow, selectBtn);
      card.appendChild(actionsWrap);
      return card;
    }

    function normalizeResultItem(raw){
      if(!raw) return null;
      const phRaw = raw.pharmacy || {};
      const name = phRaw.name || raw.pharmacy_name || raw.name || (state.lang==='el'?'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿':'Pharmacy');
      const address = phRaw.address || raw.address || raw.pharmacy_address || '';
      const phone = phRaw.phone || raw.phone || raw.pharmacy_phone || '';
      const lat = parseCoordinate(phRaw.lat ?? raw.lat ?? raw.pharmacy_lat);
      const lng = parseCoordinate(phRaw.lng ?? raw.lng ?? raw.pharmacy_lng);
      return {
        id: raw.id || phRaw.id || Math.random().toString(36).slice(2),
        is_generic: !!(raw.is_generic ?? phRaw.is_generic ?? false),
        pharmacy: { name, address, phone, lat, lng }
      };
    }

    async function ensureUserLocation(){
      if(userLocation.status === 'granted' || userLocation.status === 'denied' || userLocation.status === 'unsupported' || userLocation.status === 'error'){
        return userLocation;
      }
      if(!('geolocation' in navigator)){
        userLocation = { status:'unsupported', coords:null };
        updateLocationAlert();
        updateResultLists();
        return userLocation;
      }
      if(locationPromise){ return locationPromise; }
      userLocation = { status:'loading', coords:null };
      updateLocationAlert();
      locationPromise = new Promise(resolve => {
        navigator.geolocation.getCurrentPosition(pos => {
          userLocation = { status:'granted', coords:{ lat: pos.coords.latitude, lng: pos.coords.longitude } };
          updateLocationAlert();
          updateResultLists();
          resolve(userLocation);
        }, err => {
          userLocation = { status: (err && err.code === 1) ? 'denied' : 'error', coords:null };
          updateLocationAlert();
          updateResultLists();
          resolve(userLocation);
        }, { enableHighAccuracy:true, timeout:10000, maximumAge:0 });
      });
      return locationPromise;
    }

    function setStatus(el, message='', tone='muted'){
      if(!el) return;
      let cls = 'text-sm ';
      if(tone === 'success'){ cls += 'text-emerald-600 dark:text-emerald-300'; }
      else if(tone === 'error'){ cls += 'text-rose-500 dark:text-rose-300'; }
      else { cls += 'text-slate-500 dark:text-slate-300'; }
      el.className = cls;
      el.textContent = message;
    }

    function setAuthTab(tab='sms'){
      authState.activeTab = tab;
      authTabButtons.forEach(btn => {
        const active = (btn.dataset.authTab === tab);
        btn.setAttribute('aria-selected', active);
        btn.classList.toggle('bg-white', active);
        btn.classList.toggle('dark:bg-slate-800', active);
        btn.classList.toggle('shadow-soft', active);
        btn.classList.toggle('text-slate-600', !active);
        btn.classList.toggle('dark:text-slate-400', !active);
      });
      Object.entries(authViews).forEach(([key, view])=>{
        if(view) view.classList.toggle('hidden', key !== tab);
      });
    }

    function setAuthOption(option='login', silent=false){
      authState.option = option;
      authOptionButtons.forEach(btn => {
        const active = (btn.dataset.authOption === option);
        btn.setAttribute('aria-pressed', active);
        btn.classList.toggle('bg-white/70', active);
        btn.classList.toggle('dark:bg-white/5', active);
        btn.classList.toggle('bg-white/40', !active);
      });
      if(authOptionDescription){
        const key = option === 'register' ? 'authOptionRegisterDesc' : option === 'guest' ? 'authOptionGuestDesc' : 'authOptionLoginDesc';
        authOptionDescription.textContent = t(key);
      }
      if(!silent){
        setStatus(authSmsStatus, '');
        setStatus(authEmailStatus, '');
        setStatus(authSsoStatus, '');
        if(option === 'guest'){
          setAuthTab('sms');
        }else if(authState.activeTab === 'sms'){
          setAuthTab('email');
        }
      }
    }

    function refreshAuthMessage(){
      if(!pmAuthMessage) return;
      const verified = authState.verified;
      pmAuthMessage.textContent = verified ? t('pmAuthReady') : t('pmAuthRequired');
      pmAuthMessage.classList.toggle('text-emerald-600', verified);
      pmAuthMessage.classList.toggle('dark:text-emerald-300', verified);
      pmAuthMessage.classList.toggle('text-slate-500', !verified);
      pmAuthMessage.classList.toggle('dark:text-slate-400', !verified);
    }

    function resetAuthState({ preserveSelection=false } = {}){
      const option = preserveSelection ? (authState.option || 'login') : 'login';
      const tab = preserveSelection ? (authState.activeTab || (option==='guest'?'sms':'email')) : (option==='guest'?'sms':'email');
      authState = { option, activeTab: tab, verified:false, method:null, sms:null, email:null, payload:null };
      setAuthOption(option, true);
      setAuthTab(tab);
      setStatus(authSmsStatus, '');
      setStatus(authEmailStatus, '');
      setStatus(authSsoStatus, '');
      authSmsResendBtn?.classList.add('hidden');
      if(authSmsCodeInput) authSmsCodeInput.value = '';
      if(authSmsPhoneInput) authSmsPhoneInput.value = '';
      if(authEmailInput) authEmailInput.value = '';
      authGlobalStatus?.classList.add('hidden');
      refreshAuthMessage();
    }

    function openAuthModal(tab){
      setAuthOption(authState.option || 'login', true);
      const targetTab = tab || authState.activeTab || (authState.option === 'guest' ? 'sms' : 'email');
      setAuthTab(targetTab);
      authModalEl?.classList.remove('hidden');
      authModalEl?.classList.add('flex');
      bodyEl.classList.add('overflow-hidden');
      if(authGlobalStatus){ authGlobalStatus.classList.toggle('hidden', !authState.verified); }
    }

    function closeAuthModal(){
      authModalEl?.classList.add('hidden');
      authModalEl?.classList.remove('flex');
      const proHidden = typeof proModal === 'undefined' || !proModal || proModal.classList.contains('hidden');
      const barcodeHidden = typeof barcodeModal === 'undefined' || !barcodeModal || barcodeModal.classList.contains('hidden');
      if((!resultsModalEl || resultsModalEl.classList.contains('hidden')) && proHidden && barcodeHidden){
        bodyEl.classList.remove('overflow-hidden');
      }
    }

    function markAuthVerified(method, payload){
      authState.verified = true;
      authState.method = method;
      authState.payload = payload;
      authGlobalStatus?.classList.remove('hidden');
      authGlobalStatusText.textContent = t('authGlobalSuccess');
      refreshAuthMessage();
      const cb = afterAuthCallback;
      afterAuthCallback = null;
      setTimeout(()=>{
        closeAuthModal();
        if(cb) cb();
      }, 220);
    }

    function toPickupPharmacy(raw){
      if(!raw) return null;
      if(typeof raw === 'string'){
        return {
          name: raw,
          addr: '',
          tel: '',
          lat: '',
          lng: '',
          is_generic: false
        };
      }
      if(raw.pharmacy){
        return toPickupPharmacy({
          ...raw.pharmacy,
          is_generic: raw.is_generic ?? raw.pharmacy.is_generic
        });
      }
      return {
        name: raw.name || raw.pharmacy_name || raw.title || (state.lang==='el'?'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿':'Pharmacy'),
        addr: raw.addr || raw.address || raw.pharmacy_address || '',
        tel: raw.tel || raw.phone || raw.pharmacy_phone || '',
        lat: raw.lat ?? raw.pharmacy_lat ?? '',
        lng: raw.lng ?? raw.pharmacy_lng ?? '',
        is_generic: !!(raw.is_generic ?? raw.generic ?? false)
      };
    }

    function populateReservedDetails(pharmacy){
      const fallbackName = state.lang==='el'?'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿':'Pharmacy';
      const fallbackAddress = state.lang==='el'?'Î§Ï‰ÏÎ¯Ï‚ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·':'No address provided';
      statusReservedName.textContent = pharmacy?.name || fallbackName;
      statusReservedAddress.textContent = pharmacy?.addr || fallbackAddress;
      statusReservedGeneric.classList.toggle('hidden', !pharmacy?.is_generic);
      const querySource = pharmacy?.addr || pharmacy?.name || '';
      if(querySource){
        const encoded = encodeURIComponent(querySource);
        let href = `https://www.google.com/maps?q=${encoded}`;
        if(pharmacy?.lat && pharmacy?.lng){
          href = `https://www.google.com/maps?q=${encoded}@${pharmacy.lat},${pharmacy.lng},17z`;
        }
        statusDirectionsLink.href = href;
        setLinkAvailability(statusDirectionsLink, true);
      } else {
        statusDirectionsLink.href = '#';
        setLinkAvailability(statusDirectionsLink, false);
      }
    }

    function fmt(s){const m=String(Math.floor(s/60)).padStart(2,'0'), ss=String(s%60).padStart(2,'0'); return `${m}:${ss}`;}
    function stopPickupTimer(){ if(pInt){clearInterval(pInt); pInt=null;} pickupBox?.classList.add('hidden'); }
    function startPickupTimer(sec){
      setResultsState('reserved');
      remaining=sec; pickupTimerEl.textContent=fmt(remaining);
      const last=localStorage.getItem('pickup-extend-date'); const today=new Date().toISOString().slice(0,10);
      extendBtn.disabled=(last===today); extendBtn.classList.toggle('opacity-50',extendBtn.disabled);
      if(pInt) clearInterval(pInt);
      pInt=setInterval(()=>{remaining--; if(remaining<=0){stopPickupTimer(); return;} pickupTimerEl.textContent=fmt(remaining)},1000);
    }
    extendBtn.onclick=async ()=>{
      if(extendBtn.disabled) return;
      extendBtn.disabled = true;
      extendBtn.classList.add('opacity-50');
      try{
        if(window.currentRequest?.mode === 'functions' && window.currentRequest?.token){
          const hold = await extendViaFunctions(window.currentRequest.token);
          if(hold){
            const diff = Math.max(0, Math.round((new Date(hold).getTime() - Date.now())/1000));
            if(diff > 0){
              remaining = diff;
              pickupTimerEl.textContent = fmt(remaining);
            }
          } else {
            remaining += 15*60;
            pickupTimerEl.textContent = fmt(remaining);
          }
        } else {
          remaining += 15*60;
          pickupTimerEl.textContent = fmt(remaining);
          if(hasSupabase() && window.currentRequest?.id){
            const newUntil = new Date(Date.now()+remaining*1000).toISOString();
            await sb().from('requests').update({ pickup_until: newUntil }).eq('id', window.currentRequest.id);
          }
        }
      }catch(err){
        console.warn('extend error', err);
        remaining += 15*60;
        pickupTimerEl.textContent = fmt(remaining);
      }
      localStorage.setItem('pickup-extend-date', new Date().toISOString().slice(0,10));
    };

    statusEmptyBtn?.addEventListener('click', ()=>{
      hidePending();
      results.classList.add('hidden');
      resultsPending?.classList.remove('hidden');
      resultsListWrap?.classList.add('hidden');
      resultsEmpty?.classList.add('hidden');
      pickupBox?.classList.add('hidden');
      selectedPharmacy = null;
      closeResultsModal();
      resetAuthState({ preserveSelection:true });
      window.scrollTo({ top: 0, behavior:'smooth' });
    });

    const pm = document.getElementById('pharm-modal');
    const pmTitle = document.getElementById('pm-title');
    const pmAddr  = document.getElementById('pm-address');
    const pmMaps  = document.getElementById('pm-maps');
    const pmConfirm = document.getElementById('pm-confirm');
    const pmAuthMessage = document.getElementById('pm-auth-message');
    document.getElementById('pm-close').onclick = ()=> pm.classList.add('hidden');

    /* ========== CREATE REQUEST ========== */
    async function insertRequestRow(row){
      const { data, error } = await sb().from('requests').insert(row).select('id,created_at').single();
      if(error) throw error;
      return data;
    }

    async function createRequest(payload){
      if(!hasSupabase()) throw new Error('NO_DB');
      const baseRow = {
        status: 'pending',
        med_name: payload.med_name,
        active_substance: payload.active_substance || null,
        med_type: payload.med_type || null,
        quantity: payload.quantity,
        allow_generic: payload.allow_generic,
        city: payload.city
      };
      if(payload.barcode){
        try {
          return await insertRequestRow({ ...baseRow, barcode_value: payload.barcode });
        } catch(err){
          console.warn('Falling back without barcode_value column', err);
        }
      }
      return insertRequestRow(baseRow);
    }

    async function submitViaFunctions(payload){
      try{
        const res = await apiFetch('send-request', {
          method:'POST',
          body: {
            lang: state.lang,
            city: payload.city,
            medicine_name: payload.med_name,
            substance: payload.active_substance || '',
            type: payload.med_type || '',
            quantity: payload.quantity,
            allow_generic: payload.allow_generic,
            rx_number: payload.barcode || ''
          }
        });
        if(res?.ok){
          return { id: res.request_id, token: res.token };
        }
      }catch(err){
        console.warn('send-request error', err);
      }
      return null;
    }

    function mapReplyToItem(reply){
      if(!reply) return null;
      const available = reply.available;
      if(available === false) return null;
      const pharmacy = reply.pharmacy || {};
      return {
        id: reply.id || reply.reply_id || pharmacy.id || Math.random().toString(36).slice(2),
        is_generic: !!(reply.is_generic ?? reply.generic ?? false),
        pharmacy: {
          id: pharmacy.id || reply.pharmacy_id || null,
          name: reply.pharmacy_name || pharmacy.name || (state.lang==='el'?'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿':'Pharmacy'),
          address: reply.address || pharmacy.address || reply.pharmacy_address || '',
          phone: reply.phone || pharmacy.phone || reply.pharmacy_phone || '',
          lat: (reply.lat ?? pharmacy.lat ?? reply.pharmacy_lat ?? ''),
          lng: (reply.lng ?? pharmacy.lng ?? reply.pharmacy_lng ?? '')
        }
      };
    }

    async function pollStatusFunctions(token){
      if(!token) return null;
      try{
        const data = await apiFetch(`request-status?token=${encodeURIComponent(token)}`);
        const replies = Array.isArray(data.replies) ? data.replies : [];
        const items = replies
          .map(mapReplyToItem)
          .filter(Boolean);
        const reservedPharmacy = data.reserved_pharmacy || data.pickup_pharmacy || null;
        return {
          status: data.status || 'pending',
          items,
          holdUntil: data.hold_until || null,
          extendUsedAt: data.extend_used_at || null,
          reservedPharmacy
        };
      }catch(err){
        console.warn('request-status error', err);
        throw err;
      }
    }

    async function reserveViaFunctions(token){
      if(!token) return null;
      try{
        const data = await apiFetch('reserve', { method:'POST', body:{ token } });
        return data?.hold_until || null;
      }catch(err){
        console.warn('reserve error', err);
        return null;
      }
    }

    async function extendViaFunctions(token){
      if(!token) return null;
      try{
        const data = await apiFetch('extend-hold', { method:'POST', body:{ token } });
        return data?.hold_until || null;
      }catch(err){
        console.warn('extend-hold error', err);
        return null;
      }
    }

    /* ========== POLLING RESPONSES ========== */
    async function fetchResponses(requestId){
      const { data: rows, error } = await sb()
        .from('responses')
        .select('id, request_id, is_generic, pharmacy_id, available')
        .eq('request_id', requestId)
        .eq('available', true);

      if(error) throw error;
      if(!rows || !rows.length) return [];

      const pharmacyIds = [...new Set(rows.map(r=>r.pharmacy_id).filter(Boolean))];
      let pharmacies = [];
      if(pharmacyIds.length){
        const { data: phs } = await sb()
          .from('pharmacies')
          .select('id,name,address,phone,hours_json,lat,lng')
          .in('id', pharmacyIds);
        pharmacies = phs || [];
      }
      const byId = Object.fromEntries(pharmacies.map(p=>[p.id, p]));
      return rows.map(r=>({
        id: r.id,
        is_generic: !!r.is_generic,
        pharmacy: byId[r.pharmacy_id] || { id:r.pharmacy_id, name:'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿', address:'â€”', phone:'â€”' }
      }));
    }

    function startPolling({ mode, startTime=Date.now() }){
      if(pollInt) clearInterval(pollInt);

      async function handleFunctions(){
        if(!window.currentRequest?.token) return;
        const data = await pollStatusFunctions(window.currentRequest.token);
        if(!data) return;
        if(data.status === 'reserved'){
          hidePending();
          let reserved = selectedPharmacy || null;
          if(!reserved){
            try{
              const stored = localStorage.getItem(LS_PICKUP);
              if(stored) reserved = toPickupPharmacy(JSON.parse(stored));
            }catch{}
          }
          if(!reserved && data.reservedPharmacy){
            reserved = toPickupPharmacy(data.reservedPharmacy);
          }
          if(reserved){
            populateReservedDetails(reserved);
            localStorage.setItem(LS_PICKUP, JSON.stringify(reserved));
            selectedPharmacy = reserved;
          }
          const holdSec = data.holdUntil ? Math.max(0, Math.round((new Date(data.holdUntil).getTime() - Date.now())/1000)) : 60*60;
          if(holdSec > 0) startPickupTimer(Math.max(holdSec, 60));
          else startPickupTimer(60*60);
          clearInterval(pollInt); pollInt=null;
          return;
        }
        if(data.items.length){
          hidePending();
          renderResults(data.items);
        } else if(Date.now() - startTime > 120000){
          if(!latestResults.length){
            hidePending();
            setResultsState('empty');
          }
          clearInterval(pollInt); pollInt=null;
        }
      }

      async function handleSupabase(){
        if(!window.currentRequest?.id) return;
        const items = await fetchResponses(window.currentRequest.id);
        if(items.length){
          hidePending();
          renderResults(items);
          clearInterval(pollInt); pollInt=null;
        }else if(Date.now()-startTime > 120000){
          if(!latestResults.length){
            hidePending();
            setResultsState('empty');
          }
          clearInterval(pollInt); pollInt=null;
        }
      }

      const pollOnce = async ()=>{
        try{
          if(mode === 'functions'){
            await handleFunctions();
          }else if(mode === 'supabase'){
            await handleSupabase();
          }
        }catch(err){
          console.warn('poll error', err);
          showResultsError();
        }
      };

      pollOnce();
      pollInt = setInterval(pollOnce, 4000);
    }

    function renderResults(items){
      resultsErrorEl?.classList.add('hidden');
      resultsLoadingEl?.classList.add('hidden');
      resultsEmptyModal?.classList.add('hidden');
      selectedPharmacy = null;
      refreshAuthMessage();
      latestResults = (Array.isArray(items) ? items : []).map(normalizeResultItem).filter(Boolean);
      if(!latestResults.length){
        resultsList.innerHTML = '';
        resultsModalList.innerHTML = '';
        setResultsState('empty');
        openResultsModal();
        resultsEmptyModal?.classList.remove('hidden');
        updateLocationAlert();
        return;
      }
      updateResultLists();
      setResultsState('list');
      openResultsModal();
      updateLocationAlert();
      ensureUserLocation();
    }

    function showResultsError(){
      resultsList.innerHTML = '';
      resultsModalList.innerHTML = '';
      resultsLoadingEl?.classList.add('hidden');
      resultsEmptyModal?.classList.add('hidden');
      resultsErrorEl?.classList.remove('hidden');
      openResultsModal();
      setResultsState('empty');
    }

    function handlePharmacySelection(card){
      if(!card) return;
      selectedPharmacy = {
        name: card.dataset.name || (state.lang==='el'?'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿':'Pharmacy'),
        addr: card.dataset.addr || '',
        lat: card.dataset.lat ? parseCoordinate(card.dataset.lat) : null,
        lng: card.dataset.lng ? parseCoordinate(card.dataset.lng) : null,
        is_generic: card.dataset.generic === 'true'
      };
      pmTitle.textContent = selectedPharmacy.name || (state.lang==='el'?'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿':'Pharmacy');
      pmAddr.textContent  = (state.lang==='el'?'Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·: ':'Address: ') + (selectedPharmacy.addr || 'â€”');
      if(selectedPharmacy.addr || (selectedPharmacy.lat !== null && selectedPharmacy.lng !== null)){
        pmMaps.href = buildMapsHref({
          address: selectedPharmacy.addr,
          name: selectedPharmacy.name,
          lat: selectedPharmacy.lat,
          lng: selectedPharmacy.lng
        });
        pmMaps.classList.remove('opacity-50','pointer-events-none');
        pmMaps.removeAttribute('aria-disabled');
      }else{
        pmMaps.href = '#';
        pmMaps.classList.add('opacity-50','pointer-events-none');
        pmMaps.setAttribute('aria-disabled','true');
      }
      closeResultsModal();
      pm.classList.remove('hidden');
      pm.classList.add('flex');
      refreshAuthMessage();
    }

    resultsList.addEventListener('click', (e)=>{
      const btn = e.target.closest('.select-pharm'); if(!btn) return;
      const card = btn.closest('.result-card'); if(!card) return;
      handlePharmacySelection(card);
    });

    resultsModalList?.addEventListener('click', (e)=>{
      const btn = e.target.closest('.select-pharm'); if(!btn) return;
      const card = btn.closest('.result-card'); if(!card) return;
      handlePharmacySelection(card);
    });

    document.getElementById('pm-close').onclick = ()=> pm.classList.add('hidden');
    async function completeReservation(){
      if(!selectedPharmacy) return;
      pm.classList.add('hidden');
      populateReservedDetails(selectedPharmacy);
      let sec = 60*60;
      try{
        if(window.currentRequest?.mode === 'functions' && window.currentRequest?.token){
          const hold = await reserveViaFunctions(window.currentRequest.token);
          if(hold){
            const diff = Math.max(0, Math.round((new Date(hold).getTime() - Date.now())/1000));
            if(diff > 0) sec = diff;
          }
        } else if(hasSupabase() && window.currentRequest?.id){
          const untilISO = new Date(Date.now()+sec*1000).toISOString();
          await sb().from('requests').update({ status:'reserved', pickup_until: untilISO }).eq('id', window.currentRequest.id);
        }
      }catch(err){ console.warn('reserve confirm error', err); }
      localStorage.setItem(LS_PICKUP, JSON.stringify(selectedPharmacy));
      startPickupTimer(sec);
    }

    pmConfirm.onclick = ()=>{
      if(!selectedPharmacy) return;
      if(authState.verified){
        completeReservation();
        return;
      }
      afterAuthCallback = completeReservation;
      const defaultTab = authState.option === 'guest' ? 'sms' : (authState.activeTab || 'email');
      openAuthModal(defaultTab);
    };

    function sendSmsCode(){
      const phone = (authSmsPhoneInput?.value || '').trim();
      const digits = phone.replace(/\D/g,'');
      if(!phone || digits.length < 8){
        setStatus(authSmsStatus, t('authSmsStatusMissing'), 'error');
        return;
      }
      const code = String(Math.floor(100000 + Math.random() * 900000));
      authState.sms = { phone, code, expiresAt: Date.now() + 2 * 60 * 1000 };
      if(authSmsCodeInput) authSmsCodeInput.value = '';
      authSmsResendBtn?.classList.remove('hidden');
      setStatus(authSmsStatus, t('authSmsStatusSent').replace('%s', phone).replace('%s', code), 'success');
    }

    function sendMagicLink(mode){
      const email = (authEmailInput?.value || '').trim();
      const valid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      if(!valid){
        setStatus(authEmailStatus, t('authEmailStatusMissing'), 'error');
        return;
      }
      authState.email = { email, mode, expiresAt: Date.now() + 10 * 60 * 1000 };
      const key = mode === 'register' ? 'authEmailStatusSentRegister' : 'authEmailStatusSentLogin';
      setStatus(authEmailStatus, t(key).replace('%s', email), 'success');
    }

    authSmsSendBtn?.addEventListener('click', sendSmsCode);
    authSmsResendBtn?.addEventListener('click', sendSmsCode);
    authSmsVerifyBtn?.addEventListener('click', ()=>{
      if(!authState.sms){
        setStatus(authSmsStatus, t('authSmsStatusMissing'), 'error');
        return;
      }
      if(authState.sms.expiresAt < Date.now()){
        setStatus(authSmsStatus, t('authSmsStatusExpired'), 'error');
        return;
      }
      const code = (authSmsCodeInput?.value || '').trim();
      if(code !== authState.sms.code){
        setStatus(authSmsStatus, t('authSmsStatusMismatch'), 'error');
        return;
      }
      setStatus(authSmsStatus, t('authSmsStatusVerified'), 'success');
      markAuthVerified('sms', { phone: authState.sms.phone });
    });

    authEmailLoginBtn?.addEventListener('click', ()=> sendMagicLink('login'));
    authEmailRegisterBtn?.addEventListener('click', ()=> sendMagicLink('register'));
    authEmailConfirmBtn?.addEventListener('click', ()=>{
      if(!authState.email){
        setStatus(authEmailStatus, t('authEmailStatusPending'), 'error');
        return;
      }
      if(authState.email.expiresAt < Date.now()){
        setStatus(authEmailStatus, t('authEmailStatusExpired'), 'error');
        return;
      }
      setStatus(authEmailStatus, t('authEmailStatusVerified'), 'success');
      markAuthVerified('email', { email: authState.email.email, mode: authState.email.mode });
    });

    authSsoButtons.forEach(btn => {
      btn.addEventListener('click', ()=>{
        const provider = btn.dataset.provider || 'SSO';
        setStatus(authSsoStatus, t('authSsoStatusSuccess').replace('%s', provider), 'success');
        markAuthVerified('sso', { provider });
      });
    });

    resultsModalClose?.addEventListener('click', closeResultsModal);
    resultsModalOverlay?.addEventListener('click', closeResultsModal);
    authCloseBtn?.addEventListener('click', closeAuthModal);
    authModalOverlay?.addEventListener('click', closeAuthModal);
    authOptionButtons.forEach(btn => {
      btn.addEventListener('click', ()=> setAuthOption(btn.dataset.authOption || 'login'));
    });
    authTabButtons.forEach(btn => {
      btn.addEventListener('click', ()=> setAuthTab(btn.dataset.authTab || 'sms'));
    });

    document.addEventListener('keydown', (event)=>{
      if(event.key !== 'Escape') return;
      if(authModalEl && !authModalEl.classList.contains('hidden')){ closeAuthModal(); return; }
      if(resultsModalEl && !resultsModalEl.classList.contains('hidden')){ closeResultsModal(); }
    });

    document.getElementById('newSearch').addEventListener('click', ()=>{
      hidePending();
      stopPickupTimer();
      results.classList.add('hidden');
      resultsPending?.classList.remove('hidden');
      resultsListWrap?.classList.add('hidden');
      resultsEmpty?.classList.add('hidden');
      pickupBox?.classList.add('hidden');
      selectedPharmacy = null;
      closeResultsModal();
      resetAuthState({ preserveSelection:true });
      window.scrollTo({ top: 0, behavior:'smooth' });
    });

    /* ========== SUBMIT FLOW ========== */
    document.getElementById('submitBtn').addEventListener('click', async (e)=>{
      e.preventDefault();
      const med_name = document.getElementById('medicine-name').value.trim();
      const active_substance = document.getElementById('active-substance').value.trim();
      const barcode = document.getElementById('barcode-value').value.trim();
      const med_type = document.getElementById('medicine-type').value || null;
      const quantity = parseInt(document.getElementById('quantity').value || '1',10);
      const allow_generic = (document.querySelector('input[name="allow-generic"]:checked')?.value==='YES');
      let city = cityInputEl ? cityInputEl.value.trim() : document.getElementById('city').value.trim();
      if(city){
        const match = citySuggestions.find(name => name.toLowerCase() === city.toLowerCase());
        if(match) city = match;
      }

      if(!med_name) return alert(state.lang==='el'?'Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï†Î±ÏÎ¼Î¬ÎºÎ¿Ï…':'Enter medicine name');
      if(!city) return alert(state.lang==='el'?'Î•Ï€Î¯Î»ÎµÎ¾Îµ Ï€ÏŒÎ»Î·':'Select city');
      if(!document.getElementById('gdpr-checkbox').checked) return alert(state.lang==='el'?'Î‘Ï€Î¿Î´Î­Î¾Î¿Ï… Ï„Î¿Ï…Ï‚ ÏŒÏÎ¿Ï…Ï‚':'Accept terms');

      closeResultsModal();
      resetAuthState({ preserveSelection:true });
      playCelebration(3200);
      showPending();
      scheduleDemoFallback(allow_generic, barcode);

      try {
        if(pollInt) { clearInterval(pollInt); pollInt=null; }
        window.currentRequest = null;
        selectedPharmacy = null;
        localStorage.removeItem(LS_PICKUP);
        localStorage.removeItem('pickup-extend-date');

        const fnResult = await submitViaFunctions({ med_name, active_substance, med_type, quantity, allow_generic, city, barcode });
        if(fnResult){
          window.currentRequest = { ...fnResult, mode:'functions', city, created_at: Date.now() };
          localStorage.setItem(LS_REQ, JSON.stringify(window.currentRequest));
          startPolling({ mode:'functions' });
          return;
        }

        if(hasSupabase()){
          const inserted = await createRequest({ med_name, active_substance, med_type, quantity, allow_generic, city, barcode });
          window.currentRequest = { id: inserted.id, created_at: inserted.created_at, mode:'supabase' };
          localStorage.setItem(LS_REQ, JSON.stringify(window.currentRequest));
          startPolling({ mode:'supabase' });
          return;
        }

        console.warn('Falling back to demo pharmacies.');
      } catch(err){
        console.error(err);
        hidePending();
        showResultsError();
        alert('ÎšÎ¬Ï„Î¹ Ï€Î®Î³Îµ ÏƒÏ„ÏÎ±Î²Î¬. ÎˆÎ»ÎµÎ³Î¾Îµ Ï„Î± Supabase keys ÎºÎ±Î¹ Ï„Î± tables.');
      }
    });

    /* ===================== Web Push (3c) ===================== */
    const pushToast = document.getElementById('push-toast');
    const btnPushAllow = document.getElementById('push-allow');
    const btnPushDeny  = document.getElementById('push-deny');

    function urlBase64ToUint8Array(base64String) {
      const padding = '='.repeat((4 - base64String.length % 4) % 4);
      const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');
      const rawData = atob(base64);
      const outputArray = new Uint8Array(rawData.length);
      for (let i = 0; i < rawData.length; ++i) { outputArray[i] = rawData.charCodeAt(i); }
      return outputArray;
    }

    async function saveSubscriptionToSupabase(sub) {
      if (!hasSupabase()) return;
      // Î£Ï…Î¼Î²Î±Ï„ÏŒÏ„Î·Ï„Î±: Ï€Î¬ÏÎµ Ï„Î± keys Î±Ï€ÏŒ toJSON()
      const raw = (typeof sub.toJSON === 'function') ? sub.toJSON() : {};
      const keys = raw.keys || {};
      const row = {
        endpoint: sub.endpoint,
        p256dh: keys.p256dh || '',
        auth: keys.auth || '',
        user_agent: navigator.userAgent
      };
      // upsert Î¼Îµ onConflict:endpoint
      const { error } = await sb().from('push_subscriptions').upsert(row, { onConflict: 'endpoint' });
      if (error) console.warn('save sub error', error);
    }

    async function ensurePushSubscribed(reg) {
      try{
        if (!('Notification' in window) || !('PushManager' in window)) return;
        const publicKey = (window.ENV && window.ENV.VAPID_PUBLIC_KEY) || '';
        if (!publicKey) return;

        if (Notification.permission === 'granted') {
          const existing = await reg.pushManager.getSubscription();
          if (existing) { await saveSubscriptionToSupabase(existing); return; }
          const sub = await reg.pushManager.subscribe({
            userVisibleOnly: true,
            applicationServerKey: urlBase64ToUint8Array(publicKey)
          });
          await saveSubscriptionToSupabase(sub);
          return;
        }
        if (Notification.permission === 'default') {
          pushToast.classList.remove('hidden');
        }
      }catch(err){ console.warn('push subscribe error', err); }
    }

    btnPushAllow?.addEventListener('click', async ()=>{
      pushToast.classList.add('hidden');
      try{
        const perm = await Notification.requestPermission();
        if (perm !== 'granted') return;
        const reg = await navigator.serviceWorker.getRegistration();
        if (!reg) return;
        await ensurePushSubscribed(reg);
      }catch(e){ console.warn(e); }
    });
    btnPushDeny?.addEventListener('click', ()=> pushToast.classList.add('hidden'));

    /* ========== PWA install & SW update flow ========== */
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js').then(async reg => {
        if (reg.waiting) reg.waiting.postMessage({ type: 'SKIP_WAITING' });
        reg.addEventListener('updatefound', () => {
          const nw = reg.installing;
          nw?.addEventListener('statechange', () => {
            if (nw.state === 'installed' && navigator.serviceWorker.controller) {
              reg.waiting?.postMessage({ type: 'SKIP_WAITING' });
            }
          });
        });
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          window.location.reload();
        });

        // 3c: push subscription
        await ensurePushSubscribed(reg);
      }).catch(console.warn);
    }
    let deferredPrompt=null;
    const installBtn = document.getElementById('cta-install');
    window.addEventListener('beforeinstallprompt', (e)=>{
      e.preventDefault(); deferredPrompt = e; installBtn.classList.remove('hidden');
    });
    installBtn.addEventListener('click', async ()=>{
      if(!deferredPrompt) return;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt=null; installBtn.classList.add('hidden');
    });

    /* ========== Init ========== */
    resetAuthState({ preserveSelection:true });
    applyLang();
    try{
      const saved = JSON.parse(localStorage.getItem(LS_REQ) || 'null');
      if(saved?.id){ window.currentRequest = saved; }
    }catch{}
  </script>
</body>
</html>
