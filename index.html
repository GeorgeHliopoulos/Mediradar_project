<!DOCTYPE html>
<html lang="el" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>MediRadar</title>
  <meta name="application-name" content="MediRadar" />
  <meta name="apple-mobile-web-app-title" content="MediRadar" />
  <meta name="description" content="Î†Î¼ÎµÏƒÎ· ÎµÏÏÎµÏƒÎ· Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚ Ï†Î±ÏÎ¼Î¬ÎºÏ‰Î½ ÏƒÎµ ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±." />
  <meta property="og:site_name" content="MediRadar" />
  <meta property="og:description" content="Î†Î¼ÎµÏƒÎ· ÎµÏÏÎµÏƒÎ· Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚ Ï†Î±ÏÎ¼Î¬ÎºÏ‰Î½ ÏƒÎµ ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±." />
  <meta name="theme-color" content="#29a3a3" />
  <link rel="icon" href="/icons/icon-192.png">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <link rel="manifest" href="/manifest.json">

  <!-- Tailwind (dev Î¼Îµ CDN). Î“Î¹Î± production build Î¸Î± Ï„Î¿ Î±Î»Î»Î¬Î¾Î¿Ï…Î¼Îµ ÏƒÎµ PostCSS/CLI. -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter','ui-sans-serif','system-ui'] },
          colors: { brand: { 500:'#29a3a3', 600:'#208181', 700:'#196464' } },
          boxShadow: { soft:'0 16px 40px rgba(2,6,23,.12)' }
        }
      }
    }
  </script>

  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body { position: relative; overflow-x: hidden; }
    .glass-surface {
      background: rgba(255, 255, 255, 0.22);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.35);
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.12);
      border-radius: 1rem;
    }
    .dark .glass-surface {
      background: rgba(15, 23, 42, 0.62);
      border-color: rgba(148, 163, 184, 0.32);
      box-shadow: 0 22px 48px rgba(2, 6, 23, 0.55);
    }
    .global-emoji-layer { position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden; }
    .global-emoji-layer span {
      position: absolute; font-size: clamp(2.75rem, 6vw, 4rem); opacity: 0.18; animation-iteration-count: infinite; animation-timing-function: linear;
    }
    .global-emoji-layer span:nth-child(1) { top: 8%; left: 12%; animation-name: globalEmojiFloatA; animation-duration: 32s; }
    .global-emoji-layer span:nth-child(2) { top: 18%; right: 18%; animation-name: globalEmojiFloatB; animation-duration: 38s; }
    .global-emoji-layer span:nth-child(3) { bottom: 16%; left: 18%; animation-name: globalEmojiFloatC; animation-duration: 42s; }
    .global-emoji-layer span:nth-child(4) { bottom: 8%; right: 14%; animation-name: globalEmojiFloatD; animation-duration: 36s; }
    .global-emoji-layer span:nth-child(5) { top: 42%; left: 45%; animation-name: globalEmojiFloatE; animation-duration: 44s; opacity: 0.14; }
    .dark .global-emoji-layer span { opacity: 0.22; }
    @keyframes globalEmojiFloatA { 0% { transform: translate3d(0, 0, 0) scale(0.92); opacity: 0.06; } 40% { transform: translate3d(24px, -16px, 0) scale(1.04); opacity: 0.18; } 100% { transform: translate3d(0, 0, 0) scale(0.92); opacity: 0.06; } }
    @keyframes globalEmojiFloatB { 0% { transform: translate3d(0, 0, 0) scale(1); opacity: 0.05; } 50% { transform: translate3d(-26px, 18px, 0) scale(1.06); opacity: 0.19; } 100% { transform: translate3d(0, 0, 0) scale(1); opacity: 0.05; } }
    @keyframes globalEmojiFloatC { 0% { transform: translate3d(0, 0, 0) scale(0.94); opacity: 0.07; } 55% { transform: translate3d(22px, -12px, 0) scale(1.05); opacity: 0.2; } 100% { transform: translate3d(0, 0, 0) scale(0.94); opacity: 0.07; } }
    @keyframes globalEmojiFloatD { 0% { transform: translate3d(0, 0, 0) scale(1.02); opacity: 0.06; } 45% { transform: translate3d(-18px, -20px, 0) scale(0.95); opacity: 0.18; } 100% { transform: translate3d(0, 0, 0) scale(1.02); opacity: 0.06; } }
    @keyframes globalEmojiFloatE { 0% { transform: translate3d(0, 0, 0) scale(0.9); opacity: 0.05; } 50% { transform: translate3d(14px, 22px, 0) scale(1.07); opacity: 0.16; } 100% { transform: translate3d(0, 0, 0) scale(0.9); opacity: 0.05; } }
    .app-bg {
      background:
        radial-gradient(1100px 600px at 0% -10%, rgba(132,197,244,.30), transparent 60%),
        radial-gradient(900px 540px at 110% 0%, rgba(199,166,244,.22), transparent 58%),
        radial-gradient(1000px 600px at 25% 120%, rgba(247,141,167,.18), transparent 62%),
        radial-gradient(800px 520px at 120% 120%, rgba(157,224,214,.20), transparent 60%),
        linear-gradient(180deg, #f6fbfb 0%, #f8fafc 40%, #fbfcfe 100%);
    }
    .dark .app-bg{
      background:
        radial-gradient(1100px 600px at 0% -10%, rgba(132,197,244,.16), transparent 60%),
        radial-gradient(900px 540px at 110% 0%, rgba(199,166,244,.14), transparent 58%),
        radial-gradient(1000px 600px at 25% 120%, rgba(247,141,167,.12), transparent 62%),
        radial-gradient(800px 520px at 120% 120%, rgba(157,224,214,.12), transparent 60%),
        linear-gradient(180deg, #0b1515, #0b1515 45%, #0b1515 100%);
    }
    .ac-list { position:absolute; inset-inline:0; top:100%; z-index:40 }
    .ac-item { cursor:pointer }
    .badge { display:inline-flex; align-items:center; gap:6px; padding:.25rem .5rem; border-radius:999px; font-size:.75rem; }
    /* Î•Ï€Î¹Ï„Î±Ï‡ÏÎ½Î¿Ï…Î¼Îµ ÎºÎ±Î¹ ÎºÎ¬Î½Î¿Ï…Î¼Îµ Ï€Î¹Î¿ Î­Î½Ï„Î¿Î½Î· Ï„Î·Î½ ÎºÎ¯Î½Î·ÏƒÎ· Ï„Ï‰Î½ emoji */
    @keyframes spinHourglass {
      0%   { transform: translateY(0) scale(0.95) rotate(0deg); }
      50%  { transform: translateY(-10px) scale(1.18) rotate(270deg); }
      100% { transform: translateY(0) scale(0.95) rotate(540deg); }
    }
    /* Î•Ï†Î±ÏÎ¼ÏŒÎ¶Î¿Ï…Î¼Îµ Î³ÏÎ·Î³Î¿ÏÏŒÏ„ÎµÏÎ· ÎºÎ¯Î½Î·ÏƒÎ· & Ï€Î¹Î¿ Î¶Ï‰Î½Ï„Î±Î½Î¬ Ï‡ÏÏÎ¼Î±Ï„Î± ÏƒÏ„Î¿ animated emoji */
    .emoji-spinner {
      animation: spinHourglass 0.6s ease-out infinite;
      filter: saturate(1.4) brightness(1.1);
      opacity: 1;
      display: inline-flex;
    }
    /* Î¼Î¹ÎºÏÏŒ, Î´Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÏŒ toast Î³Î¹Î± ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ */
    #push-toast { transition: transform .25s ease, opacity .25s ease; }
    #push-toast.hidden { opacity:0; pointer-events:none; transform: translateY(6px); }
    .lang-btn { transition: all .2s ease; }
    .lang-btn[data-active="true"] {
      background: linear-gradient(135deg, #29a3a3, #208181);
      color: #fff;
      box-shadow: 0 12px 24px rgba(32,129,129,.25);
    }
    .dark .lang-btn[data-active="true"] {
      background: linear-gradient(135deg, #7edbd9, #4cc2c1);
      color: #062322;
    }
    .flag-icon { display:inline-flex; align-items:center; justify-content:center; }
    .flag-icon svg { width:24px; height:16px; border-radius:2px; box-shadow:0 0 0 1px rgba(15,23,42,.15); }
    .dark .flag-icon svg { box-shadow:0 0 0 1px rgba(148,163,184,.4); }
    .barcode-highlight { box-shadow:0 0 0 3px rgba(16,185,129,.45); }
  </style>
</head>
<body class="min-h-full app-bg text-slate-900 dark:text-slate-200 font-sans">
  <div class="global-emoji-layer" aria-hidden="true">
    <span>ğŸ’Š</span>
    <span>ğŸ’‰</span>
    <span>ğŸ©¹</span>
    <span>ğŸ§´</span>
    <span>ğŸ’š</span>
  </div>

  <!-- Confetti -->
  <canvas id="confetti" class="fixed inset-0 pointer-events-none z-[60]" style="display:none;"></canvas>

  <!-- Top bar -->
  <div class="absolute top-3 left-3 right-3 z-50">
    <div class="flex flex-wrap items-center justify-between gap-3 sm:gap-4">
      <button id="pro-trigger" data-open-pro type="button" class="flex items-center gap-2 px-3 py-1.5 text-sm font-semibold rounded-2xl bg-white/80 dark:bg-white/10 border border-slate-200 dark:border-slate-700 backdrop-blur shadow-sm hover:bg-white dark:hover:bg-white/20">
        <span aria-hidden="true">ğŸ’¼</span>
        <span id="t-pro">Î“Î¹Î± ÎµÏ€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¯ÎµÏ‚</span>
      </button>

      <div class="flex items-center gap-2 rounded-2xl bg-white/80 dark:bg-white/10 border border-slate-200 dark:border-slate-700 backdrop-blur px-2 py-1 shadow-sm">
        <div class="flex items-center gap-1">
          <button id="lang-el" type="button" class="lang-btn px-3 py-1.5 text-xs sm:text-sm font-semibold rounded-xl flex items-center gap-2 bg-white/60 dark:bg-white/10 text-slate-800 dark:text-slate-200 hover:bg-white dark:hover:bg-white/20">
            <span aria-hidden="true" class="flag-icon">
              <svg viewBox="0 0 28 20" role="presentation" focusable="false" xmlns="http://www.w3.org/2000/svg">
                <rect width="28" height="20" fill="#0d5eaf"></rect>
                <g fill="#ffffff">
                  <rect y="2" width="28" height="2"></rect>
                  <rect y="6" width="28" height="2"></rect>
                  <rect y="10" width="28" height="2"></rect>
                  <rect y="14" width="28" height="2"></rect>
                  <rect y="18" width="28" height="2"></rect>
                </g>
                <rect width="10" height="10" fill="#0d5eaf"></rect>
                <rect x="4" width="2" height="10" fill="#ffffff"></rect>
                <rect y="4" width="10" height="2" fill="#ffffff"></rect>
              </svg>
            </span>
            <span id="t-langElLabel" class="hidden sm:inline">Î•Î»Î»Î·Î½Î¹ÎºÎ¬</span>
            <span class="sm:hidden">EL</span>
          </button>
          <button id="lang-en" type="button" class="lang-btn px-3 py-1.5 text-xs sm:text-sm font-semibold rounded-xl flex items-center gap-2 bg-white/60 dark:bg-white/10 text-slate-800 dark:text-slate-200 hover:bg-white dark:hover:bg-white/20">
            <span aria-hidden="true" class="flag-icon">
              <svg viewBox="0 0 30 20" role="presentation" focusable="false" xmlns="http://www.w3.org/2000/svg">
                <rect width="30" height="20" fill="#012169"></rect>
                <path d="M0 0L30 20M30 0L0 20" stroke="#ffffff" stroke-width="6" stroke-linecap="square"></path>
                <path d="M0 0L30 20M30 0L0 20" stroke="#c8102e" stroke-width="2.5" stroke-linecap="square"></path>
                <rect x="13" width="4" height="20" fill="#ffffff"></rect>
                <rect y="8" width="30" height="4" fill="#ffffff"></rect>
                <rect x="14" width="2" height="20" fill="#c8102e"></rect>
                <rect y="9" width="30" height="2" fill="#c8102e"></rect>
              </svg>
            </span>
            <span id="t-langEnLabel" class="hidden sm:inline">Î‘Î³Î³Î»Î¹ÎºÎ¬</span>
            <span class="sm:hidden">EN</span>
          </button>
        </div>

        <button id="theme-toggle" type="button" class="px-2.5 py-1.5 rounded-xl hover:bg-white dark:hover:bg-white/20">
          <span id="icon-sun" class="hidden">ğŸŒ</span><span id="icon-moon">ğŸŒ™</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Pending toast -->
  <div id="pending-toast" class="hidden fixed top-16 left-1/2 -translate-x-1/2 z-40 w-[min(760px,92vw)] pointer-events-none">
    <div class="pointer-events-auto rounded-2xl p-4 border border-amber-300/70 bg-amber-50 text-amber-900 dark:bg-amber-900/30 dark:text-amber-100 dark:border-amber-800 shadow-soft">
      <div class="flex items-center gap-4">
        <!-- Î ÏÎ¿ÏƒÎ¸Î­Ï„Î¿Ï…Î¼Îµ Ï„Î·Î½ ÎºÎ»Î¬ÏƒÎ· emoji-spinner Î³Î¹Î± Ï€Î¹Î¿ Î¶Ï‰Î·ÏÎ®, Î³ÏÎ®Î³Î¿ÏÎ· ÎºÎ¯Î½Î·ÏƒÎ· -->
        <div class="text-4xl emoji-spinner">â³</div>
        <div class="text-sm sm:text-base">
          <div id="t-pending">Î ÎµÏÎ¹Î¼Î­Î½Î¿Ï…Î¼Îµ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ Ï„Î± ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±â€¦</div>
          <div class="mt-1 font-semibold opacity-80"><span id="wait-elapsed">0s</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Push toast -->
  <div id="push-toast" class="hidden fixed bottom-4 left-1/2 -translate-x-1/2 z-40 w-[min(680px,94vw)]">
    <div class="rounded-2xl p-4 border border-sky-300/70 bg-sky-50 text-sky-900 dark:bg-sky-900/30 dark:text-sky-100 dark:border-sky-800 shadow-soft flex items-center justify-between gap-3">
      <div class="text-sm" id="t-pushText">
        ğŸ”” Î˜ÎµÏ‚ Î½Î± Î»Î±Î¼Î²Î¬Î½ÎµÎ¹Ï‚ ÎµÎ¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÏŒÏ„Î±Î½ Î±Ï€Î±Î½Ï„Î¬ Î­Î½Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿;
      </div>
      <div class="flex gap-2">
        <button id="push-deny" class="px-3 py-1.5 rounded-xl border hover:bg-white/70 dark:hover:bg-white/10 text-sm"><span id="t-pushNo">ÎŒÏ‡Î¹ Ï„ÏÏÎ±</span></button>
        <button id="push-allow" class="px-3 py-1.5 rounded-xl bg-brand-600 text-white font-semibold text-sm"><span id="t-pushYes">Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ·</span></button>
      </div>
    </div>
  </div>

  <!-- Splash -->
  <section id="splash" class="min-h-[100svh] grid place-items-center relative px-4">
    <div class="w-full max-w-4xl text-center">
      <div class="mx-auto w-24 h-24 rounded-3xl bg-brand-600 text-white grid place-items-center shadow-soft">
        <svg viewBox="0 0 24 24" class="w-10 h-10" aria-hidden="true">
          <path fill="currentColor" d="M11 2h2v3.06A7 7 0 0 1 18.94 11H22v2h-3.06A7 7 0 0 1 13 18.94V22h-2v-3.06A7 7 0 0 1 5.06 13H2v-2h3.06A7 7 0 0 1 11 5.06V2Zm1 5a5 5 0 1 0 0 10a5 5 0 0 0 0-10Z"/>
        </svg>
      </div>
      <h1 class="mt-5 text-4xl sm:text-5xl font-extrabold tracking-tight">MediRadar</h1>
      <p id="t-hero" class="mt-2 text-lg text-slate-600 dark:text-slate-400">Î†Î¼ÎµÏƒÎ· ÎµÏÏÎµÏƒÎ· Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚ Ï†Î±ÏÎ¼Î¬ÎºÏ‰Î½ ÏƒÎµ ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±.</p>
      <div class="mt-8 flex flex-col items-center gap-4 max-w-3xl mx-auto">
        <button id="cta-search" class="w-full sm:max-w-xl px-6 py-4 sm:py-5 sm:px-7 rounded-2xl bg-gradient-to-r from-brand-500 to-brand-600 text-white font-semibold shadow-soft hover:opacity-95 transform scale-[1.05] sm:scale-[1.1] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500">
          <span id="t-searchBTN">Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…</span>
        </button>
        <button id="cta-how" class="w-full sm:max-w-lg px-6 py-4 rounded-2xl bg-white/85 backdrop-blur border border-slate-200 hover:bg-white font-semibold focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500">
          <span id="t-howBTN">Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯</span>
        </button>
      </div>
      <button id="cta-install" class="mt-4 inline-flex items-center gap-2 px-4 py-2 rounded-xl border border-brand-600 text-brand-700 font-semibold bg-white/80 backdrop-blur hover:bg-white hidden">
        ğŸ“² <span id="t-installBTN">Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</span>
      </button>

      <div class="sm:hidden mt-4">
        <button id="pro-trigger-mobile" data-open-pro type="button" class="text-sm underline decoration-2">
          <span id="t-pro-m">Î“Î¹Î± ÎµÏ€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¯ÎµÏ‚</span>
        </button>
      </div>

      <div class="mt-16 max-w-3xl mx-auto w-full relative sm:min-h-[240px]">
        <div class="rounded-3xl border border-slate-200 dark:border-slate-700 bg-white/70 dark:bg-slate-900/40 backdrop-blur-sm p-6 text-left text-slate-700 dark:text-slate-300 w-full sm:w-[min(320px,45%)] sm:max-w-sm sm:absolute sm:bottom-0 sm:left-0">
          <h2 id="t-faqTitle" class="text-xl font-semibold">Î£Ï…Ï‡Î½Î­Ï‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ (ÏƒÏÎ½Ï„Î¿Î¼Î± Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚)</h2>
          <p id="t-faqSoon" class="mt-2 text-sm">Î•Ï„Î¿Î¹Î¼Î¬Î¶Î¿Ï…Î¼Îµ ÎµÎ½ÏŒÏ„Î·Ï„Î± FAQ Î¼Îµ Ï„Î¹Ï‚ Ï€Î¹Î¿ ÏƒÏ…Ï‡Î½Î­Ï‚ Î±Ï€Î¿ÏÎ¯ÎµÏ‚ ÏƒÎ±Ï‚. Î‘Î½ Î­Ï‡ÎµÎ¹Ï‚ ÎµÏÏÏ„Î·ÏƒÎ·, ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ­ Î¼Î±Ï‚.</p>
        </div>

        <div class="mt-6 flex flex-col gap-4 items-center text-slate-500 dark:text-slate-400 w-full sm:w-[min(320px,45%)] sm:max-w-sm sm:absolute sm:bottom-0 sm:right-0 sm:items-end sm:text-right">
          <a id="faq-contact" href="mailto:info@mediradar.gr" class="inline-flex items-center gap-2 text-sm font-semibold text-brand-700 hover:underline sm:self-end">
            âœ‰ï¸ <span id="t-faqContact">Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±: info@mediradar.gr</span>
          </a>
          <div class="flex flex-col items-center sm:items-end gap-3 text-center sm:text-right">
            <p id="t-shareTitle" class="text-xs uppercase tracking-[0.32em] text-slate-400 dark:text-slate-500">ÎœÎ¿Î¹ÏÎ¬ÏƒÎ¿Ï… Ï„Î¿ MediRadar</p>
            <div class="flex items-center gap-3">
              <a id="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fmediradar.gr" target="_blank" rel="noopener" class="p-2 rounded-full border border-slate-200 dark:border-slate-700 hover:bg-white/80 dark:hover:bg-white/10 transition" aria-label="ÎšÎ¿Î¹Î½Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÏƒÏ„Î¿ Facebook">
                <span class="sr-only" id="t-shareFacebook">ÎšÎ¿Î¹Î½Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÏƒÏ„Î¿ Facebook</span>
                <svg aria-hidden="true" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M13.5 22v-8.2h2.7l.4-3.2h-3.1v-2c0-.9.3-1.5 1.6-1.5h1.6V4.2c-.3 0-1.2-.1-2.2-.1c-2.2 0-3.7 1.3-3.7 3.8v2.1H8.8v3.2h2.9V22h1.8Z"/></svg>
              </a>
              <a id="share-twitter" href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fmediradar.gr" target="_blank" rel="noopener" class="p-2 rounded-full border border-slate-200 dark:border-slate-700 hover:bg-white/80 dark:hover:bg-white/10 transition" aria-label="ÎšÎ¿Î¹Î½Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÏƒÏ„Î¿ X">
                <span class="sr-only" id="t-shareTwitter">ÎšÎ¿Î¹Î½Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÏƒÏ„Î¿ X</span>
                <svg aria-hidden="true" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M4 3h4.4l3.2 4.7L15.7 3H20l-6.2 7.2L20 21h-4.4l-3.6-5.1L8.2 21H4l6.5-7.5L4 3Z"/></svg>
              </a>
              <a id="share-instagram" href="https://www.instagram.com/" target="_blank" rel="noopener" class="p-2 rounded-full border border-slate-200 dark:border-slate-700 hover:bg-white/80 dark:hover:bg-white/10 transition" aria-label="ÎšÎ¿Î¹Î½Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÏƒÏ„Î¿ Instagram">
                <span class="sr-only" id="t-shareInstagram">ÎšÎ¿Î¹Î½Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÏƒÏ„Î¿ Instagram</span>
                <svg aria-hidden="true" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5Zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7Zm5 3.5A4.5 4.5 0 1 1 7.5 12 4.5 4.5 0 0 1 12 7.5ZM12 9a3 3 0 1 0 3 3 3 3 0 0 0-3-3Zm6.25-2.75a1 1 0 1 1-1 1a1 1 0 0 1 1-1Z"/></svg>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- APP -->
  <main id="app" class="hidden mx-auto max-w-3xl px-4 pb-16">
    <header class="sticky top-0 z-30 -mt-3 mb-4">
      <div class="flex items-center justify-between px-2 py-3 rounded-2xl glass-surface bg-white/80 dark:bg-slate-900/70 backdrop-blur border border-slate-200 dark:border-slate-800">
        <div class="flex items-center gap-2">
          <button id="backHome" type="button" data-go-home class="px-3 py-1.5 rounded-lg border text-sm hover:bg-slate-50 dark:hover:bg-slate-800">â† <span id="t-home">Î‘ÏÏ‡Î¹ÎºÎ®</span></button>
          <span id="t-searchTitle" class="font-semibold">Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…</span>
        </div>
      </div>
    </header>

    <section class="grid grid-cols-1 gap-4 sm:gap-5">
      <!-- City -->
      <div class="rounded-2xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4 shadow-soft">
        <label class="text-sm font-semibold flex items-center gap-2">
          <span class="w-6 h-6 grid place-items-center">ğŸ“</span>
          <span id="t-city">Î ÏŒÎ»Î·</span>
        </label>
        <select id="city" required
                class="mt-2 w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-500/30">
          <option value="">â€” Î•Ï€Î¹Î»Î¿Î³Î® â€”</option>
          <!-- ÎœÎµÎ³Î¬Î»Î± Î±ÏƒÏ„Î¹ÎºÎ¬ ÎºÎ­Î½Ï„ÏÎ± + extra -->
          <option>Î‘Î¸Î®Î½Î±</option><option>Î ÎµÎ¹ÏÎ±Î¹Î¬Ï‚</option><option>Î˜ÎµÏƒÏƒÎ±Î»Î¿Î½Î¯ÎºÎ·</option>
          <option>Î Î¬Ï„ÏÎ±</option><option>Î—ÏÎ¬ÎºÎ»ÎµÎ¹Î¿</option><option>Î›Î¬ÏÎ¹ÏƒÎ±</option>
          <option>Î’ÏŒÎ»Î¿Ï‚</option><option>Î™Ï‰Î¬Î½Î½Î¹Î½Î±</option><option>Î§Î±Î½Î¹Î¬</option>
          <option>ÎšÎ±Î»Î±Î¼Î¬Ï„Î±</option><option>ÎšÎ±Î²Î¬Î»Î±</option><option>ÎÎ¬Î½Î¸Î·</option>
          <option>ÎšÎ¿Î¼Î¿Ï„Î·Î½Î®</option><option>Î‘Î»ÎµÎ¾Î±Î½Î´ÏÎ¿ÏÏ€Î¿Î»Î·</option><option>Î£Î­ÏÏÎµÏ‚</option>
          <option>Î¤ÏÎ¯ÎºÎ±Î»Î±</option><option>Î›Î±Î¼Î¯Î±</option><option>Î§Î±Î»ÎºÎ¯Î´Î±</option>
          <option>ÎšÏŒÏÎ¹Î½Î¸Î¿Ï‚</option><option>Î¡ÏŒÎ´Î¿Ï‚</option><option>ÎœÏ…Ï„Î¹Î»Î®Î½Î·</option>
          <option>Î¡Î­Î¸Ï…Î¼Î½Î¿</option><option>ÎšÎ­ÏÎºÏ…ÏÎ±</option><option>Î§Î¯Î¿Ï‚</option>
          <option>Î‘Î³ÏÎ¯Î½Î¹Î¿</option><option>Î’Î­ÏÎ¿Î¹Î±</option><option>Î”ÏÎ¬Î¼Î±</option>
          <option>ÎšÎ±Ï„ÎµÏÎ¯Î½Î·</option><option>ÎšÎ¿Î¶Î¬Î½Î·</option><option>ÎÎ±ÏÏ€Î»Î¹Î¿</option>
          <option>Î ÏÏÎ³Î¿Ï‚</option><option>Î“Î»Ï…Ï†Î¬Î´Î±</option>
          <!-- Î‘Ï„Ï„Î¹ÎºÎ® â€“ Î´Î®Î¼Î¿Î¹ -->
          <option>ÎœÎ±ÏÎ¿ÏÏƒÎ¹</option><option>Î§Î±Î»Î¬Î½Î´ÏÎ¹</option><option>ÎšÎ·Ï†Î¹ÏƒÎ¹Î¬</option>
          <option>ÎÎ­Î± Î™Ï‰Î½Î¯Î±</option><option>ÎœÎµÏ„Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ·</option><option>Î ÎµÏÎ¹ÏƒÏ„Î­ÏÎ¹</option>
          <option>Î‘Î¹Î³Î¬Î»ÎµÏ‰</option><option>ÎšÎ±Î»Î»Î¹Î¸Î­Î±</option><option>ÎÎ­Î± Î£Î¼ÏÏÎ½Î·</option>
          <option>Î Î±Î»Î±Î¹ÏŒ Î¦Î¬Î»Î·ÏÎ¿</option><option>Î†Î»Î¹Î¼Î¿Ï‚</option><option>Î™Î»Î¯Î¿Ï…</option>
          <option>Î–Ï‰Î³ÏÎ¬Ï†Î¿Ï…</option><option>Î“Î±Î»Î¬Ï„ÏƒÎ¹</option><option>Î’ÏÏÏ‰Î½Î±Ï‚</option>
          <option>Î”Î¬Ï†Î½Î·</option><option>Î—Î»Î¹Î¿ÏÏ€Î¿Î»Î·</option><option>ÎÎ¯ÎºÎ±Î¹Î±</option>
          <option>ÎšÎ¿ÏÏ…Î´Î±Î»Î»ÏŒÏ‚</option><option>Î ÎµÏ„ÏÎ¿ÏÏ€Î¿Î»Î·</option><option>Î‘ÏÎ³Ï…ÏÎ¿ÏÏ€Î¿Î»Î·</option>
          <option>Î—ÏÎ¬ÎºÎ»ÎµÎ¹Î¿ Î‘Ï„Ï„Î¹ÎºÎ®Ï‚</option><option>ÎÎ­Î± Î¦Î¹Î»Î±Î´Î­Î»Ï†ÎµÎ¹Î±</option><option>ÎÎ­Î± Î§Î±Î»ÎºÎ·Î´ÏŒÎ½Î±</option>
          <!-- ÎšÏÎ®Ï„Î· extra -->
          <option>Î£Î·Ï„ÎµÎ¯Î±</option><option>Î™ÎµÏÎ¬Ï€ÎµÏ„ÏÎ±</option><option>Î†Î³Î¹Î¿Ï‚ ÎÎ¹ÎºÏŒÎ»Î±Î¿Ï‚</option>
          <!-- ÎÎ·ÏƒÎ¹Î¬ extra -->
          <option>ÎšÏ‰Ï‚</option><option>Î£Î¬Î¼Î¿Ï‚</option><option>Î£ÏÏÎ¿Ï‚</option><option>Î Î¬ÏÎ¿Ï‚</option><option>ÎÎ¬Î¾Î¿Ï‚</option>
        </select>
      </div>

      <!-- Medicine -->
      <div class="rounded-2xl glass-surface bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4 shadow-soft">
        <label class="text-sm font-semibold flex items-center gap-2">
          <span class="w-6 h-6 grid place-items-center">ğŸ”</span>
          <span id="t-medname">ÎŒÎ½Î¿Î¼Î± Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…</span>
        </label>
        <div class="mt-2 relative">
          <input id="medicine-name" type="text" autocomplete="off"
                 class="w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-500/30 placeholder:text-slate-400"
                 placeholder="Ï€.Ï‡. Augmentin 875mg" />
          <div id="ac-medicine" class="ac-list hidden rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-lg"></div>
        </div>
        <p class="mt-2 text-xs text-slate-500 dark:text-slate-400" id="t-formatTip">Î£Ï…Î¼Î²Î¿Ï…Î»Î®: Î•Î¼Ï€Î¿ÏÎ¹ÎºÎ® Î¿Î½Î¿Î¼Î±ÏƒÎ¯Î± + Î´Î¿ÏƒÎ¿Î»Î¿Î³Î¯Î± (Ï€.Ï‡. â€œ500mgâ€).</p>
        <div class="mt-4 rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-900/40 p-4">
          <div class="flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
            <div class="space-y-1">
              <div class="text-sm font-semibold flex items-center gap-2">
                <span class="w-6 h-6 grid place-items-center">ğŸ“·</span>
                <span id="t-barcodeTitle">Î£Î¬ÏÏ‰ÏƒÎ· barcode ÏƒÏ…Î½Ï„Î±Î³Î®Ï‚ Î® ÎºÎ¿Ï…Ï„Î¹Î¿Ï</span>
                <span id="t-barcodeOptional" class="text-xs font-normal text-slate-400">(Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬)</span>
              </div>
              <p id="t-barcodeHelp" class="text-xs text-slate-500 dark:text-slate-400">Î£Î¬ÏÏ‰ÏƒÎµ Ï„Î¿Î½ Î³ÏÎ±Î¼Î¼Ï‰Ï„ÏŒ ÎºÏ‰Î´Î¹ÎºÏŒ Î³Î¹Î± Î½Î± ÏƒÏ…Î¼Ï€Î»Î·ÏÏ‰Î¸ÎµÎ¯ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î±.</p>
            </div>
            <button id="barcode-start" type="button" class="inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-slate-900 text-white text-xs sm:text-sm font-semibold shadow-soft hover:bg-slate-700 dark:bg-slate-100 dark:text-slate-900 dark:hover:bg-slate-200">
              <span aria-hidden="true">ğŸ¯</span>
              <span id="t-barcodeStart">Î†Î½Î¿Î¹Î³Î¼Î± ÎºÎ¬Î¼ÎµÏÎ±Ï‚</span>
            </button>
          </div>
          <input id="barcode-value" type="text" inputmode="numeric" pattern="[0-9]*" class="mt-3 w-full px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 bg-white/95 dark:bg-slate-900 focus:outline-none focus:ring-4 focus:ring-brand-500/30 placeholder:text-slate-400" placeholder="ÎŸ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ Î¸Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„ÎµÎ¯ ÎµÎ´Ï" autocomplete="off" />
        </div>
      </div>

      <!-- Quantity + Type -->
      <div class="grid sm:grid-cols-2 gap-4">
        <div class="rounded-2xl glass-surface bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4 shadow-soft">
          <label class="text-sm font-semibold flex items-center gap-2">
            <span class="w-6 h-6 grid place-items-center">ğŸ“¦</span>
            <span id="t-qty">Î Î¿ÏƒÏŒÏ„Î·Ï„Î± (Ï„ÎµÎ¼Î¬Ï‡Î¹Î±/ÎºÎ¿Ï…Ï„Î¹Î¬)</span>
          </label>
          <input id="quantity" type="number" min="1" value="1" required
                 class="mt-2 w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-500/30" />
        </div>

        <div class="rounded-2xl glass-surface bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4 shadow-soft">
          <label class="text-sm font-semibold flex items-center gap-2">
            <span class="w-6 h-6 grid place-items-center">ğŸ“¦</span>
            <span id="t-qty">Î Î¿ÏƒÏŒÏ„Î·Ï„Î± (Ï„ÎµÎ¼Î¬Ï‡Î¹Î±/ÎºÎ¿Ï…Ï„Î¹Î¬)</span>
          </label>
          <input id="quantity" type="number" min="1" value="1" required
                 class="mt-2 w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-500/30" />
        </div>

        <div class="rounded-2xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4 shadow-soft">
          <label class="text-sm font-semibold flex items-center gap-2">
            <span class="w-6 h-6 grid place-items-center">ğŸ’Š</span>
            <span id="t-type">Î¤ÏÏ€Î¿Ï‚ Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…</span>
          </label>
          <select id="medicine-type"
                  class="mt-2 w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-500/30">
            <option value="">â€” Î•Ï€Î¹Î»Î¿Î³Î® â€”</option>
            <option>Î§Î¬Ï€Î¹</option>
            <option>ÎšÎ¬ÏˆÎ¿Ï…Î»Î±</option>
            <option>Î£ÎºÏŒÎ½Î·</option>
            <option>Î¥Î³ÏÏŒ</option>
            <option>Î£Î¹ÏÏŒÏ€Î¹</option>
            <option>Î£Ï„Î±Î³ÏŒÎ½ÎµÏ‚</option>
            <option>Î•Î¹ÏƒÏ€Î½ÎµÏŒÎ¼ÎµÎ½Î¿</option>
            <option>Î£Ï€ÏÎ­Î¹</option>
            <option>Î¡Î¹Î½Î¹ÎºÏŒ ÏƒÏ€ÏÎ­Î¹</option>
            <option>ÎŸÏ†Î¸Î±Î»Î¼Î¹ÎºÎ­Ï‚ ÏƒÏ„Î±Î³ÏŒÎ½ÎµÏ‚</option>
            <option>Î‘Î»Î¿Î¹Ï†Î®</option>
            <option>Î”ÎµÏÎ¼Î±Ï„Î¹ÎºÎ® ÎšÏÎ­Î¼Î±</option>
            <option>Î–ÎµÎ»Î­</option>
            <option>Î•Ï€Î¯Î¸ÎµÎ¼Î±</option>
            <option>Î¥Ï€ÏŒÎ¸ÎµÏ„Î¿</option>
            <option>Î Î­Î½Î± (Ï€ÏÎ¿Î³ÎµÎ¼Î¹ÏƒÎ¼Î­Î½Î·)</option>
            <option>Î”Î¹Î¬Î»Ï…Î¼Î± Î­Î³Ï‡Ï…ÏƒÎ·Ï‚</option>
          </select>
        </div>
      </div>

      <!-- Substance -->
      <div class="rounded-2xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4 shadow-soft">
        <label class="text-sm font-semibold flex items-center gap-2">
          <span class="w-6 h-6 grid place-items-center">ğŸ§ª</span>
          <span id="t-substance">Î”ÏÎ±ÏƒÏ„Î¹ÎºÎ® ÎŸÏ…ÏƒÎ¯Î±</span> <span class="text-slate-400 ml-1" id="t-optional">(Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬)</span>
        </label>
        <div class="mt-2 relative">
          <input id="active-substance" type="text" autocomplete="off"
                 class="w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-500/30 placeholder:text-slate-400"
                 placeholder="Ï€.Ï‡. Î Î±ÏÎ±ÎºÎµÏ„Î±Î¼ÏŒÎ»Î·" />
          <div id="ac-substance" class="ac-list hidden rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-lg"></div>
        </div>
        <p class="mt-2 text-xs text-slate-500 dark:text-slate-400" id="t-doseEx">Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î´Î¿ÏƒÎ¿Î»Î¿Î³Î¯Î±Ï‚: Paracetamol 500mg.</p>
      </div>

      <!-- Generic -->
      <div class="rounded-2xl glass-surface bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4 shadow-soft">
        <p class="text-sm font-semibold flex items-center gap-2">
          <span class="w-6 h-6 grid place-items-center">âœ…</span>
          <span id="t-genericQ">Î‘Î½ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Ï„Î¿ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ ÎµÎ¼Ï€Î¿ÏÎ¹ÎºÏŒ, ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹Ï‚ Î½Î± ÏƒÎ¿Ï… Ï€ÏÎ¿Ï„ÎµÎ¯Î½Î¿Ï…Î¼Îµ Î¹ÏƒÎ¿Î´ÏÎ½Î±Î¼Î¿ (Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿);</span>
        </p>
        <div class="mt-3 flex gap-4">
          <label class="inline-flex items-center gap-2"><input type="radio" name="allow-generic" value="YES" class="size-4 accent-brand-600" checked><span id="t-yes">ÎÎ‘Î™</span></label>
          <label class="inline-flex items-center gap-2"><input type="radio" name="allow-generic" value="NO" class="size-4 accent-brand-600"><span id="t-no">ÎŸÎ§Î™</span></label>
        </div>
      </div>

      <!-- GDPR + Submit -->
      <div class="rounded-2xl glass-surface bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4 shadow-soft">
        <label class="inline-flex items-start gap-3">
          <input id="gdpr-checkbox" type="checkbox" required class="mt-0.5 size-5 accent-brand-600">
          <span class="text-sm"><span id="t-accept">Î‘Ï€Î¿Î´Î­Ï‡Î¿Î¼Î±Î¹ Ï„Î¿Ï…Ï‚</span> <button type="button" id="gdpr-open" class="underline text-brand-700"><span id="t-gdprLink">ÎŒÏÎ¿Ï…Ï‚ Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚ & GDPR</span></button>.</span>
        </label>
        <div class="mt-4 flex justify-end">
          <button id="submitBtn" class="px-5 py-3 rounded-2xl bg-gradient-to-r from-brand-500 to-brand-600 text-white font-semibold shadow-soft hover:opacity-95">
            <span id="t-submit">Î¥Ï€Î¿Î²Î¿Î»Î® Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚</span>
          </button>
        </div>
      </div>
    </section>

    <!-- Results & status flow -->
    <section id="results" class="hidden mt-6">
      <div class="rounded-3xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 shadow-soft overflow-hidden">
        <div class="flex items-center gap-3 px-5 py-4 border-b border-slate-200 dark:border-slate-800">
          <button type="button" data-go-home class="flex items-center gap-2 text-sm font-semibold px-3 py-1.5 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800">
            â† <span id="t-statusHome">Î‘ÏÏ‡Î¹ÎºÎ®</span>
          </button>
          <h3 id="t-statusHeading" class="flex-1 text-center text-base sm:text-lg font-semibold">ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚</h3>
          <div class="w-10 h-10" aria-hidden="true"></div>
        </div>
        <div class="p-6 space-y-8">
          <div id="results-pending" class="flex flex-col items-center gap-4 text-center py-10">
            <div class="relative">
              <div class="h-16 w-16 rounded-full border-4 border-brand-500/30 border-t-brand-600 animate-spin"></div>
            </div>
            <div class="space-y-2">
              <h4 id="t-statusPendingTitle" class="text-xl font-bold tracking-tight">Î‘Î½Î±Î¶Î·Ï„Î¿ÏÎ¼Îµ Ï„Î¿ Ï†Î±ÏÎ¼Î±ÎºÏŒ ÏƒÎ¿Ï…â€¦</h4>
              <p id="t-statusPendingDesc" class="text-sm text-slate-500 dark:text-slate-400">Î˜Î± ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯Ï‚ Î¼ÏŒÎ»Î¹Ï‚ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹ Î­Î½Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿.</p>
            </div>
          </div>

          <div id="results-list" class="hidden space-y-4">
            <div class="space-y-1">
              <h4 id="t-statusListTitle" class="text-lg font-semibold">Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î± Î¼Îµ Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±</h4>
              <p id="t-statusListDesc" class="text-sm text-slate-500 dark:text-slate-400">Î•Ï€Î¯Î»ÎµÎ¾Îµ Ï„Î¿ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ Ï€Î¿Ï… ÏƒÎµ ÎµÎ¾Ï…Ï€Î·ÏÎµÏ„ÎµÎ¯ Î³Î¹Î± self pick-up.</p>
            </div>
            <p id="distance-hint" class="hidden text-xs text-slate-500 dark:text-slate-400"></p>
            <div id="resultsList" class="space-y-3"></div>
          </div>

          <div id="pickup-box" class="hidden flex flex-col items-center gap-5 text-center py-8 px-4 rounded-2xl bg-emerald-50/80 dark:bg-emerald-900/20 border border-emerald-300 dark:border-emerald-800">
            <div id="t-statusReservedTitle" class="text-sm font-semibold uppercase tracking-widest text-emerald-700 dark:text-emerald-200">Î¤Î¿ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ ÏƒÎµ Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÎ¹</div>
            <div class="space-y-2">
              <h4 id="status-reserved-name" class="text-2xl sm:text-3xl font-bold tracking-tight">City Pharmacy</h4>
              <p id="status-reserved-address" class="text-sm text-slate-600 dark:text-slate-300">Î™Ï€Ï€Î¿ÎºÏÎ¬Ï„Î¿Ï…Ï‚ 12, Î‘Î¸Î®Î½Î±</p>
            </div>
            <div class="flex items-baseline gap-3">
              <span id="pickup-timer" class="text-5xl font-extrabold tracking-tight">60:00</span>
              <span id="t-statusReservedHint" class="text-sm text-emerald-700 dark:text-emerald-200">Î§ÏÏŒÎ½Î¿Ï‚ ÎºÏÎ¬Ï„Î·ÏƒÎ·Ï‚</span>
            </div>
            <div id="status-reserved-generic" class="hidden px-3 py-1 rounded-full bg-emerald-100/70 dark:bg-emerald-800/40 text-xs font-semibold text-emerald-700 dark:text-emerald-200">ğŸ§¬ <span id="t-statusGenericBadge">Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿</span></div>
            <div class="flex flex-wrap justify-center gap-3">
              <button id="extend-btn" class="px-4 py-2 rounded-xl border border-emerald-500 text-emerald-700 dark:text-emerald-200 hover:bg-emerald-100/70 dark:hover:bg-emerald-800/40 text-sm font-semibold">
                <span id="t-statusExtend">+15 Î»ÎµÏ€Ï„Î¬</span>
              </button>
              <a id="status-call" class="px-4 py-2 rounded-xl bg-emerald-600 text-white text-sm font-semibold hover:bg-emerald-700 opacity-60 pointer-events-none" href="#">
                ğŸ“ <span id="t-statusCall">ÎšÎ»Î®ÏƒÎ·</span>
              </a>
              <a id="status-directions" class="px-4 py-2 rounded-xl bg-sky-600 text-white text-sm font-semibold hover:bg-sky-700 opacity-60 pointer-events-none" href="#" target="_blank" rel="noopener">
                ğŸ§­ <span id="t-statusDirections">ÎŸÎ´Î·Î³Î¯ÎµÏ‚</span>
              </a>
            </div>
            <p id="extend-note" class="text-xs text-emerald-700 dark:text-emerald-200 text-center max-w-xs sm:max-w-sm mx-auto">
              ÎœÏ€Î¿ÏÎµÎ¯Ï‚ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ Î±Ï…Ï„Î® Ï„Î·Î½ ÎµÏ€Î­ÎºÏ„Î±ÏƒÎ· Î¼ÏŒÎ½Î¿ Î¼Î¯Î± Ï†Î¿ÏÎ¬ Î±Î½Î¬ 12 ÏÏÎµÏ‚.
            </p>
            <button id="status-done" data-go-home type="button" class="px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-white dark:hover:bg-slate-800 text-sm font-semibold">
              <span id="t-statusBackHome">Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ®</span>
            </button>
          </div>

          <div id="results-empty" class="hidden flex flex-col items-center gap-4 text-center py-10 px-4">
            <div class="w-16 h-16 rounded-full bg-rose-100 text-rose-600 grid place-items-center text-2xl">âš ï¸</div>
            <h4 id="t-statusEmptyTitle" class="text-xl font-bold tracking-tight">Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±</h4>
            <p id="t-statusEmptyBody" class="text-sm text-slate-500 dark:text-slate-400 max-w-md">Î”ÎµÎ½ ÎµÎ½Ï„Î¿Ï€Î¯ÏƒÎ±Î¼Îµ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± Î±Ï…Ï„Î® Ï„Î· ÏƒÏ„Î¹Î³Î¼Î®. Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿ Î® Î¬Î»Î»Î±Î¾Îµ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Ï„Î·Ï‚ Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚.</p>
            <button id="status-empty-btn" type="button" class="px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm font-semibold">
              <span id="t-statusEmptyCta">Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î¾Î±Î½Î¬</span>
            </button>
          </div>
        </div>
        <div class="px-6 pb-6 pt-4 border-t border-slate-200 dark:border-slate-800 flex justify-end">
          <button id="newSearch" class="px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800">
            <span id="t-newSearch">ÎÎ­Î± Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·</span>
          </button>
        </div>
      </div>
    </section>
  </main>

  <!-- PRO PORTAL MODAL -->
  <div id="pro-modal" class="fixed inset-0 hidden items-center justify-center bg-slate-950/60 backdrop-blur-sm px-4 py-6 z-[70]">
    <div class="relative w-full max-w-3xl max-h-[90svh] overflow-y-auto rounded-3xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 shadow-soft p-6 sm:p-8">
      <button id="pro-close" type="button" class="absolute top-4 right-4 p-2 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800" aria-label="ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿">âœ•</button>
      <div class="space-y-6">
        <div class="flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between">
          <div class="space-y-1">
            <h2 id="t-proModalTitle" class="text-2xl font-bold">Î ÏÏŒÏƒÎ²Î±ÏƒÎ· Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Ï‰Î½</h2>
            <p id="t-proModalSubtitle" class="text-sm text-slate-600 dark:text-slate-400">Î£Ï…Î½Î´Î­ÏƒÎ¿Ï… Î® ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎµ Ï„Î¿ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ ÏƒÎ¿Ï… Î³Î¹Î± Î½Î± Î±Ï€Î±Î½Ï„Î¬Ï‚ ÏƒÎµ Î±Î¹Ï„Î®Î¼Î±Ï„Î± Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚.</p>
          </div>
        </div>

        <div class="flex items-center gap-1 rounded-2xl bg-slate-100/80 dark:bg-white/5 p-1">
          <button id="pro-tab-signin" type="button" class="flex-1 rounded-2xl px-4 py-2 text-sm font-semibold bg-white dark:bg-slate-800 shadow-soft" aria-selected="true">
            <span id="t-proSigninTab">Î£ÏÎ½Î´ÎµÏƒÎ·</span>
          </button>
          <button id="pro-tab-register" type="button" class="flex-1 rounded-2xl px-4 py-2 text-sm font-semibold text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200" aria-selected="false">
            <span id="t-proRegisterTab">Î•Î³Î³ÏÎ±Ï†Î®</span>
          </button>
        </div>

        <div id="pro-view-signin" class="space-y-5">
          <div class="grid gap-4 sm:grid-cols-2">
            <label class="text-sm font-semibold flex flex-col gap-2">
              <span id="t-proSigninEmailLabel">Email Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï…</span>
              <input id="pro-signin-email" type="email" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="pharmacy@example.gr">
            </label>
            <label class="text-sm font-semibold flex flex-col gap-2">
              <span id="t-proSigninPasswordLabel">ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚</span>
              <input id="pro-signin-password" type="password" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </label>
          </div>
          <button id="pro-signin-submit" class="w-full sm:w-auto px-5 py-3 rounded-2xl bg-brand-600 text-white font-semibold shadow-soft hover:bg-brand-700" type="button">
            <span id="t-proSigninSubmit">Î£ÏÎ½Î´ÎµÏƒÎ·</span>
          </button>
          <button id="pro-forgot" type="button" class="text-sm underline text-slate-600 dark:text-slate-300 hover:opacity-80 w-fit">
            <span id="t-proForgot">ÎÎ­Ï‡Î±ÏƒÎµÏ‚ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ;</span>
          </button>

          <div class="space-y-3">
            <div class="flex items-center gap-2 text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400">
              <div class="h-px flex-1 bg-slate-200 dark:bg-slate-700"></div>
              <span id="t-proSSO">Î‰ ÏƒÏ…Î½Î­Ï‡Î¹ÏƒÎµ Î¼Îµ</span>
              <div class="h-px flex-1 bg-slate-200 dark:bg-slate-700"></div>
            </div>
            <div class="grid gap-2 sm:grid-cols-3">
              <button class="pro-sso-btn px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center gap-2" type="button" data-provider="Google">
                <span aria-hidden="true">ğŸŸ¢</span> Google
              </button>
              <button class="pro-sso-btn px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center gap-2" type="button" data-provider="Microsoft">
                <span aria-hidden="true">ğŸªŸ</span> Microsoft
              </button>
              <button class="pro-sso-btn px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center gap-2" type="button" data-provider="Apple">
                <span aria-hidden="true">ğŸ</span> Apple
              </button>
            </div>
          </div>

        </div>

        <div id="pro-view-register" class="space-y-5 hidden">
          <div class="space-y-3">
            <div class="flex items-center gap-2 text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400">
              <div class="h-px flex-1 bg-slate-200 dark:bg-slate-700"></div>
              <span id="t-proSSO2">Î‰ ÏƒÏ…Î½Î­Ï‡Î¹ÏƒÎµ Î¼Îµ</span>
              <div class="h-px flex-1 bg-slate-200 dark:bg-slate-700"></div>
            </div>
            <div class="grid gap-2 sm:grid-cols-3">
              <button class="pro-sso-btn px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center gap-2" type="button" data-provider="Google">
                <span aria-hidden="true">ğŸŸ¢</span> Google
              </button>
              <button class="pro-sso-btn px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center gap-2" type="button" data-provider="Microsoft">
                <span aria-hidden="true">ğŸªŸ</span> Microsoft
              </button>
              <button class="pro-sso-btn px-3 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center gap-2" type="button" data-provider="Apple">
                <span aria-hidden="true">ğŸ</span> Apple
              </button>
            </div>
          </div>

          <div>
            <h3 id="t-proRegisterHeading" class="text-lg font-semibold">Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï…</h3>
            <p id="t-proRegisterDesc" class="mt-1 text-sm text-slate-600 dark:text-slate-400">Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Ï„Î¿Ï… Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï… Î³Î¹Î± Î½Î± Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚.</p>
          </div>

          <form id="pro-register-form" class="grid gap-4 sm:grid-cols-2">
            <label class="text-sm font-semibold flex flex-col gap-2 sm:col-span-2">
              <span id="t-proFieldBusinessName">Î•Ï€Ï‰Î½Ï…Î¼Î¯Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï…</span>
              <input id="pro-field-business" type="text" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ ÎšÎµÎ½Ï„ÏÎ¹ÎºÎ®Ï‚ Î Î»Î±Ï„ÎµÎ¯Î±Ï‚">
            </label>
            <label class="text-sm font-semibold flex flex-col gap-2">
              <span id="t-proFieldVat">Î‘Î¦Îœ</span>
              <input id="pro-field-vat" type="text" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="123456789">
            </label>
            <label class="text-sm font-semibold flex flex-col gap-2">
              <span id="t-proFieldRegistrationNumber">Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î¬Î´ÎµÎ¹Î±Ï‚</span>
              <input id="pro-field-license" type="text" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="12345">
            </label>
            <label class="text-sm font-semibold flex flex-col gap-2">
              <span id="t-proFieldContact">Î¥Ï€ÎµÏÎ¸Ï…Î½Î¿Ï‚ ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚</span>
              <input id="pro-field-contact" type="text" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="ÎœÎ±ÏÎ¯Î± Î Î±Ï€Î±Î´Î¿Ï€Î¿ÏÎ»Î¿Ï…">
            </label>
            <label class="text-sm font-semibold flex flex-col gap-2">
              <span id="t-proFieldEmail">Email ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚</span>
              <input id="pro-field-email" type="email" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="pharmacy@example.gr">
            </label>
            <label class="text-sm font-semibold flex flex-col gap-2">
              <span id="t-proFieldPhone">Î¤Î·Î»Î­Ï†Ï‰Î½Î¿</span>
              <input id="pro-field-phone" type="tel" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="2101234567">
            </label>
            <label class="text-sm font-semibold flex flex-col gap-2 sm:col-span-2">
              <span id="t-proFieldAddress">Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·</span>
              <input id="pro-field-address" type="text" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="Î™Ï€Ï€Î¿ÎºÏÎ¬Ï„Î¿Ï…Ï‚ 12">
            </label>
            <label class="text-sm font-semibold flex flex-col gap-2">
              <span id="t-proFieldCity">Î ÏŒÎ»Î·</span>
              <input id="pro-field-city" type="text" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 px-3 py-2 focus:outline-none focus:ring-4 focus:ring-brand-500/30" placeholder="Î‘Î¸Î®Î½Î±">
            </label>
            <div class="sm:col-span-2">
              <button id="pro-register-submit" type="submit" class="w-full sm:w-auto px-5 py-3 rounded-2xl bg-brand-600 text-white font-semibold shadow-soft hover:bg-brand-700">
                <span id="t-proRegisterSubmit">Î‘Î¯Ï„Î·ÏƒÎ· ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚</span>
              </button>
            </div>
          </form>

          <div class="text-sm text-slate-600 dark:text-slate-300">
            <span id="t-proHaveAccount">ÎˆÏ‡ÎµÎ¹Ï‚ Î®Î´Î· Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ;</span>
            <button id="t-proGoSignin" data-pro-switch="signin" type="button" class="ml-1 font-semibold underline decoration-2">Î£ÏÎ½Î´ÎµÏƒÎ·</button>
          </div>
        </div>

        <div class="flex flex-wrap items-center justify-between gap-3 pt-2">
          <button id="pro-back-home" type="button" data-go-home data-close-pro="true" class="inline-flex items-center gap-2 px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm font-semibold">
            <span aria-hidden="true">â†</span>
            <span id="t-proBackHome">Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ®</span>
          </button>
          <p class="text-xs text-slate-500 dark:text-slate-400">MediRadar Â©</p>
        </div>
      </div>
    </div>
  </div>

  <!-- HOW -->
  <div id="modal-how" class="fixed inset-0 hidden items-center justify-center bg-black/40 p-4">
    <div class="w-full max-w-2xl rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 shadow-soft">
      <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200 dark:border-slate-800">
        <h3 class="text-lg font-bold" id="t-howTitle">Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï„Î¿ MediRadar</h3>
        <button id="how-close" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl">âœ•</button>
      </div>
      <div id="how-body" class="p-5 leading-relaxed text-slate-700 dark:text-slate-300"></div>
      <div class="px-5 pb-5 flex justify-end">
        <button id="how-ok" class="px-4 py-2 rounded-xl bg-brand-600 text-white font-semibold hover:opacity-95"><span id="t-continue">Î£Ï…Î½Î­Ï‡ÎµÎ¹Î±</span></button>
      </div>
    </div>
  </div>

  <!-- GDPR MODAL -->
  <div id="gdpr-modal" class="fixed inset-0 hidden items-center justify-center bg-black/40 p-4">
    <div class="w-full max-w-3xl rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 shadow-soft">
      <div class="flex items-center justify-between px-5 py-4 border-b">
        <h3 class="text-lg font-bold" id="t-gdprTitle">Î Î¿Î»Î¹Ï„Î¹ÎºÎ® Î ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚ Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ & ÎŒÏÎ¿Î¹ Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚</h3>
        <button id="gdpr-close" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl">âœ•</button>
      </div>
      <div id="gdpr-body" class="p-5 text-sm text-slate-700 dark:text-slate-300 space-y-3" style="max-height:62vh; overflow:auto"></div>
      <div class="px-5 pb-5 flex justify-end">
        <button id="gdpr-ok" class="px-4 py-2 rounded-xl bg-brand-600 text-white font-semibold hover:opacity-95"><span id="t-gdprAccept">OK</span></button>
      </div>
    </div>
  </div>

  <!-- Pharmacy details modal -->
  <div id="pharm-modal" class="fixed inset-0 hidden items-center justify-center bg-black/40 p-4">
    <div class="w-full max-w-lg rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 shadow-soft">
      <div class="flex items-center justify-between px-5 py-4 border-b">
        <h3 class="text-lg font-bold" id="pm-title">Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿</h3>
        <button id="pm-close" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl">âœ•</button>
      </div>
      <div class="p-5 space-y-4 text-sm">
        <div id="pm-address">Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·:</div>
        <div id="pm-hours-section" class="hidden">
          <div class="text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">Î©ÏÎ¬ÏÎ¹Î¿</div>
          <div id="pm-hours" class="mt-1 grid gap-1 text-xs text-slate-600 dark:text-slate-300"></div>
        </div>
      </div>
      <div id="pm-auth-message" class="px-5 pb-3 text-xs text-slate-500 dark:text-slate-400">Î— Î´Î­ÏƒÎ¼ÎµÏ…ÏƒÎ· Î±Ï€Î±Î¹Ï„ÎµÎ¯ Ï„Î±Ï…Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ·.</div>
      <div class="px-5 pb-5 flex gap-2 justify-between flex-wrap items-center">
        <div class="flex gap-2 flex-wrap">
          <a id="pm-maps" target="_blank" rel="noopener" class="px-4 py-2 rounded-xl bg-sky-600 text-white font-semibold hover:bg-sky-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-sky-500" aria-label="Î ÏÎ¿Î²Î¿Î»Î® ÏƒÎµ Ï‡Î¬ÏÏ„Î·">Î†Î½Î¿Î¹Î³Î¼Î± ÏƒÎµ Î§Î¬ÏÏ„ÎµÏ‚</a>
        </div>
        <button id="pm-confirm" class="px-4 py-2 rounded-2xl bg-brand-600 text-white font-semibold hover:bg-brand-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500">Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ· & ÎˆÎ½Î±ÏÎ¾Î· 60â€™</button>
      </div>
    </div>
  </div>

  <!-- BARCODE MODAL -->
  <div id="barcode-modal" class="fixed inset-0 hidden items-center justify-center bg-black/50 backdrop-blur-sm px-4 py-6 z-[70]">
    <div class="w-full max-w-md rounded-3xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 shadow-soft overflow-hidden">
      <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200 dark:border-slate-800">
        <h3 id="t-barcodeModalTitle" class="text-lg font-bold">Î£Î¬ÏÏ‰ÏƒÎ· barcode</h3>
        <button id="barcode-close" type="button" class="p-2 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800" aria-label="ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿">âœ•</button>
      </div>
      <div class="p-5 space-y-4">
        <div id="barcode-status" class="text-sm text-slate-600 dark:text-slate-300">Î£Ï„ÏŒÏ‡ÎµÏ…ÏƒÎµ Ï„Î¿Î½ Î³ÏÎ±Î¼Î¼Ï‰Ï„ÏŒ ÎºÏ‰Î´Î¹ÎºÏŒ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Ï€Î»Î±Î¯ÏƒÎ¹Î¿.</div>
        <div class="rounded-2xl overflow-hidden border border-slate-200 dark:border-slate-800 bg-black">
          <video id="barcode-video" class="w-full aspect-video" autoplay muted playsinline></video>
        </div>
        <div class="flex justify-end">
          <button id="barcode-stop" type="button" class="hidden px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-700 text-sm font-semibold hover:bg-slate-100 dark:hover:bg-slate-800">
            <span id="t-barcodeStop">Î”Î¹Î±ÎºÎ¿Ï€Î®</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- BARCODE MODAL -->
  <div id="barcode-modal" class="fixed inset-0 hidden items-center justify-center bg-black/50 backdrop-blur-sm px-4 py-6 z-[70]">
    <div class="w-full max-w-md rounded-3xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 shadow-soft overflow-hidden">
      <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200 dark:border-slate-800">
        <h3 id="t-barcodeModalTitle" class="text-lg font-bold">Î£Î¬ÏÏ‰ÏƒÎ· barcode</h3>
        <button id="barcode-close" type="button" class="p-2 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800" aria-label="ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿">âœ•</button>
      </div>
      <div class="p-5 space-y-4">
        <div id="barcode-status" class="text-sm text-slate-600 dark:text-slate-300">Î£Ï„ÏŒÏ‡ÎµÏ…ÏƒÎµ Ï„Î¿Î½ Î³ÏÎ±Î¼Î¼Ï‰Ï„ÏŒ ÎºÏ‰Î´Î¹ÎºÏŒ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Ï€Î»Î±Î¯ÏƒÎ¹Î¿.</div>
        <div class="rounded-2xl overflow-hidden border border-slate-200 dark:border-slate-800 bg-black">
          <video id="barcode-video" class="w-full aspect-video" autoplay muted playsinline></video>
        </div>
        <div class="flex justify-end">
          <button id="barcode-stop" type="button" class="hidden px-4 py-2 rounded-xl border border-slate-300 dark:border-slate-700 text-sm font-semibold hover:bg-slate-100 dark:hover:bg-slate-800">
            <span id="t-barcodeStop">Î”Î¹Î±ÎºÎ¿Ï€Î®</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== ENV (INLINE â€” Ï‡Ï‰ÏÎ¯Ï‚ /env.js) ===== -->
  <script>
    window.ENV = window.ENV || {
      SUPABASE_URL: 'https://qzerrisyowkfkmcyxmav.supabase.co',
      SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF6ZXJyaXN5b3drZmttY3l4bWF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwMTcxODQsImV4cCI6MjA3NTU5MzE4NH0.alkvHkOQPBTwY3daUcKAEsf4nt0kizuU3rYI2c2InPk',
      VAPID_PUBLIC_KEY: 'BGS8pCF76A6Es7XAu3hcTAEE8vcRDl1JlWQ7Hym7m5WK63gIHqbuuSJl_xfC4l7729H5ClVqysTjnShnJwviHgo'
    };
  </script>

  <!-- Supabase client -->
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
    const { SUPABASE_URL, SUPABASE_ANON_KEY } = window.ENV || {};
    if(!SUPABASE_URL || !SUPABASE_ANON_KEY){
      console.error('Missing Supabase ENV');
    }
    window.supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    console.log('Supabase ready:', !!window.supabase);
  </script>

  <!-- App JS -->
  <script>
    /* ========== Theme ========== */
    const html = document.documentElement;
    const bodyEl = document.body;
    const themeBtn = document.getElementById('theme-toggle');
    const iconSun = document.getElementById('icon-sun');
    const iconMoon = document.getElementById('icon-moon');
    const pushToast = document.getElementById('push-toast');
    function setTheme(mode){
      const dark = mode==='dark';
      html.classList.toggle('dark', dark);
      iconSun.classList.toggle('hidden', !dark);
      iconMoon.classList.toggle('hidden', dark);
      localStorage.setItem('mediradar-theme', dark?'dark':'light');
    }

    /* ========== i18n ========== */
    const strings = {
      el:{
        hero:'Î†Î¼ÎµÏƒÎ· ÎµÏÏÎµÏƒÎ· Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚ Ï†Î±ÏÎ¼Î¬ÎºÏ‰Î½ ÏƒÎµ ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±.',
        searchBTN:'Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…', howBTN:'Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯', signinBTN:'Î£ÏÎ½Î´ÎµÏƒÎ·', installBTN:'Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·',
        searchTitle:'Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…', home:'Î‘ÏÏ‡Î¹ÎºÎ®', medname:'ÎŒÎ½Î¿Î¼Î± Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…', formatTip:'Î£Ï…Î¼Î²Î¿Ï…Î»Î®: Î•Î¼Ï€Î¿ÏÎ¹ÎºÎ® Î¿Î½Î¿Î¼Î±ÏƒÎ¯Î± + Î´Î¿ÏƒÎ¿Î»Î¿Î³Î¯Î± (Ï€.Ï‡. â€œ500mgâ€).',
        substance:'Î”ÏÎ±ÏƒÏ„Î¹ÎºÎ® ÎŸÏ…ÏƒÎ¯Î±', optional:'(Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬)', doseEx:'Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î´Î¿ÏƒÎ¿Î»Î¿Î³Î¯Î±Ï‚: Paracetamol 500mg.', type:'Î¤ÏÏ€Î¿Ï‚ Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…',
        qty:'Î Î¿ÏƒÏŒÏ„Î·Ï„Î± (Ï„ÎµÎ¼Î¬Ï‡Î¹Î±/ÎºÎ¿Ï…Ï„Î¹Î¬)', select:'Î•Ï€Î¹Î»Î¿Î³Î®', genericQ:'Î‘Î½ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Ï„Î¿ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ ÎµÎ¼Ï€Î¿ÏÎ¹ÎºÏŒ, ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹Ï‚ Î½Î± ÏƒÎ¿Ï… Ï€ÏÎ¿Ï„ÎµÎ¯Î½Î¿Ï…Î¼Îµ Î¹ÏƒÎ¿Î´ÏÎ½Î±Î¼Î¿ (Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿);',
        yes:'ÎÎ‘Î™', no:'ÎŸÎ§Î™', city:'Î ÏŒÎ»Î·', accept:'Î‘Ï€Î¿Î´Î­Ï‡Î¿Î¼Î±Î¹ Ï„Î¿Ï…Ï‚', submit:'Î¥Ï€Î¿Î²Î¿Î»Î® Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚', results:'Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±', newSearch:'ÎÎ­Î± Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·',
        pro:'Î“Î¹Î± ÎµÏ€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¯ÎµÏ‚', howTitle:'Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï„Î¿ MediRadar', continue:'Î£Ï…Î½Î­Ï‡ÎµÎ¹Î±', pending:'Î ÎµÏÎ¹Î¼Î­Î½Î¿Ï…Î¼Îµ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ Ï„Î± ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±â€¦', pharmLogin:'Î•Î¯ÏƒÎ¿Î´Î¿Ï‚ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Ï‰Î½',
        langGreek:'Î•Î»Î»Î·Î½Î¹ÎºÎ¬', langEnglish:'Î‘Î³Î³Î»Î¹ÎºÎ¬',
        gdprLink:'ÎŒÏÎ¿Ï…Ï‚ Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚ & GDPR',
        gdprTitle:'Î Î¿Î»Î¹Ï„Î¹ÎºÎ® Î ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚ Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ & ÎŒÏÎ¿Î¹ Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚',
        gdprBody:`<p>Î— MediRadar ÎµÏ€ÎµÎ¾ÎµÏÎ³Î¬Î¶ÎµÏ„Î±Î¹ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Ï€Î¿Ï… ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎµÎ¯Ï‚ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ Î³Î¹Î± Ï„Î·Î½ ÎµÎ¾Ï…Ï€Î·ÏÎ­Ï„Î·ÏƒÎ· Ï„Î¿Ï… Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚ Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚.</p>
          <ul class="list-disc pl-5 space-y-2">
            <li>Î£Ï…Î»Î»Î­Î³Î¿Ï…Î¼Îµ Ï„Î¿ Ï†Î¬ÏÎ¼Î±ÎºÎ¿, Ï„Î·Î½ Ï€ÏŒÎ»Î·, Ï„Î·Î½ ÎµÏ€Î¹Î¸Ï…Î¼Î·Ï„Î® Ï€Î¿ÏƒÏŒÏ„Î·Ï„Î± ÎºÎ±Î¹ Ï„Ï…Ï‡ÏŒÎ½ Ï€ÏÏŒÏƒÎ¸ÎµÏ„ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Ï€Î¿Ï… Î´Î¯Î½ÎµÎ¹Ï‚ (Î´ÏÎ±ÏƒÏ„Î¹ÎºÎ® Î¿Ï…ÏƒÎ¯Î±, barcode).</li>
            <li>Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ¼Îµ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î³Î¹Î± Î½Î± ÎµÎ½Î·Î¼ÎµÏÏÏƒÎ¿Ï…Î¼Îµ Ï„Î± ÏƒÏ…Î½ÎµÏÎ³Î±Î¶ÏŒÎ¼ÎµÎ½Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± ÎºÎ±Î¹ Î½Î± ÏƒÎµ ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î¼Îµ Î³Î¹Î± Ï„Î¹Ï‚ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ Ï„Î¿Ï…Ï‚.</li>
            <li>Î”Î¹Î±Ï„Î·ÏÎ¿ÏÎ¼Îµ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Î¼ÏŒÎ½Î¿ ÏŒÏƒÎ¿ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î³Î¹Î± Î½Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏ‰Î¸ÎµÎ¯ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î± Î® Î­Ï‰Ï‚ 30 Î·Î¼Î­ÏÎµÏ‚, ÎµÎºÏ„ÏŒÏ‚ Î±Î½ Î¶Î·Ï„Î®ÏƒÎµÎ¹Ï‚ Î½Ï‰ÏÎ¯Ï„ÎµÏÎ± Ï„Î· Î´Î¹Î±Î³ÏÎ±Ï†Î® Ï„Î¿Ï…Ï‚.</li>
          </ul>
          <p>Î”ÎµÎ½ Î´Î¹Î±Î²Î¹Î²Î¬Î¶Î¿Ï…Î¼Îµ Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏƒÎµ Ï„ÏÎ¯Ï„Î¿Ï…Ï‚ ÎºÎ±Î¹ ÎµÏ†Î±ÏÎ¼ÏŒÎ¶Î¿Ï…Î¼Îµ Ï„ÎµÏ‡Î½Î¹ÎºÎ¬ Î¼Î­Ï„ÏÎ± Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±Ï‚ ÏƒÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ Ï„Î¿Î½ GDPR.</p>
          <p>ÎˆÏ‡ÎµÎ¹Ï‚ Î´Î¹ÎºÎ±Î¯Ï‰Î¼Î± Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚, Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·Ï‚ Î® Î´Î¹Î±Î³ÏÎ±Ï†Î®Ï‚ ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½ÏÎ½Ï„Î±Ï‚ ÏƒÏ„Î¿ <a class="text-brand-700 underline" href="mailto:privacy@mediradar.gr">privacy@mediradar.gr</a>.</p>`,
        barcodeTitle:'Î£Î¬ÏÏ‰ÏƒÎ· barcode ÏƒÏ…Î½Ï„Î±Î³Î®Ï‚ Î® ÎºÎ¿Ï…Ï„Î¹Î¿Ï', barcodeHelp:'Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎµ Ï„Î·Î½ ÎºÎ¬Î¼ÎµÏÎ± Î³Î¹Î± Î½Î± ÏƒÎ±ÏÏÏƒÎµÎ¹Ï‚ Ï„Î¿Î½ Î³ÏÎ±Î¼Î¼Ï‰Ï„ÏŒ ÎºÏ‰Î´Î¹ÎºÏŒ Ï„Î·Ï‚ ÏƒÏ…Î½Ï„Î±Î³Î®Ï‚ Î® Ï„Î¿Ï… ÎºÎ¿Ï…Ï„Î¹Î¿Ï.',
        barcodeStart:'Î†Î½Î¿Î¹Î³Î¼Î± ÎºÎ¬Î¼ÎµÏÎ±Ï‚', barcodePlaceholder:'ÎŸ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ Î¸Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„ÎµÎ¯ ÎµÎ´Ï', barcodeModalTitle:'Î£Î¬ÏÏ‰ÏƒÎ· barcode',
        barcodeStatusInit:'Î£Ï„ÏŒÏ‡ÎµÏ…ÏƒÎµ Ï„Î¿Î½ Î³ÏÎ±Î¼Î¼Ï‰Ï„ÏŒ ÎºÏ‰Î´Î¹ÎºÏŒ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Ï€Î»Î±Î¯ÏƒÎ¹Î¿.', barcodeStatusScanning:'Î£Î¬ÏÏ‰ÏƒÎ· ÏƒÎµ ÎµÎ¾Î­Î»Î¹Î¾Î·â€¦',
        barcodeStatusSuccess:'Î•Î½Ï„Î¿Ï€Î¯ÏƒÏ„Î·ÎºÎµ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚: %s', barcodeStatusNoApi:'ÎŸ Ï€ÎµÏÎ¹Î·Î³Î·Ï„Î®Ï‚ Î´ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î±Î½Î¬Î³Î½Ï‰ÏƒÎ· barcode. Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï‡ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î±.',
        barcodeStatusNoCamera:'Î”ÎµÎ½ ÎµÎ½Ï„Î¿Ï€Î¯ÏƒÏ„Î·ÎºÎµ ÎºÎ¬Î¼ÎµÏÎ± ÏƒÏ„Î· ÏƒÏ…ÏƒÎºÎµÏ…Î®.', barcodeStatusDenied:'Î— Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î·Î½ ÎºÎ¬Î¼ÎµÏÎ± Î±Ï€Î¿ÏÏÎ¯Ï†Î¸Î·ÎºÎµ. ÎˆÎ»ÎµÎ³Î¾Îµ Ï„Î¹Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚.',
        barcodeStatusStopped:'Î— ÏƒÎ¬ÏÏ‰ÏƒÎ· Î´Î¹Î±ÎºÏŒÏ€Î·ÎºÎµ. ÎœÏ€Î¿ÏÎµÎ¯Ï‚ Î½Î± ÎºÎ»ÎµÎ¯ÏƒÎµÎ¹Ï‚ Ï„Î¿ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ¿.', barcodeStop:'Î”Î¹Î±ÎºÎ¿Ï€Î®',
        proModalTitle:'Î ÏÏŒÏƒÎ²Î±ÏƒÎ· Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Ï‰Î½', proModalSubtitle:'Î£Ï…Î½Î´Î­ÏƒÎ¿Ï… Î® ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎµ Ï„Î¿ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ ÏƒÎ¿Ï… Î³Î¹Î± Î½Î± Î±Ï€Î±Î½Ï„Î¬Ï‚ ÏƒÎµ Î±Î¹Ï„Î®Î¼Î±Ï„Î± Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚.',
        proSigninTab:'Î£ÏÎ½Î´ÎµÏƒÎ·', proRegisterTab:'Î•Î³Î³ÏÎ±Ï†Î®',
        proSigninEmailLabel:'Email Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï…', proSigninPasswordLabel:'ÎšÏ‰Î´Î¹ÎºÏŒÏ‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚', proSigninSubmit:'Î£ÏÎ½Î´ÎµÏƒÎ·',
        proForgot:'ÎÎ­Ï‡Î±ÏƒÎµÏ‚ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ;', proSSO:'Î‰ ÏƒÏ…Î½Î­Ï‡Î¹ÏƒÎµ Î¼Îµ',
        proHaveAccount:'ÎˆÏ‡ÎµÎ¹Ï‚ Î®Î´Î· Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ;', proGoSignin:'Î£ÏÎ½Î´ÎµÏƒÎ·',
        proRegisterHeading:'Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï…', proRegisterDesc:'Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Ï„Î¿Ï… Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï… Î³Î¹Î± Î½Î± Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚.',
        proFieldBusinessName:'Î•Ï€Ï‰Î½Ï…Î¼Î¯Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï…', proFieldVat:'Î‘Î¦Îœ', proFieldContact:'Î¥Ï€ÎµÏÎ¸Ï…Î½Î¿Ï‚ ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚',
        proFieldEmail:'Email ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚', proFieldPhone:'Î¤Î·Î»Î­Ï†Ï‰Î½Î¿', proFieldAddress:'Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·', proFieldCity:'Î ÏŒÎ»Î·',
        proFieldRegistrationNumber:'Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î¬Î´ÎµÎ¹Î±Ï‚', proRegisterSubmit:'Î‘Î¯Ï„Î·ÏƒÎ· ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚', proBackHome:'Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ®',
        statusHeading:'ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚', statusPendingTitle:'Î‘Î½Î±Î¶Î·Ï„Î¿ÏÎ¼Îµ Ï„Î¿ Ï†Î±ÏÎ¼Î±ÎºÏŒ ÏƒÎ¿Ï…â€¦',
        statusPendingDesc:'Î˜Î± ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯Ï‚ Î¼ÏŒÎ»Î¹Ï‚ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹ ÎºÎ¬Ï€Î¿Î¹Î¿ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿.',
        statusListTitle:'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î± Î¼Îµ Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±', statusListDesc:'Î•Ï€Î¯Î»ÎµÎ¾Îµ Ï„Î¿ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ Ï€Î¿Ï… ÏƒÎµ ÎµÎ¾Ï…Ï€Î·ÏÎµÏ„ÎµÎ¯ Î³Î¹Î± self pick-up.',
        statusAccept:'Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ·', statusReservedTitle:'Î¤Î¿ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ ÏƒÎµ Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÎ¹', statusReservedHint:'Î§ÏÏŒÎ½Î¿Ï‚ ÎºÏÎ¬Ï„Î·ÏƒÎ·Ï‚',
        statusExtend:'+15 Î»ÎµÏ€Ï„Î¬', statusCall:'ÎšÎ»Î®ÏƒÎ·', statusDirections:'ÎŸÎ´Î·Î³Î¯ÎµÏ‚',
        statusGenericBadge:'Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿', statusGenericShort:'Î“ÎµÎ½ÏŒÏƒÎ·Î¼Î¿',
        extendNote:'ÎœÏ€Î¿ÏÎµÎ¯Ï‚ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ Î±Ï…Ï„Î® Ï„Î·Î½ ÎµÏ€Î­ÎºÏ„Î±ÏƒÎ· Î¼ÏŒÎ½Î¿ Î¼Î¯Î± Ï†Î¿ÏÎ¬ Î±Î½Î¬ 12 ÏÏÎµÏ‚.',
        extendNoteUsed:'ÎˆÏ‡ÎµÎ¹Ï‚ Î®Î´Î· Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î·Î½ ÎµÏ€Î­ÎºÏ„Î±ÏƒÎ· Î¼Î­ÏƒÎ± ÏƒÏ„Î¹Ï‚ Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯ÎµÏ‚ 12 ÏÏÎµÏ‚.',
        statusBackHome:'Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® ÏƒÏ„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ®', statusEmptyTitle:'Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±',
        statusEmptyBody:'Î”ÎµÎ½ ÎµÎ½Ï„Î¿Ï€Î¯ÏƒÎ±Î¼Îµ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± Î±Ï…Ï„Î® Ï„Î· ÏƒÏ„Î¹Î³Î¼Î®. Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î¾Î±Î½Î¬ ÏƒÎµ Î»Î¯Î³Î¿ Î® Î¬Î»Î»Î±Î¾Îµ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Ï„Î·Ï‚ Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚.',
        statusEmptyCta:'Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î¾Î±Î½Î¬',
        distanceAway:'%s Ï‡Î»Î¼. Î±Ï€ÏŒ ÎµÏƒÎ­Î½Î±',
        distanceHintLoading:'Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶Î¿Ï…Î¼Îµ Î±Ï€Î¿ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ Î²Î¬ÏƒÎµÎ¹ Ï„Î·Ï‚ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±Ï‚ ÏƒÎ¿Ï…â€¦',
        distanceHintDenied:'Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎµ Ï„Î·Î½ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î± Ï„Î¿Ï… Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚ Ï€ÎµÏÎ¹Î®Î³Î·ÏƒÎ·Ï‚ Î³Î¹Î± Î½Î± Î´ÎµÎ¹Ï‚ Î±Ï€Î¿ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚.',
        distanceHintUnsupported:'Î— ÏƒÏ…ÏƒÎºÎµÏ…Î® Î´ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±Ï‚.',
        distanceHintUnavailable:'Î”ÎµÎ½ Î®Ï„Î±Î½ Î´Ï…Î½Î±Ï„ÏŒÏ‚ Î¿ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î±Ï€Î¿ÏƒÏ„Î¬ÏƒÎµÏ‰Î½ Î±Ï…Ï„Î® Ï„Î· ÏƒÏ„Î¹Î³Î¼Î®.',
        shareTitle:'ÎœÎ¿Î¹ÏÎ¬ÏƒÎ¿Ï… Ï„Î¿ MediRadar',
        shareFacebook:'ÎšÎ¿Î¹Î½Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÏƒÏ„Î¿ Facebook',
        shareTwitter:'ÎšÎ¿Î¹Î½Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÏƒÏ„Î¿ X',
        shareInstagram:'ÎšÎ¿Î¹Î½Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÏƒÏ„Î¿ Instagram',
        faqTitle:'Î£Ï…Ï‡Î½Î­Ï‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ (ÏƒÏÎ½Ï„Î¿Î¼Î± Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚)',
        faqSoon:'Î•Ï„Î¿Î¹Î¼Î¬Î¶Î¿Ï…Î¼Îµ ÎµÎ½ÏŒÏ„Î·Ï„Î± FAQ Î¼Îµ Ï„Î¹Ï‚ Ï€Î¹Î¿ ÏƒÏ…Ï‡Î½Î­Ï‚ Î±Ï€Î¿ÏÎ¯ÎµÏ‚ ÏƒÎ±Ï‚. Î‘Î½ Î­Ï‡ÎµÎ¹Ï‚ ÎµÏÏÏ„Î·ÏƒÎ·, ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ­ Î¼Î±Ï‚.',
        faqContact:'Î•Ï€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±: info@mediradar.gr'
      },
      en:{
        hero:'Instant availability check at nearby pharmacies.',
        searchBTN:'Medicine Search', howBTN:'How it works', signinBTN:'Sign in', installBTN:'Install',
        searchTitle:'Medicine Search', home:'Home', medname:'Medicine Name', formatTip:'Tip: Brand name + dosage (e.g. â€œ500mgâ€).',
        substance:'Active Substance', optional:'(optional)', doseEx:'Dosage example: Paracetamol 500mg.', type:'Medicine Type',
        qty:'Quantity (units/boxes)', select:'Select', genericQ:'If the specific brand is unavailable, may we suggest an equivalent (generic)?',
        yes:'YES', no:'NO', city:'City', accept:'I accept the', submit:'Submit Search', results:'Results', newSearch:'New search',
        pro:'For professionals', howTitle:'How MediRadar works', continue:'Continue', pending:'Waiting for responses from nearby pharmaciesâ€¦', pharmLogin:'Pharmacy login',
        langGreek:'Greek', langEnglish:'English',
        gdprLink:'Search Terms & GDPR',
        gdprTitle:'Data Protection & Search Terms',
        gdprBody:`<p>MediRadar processes the details you provide solely to fulfil your medicine availability request.</p>
          <ul class="list-disc pl-5 space-y-2">
            <li>We collect the medicine, city, desired quantity and any optional details you share (active substance, barcode).</li>
            <li>Your data is used to notify participating pharmacies and relay their responses back to you.</li>
            <li>Information is retained only for the time needed to complete the request or up to 30 days, unless you ask for earlier deletion.</li>
          </ul>
          <p>We do not pass data to third parties and apply security safeguards in line with GDPR requirements.</p>
          <p>You may request access, correction or deletion by emailing <a class="text-brand-700 underline" href="mailto:privacy@mediradar.gr">privacy@mediradar.gr</a>.</p>`,
        barcodeTitle:'Scan prescription or box barcode', barcodeHelp:'Use your camera to capture the prescription or medicine box barcode.',
        barcodeStart:'Open camera', barcodePlaceholder:'The code will appear here', barcodeModalTitle:'Barcode scan',
        barcodeStatusInit:'Align the barcode inside the frame.', barcodeStatusScanning:'Scanningâ€¦',
        barcodeStatusSuccess:'Detected code: %s', barcodeStatusNoApi:'Your browser does not support automatic barcode reading. Enter the code manually.',
        barcodeStatusNoCamera:'No camera was found on this device.', barcodeStatusDenied:'Camera access was denied. Check your permission settings.',
        barcodeStatusStopped:'Scanning stopped. You can close this window.', barcodeStop:'Stop',
        proModalTitle:'Pharmacy access', proModalSubtitle:'Sign in or register your pharmacy to respond to availability requests.',
        proSigninTab:'Sign in', proRegisterTab:'Register',
        proSigninEmailLabel:'Pharmacy email', proSigninPasswordLabel:'Password', proSigninSubmit:'Sign in',
        proForgot:'Forgot password?', proSSO:'Or continue with',
        proHaveAccount:'Already have an account?', proGoSignin:'Sign in',
        proRegisterHeading:'Pharmacy details', proRegisterDesc:'Share your business information to get started.',
        proFieldBusinessName:'Pharmacy name', proFieldVat:'VAT number', proFieldContact:'Primary contact',
        proFieldEmail:'Contact email', proFieldPhone:'Phone', proFieldAddress:'Address', proFieldCity:'City',
        proFieldRegistrationNumber:'License number', proRegisterSubmit:'Submit registration', proBackHome:'Back to home',
        statusHeading:'Request status', statusPendingTitle:'Searching for your medicineâ€¦',
        statusPendingDesc:'We will notify you as soon as a pharmacy responds.',
        statusListTitle:'Pharmacies with availability', statusListDesc:'Choose the pharmacy that suits you for self pick-up.',
        statusAccept:'Accept', statusReservedTitle:'Your pick-up is ready', statusReservedHint:'Reservation timer',
        statusExtend:'+15 minutes', statusCall:'Call', statusDirections:'Directions',
        statusGenericBadge:'Generic option available', statusGenericShort:'Generic',
        extendNote:'You can use this extension only once every 12 hours.',
        extendNoteUsed:'You have already used the extension within the last 12 hours.',
        statusBackHome:'Back to home', statusEmptyTitle:'No pharmacies found',
        statusEmptyBody:'We couldnâ€™t find any pharmacies with availability right now. Please try again shortly or adjust your request.',
        statusEmptyCta:'Try again',
        distanceAway:'%s km from you',
        distanceHintLoading:'Calculating distances based on your locationâ€¦',
        distanceHintDenied:'Enable location access in your browser to see distances.',
        distanceHintUnsupported:'Your device does not support location services.',
        distanceHintUnavailable:'We could not calculate distances right now.',
        shareTitle:'Share MediRadar',
        shareFacebook:'Share on Facebook',
        shareTwitter:'Share on X',
        shareInstagram:'Share on Instagram',
        faqTitle:'FAQ (coming soon)',
        faqSoon:'We are preparing an FAQ section with the most common questions. Let us know what you need.',
        faqContact:'Contact: info@mediradar.gr'
      }
    };
    const state = {
      lang: localStorage.getItem('mediradar-lang') || 'el',
      locationStatus: 'idle',
      locationAttempted: false,
      userCoords: null
    };
    let selectedPharmacy = null;
    function t(k){ return strings[state.lang][k]; }
    function setText(id, txt){ const el=document.getElementById(id); if(el) el.textContent=txt; }
    function setHTML(id, html){ const el=document.getElementById(id); if(el) el.innerHTML=html; }
    function applyLang(){
      document.documentElement.lang = state.lang;
      setText('t-hero', t('hero'));
      setText('t-searchBTN', t('searchBTN')); setText('t-howBTN', t('howBTN')); setText('t-signinBTN', t('signinBTN')); setText('t-installBTN', t('installBTN'));
      setText('t-searchTitle', t('searchTitle')); setText('t-home', t('home'));
      setText('t-medname', t('medname')); setText('t-formatTip', t('formatTip'));
      setText('t-city', t('city'));
      setText('t-qty', t('qty'));
      setText('t-type', t('type'));
      setText('t-substance', t('substance'));
      setText('t-doseEx', t('doseEx'));
      setText('t-genericQ', t('genericQ'));
      setText('t-yes', t('yes'));
      setText('t-no', t('no'));
      setText('t-accept', t('accept'));
      setText('t-gdprLink', t('gdprLink'));
      setText('t-submit', t('submit'));
      setText('t-results', t('results')); setText('t-newSearch', t('newSearch')); setText('t-pending', t('pending'));
      setText('t-pro', t('pro')); setText('t-pro-m', t('pro'));
      setText('t-howTitle', t('howTitle')); setText('t-continue', t('continue'));
      setText('t-langElLabel', t('langGreek')); setText('t-langEnLabel', t('langEnglish'));
      setText('t-barcodeTitle', t('barcodeTitle'));
      setText('t-barcodeOptional', t('optional'));
      setText('t-barcodeHelp', t('barcodeHelp'));
      setText('t-barcodeStart', t('barcodeStart'));
      setText('t-barcodeModalTitle', t('barcodeModalTitle'));
      setText('t-barcodeStop', t('barcodeStop'));
      setText('t-gdprTitle', t('gdprTitle'));
      setHTML('gdpr-body', t('gdprBody'));
      setText('t-proModalTitle', t('proModalTitle')); setText('t-proModalSubtitle', t('proModalSubtitle'));
      setText('t-proSigninTab', t('proSigninTab')); setText('t-proRegisterTab', t('proRegisterTab'));
      setText('t-proSigninEmailLabel', t('proSigninEmailLabel')); setText('t-proSigninPasswordLabel', t('proSigninPasswordLabel'));
      setText('t-proSigninSubmit', t('proSigninSubmit')); setText('t-proForgot', t('proForgot'));
      setText('t-proSSO', t('proSSO')); setText('t-proSSO2', t('proSSO'));
      setText('t-proRegisterHeading', t('proRegisterHeading')); setText('t-proRegisterDesc', t('proRegisterDesc'));
      setText('t-proFieldBusinessName', t('proFieldBusinessName')); setText('t-proFieldVat', t('proFieldVat'));
      setText('t-proFieldRegistrationNumber', t('proFieldRegistrationNumber'));
      setText('t-proFieldContact', t('proFieldContact')); setText('t-proFieldEmail', t('proFieldEmail'));
      setText('t-proFieldPhone', t('proFieldPhone')); setText('t-proFieldAddress', t('proFieldAddress'));
      setText('t-proFieldCity', t('proFieldCity'));
      setText('t-proRegisterSubmit', t('proRegisterSubmit'));
      setText('t-proHaveAccount', t('proHaveAccount')); setText('t-proGoSignin', t('proGoSignin'));
      setText('t-proBackHome', t('proBackHome'));
      setText('t-optional', t('optional'));
      setText('t-shareTitle', t('shareTitle'));
      setText('t-shareFacebook', t('shareFacebook'));
      setText('t-shareTwitter', t('shareTwitter'));
      setText('t-shareInstagram', t('shareInstagram'));
      setText('t-faqTitle', t('faqTitle'));
      setText('t-faqSoon', t('faqSoon'));
      setText('t-faqContact', t('faqContact'));
      if(typeof refreshExtendNote === 'function') refreshExtendNote();
      setText('t-statusHeading', t('statusHeading'));
      setText('t-statusPendingTitle', t('statusPendingTitle'));
      setText('t-statusPendingDesc', t('statusPendingDesc'));
      setText('t-statusListTitle', t('statusListTitle'));
      setText('t-statusListDesc', t('statusListDesc'));
      setText('t-statusReservedTitle', t('statusReservedTitle'));
      setText('t-statusReservedHint', t('statusReservedHint'));
      setText('t-statusGenericBadge', t('statusGenericBadge'));
      setText('t-statusExtend', t('statusExtend'));
      setText('t-statusCall', t('statusCall'));
      setText('t-statusDirections', t('statusDirections'));
      setText('t-statusBackHome', t('statusBackHome'));
      setText('t-statusEmptyTitle', t('statusEmptyTitle'));
      setText('t-statusEmptyBody', t('statusEmptyBody'));
      setText('t-statusEmptyCta', t('statusEmptyCta'));
      setText('t-statusHome', t('home'));
      document.getElementById('medicine-name').placeholder = state.lang==='el'?'Ï€.Ï‡. Augmentin 875mg':'e.g. Augmentin 875mg';
      document.getElementById('active-substance').placeholder = state.lang==='el'?'Ï€.Ï‡. Paracetamol':'e.g. Paracetamol';
      document.getElementById('barcode-value').placeholder = t('barcodePlaceholder');
      document.getElementById('pro-signin-email').placeholder = state.lang==='el'?'Ï€.Ï‡. pharmacy@domain.gr':'e.g. pharmacy@domain.com';
      document.getElementById('pro-signin-password').placeholder = state.lang==='el'?'ÎŸ ÎºÏ‰Î´Î¹ÎºÏŒÏ‚ ÏƒÎ¿Ï…':'Your password';
      document.getElementById('pro-field-business').placeholder = state.lang==='el'?'Ï€.Ï‡. Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ ÎšÎµÎ½Ï„ÏÎ¹ÎºÎ®Ï‚ Î Î»Î±Ï„ÎµÎ¯Î±Ï‚':'e.g. Central Square Pharmacy';
      document.getElementById('pro-field-vat').placeholder = state.lang==='el'?'Ï€.Ï‡. 123456789':'e.g. 123456789';
      document.getElementById('pro-field-license').placeholder = state.lang==='el'?'Ï€.Ï‡. 12345':'e.g. 12345';
      document.getElementById('pro-field-contact').placeholder = state.lang==='el'?'Ï€.Ï‡. ÎœÎ±ÏÎ¯Î± Î Î±Ï€Î±Î´Î¿Ï€Î¿ÏÎ»Î¿Ï…':'e.g. Maria Papadopoulou';
      document.getElementById('pro-field-email').placeholder = state.lang==='el'?'Ï€.Ï‡. pharmacy@domain.gr':'e.g. pharmacy@domain.com';
      document.getElementById('pro-field-phone').placeholder = state.lang==='el'?'Ï€.Ï‡. 2101234567':'e.g. +30 2101234567';
      document.getElementById('pro-field-address').placeholder = state.lang==='el'?'Ï€.Ï‡. Î™Ï€Ï€Î¿ÎºÏÎ¬Ï„Î¿Ï…Ï‚ 12':'e.g. 12 Ippokratous St';
      document.getElementById('pro-field-city').placeholder = state.lang==='el'?'Ï€.Ï‡. Î‘Î¸Î®Î½Î±':'e.g. Athens';
      themeBtn.setAttribute('aria-label', state.lang==='el'?'Î‘Î»Î»Î±Î³Î® Î¸Î­Î¼Î±Ï„Î¿Ï‚':'Toggle theme');
      document.getElementById('pro-trigger').setAttribute('aria-label', state.lang==='el'?'Î ÏÏŒÏƒÎ²Î±ÏƒÎ· Î³Î¹Î± ÎµÏ€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¯ÎµÏ‚':'Professionals area');
      document.getElementById('pro-trigger-mobile').setAttribute('aria-label', state.lang==='el'?'Î ÏÏŒÏƒÎ²Î±ÏƒÎ· Î³Î¹Î± ÎµÏ€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¯ÎµÏ‚':'Professionals area');
      document.getElementById('pro-close').setAttribute('aria-label', state.lang==='el'?'ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ Ï€Î±ÏÎ±Î¸ÏÏÎ¿Ï…':'Close window');
      document.getElementById('barcode-start').setAttribute('aria-label', state.lang==='el'?'Î£Î¬ÏÏ‰ÏƒÎ· barcode':'Scan barcode');
      document.getElementById('barcode-close').setAttribute('aria-label', state.lang==='el'?'ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ Ï€Î±ÏÎ±Î¸ÏÏÎ¿Ï…':'Close window');
      document.getElementById('share-facebook')?.setAttribute('aria-label', t('shareFacebook'));
      document.getElementById('share-twitter')?.setAttribute('aria-label', t('shareTwitter'));
      document.getElementById('share-instagram')?.setAttribute('aria-label', t('shareInstagram'));
      statusCallLink?.setAttribute('aria-label', t('statusCall'));
      statusDirectionsLink?.setAttribute('aria-label', t('statusDirections'));
      document.querySelectorAll('.status-accept-label').forEach(el=> el.textContent = t('statusAccept'));
      document.querySelectorAll('.status-generic-label').forEach(el=> el.textContent = t('statusGenericShort'));
      if(document.getElementById('barcode-modal').classList.contains('hidden')){
        document.getElementById('barcode-status').textContent = t('barcodeStatusInit');
      }
      const langElBtn = document.getElementById('lang-el');
      const langEnBtn = document.getElementById('lang-en');
      langElBtn.dataset.active = state.lang==='el';
      langEnBtn.dataset.active = state.lang==='en';
      langElBtn.setAttribute('aria-pressed', state.lang==='el');
      langEnBtn.setAttribute('aria-pressed', state.lang==='en');
      updateDistanceHint();
      localStorage.setItem('mediradar-lang', state.lang);
    }
    document.getElementById('lang-el').addEventListener('click', ()=>{ state.lang='el'; applyLang(); });
    document.getElementById('lang-en').addEventListener('click', ()=>{ state.lang='en'; applyLang(); });

    // city dropdown
    const citySelect = document.getElementById('city');
    const frag = document.createDocumentFragment();
    citySuggestions.forEach(name=>{
      const opt = document.createElement('option');
      opt.value = name;
      opt.textContent = name;
      frag.appendChild(opt);
    });
    citySelect.appendChild(frag);
    state.cities = citySuggestions;

    // CTA
    const ctaSearch = document.getElementById('cta-search');
    const splash = document.getElementById('splash');
    const app = document.getElementById('app');
    function goHome(){
      stopPickupTimer();
      if(demoTimeout){ clearTimeout(demoTimeout); demoTimeout=null; }
      app.classList.add('hidden');
      splash.classList.remove('hidden');
      hidePending();
      const resultsSection = document.getElementById('results');
      resultsSection?.classList.add('hidden');
      document.getElementById('pickup-box')?.classList.add('hidden');
      document.getElementById('results-pending')?.classList.remove('hidden');
      document.getElementById('results-list')?.classList.add('hidden');
      document.getElementById('results-empty')?.classList.add('hidden');
      distanceHintEl?.classList.add('hidden');
      selectedPharmacy = null;
      window.scrollTo({ top: 0, behavior:'smooth' });
    }
    document.getElementById('cta-search').addEventListener('click', ()=>{ splash.classList.add('hidden'); app.classList.remove('hidden'); window.scrollTo({ top: 0, behavior:'smooth' }); });
    document.body.addEventListener('click', (event) => {
      const btn = event.target.closest('[data-go-home]');
      if(!btn) return;
      event.preventDefault();
      if (btn.dataset.closePro === 'true') {
        closeProModal();
      }
      goHome();
    });

    /* ========== Modals (How/GDPR/Login) ========== */
    const modalHow = document.getElementById('modal-how');
    document.getElementById('cta-how').onclick = ()=> {
      modalHow.classList.remove('hidden'); modalHow.classList.add('flex');
      const body = state.lang==='el'
        ? `<div class="space-y-4">
            <div class="space-y-2">
              <p class="text-base font-semibold">ğŸš€ MediRadar â€“ Î¤Î¿ Ï†Î¬ÏÎ¼Î±ÎºÏŒ ÏƒÎ¿Ï…, Ï‡Ï‰ÏÎ¯Ï‚ ÎºÎ±Î¸Ï…ÏƒÏ„ÎµÏÎ®ÏƒÎµÎ¹Ï‚!</p>
              <p>Î¨Î¬Ï‡Î½ÎµÎ¹Ï‚ Ï†Î¬ÏÎ¼Î±ÎºÎ¿ ÎºÎ±Î¹ Î´ÎµÎ½ Î¸ÎµÏ‚ Î½Î± Ï‡Î¬Î½ÎµÎ¹Ï‚ Ï‡ÏÏŒÎ½Î¿;</p>
              <p>ÎœÎµ Ï„Î¿ MediRadar, Î²ÏÎ¯ÏƒÎºÎµÎ¹Ï‚ Î¬Î¼ÎµÏƒÎ± Ï€Î¿Î¹Î¿ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ Î­Ï‡ÎµÎ¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Ï„Î¿ Ï†Î±ÏÎ¼Î±ÎºÏŒ ÏƒÎ¿Ï… â€“ Ï‡Ï‰ÏÎ¯Ï‚ Î¬ÏƒÎºÎ¿Ï€ÎµÏ‚ ÎºÎ»Î®ÏƒÎµÎ¹Ï‚, Ï‡Ï‰ÏÎ¯Ï‚ Ï€ÎµÏÎ¹Ï„Ï„Î­Ï‚ Î¼ÎµÏ„Î±ÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚!</p>
            </div>
            <div class="space-y-2">
              <p class="font-semibold">ğŸ§  Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯;</p>
              <p>ÎœÏ€Î±Î¯Î½ÎµÎ¹Ï‚ ÏƒÏ„Î·Î½ Ï€Î»Î±Ï„Ï†ÏŒÏÎ¼Î±, ÏƒÏ…Î¼Ï€Î»Î·ÏÏÎ½ÎµÎ¹Ï‚ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Ï„Î¿Ï… Ï†Î±ÏÎ¼Î¬ÎºÎ¿Ï… ÎºÎ±Î¹â€¦ Ï„Î­Î»Î¿Ï‚! Î¤Î± ÏƒÏ…Î½ÎµÏÎ³Î±Î¶ÏŒÎ¼ÎµÎ½Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î½ Ï„Î·Î½ Î±Î¯Ï„Î·ÏƒÎ® ÏƒÎ¿Ï… ÎºÎ±Î¹ ÏƒÎ¿Ï… Î±Ï€Î±Î½Ï„Î¿ÏÎ½ Î¸ÎµÏ„Î¹ÎºÎ¬. Î¤Î¿ Ï†Î¬ÏÎ¼Î±ÎºÎ¿ ÏƒÎµ Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÎ¹ Î³Î¹Î± Ï€Î±ÏÎ±Î»Î±Î²Î® ÏƒÎµ Î¼ÏŒÎ»Î¹Ï‚ 60 Î»ÎµÏ€Ï„Î¬!</p>
            </div>
            <div class="space-y-2">
              <p class="font-semibold">ğŸ’¡ Î“Î¹Î±Ï„Î¯ Î½Î± Ï„Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚;</p>
              <ul class="list-disc pl-5 space-y-2">
                <li>âœ… Î“ÏÎ®Î³Î¿ÏÎ· ÎºÎ±Î¹ ÎµÏÎºÎ¿Î»Î· Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Ï†Î±ÏÎ¼Î¬ÎºÎ¿Ï…</li>
                <li>âœ… Î§Ï‰ÏÎ¯Ï‚ Ï„Î·Î»ÎµÏ†Ï‰Î½Î®Î¼Î±Ï„Î± Î® Î±Î½Î±Î¼Î¿Î½Î­Ï‚</li>
                <li>âœ… Î§Ï‰ÏÎ¯Ï‚ Î¬Î³Ï‡Î¿Ï‚ Î³Î¹Î± Ï€Î»Î·ÏÏ‰Î¼Î­Ï‚ Î® Î±Ï€Î¿ÏƒÏ„Î¿Î»Î­Ï‚</li>
                <li>âœ… Î‘Î½ Î­Ï‡ÎµÎ¹Ï‚ ÏƒÏ…Î½Ï„Î±Î³Î®, ÏŒÎ»Î± Î³Î¯Î½Î¿Î½Ï„Î±Î¹ ÏƒÏ„Î¿ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿</li>
                <li>âœ… Î”ÎµÎ½ ÏƒÏ…Î»Î»Î­Î³Î¿Ï…Î¼Îµ Ï„Î¹Î¼Î­Ï‚ Î® Î¹Î±Ï„ÏÎ¹ÎºÎ¬ Î´ÎµÎ´Î¿Î¼Î­Î½Î±</li>
              </ul>
            </div>
            <p>ğŸ¯ Î•ÏƒÏ Î±ÏƒÏ‡Î¿Î»ÎµÎ¯ÏƒÎ±Î¹ Î¼ÏŒÎ½Î¿ Î¼Îµ Ï„Î·Î½ Ï…Î³ÎµÎ¯Î± ÏƒÎ¿Ï… â€“ ÎµÎ¼ÎµÎ¯Ï‚ Î¼Îµ ÏŒÎ»Î± Ï„Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î±!</p>
          </div>`
        : `<div class="space-y-4">
            <div class="space-y-2">
              <p class="text-base font-semibold">ğŸš€ MediRadar â€“ Your medicine, without delays!</p>
              <p>Looking for medication and donâ€™t want to waste time?</p>
              <p>With MediRadar you instantly see which pharmacy has your medicine availableâ€”no unnecessary calls or trips.</p>
            </div>
            <div class="space-y-2">
              <p class="font-semibold">ğŸ§  How it works?</p>
              <p>Visit the platform, fill in the medicine details andâ€¦ done! Partner pharmacies receive your request and reply with availability. Your medicine is ready for pick-up within just 60 minutes.</p>
            </div>
            <div class="space-y-2">
              <p class="font-semibold">ğŸ’¡ Why use it?</p>
              <ul class="list-disc pl-5 space-y-2">
                <li>âœ… Fast and easy medicine search</li>
                <li>âœ… No phone calls or waiting lines</li>
                <li>âœ… No stress about payments or shipping</li>
                <li>âœ… If you have a prescription, everything happens at the pharmacy</li>
                <li>âœ… We do not collect pricing or medical data</li>
              </ul>
            </div>
            <p>ğŸ¯ You focus on your health â€” we handle the rest!</p>
          </div>`;
      document.getElementById('how-body').innerHTML = body;
    };
    document.getElementById('how-close').onclick = ()=> modalHow.classList.add('hidden');
    document.getElementById('how-ok').onclick    = ()=> modalHow.classList.add('hidden');

    const modalGdpr = document.getElementById('gdpr-modal');
    document.getElementById('gdpr-open').onclick = ()=> { modalGdpr.classList.remove('hidden'); modalGdpr.classList.add('flex'); };
    document.getElementById('gdpr-close').onclick= ()=> modalGdpr.classList.add('hidden');
    document.getElementById('gdpr-ok').onclick   = ()=> modalGdpr.classList.add('hidden');

    const loginModal = document.getElementById('login-modal');
    document.getElementById('cta-signin').onclick = ()=>{ loginModal.classList.remove('hidden'); loginModal.classList.add('flex'); };
    document.getElementById('login-close').onclick = ()=> loginModal.classList.add('hidden');
    document.getElementById('login-email-btn').onclick = ()=> loginModal.classList.add('hidden');
    document.getElementById('login-google').onclick = ()=> loginModal.classList.add('hidden');
    document.getElementById('login-apple').onclick  = ()=> loginModal.classList.add('hidden');
    document.getElementById('login-guest').onclick  = ()=> loginModal.classList.add('hidden');
    document.getElementById('login-forgot').onclick = ()=> alert('Î˜Î± Ï€ÏÎ¿ÏƒÏ„ÎµÎ¸ÎµÎ¯ ÏÎ¿Î® Ï…Ï€ÎµÎ½Î¸ÏÎ¼Î¹ÏƒÎ·Ï‚ ÎºÏ‰Î´Î¹ÎºÎ¿Ï.');

    /* ========== Barcode scanning ========== */
    const barcodeModal = document.getElementById('barcode-modal');
    const barcodeStartBtn = document.getElementById('barcode-start');
    const barcodeCloseBtn = document.getElementById('barcode-close');
    const barcodeStopBtn = document.getElementById('barcode-stop');
    const barcodeStatus = document.getElementById('barcode-status');
    const barcodeVideo = document.getElementById('barcode-video');
    const barcodeInput = document.getElementById('barcode-value');
    let barcodeStream = null;
    let barcodeDetector = null;
    let barcodeActive = false;
    const barcodeFormats = ['ean_13','ean_8','code_128','code_39','qr_code','upc_a','upc_e','itf','data_matrix','pdf417'];

    function setBarcodeStatus(key, value){
      if(!barcodeStatus) return;
      const txt = t(key);
      barcodeStatus.textContent = (value !== undefined && txt.includes('%s')) ? txt.replace('%s', value) : txt;
    }

    async function ensureBarcodeDetector(){
      if(barcodeDetector) return barcodeDetector;
      if(!('BarcodeDetector' in window)) return null;
      try{
        barcodeDetector = new BarcodeDetector({ formats: barcodeFormats });
      }catch(err){
        console.warn('BarcodeDetector init error', err);
        try{ barcodeDetector = new BarcodeDetector(); }
        catch(err2){ console.warn('BarcodeDetector fallback failed', err2); barcodeDetector = null; }
      }
      return barcodeDetector;
    }

    function openBarcodeModal(){
      setBarcodeStatus('barcodeStatusInit');
      barcodeModal.classList.remove('hidden');
      barcodeModal.classList.add('flex');
      bodyEl.classList.add('overflow-hidden');
    }

    function stopBarcodeScan(keepStatus=false){
      barcodeActive = false;
      if(barcodeStream){
        barcodeStream.getTracks().forEach(track=>track.stop());
        barcodeStream = null;
      }
      if(barcodeVideo){
        barcodeVideo.pause?.();
        barcodeVideo.srcObject = null;
      }
      barcodeStopBtn.classList.add('hidden');
      if(!keepStatus){
        setBarcodeStatus('barcodeStatusInit');
      }
    }

    function closeBarcodeModal(){
      stopBarcodeScan();
      barcodeModal.classList.add('hidden');
      barcodeModal.classList.remove('flex');
      bodyEl.classList.remove('overflow-hidden');
    }

    async function startBarcodeScan(){
      if(!navigator.mediaDevices?.getUserMedia){
        setBarcodeStatus('barcodeStatusNoCamera');
        barcodeStopBtn.classList.add('hidden');
        return;
      }
      try{
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: { ideal: 'environment' } }});
        barcodeStream = stream;
        barcodeVideo.srcObject = stream;
        await barcodeVideo.play();
        barcodeStopBtn.classList.remove('hidden');
        const detector = await ensureBarcodeDetector();
        if(!detector){
          setBarcodeStatus('barcodeStatusNoApi');
          return;
        }
        barcodeActive = true;
        setBarcodeStatus('barcodeStatusScanning');
        requestAnimationFrame(scanLoop);
      }catch(err){
        console.warn('Barcode camera error', err);
        if(err && (err.name === 'NotAllowedError' || err.name === 'SecurityError')){
          setBarcodeStatus('barcodeStatusDenied');
        }else{
          setBarcodeStatus('barcodeStatusNoCamera');
        }
        stopBarcodeScan(true);
      }
    }

    async function scanLoop(){
      if(!barcodeActive || !barcodeDetector) return;
      try{
        const barcodes = await barcodeDetector.detect(barcodeVideo);
        if(barcodes && barcodes.length){
          const code = String(barcodes[0].rawValue || '').trim();
          if(code){
            barcodeInput.value = code;
            barcodeInput.focus();
            barcodeInput.classList.add('barcode-highlight');
            setTimeout(()=> barcodeInput.classList.remove('barcode-highlight'), 1400);
            setBarcodeStatus('barcodeStatusSuccess', code);
            stopBarcodeScan(true);
            setTimeout(()=> closeBarcodeModal(), 900);
            return;
          }
        }
      }catch(err){
        console.warn('Barcode detect error', err);
      }
      if(barcodeActive) requestAnimationFrame(scanLoop);
    }

    barcodeStartBtn?.addEventListener('click', ()=>{ openBarcodeModal(); startBarcodeScan(); });
    barcodeCloseBtn?.addEventListener('click', closeBarcodeModal);
    barcodeModal?.addEventListener('click', (event)=>{ if(event.target === barcodeModal){ closeBarcodeModal(); }});
    barcodeStopBtn?.addEventListener('click', ()=>{ stopBarcodeScan(true); setBarcodeStatus('barcodeStatusStopped'); });
    document.addEventListener('keydown', (event)=>{ if(event.key === 'Escape' && !barcodeModal.classList.contains('hidden')) closeBarcodeModal(); });

    /* ========== Pro modal (pharmacies) ========== */
    const proModal = document.getElementById('pro-modal');
    const proClose = document.getElementById('pro-close');
    const proTabSignin = document.getElementById('pro-tab-signin');
    const proTabRegister = document.getElementById('pro-tab-register');
    const proSigninView = document.getElementById('pro-view-signin');
    const proRegisterView = document.getElementById('pro-view-register');
    const proOpeners = document.querySelectorAll('[data-open-pro]');
    const proSwitchers = document.querySelectorAll('[data-pro-switch]');
    const proSigninBtn = document.getElementById('pro-signin-submit');
    const proForgotBtn = document.getElementById('pro-forgot');
    const proRegisterForm = document.getElementById('pro-register-form');

    function setProMode(mode='signin'){
      const isSignin = mode==='signin';
      proSigninView.classList.toggle('hidden', !isSignin);
      proRegisterView.classList.toggle('hidden', isSignin);
      proTabSignin.classList.toggle('bg-white', isSignin);
      proTabSignin.classList.toggle('dark:bg-slate-800', isSignin);
      proTabSignin.classList.toggle('text-slate-900', isSignin);
      proTabSignin.classList.toggle('dark:text-slate-100', isSignin);
      proTabSignin.classList.toggle('text-slate-600', !isSignin);
      proTabSignin.classList.toggle('dark:text-slate-400', !isSignin);
      proTabSignin.classList.toggle('shadow-soft', isSignin);
      proTabSignin.setAttribute('aria-selected', isSignin);
      proTabRegister.classList.toggle('bg-white', !isSignin);
      proTabRegister.classList.toggle('dark:bg-slate-800', !isSignin);
      proTabRegister.classList.toggle('text-slate-900', !isSignin);
      proTabRegister.classList.toggle('dark:text-slate-100', !isSignin);
      proTabRegister.classList.toggle('text-slate-600', isSignin);
      proTabRegister.classList.toggle('dark:text-slate-400', isSignin);
      proTabRegister.classList.toggle('shadow-soft', !isSignin);
      proTabRegister.setAttribute('aria-selected', !isSignin);
    }

    function openProModal(mode='signin'){
      setProMode(mode);
      proModal.classList.remove('hidden');
      proModal.classList.add('flex');
      bodyEl.classList.add('overflow-hidden');
    }

    function closeProModal(){
      proModal.classList.add('hidden');
      proModal.classList.remove('flex');
      bodyEl.classList.remove('overflow-hidden');
      setProMode('signin');
    }

    proOpeners.forEach(btn=>{
      btn.addEventListener('click', (e)=>{
        e.preventDefault();
        openProModal(btn.dataset.mode || 'signin');
      });
    });
    proTabSignin.addEventListener('click', ()=> setProMode('signin'));
    proTabRegister.addEventListener('click', ()=> setProMode('register'));
    proSwitchers.forEach(btn=> btn.addEventListener('click', ()=> setProMode(btn.dataset.proSwitch || 'signin')));
    proClose.addEventListener('click', closeProModal);
    proModal.addEventListener('click', (event)=>{ if(event.target === proModal){ closeProModal(); }});
    document.addEventListener('keydown', (event)=>{ if(event.key === 'Escape' && !proModal.classList.contains('hidden')) closeProModal(); });

    document.querySelectorAll('.pro-sso-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const provider = btn.dataset.provider;
        alert(state.lang==='el'
          ? `Î— ÏƒÏÎ½Î´ÎµÏƒÎ· Î¼Îµ ${provider} Î¸Î± ÎµÎ¯Î½Î±Î¹ ÏƒÏÎ½Ï„Î¿Î¼Î± Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î·.`
          : `${provider} sign-in is coming soon.`);
      });
    });

    proSigninBtn.addEventListener('click', ()=>{
      alert(state.lang==='el'
        ? 'Î— ÏƒÏÎ½Î´ÎµÏƒÎ· Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï… Î¸Î± ÎµÎ¯Î½Î±Î¹ ÏƒÏÎ½Ï„Î¿Î¼Î± Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î·.'
        : 'Pharmacy sign-in will be available soon.');
    });

    proForgotBtn.addEventListener('click', ()=>{
      alert(state.lang==='el'
        ? 'Î˜Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎ¿Ï…Î¼Îµ ÏÎ¿Î® Î±Î½Î¬ÎºÏ„Î·ÏƒÎ·Ï‚ ÎºÏ‰Î´Î¹ÎºÎ¿Ï ÏƒÏÎ½Ï„Î¿Î¼Î±.'
        : 'Password recovery will be added soon.');
    });

    proRegisterForm.addEventListener('submit', (e)=>{
      e.preventDefault();
      alert(state.lang==='el'
        ? 'Î•Ï…Ï‡Î±ÏÎ¹ÏƒÏ„Î¿ÏÎ¼Îµ! Î— Î¿Î¼Î¬Î´Î± MediRadar Î¸Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÎµÎ¹ Î¼Î±Î¶Î¯ ÏƒÎ¿Ï… Î³Î¹Î± Ï„Î·Î½ Î¿Î»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ· Ï„Î·Ï‚ ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚.'
        : 'Thanks! The MediRadar team will reach out to finish your registration.');
      closeProModal();
    });

    /* ========== Autocomplete (demo) ========== */
    const AC_MEDICINES = [
      'Algofren 400mg',
      'Apotel 500mg',
      'Augmentin 875mg/125mg',
      'Bepanthene 5% Cream',
      'Betadine 10%',
      'Canesten 1% Cream',
      'Clavulin 875/125mg',
      'Daktarin Gel',
      'Depon 500mg',
      'Efferalgan 500mg',
      'Fucidin 2%',
      'Gaviscon Double Action',
      'Humira 40mg Pen',
      'Imodium 2mg',
      'Losec 20mg',
      'Nurofen Express 400mg',
      'Otrivin 0.1% Spray',
      'Panadol 500mg',
      'Plavix 75mg',
      'Prospan Syrup',
      'Salospir 100mg',
      'Synagis 100mg',
      'Voltaren 50mg',
      'Xanax 0.5mg',
      'Zylapour 300mg',
      'Zyrtec 10mg'
    ];
    const AC_SUBSTANCES = [
      'Acetylcysteine 600mg',
      'Acetylsalicylic Acid 100mg',
      'Acyclovir 400mg',
      'Allopurinol 300mg',
      'Amlodipine 5mg',
      'Amoxicillin 500mg',
      'Amoxicillin + Clavulanic Acid 875/125mg',
      'Atorvastatin 20mg',
      'Azithromycin 500mg',
      'Cetirizine 10mg',
      'Doxycycline 100mg',
      'Ibuprofen 400mg',
      'Levocetirizine 5mg',
      'Metformin 1000mg',
      'Metoprolol 50mg',
      'Omeprazole 20mg',
      'Paracetamol 500mg',
      'Rivaroxaban 20mg',
      'Rosuvastatin 10mg',
      'Salbutamol 2mg/5ml',
      'Valsartan 160mg'
    ];
    function attachAutocomplete(inputId, listId, data){
      const input = document.getElementById(inputId);
      const list = document.getElementById(listId);
      let idx = -1;
      function render(items){
        list.innerHTML = items.map((x,i)=>`<div class="ac-item px-3 py-2 text-sm hover:bg-brand-50 dark:hover:bg-slate-800 ${i===idx?'bg-brand-50 dark:bg-slate-800':''}" data-val="${x}">${x}</div>`).join('');
        list.classList.toggle('hidden', items.length===0);
      }
    });

    // barcode modal
    initBarcode();

    // Supabase
    if (window.SUPABASE_URL && window.SUPABASE_ANON_KEY && window.supabase) {
      state.supabase = window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);
    }

    // Submit
    document.getElementById('submitBtn').addEventListener('click', onSubmitRequest);

    // Results actions
    document.getElementById('newSearch').addEventListener('click', resetToSearch);
    document.getElementById('status-empty-btn').addEventListener('click', ()=> {
      document.getElementById('results-empty').classList.add('hidden');
      document.getElementById('results-pending').classList.remove('hidden');
      if (state.currentRequestId) startPolling(state.currentRequestId);
    });
    document.getElementById('pm-confirm').addEventListener('click', confirmReservationFromModal);

    // Install prompt
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      state.deferredPrompt = e;
      const btn = document.getElementById('cta-install');
      btn.classList.remove('hidden');
      btn.addEventListener('click', async () => {
        state.deferredPrompt.prompt();
        const { outcome } = await state.deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          btn.classList.add('hidden');
          state.deferredPrompt = null;
        }
      });
    });

    // Extend button
    document.getElementById('extend-btn').addEventListener('click', extendReservation);

    // Close results modal
    document.getElementById('results-modal-close').addEventListener('click', closeResultsModal);
    document.querySelectorAll('[data-results-close]').forEach(e=>e.addEventListener('click', closeResultsModal));

    // pharmacy modal close
    document.getElementById('pm-close').addEventListener('click', ()=>{
      document.getElementById('pharm-modal').classList.add('hidden');
      document.getElementById('pharm-modal').classList.remove('flex');
    });

    // Fake auth buttons
    document.querySelectorAll('[data-auth-open]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const target = btn.getAttribute('data-auth-target');
        openAuthModal(target);
      });
    });
    document.querySelectorAll('[data-auth-close]').forEach(btn=>{
      btn.addEventListener('click', closeAuthModals);
    });
  });

  function applyLang() {
    const all = document.querySelectorAll('[id^="t-"], #pending-overlay-headline, #pending-overlay-message, #pending-overlay-status-text');
    all.forEach(el=>{
      const id = el.id;
      const val = strings[state.lang][id];
      if (val) el.textContent = val;
    });
    // how / gdpr bodies
    const howBody = document.getElementById('how-body');
    if (howBody && !howBody.classList.contains('hidden')) howBody.textContent = strings[state.lang]['how-body'];
    const gdprBody = document.getElementById('gdpr-body');
    if (gdprBody && !gdprBody.classList.contains('hidden')) gdprBody.textContent = strings[state.lang]['gdpr-body'];

    // lang buttons active
    document.getElementById('lang-el').setAttribute('data-active', state.lang==='el');
    document.getElementById('lang-en').setAttribute('data-active', state.lang==='en');

    // city placeholder
    const citySelect = document.getElementById('city');
    if (citySelect) {
      citySelect.options[0].textContent = state.lang==='el' ? 'â€” Î•Ï€Î¹Î»Î¿Î³Î® Ï€ÏŒÎ»Î·Ï‚ â€”' : 'â€” Select city â€”';
    }
    attachAutocomplete('medicine-name','ac-medicine',AC_MEDICINES);
    attachAutocomplete('active-substance','ac-substance',AC_SUBSTANCES);

    /* ========== Pending + Confetti ========== */
    const pendingToast=document.getElementById('pending-toast'), waitSpan=document.getElementById('wait-elapsed');
    let waitT=null, waitStart=0;
    function showPending(){
      waitStart=Date.now();
      pendingToast.classList.remove('hidden');
      if(waitT) clearInterval(waitT);
      waitT=setInterval(()=>{waitSpan.textContent=Math.floor((Date.now()-waitStart)/1000)+'s'},500);
      setResultsState('pending');
      window.scrollTo({top:0,behavior:'smooth'});
    }
    function hidePending(){ pendingToast.classList.add('hidden'); if(waitT){clearInterval(waitT); waitT=null;} }
    function fireConfetti(ms=3500){
      const c=document.getElementById('confetti'),ctx=c.getContext('2d');
      const W=c.width=innerWidth,H=c.height=innerHeight; c.style.display='block';
      const N=180,P=Array.from({length:N},()=>({x:Math.random()*W,y:-20-Math.random()*H*.3,r:2+Math.random()*4,vx:-1+Math.random()*2,vy:2+Math.random()*3,a:Math.random()*Math.PI,va:-.2+Math.random()*.4}));
      let run=true; const end=performance.now()+ms;
      (function loop(t){ if(t>end) run=false;
        ctx.clearRect(0,0,W,H);
        P.forEach(p=>{ if(run) p.vy+=.02; p.x+=p.vx; p.y+=p.vy; p.a+=p.va;
          if(p.y>H+20){p.y=-20;p.x=Math.random()*W;p.vy=2+Math.random()*3}
          ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.a);
          ctx.fillStyle=`hsl(${(p.x/W)*360},90%,55%)`; ctx.fillRect(-p.r,-p.r,p.r*2,p.r*2); ctx.restore();
        });
        if(run) requestAnimationFrame(loop); else { c.style.display='none'; ctx.clearRect(0,0,W,H); }
      })(performance.now());
    }

    // show pending
    showPendingOverlay();

    // insert to supabase
    let reqId = crypto.randomUUID();
    const payload = {
      id: reqId,
      city,
      medicine_name: name,
      quantity: qty,
      medicine_type: type || null,
      active_substance: substance || null,
      barcode: barcode || null,
      allow_generic: allowGeneric,
      status: 'pending',
      created_at: new Date().toISOString()
    };

    /* ========== Results + Pharmacy modal + Pickup timer ========== */
    const results = document.getElementById('results');
    const resultsList = document.getElementById('resultsList');
    const resultsPending = document.getElementById('results-pending');
    const resultsListWrap = document.getElementById('results-list');
    const resultsEmpty = document.getElementById('results-empty');
    const distanceHintEl = document.getElementById('distance-hint');
    const pickupBox = document.getElementById('pickup-box');
    const pickupTimerEl = document.getElementById('pickup-timer');
    const extendBtn = document.getElementById('extend-btn');
    const extendNoteEl = document.getElementById('extend-note');
    const EXTEND_STORAGE_KEY = 'pickup-extend-at';
    const LEGACY_EXTEND_KEY = 'pickup-extend-date';
    const EXTEND_COOLDOWN_MS = 12 * 60 * 60 * 1000;
    const statusReservedName = document.getElementById('status-reserved-name');
    const statusReservedAddress = document.getElementById('status-reserved-address');
    const statusReservedGeneric = document.getElementById('status-reserved-generic');
    const statusCallLink = document.getElementById('status-call');
    const statusDirectionsLink = document.getElementById('status-directions');
    const statusEmptyBtn = document.getElementById('status-empty-btn');

    function readExtendTimestamp(){
      const raw = localStorage.getItem(EXTEND_STORAGE_KEY);
      if(raw){
        const numeric = Number(raw);
        if(!Number.isNaN(numeric)) return numeric;
        const parsed = Date.parse(raw);
        if(!Number.isNaN(parsed)) return parsed;
        localStorage.removeItem(EXTEND_STORAGE_KEY);
      }
      const legacy = localStorage.getItem(LEGACY_EXTEND_KEY);
      if(legacy){
        localStorage.removeItem(LEGACY_EXTEND_KEY);
        const parsedLegacy = Date.parse(legacy);
        if(!Number.isNaN(parsedLegacy)){
          localStorage.setItem(EXTEND_STORAGE_KEY, String(parsedLegacy));
          return parsedLegacy;
        }
      }
      return null;
    }
    function writeExtendTimestamp(ts){
      localStorage.setItem(EXTEND_STORAGE_KEY, String(ts));
      localStorage.removeItem(LEGACY_EXTEND_KEY);
    }
    function canUseExtend(){
      const last = readExtendTimestamp();
      return !last || (Date.now() - last) >= EXTEND_COOLDOWN_MS;
    }
    function refreshExtendNote(){
      const key = extendBtn && extendBtn.disabled ? 'extendNoteUsed' : 'extendNote';
      if(extendBtn){
        extendBtn.setAttribute('title', t(key));
        extendBtn.setAttribute('aria-disabled', extendBtn.disabled ? 'true' : 'false');
      }
      if(extendNoteEl){
        extendNoteEl.textContent = t(key);
      }
    }
    function updateExtendAvailability(){
      if(!extendBtn) return true;
      const allowed = canUseExtend();
      extendBtn.disabled = !allowed;
      extendBtn.classList.toggle('opacity-50', !allowed);
      extendBtn.classList.toggle('cursor-not-allowed', !allowed);
      refreshExtendNote();
      return allowed;
    }

    let pInt=null, remaining=0, pollInt=null, demoTimeout=null;

    function showResultsWrapper(){ results.classList.remove('hidden'); }
    function setResultsState(state){
      showResultsWrapper();
      resultsPending?.classList.toggle('hidden', state!=='pending');
      resultsListWrap?.classList.toggle('hidden', state!=='list');
      resultsEmpty?.classList.toggle('hidden', state!=='empty');
      pickupBox?.classList.toggle('hidden', state!=='reserved');
      if(state==='pending'){
        resultsList.innerHTML='';
        if(statusCallLink){ statusCallLink.href = '#'; setLinkAvailability(statusCallLink, false); }
        if(statusDirectionsLink){ statusDirectionsLink.href = '#'; setLinkAvailability(statusDirectionsLink, false); }
        statusReservedGeneric?.classList.add('hidden');
      }
      if(state==='empty'){
        if(statusCallLink){ statusCallLink.href = '#'; setLinkAvailability(statusCallLink, false); }
        if(statusDirectionsLink){ statusDirectionsLink.href = '#'; setLinkAvailability(statusDirectionsLink, false); }
        statusReservedGeneric?.classList.add('hidden');
      }
      if(state==='pending' || state==='empty'){ selectedPharmacy = null; }
      if(state!=='pending'){
        results.scrollIntoView({ behavior:'smooth', block:'start' });
      }
    }
    function setLinkAvailability(el, enabled){
      if(!el) return;
      el.classList.toggle('opacity-60', !enabled);
      el.classList.toggle('pointer-events-none', !enabled);
    }

    function updateDistanceHint(){
      if(!distanceHintEl) return;
      switch(state.locationStatus){
        case 'loading':
          distanceHintEl.textContent = t('distanceHintLoading');
          distanceHintEl.classList.remove('hidden');
          break;
        case 'denied':
          distanceHintEl.textContent = t('distanceHintDenied');
          distanceHintEl.classList.remove('hidden');
          break;
        case 'unsupported':
          distanceHintEl.textContent = t('distanceHintUnsupported');
          distanceHintEl.classList.remove('hidden');
          break;
        case 'unavailable':
          distanceHintEl.textContent = t('distanceHintUnavailable');
          distanceHintEl.classList.remove('hidden');
          break;
        default:
          distanceHintEl.classList.add('hidden');
          break;
      }
    }

    let locatingPromise = null;
    async function requestUserLocation(){
      if(state.userCoords) return state.userCoords;
      if(state.locationStatus === 'denied' || state.locationStatus === 'unsupported'){
        updateDistanceHint();
        return null;
      }
      if(!('geolocation' in navigator)){
        state.locationStatus = 'unsupported';
        updateDistanceHint();
        return null;
      }
      if(locatingPromise){
        return locatingPromise;
      }
      state.locationAttempted = true;
      state.locationStatus = 'loading';
      updateDistanceHint();
      locatingPromise = new Promise((resolve)=>{
        navigator.geolocation.getCurrentPosition((pos)=>{
          state.userCoords = {
            lat: pos.coords.latitude,
            lng: pos.coords.longitude
          };
          state.locationStatus = 'ready';
          locatingPromise = null;
          updateDistanceHint();
          resolve(state.userCoords);
        }, (err)=>{
          locatingPromise = null;
          if(err && err.code === err.PERMISSION_DENIED){
            state.locationStatus = 'denied';
          }else{
            state.locationStatus = 'unavailable';
          }
          updateDistanceHint();
          resolve(null);
        }, {
          enableHighAccuracy: true,
          timeout: 8000,
          maximumAge: 120000
        });
      });
      return locatingPromise;
    }

    function haversineDistanceKm(lat1, lon1, lat2, lon2){
      const R = 6371;
      const toRad = (deg)=> deg * Math.PI / 180;
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon/2)**2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }

    function formatDistance(km){
      if(Number.isNaN(km)) return null;
      const rounded = km >= 10 ? Math.round(km) : Math.round(km * 10) / 10;
      return rounded.toFixed(rounded % 1 === 0 ? 0 : 1);
    }
    function populateReservedDetails(pharmacy){
      const fallbackName = state.lang==='el'?'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿':'Pharmacy';
      const fallbackAddress = state.lang==='el'?'Î§Ï‰ÏÎ¯Ï‚ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·':'No address provided';
      statusReservedName.textContent = pharmacy?.name || fallbackName;
      statusReservedAddress.textContent = pharmacy?.addr || fallbackAddress;
      statusReservedGeneric.classList.toggle('hidden', !pharmacy?.is_generic);
      if(pharmacy?.tel){
        const tel = pharmacy.tel.replace(/\s+/g,'');
        statusCallLink.href = `tel:${tel}`;
        setLinkAvailability(statusCallLink, true);
      } else {
        statusCallLink.href = '#';
        setLinkAvailability(statusCallLink, false);
      }
      const querySource = pharmacy?.addr || pharmacy?.name || '';
      if(querySource){
        const encoded = encodeURIComponent(querySource);
        let href = `https://www.google.com/maps?q=${encoded}`;
        if(pharmacy?.lat && pharmacy?.lng){
          href = `https://www.google.com/maps?q=${encoded}@${pharmacy.lat},${pharmacy.lng},17z`;
        }
        statusDirectionsLink.href = href;
        setLinkAvailability(statusDirectionsLink, true);
      } else {
        statusDirectionsLink.href = '#';
        setLinkAvailability(statusDirectionsLink, false);
      }
    }

    function fmt(s){const m=String(Math.floor(s/60)).padStart(2,'0'), ss=String(s%60).padStart(2,'0'); return `${m}:${ss}`;}
    function stopPickupTimer(){ if(pInt){clearInterval(pInt); pInt=null;} pickupBox?.classList.add('hidden'); }
    function startPickupTimer(sec){
      setResultsState('reserved');
      remaining=sec; pickupTimerEl.textContent=fmt(remaining);
      updateExtendAvailability();
      if(pInt) clearInterval(pInt);
      pInt=setInterval(()=>{remaining--; if(remaining<=0){stopPickupTimer(); return;} pickupTimerEl.textContent=fmt(remaining)},1000);
    }
    if(extendBtn){
      extendBtn.onclick=async ()=>{
        if(!canUseExtend()){
          updateExtendAvailability();
          return;
        }
        remaining+=15*60; pickupTimerEl.textContent=fmt(remaining);
        writeExtendTimestamp(Date.now());
        updateExtendAvailability();
        if(hasSupabase() && window.currentRequest?.id){
          const newUntil = new Date(Date.now()+remaining*1000).toISOString();
          await sb().from('requests').update({ pickup_until: newUntil }).eq('id', window.currentRequest.id);
        }
      };
    }

    statusEmptyBtn?.addEventListener('click', ()=>{
      hidePending();
      results.classList.add('hidden');
      resultsPending?.classList.remove('hidden');
      resultsListWrap?.classList.add('hidden');
      resultsEmpty?.classList.add('hidden');
      pickupBox?.classList.add('hidden');
      selectedPharmacy = null;
      window.scrollTo({ top: 0, behavior:'smooth' });
    });

    const pm = document.getElementById('pharm-modal');
    const pmTitle = document.getElementById('pm-title');
    const pmAddr  = document.getElementById('pm-address');
    const pmPhone = document.getElementById('pm-phone');
    const pmCall  = document.getElementById('pm-call');
    const pmMaps  = document.getElementById('pm-maps');
    const pmConfirm = document.getElementById('pm-confirm');
    document.getElementById('pm-close').onclick = ()=> pm.classList.add('hidden');

    /* ========== CREATE REQUEST ========== */
    async function insertRequestRow(row){
      const { data, error } = await sb().from('requests').insert(row).select('id,created_at').single();
      if(error) throw error;
      return data;
    }

    async function createRequest(payload){
      if(!hasSupabase()) throw new Error('NO_DB');
      const baseRow = {
        status: 'pending',
        med_name: payload.med_name,
        active_substance: payload.active_substance || null,
        med_type: payload.med_type || null,
        quantity: payload.quantity,
        allow_generic: payload.allow_generic,
        city: payload.city
      };
      if(payload.barcode){
        try {
          return await insertRequestRow({ ...baseRow, barcode_value: payload.barcode });
        } catch(err){
          console.warn('Falling back without barcode_value column', err);
        }
      }
      return insertRequestRow(baseRow);
    }

    statusEmptyBtn?.addEventListener('click', ()=>{
      hidePending();
      results.classList.add('hidden');
      resultsPending?.classList.remove('hidden');
      resultsListWrap?.classList.add('hidden');
      resultsEmpty?.classList.add('hidden');
      pickupBox?.classList.add('hidden');
      selectedPharmacy = null;
      window.scrollTo({ top: 0, behavior:'smooth' });
    });

    statusEmptyBtn?.addEventListener('click', ()=>{
      hidePending();
      results.classList.add('hidden');
      resultsPending?.classList.remove('hidden');
      resultsListWrap?.classList.add('hidden');
      resultsEmpty?.classList.add('hidden');
      pickupBox?.classList.add('hidden');
      selectedPharmacy = null;
      window.scrollTo({ top: 0, behavior:'smooth' });
    });
  }

  // ==========================
  //  PHARMACY MODAL / RESERVE
  // ==========================
  function openPharmacyModal(resp) {
    state.reservation.pharmacy = resp;
    const modal = document.getElementById('pharm-modal');
    document.getElementById('pm-title').textContent = resp.pharmacy_name || 'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿';
    document.getElementById('pm-address').textContent = (state.lang==='el'?'Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·: ':'Address: ') + (resp.pharmacy_address || '-');
    const mapsBtn = document.getElementById('pm-maps');
    if (resp.latitude && resp.longitude) {
      mapsBtn.href = `https://maps.google.com/?q=${resp.latitude},${resp.longitude}`;
      mapsBtn.classList.remove('opacity-50','pointer-events-none');
    } else if (resp.pharmacy_address) {
      const q = encodeURIComponent(resp.pharmacy_address);
      mapsBtn.href = `https://maps.google.com/?q=${q}`;
      mapsBtn.classList.remove('opacity-50','pointer-events-none');
    } else {
      mapsBtn.href = '#';
      mapsBtn.classList.add('opacity-50','pointer-events-none');
    }
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }

  async function confirmReservationFromModal() {
    const resp = state.reservation.pharmacy;
    if (!resp) return;
    const modal = document.getElementById('pharm-modal');
    modal.classList.add('hidden');
    modal.classList.remove('flex');

    // update request to reserved
    if (state.supabase && state.currentRequestId) {
      const pickupUntil = new Date(Date.now() + 60*60*1000).toISOString();
      const { error } = await state.supabase.from('requests').update({
        status: 'reserved',
        chosen_pharmacy: resp.pharmacy_id || resp.id || null,
        pickup_until: pickupUntil
      }).eq('id', state.currentRequestId);
      if (error) console.error(error);
      startCountdown(pickupUntil);
      showReservationBox(resp, pickupUntil);
      showCelebration();
    } else {
      const pickupUntil = new Date(Date.now() + 60*60*1000).toISOString();
      startCountdown(pickupUntil);
      showReservationBox(resp, pickupUntil);
      showCelebration();
    }
  }

  function showReservationBox(resp, pickupUntil) {
    document.getElementById('pickup-box').classList.remove('hidden');
    document.getElementById('results-list').classList.add('hidden');
    document.getElementById('status-reserved-name').textContent = resp.pharmacy_name || 'Pharmacy';
    document.getElementById('status-reserved-address').textContent = resp.pharmacy_address || '';
    if (resp.has_generic) {
      document.getElementById('status-reserved-generic').classList.remove('hidden');
    } else {
      document.getElementById('status-reserved-generic').classList.add('hidden');
    }

    async function renderResults(items){
      resultsList.innerHTML='';
      const safeItems = Array.isArray(items) ? items : [];
      const hasGeoData = safeItems.some(item => {
        const ph = item?.pharmacy || {};
        const lat = ph.lat !== undefined && ph.lat !== null ? parseFloat(ph.lat) : NaN;
        const lng = ph.lng !== undefined && ph.lng !== null ? parseFloat(ph.lng) : NaN;
        return Number.isFinite(lat) && Number.isFinite(lng);
      });
      let coords = state.userCoords;
      if(hasGeoData && !coords){
        coords = await requestUserLocation();
      }
      if(!hasGeoData){
        distanceHintEl?.classList.add('hidden');
      } else if(!coords && state.locationStatus === 'idle'){
        updateDistanceHint();
      }
      safeItems.forEach(item=>{
        const ph=item.pharmacy || {};
        const lat = ph.lat !== undefined && ph.lat !== null ? parseFloat(ph.lat) : null;
        const lng = ph.lng !== undefined && ph.lng !== null ? parseFloat(ph.lng) : null;
        let distanceLabel='';
        if(coords && Number.isFinite(lat) && Number.isFinite(lng)){
          const km = haversineDistanceKm(coords.lat, coords.lng, lat, lng);
          const formatted = formatDistance(km);
          if(formatted){
            distanceLabel = t('distanceAway').replace('%s', formatted);
          }
        }
        const card = document.createElement('article');
        card.className = 'result-card flex items-center gap-4 rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/85 dark:bg-slate-900/50 px-4 py-4 shadow-soft';
        card.innerHTML = `
          <div class="w-12 h-12 rounded-2xl bg-brand-500/10 text-brand-600 grid place-items-center shrink-0">
            <span aria-hidden="true">ğŸ’Š</span>
          </div>
          <div class="flex flex-col flex-1 min-w-0 text-left">
            <p class="font-semibold text-slate-900 dark:text-slate-100 truncate">${ph.name || (state.lang==='el'?'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿':'Pharmacy')}</p>
            <p class="text-sm text-slate-500 dark:text-slate-400 truncate">${ph.address || 'â€”'}</p>
            ${distanceLabel ? `<p class="mt-1 text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1"><span aria-hidden="true">ğŸ“</span><span>${distanceLabel}</span></p>` : ''}
          </div>
          <div class="flex flex-col items-end gap-2 shrink-0">
            ${item.is_generic ? `<span class="px-2 py-1 rounded-full bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-200 text-xs font-semibold status-generic-label-wrapper"><span class="status-generic-label">${t('statusGenericShort')}</span></span>` : ''}
            <button class="select-pharm status-accept px-4 py-2 rounded-xl bg-brand-600 text-white text-sm font-semibold hover:bg-brand-700 transition">
              <span class="status-accept-label">${t('statusAccept')}</span>
            </button>
          </div>`;
        card.dataset.name = ph.name || (state.lang==='el'?'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿':'Pharmacy');
        card.dataset.addr = ph.address || '';
        card.dataset.tel  = ph.phone || '';
        card.dataset.lat  = ph.lat || '';
        card.dataset.lng  = ph.lng || '';
        card.dataset.generic = item.is_generic ? 'true' : 'false';
        resultsList.appendChild(card);
      });
      if(safeItems.length){
        setResultsState('list');
        if(pushToast && !pushToast.dataset.shown){
          pushToast.classList.remove('hidden');
          pushToast.dataset.shown = 'true';
        }
      }else{
        setResultsState('empty');
      }
    }

    function scheduleDemoResults(allow_generic, barcode){
      if(pollInt){ clearInterval(pollInt); pollInt=null; }
      if(demoTimeout){ clearTimeout(demoTimeout); }
      demoTimeout = setTimeout(async ()=>{
        hidePending();
        const demoItems = [
          { pharmacy:{ name:'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ Î™Î¬ÎºÏ‰Î²Î¿Ï‚', address:'Î™Ï€Ï€Î¿ÎºÏÎ¬Ï„Î¿Ï…Ï‚ 12, Î‘Î¸Î®Î½Î±', phone:'+30 210 1234567', lat:37.984, lng:23.735 }, is_generic: allow_generic },
          { pharmacy:{ name:'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ ÎÎ¯ÎºÎ·', address:'Î£ÏŒÎ»Ï‰Î½Î¿Ï‚ 90, Î‘Î¸Î®Î½Î±', phone:'+30 210 7654321', lat:37.983, lng:23.732 }, is_generic: false },
          { pharmacy:{ name:'PharmaPlus Care', address:'Î‘Ï‡Î±ÏÎ½ÏÎ½ 45, Î‘Î¸Î®Î½Î±', phone:'+30 210 5556677', lat:37.997, lng:23.727 }, is_generic: false }
        ];
        if(barcode){ console.info('Submitted barcode:', barcode); }
        await renderResults(demoItems);
        demoTimeout = null;
      }, 4500);
    }

    resultsList.addEventListener('click', (e)=>{
      const btn = e.target.closest('.select-pharm'); if(!btn) return;
      const card = btn.closest('.result-card'); if(!card) return;
      selectedPharmacy = {
        name: card.dataset.name,
        addr: card.dataset.addr,
        tel: card.dataset.tel,
        lat: card.dataset.lat,
        lng: card.dataset.lng,
        is_generic: card.dataset.generic === 'true'
      };
      pmTitle.textContent = selectedPharmacy.name;
      pmAddr.textContent  = (state.lang==='el'?'Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·: ':'Address: ') + (selectedPharmacy.addr || 'â€”');
      pmPhone.textContent = (state.lang==='el'?'Î¤Î·Î»Î­Ï†Ï‰Î½Î¿: ':'Phone: ') + (selectedPharmacy.tel || 'â€”');
      pmCall.href = selectedPharmacy.tel ? `tel:${selectedPharmacy.tel.replace(/\s+/g,'')}` : '#';
      pmMaps.href = `https://www.google.com/maps?q=${encodeURIComponent(selectedPharmacy.addr||selectedPharmacy.name)}${selectedPharmacy.lat?`@${selectedPharmacy.lat},${selectedPharmacy.lng},17z`:''}`;
      pm.classList.remove('hidden'); pm.classList.add('flex');
    });

    document.getElementById('pm-close').onclick = ()=> pm.classList.add('hidden');
    document.getElementById('pm-confirm').onclick = async ()=>{
      if(!selectedPharmacy) return;
      pm.classList.add('hidden');
      const sec = 60*60;
      populateReservedDetails(selectedPharmacy);
      startPickupTimer(sec);
      if(hasSupabase() && window.currentRequest?.id){
        const untilISO = new Date(Date.now()+sec*1000).toISOString();
        await sb().from('requests').update({ status:'reserved', pickup_until: untilISO }).eq('id', window.currentRequest.id);
      }
    };

    document.getElementById('newSearch').addEventListener('click', ()=>{
      hidePending();
      stopPickupTimer();
      if(demoTimeout){ clearTimeout(demoTimeout); demoTimeout=null; }
      results.classList.add('hidden');
      resultsPending?.classList.remove('hidden');
      resultsListWrap?.classList.add('hidden');
      resultsEmpty?.classList.add('hidden');
      pickupBox?.classList.add('hidden');
      selectedPharmacy = null;
      window.scrollTo({ top: 0, behavior:'smooth' });
    });

    /* ========== SUBMIT FLOW ========== */
    document.getElementById('submitBtn').addEventListener('click', async (e)=>{
      e.preventDefault();
      const med_name = document.getElementById('medicine-name').value.trim();
      const active_substance = document.getElementById('active-substance').value.trim();
      const barcode = document.getElementById('barcode-value').value.trim();
      const med_type = document.getElementById('medicine-type').value || null;
      const quantity = parseInt(document.getElementById('quantity').value || '1',10);
      const allow_generic = (document.querySelector('input[name="allow-generic"]:checked')?.value==='YES');
      const city = document.getElementById('city').value;

      if(!med_name) return alert(state.lang==='el'?'Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï†Î±ÏÎ¼Î¬ÎºÎ¿Ï…':'Enter medicine name');
      if(!city) return alert(state.lang==='el'?'Î•Ï€Î¯Î»ÎµÎ¾Îµ Ï€ÏŒÎ»Î·':'Select city');
      if(!document.getElementById('gdpr-checkbox').checked) return alert(state.lang==='el'?'Î‘Ï€Î¿Î´Î­Î¾Î¿Ï… Ï„Î¿Ï…Ï‚ ÏŒÏÎ¿Ï…Ï‚':'Accept terms');

      fireConfetti(3500);
      showPending();

      try {
        let inserted = null;
        if(hasSupabase()){
          inserted = await createRequest({ med_name, active_substance, med_type, quantity, allow_generic, city, barcode });
          window.currentRequest = inserted;
          localStorage.setItem(LS_REQ, JSON.stringify({ id: inserted.id, created_at: inserted.created_at }));
        }

        if(hasSupabase() && inserted?.id){
          if(pollInt) clearInterval(pollInt);
          const startPoll = Date.now();
          pollInt = setInterval(async ()=>{
            try{
              const items = await fetchResponses(inserted.id);
              if(items.length){
                hidePending();
                await renderResults(items);
                clearInterval(pollInt); pollInt=null;
              }else if(Date.now()-startPoll > 120000){
                hidePending();
                setResultsState('empty');
                clearInterval(pollInt); pollInt=null;
              }
            }catch(err){ console.warn('poll error', err); }
          }, 3000);
        } else {
          scheduleDemoResults(allow_generic, barcode);
        }
      } catch(err){
        console.error(err);
        window.currentRequest = null;
        localStorage.removeItem(LS_REQ);
        scheduleDemoResults(allow_generic, barcode);
        alert(state.lang==='el'
          ? 'Î”ÎµÎ½ Î®Ï„Î±Î½ Î´Ï…Î½Î±Ï„Î® Î· ÏƒÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Ï„Î· Î²Î¬ÏƒÎ·. Î•Î¼Ï†Î±Î½Î¯Î¶Î¿Î½Ï„Î±Î¹ ÎµÎ½Î´ÎµÎ¹ÎºÏ„Î¹ÎºÎ¬ Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±.'
          : 'We could not connect to the database. Showing demo results instead.');
      }
    });

    /* ===================== Web Push (3c) ===================== */
    const btnPushAllow = document.getElementById('push-allow');
    const btnPushDeny  = document.getElementById('push-deny');

    statusNotifyBtn?.addEventListener('click', ()=>{
      pushToast?.classList.remove('hidden');
      pushToast?.scrollIntoView({ behavior:'smooth', block:'end' });
    });

    function urlBase64ToUint8Array(base64String) {
      const padding = '='.repeat((4 - base64String.length % 4) % 4);
      const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');
      const rawData = atob(base64);
      const outputArray = new Uint8Array(rawData.length);
      for (let i = 0; i < rawData.length; ++i) { outputArray[i] = rawData.charCodeAt(i); }
      return outputArray;
    }

    async function saveSubscriptionToSupabase(sub) {
      if (!hasSupabase()) return;
      // Î£Ï…Î¼Î²Î±Ï„ÏŒÏ„Î·Ï„Î±: Ï€Î¬ÏÎµ Ï„Î± keys Î±Ï€ÏŒ toJSON()
      const raw = (typeof sub.toJSON === 'function') ? sub.toJSON() : {};
      const keys = raw.keys || {};
      const row = {
        endpoint: sub.endpoint,
        p256dh: keys.p256dh || '',
        auth: keys.auth || '',
        user_agent: navigator.userAgent
      };
      // upsert Î¼Îµ onConflict:endpoint
      const { error } = await sb().from('push_subscriptions').upsert(row, { onConflict: 'endpoint' });
      if (error) console.warn('save sub error', error);
    }
    closeBtn.addEventListener('click', stop);
    stopBtn.addEventListener('click', stop);
  }

  // ==========================
  //  AUTH (mocked / simple)
  // ==========================
  function openAuthModal(role) {
    const mUsers = document.getElementById('auth-modal-users');
    const mPharm = document.getElementById('auth-modal-pharmacies');
    if (role === 'pharmacies') {
      mPharm.classList.remove('hidden');
      mPharm.classList.add('flex');
    } else {
      mUsers.classList.remove('hidden');
      mUsers.classList.add('flex');
    }
  }
  function closeAuthModals() {
    document.getElementById('auth-modal-users').classList.add('hidden');
    document.getElementById('auth-modal-users').classList.remove('flex');
    document.getElementById('auth-modal-pharmacies').classList.add('hidden');
    document.getElementById('auth-modal-pharmacies').classList.remove('flex');
  }

    /* ========== Init ========== */
    applyLang();
    try{
      const saved = JSON.parse(localStorage.getItem(LS_REQ) || 'null');
      if(saved?.id){ window.currentRequest = saved; }
    }catch{}
  </script>
</body>
</html>
