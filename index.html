<!DOCTYPE html>
<html lang="el" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MediRadar</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter','ui-sans-serif','system-ui'] },
          colors: {
            brand: { 50:'#e6f6f6', 300:'#79cfcf', 400:'#4fbcbc', 500:'#29a3a3', 600:'#208181', 700:'#196464' }
          },
          boxShadow: { soft:'0 16px 40px rgba(2,6,23,.12)' }
        }
      }
    }
  </script>

  <!-- Background (soft colorful fade) -->
  <style>
    .app-bg{
      background:
        radial-gradient(1100px 600px at 0% -10%, rgba(132,197,244,.30), transparent 60%),
        radial-gradient(900px 540px at 110% 0%, rgba(199,166,244,.22), transparent 58%),
        radial-gradient(1000px 600px at 25% 120%, rgba(247,141,167,.18), transparent 62%),
        radial-gradient(800px 520px at 120% 120%, rgba(157,224,214,.20), transparent 60%),
        linear-gradient(180deg, #f6fbfb 0%, #f8fafc 40%, #fbfcfe 100%);
    }
    .dark .app-bg{
      background:
        radial-gradient(1100px 600px at 0% -10%, rgba(132,197,244,.16), transparent 60%),
        radial-gradient(900px 540px at 110% 0%, rgba(199,166,244,.14), transparent 58%),
        radial-gradient(1000px 600px at 25% 120%, rgba(247,141,167,.12), transparent 62%),
        radial-gradient(800px 520px at 120% 120%, rgba(157,224,214,.12), transparent 60%),
        linear-gradient(180deg, #0b1515, #0b1515 45%, #0b1515 100%);
    }
    .ac-list { position:absolute; inset-inline:0; top:100%; z-index:40 }
    .ac-item { cursor:pointer }
    .badge { display:inline-flex; align-items:center; gap:6px; padding:.25rem .5rem; border-radius:999px; font-size:.75rem; }
    @keyframes hourglass {
      0% { transform: rotate(0deg); }
      50% { transform: rotate(180deg); }
      100% { transform: rotate(360deg); }
    }
    .spin-hourglass{ animation: hourglass 1.6s linear infinite; }
  </style>

  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#29a3a3" />
</head>
<body class="min-h-full app-bg text-slate-900 dark:text-slate-200 font-sans selection:bg-brand-50">

  <!-- Top-right controls (language + theme) -->
  <div class="absolute top-3 left-3 right-3 z-50">
    <div class="ml-auto w-fit flex items-center gap-2 rounded-2xl bg-white/85 dark:bg-white/10 border border-slate-200 dark:border-slate-700 backdrop-blur px-2 py-1">
      <!-- Î“Î¹Î± ÎµÏ€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¯ÎµÏ‚ (link Î¼ÏŒÎ½Î¿ ÏƒÏ„Î¿ splash) -->
      <a href="/pharmacy.html" class="hidden sm:inline text-sm px-2 py-1 rounded-lg hover:bg-white/70 dark:hover:bg-white/20" id="link-pro">Î“Î¹Î± ÎµÏ€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¯ÎµÏ‚</a>

      <!-- Language with flags -->
      <div class="flex items-center rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700">
        <button id="lang-el" class="px-2 py-1.5 text-xs font-semibold flex items-center gap-1 bg-white/70 dark:bg-white/10 focus:outline-none focus:ring-2 focus:ring-brand-400">
          <svg width="14" height="10" viewBox="0 0 27 18" aria-hidden="true">
            <rect width="27" height="18" fill="#0D5EAF"/>
            <g fill="#fff"><rect y="2" width="27" height="2"/><rect y="6" width="27" height="2"/><rect y="10" width="27" height="2"/><rect y="14" width="27" height="2"/></g>
            <rect width="10" height="10" fill="#0D5EAF"/><rect x="4" width="2" height="10" fill="#fff"/><rect y="4" width="10" height="2" fill="#fff"/>
          </svg> EL
        </button>
        <button id="lang-en" class="px-2 py-1.5 text-xs font-semibold flex items-center gap-1 opacity-90 hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-brand-400">
          <svg width="14" height="10" viewBox="0 0 28 20" aria-hidden="true">
            <rect width="28" height="20" fill="#012169"/>
            <path d="M0,0 L28,20 M28,0 L0,20" stroke="#fff" stroke-width="5"/>
            <path d="M0,0 L28,20 M28,0 L0,20" stroke="#C8102E" stroke-width="3"/>
            <rect x="11" width="6" height="20" fill="#fff"/><rect y="7" width="28" height="6" fill="#fff"/>
            <rect x="12" width="4" height="20" fill="#C8102E"/><rect y="8" width="28" height="4" fill="#C8102E"/>
          </svg> EN
        </button>
      </div>

      <!-- Theme toggle -->
      <button id="theme-toggle" class="px-2 py-1.5 rounded-xl hover:bg-white/70 dark:hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-brand-400" title="Light / Dark">
        <span id="icon-sun" class="hidden">ğŸŒ</span><span id="icon-moon">ğŸŒ™</span>
      </button>
    </div>
  </div>

  <!-- SPLASH -->
  <section id="splash" class="min-h-[100svh] grid place-items-center relative px-4">
    <div class="w-full max-w-4xl text-center">
      <!-- Logo -->
      <div class="mx-auto w-24 h-24 rounded-3xl bg-brand-600 text-white grid place-items-center shadow-soft">
        <svg viewBox="0 0 24 24" class="w-10 h-10" aria-hidden="true">
          <path fill="currentColor" d="M11 2h2v3.06A7 7 0 0 1 18.94 11H22v2h-3.06A7 7 0 0 1 13 18.94V22h-2v-3.06A7 7 0 0 1 5.06 13H2v-2h3.06A7 7 0 0 1 11 5.06V2Zm1 5a5 5 0 1 0 0 10a5 5 0 0 0 0-10Z"/>
        </svg>
      </div>

      <h1 class="mt-5 text-4xl sm:text-5xl font-extrabold tracking-tight">MediRadar</h1>
      <p id="t-hero" class="mt-2 text-lg text-slate-600 dark:text-slate-400">Î†Î¼ÎµÏƒÎ· ÎµÏÏÎµÏƒÎ· Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚ Ï†Î±ÏÎ¼Î¬ÎºÏ‰Î½ ÏƒÎµ ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±.</p>

      <!-- Buttons centered -->
      <div class="mt-8 grid grid-cols-1 sm:grid-cols-3 gap-4 max-w-3xl mx-auto">
        <button id="cta-search" class="px-6 py-4 rounded-2xl bg-gradient-to-r from-brand-500 to-brand-600 text-white font-semibold shadow-soft hover:opacity-95 focus:outline-none focus:ring-2 focus:ring-brand-300">
          <span id="t-searchBTN">Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…</span>
        </button>
        <button id="cta-how" class="px-6 py-4 rounded-2xl bg-white/85 backdrop-blur border border-slate-200 hover:bg-white font-semibold focus:outline-none focus:ring-2 focus:ring-brand-300">
          <span id="t-howBTN">Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯</span>
        </button>
        <button id="cta-signin" class="px-6 py-4 rounded-2xl bg-white/85 backdrop-blur border border-slate-200 hover:bg-white font-semibold focus:outline-none focus:ring-2 focus:ring-brand-300">
          <span id="t-signinBTN">Î£ÏÎ½Î´ÎµÏƒÎ·</span>
        </button>
      </div>

      <button id="cta-install" class="mt-4 inline-flex items-center gap-2 px-4 py-2 rounded-xl border border-brand-600 text-brand-700 font-semibold bg-white/80 backdrop-blur hover:bg-white hidden focus:outline-none focus:ring-2 focus:ring-brand-300">
        ğŸ“² <span id="t-installBTN">Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</span>
      </button>

      <!-- Pro link (mobile) -->
      <div class="sm:hidden mt-4">
        <a href="/pharmacy.html" class="text-sm underline" id="t-pro-m">Î“Î¹Î± ÎµÏ€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¯ÎµÏ‚</a>
      </div>
    </div>
  </section>

  <!-- FULLSCREEN SEARCH MODAL -->
  <div id="searchModal" class="fixed inset-0 hidden z-40">
    <div class="absolute inset-0 bg-black/40" id="closeSearch"></div>
    <div class="absolute inset-0 overflow-auto">
      <div class="mx-auto max-w-3xl p-4 sm:p-6">
        <div class="rounded-2xl bg-white/95 dark:bg-slate-900/90 backdrop-blur border border-slate-200 dark:border-slate-800 shadow-soft">
          <!-- Modal header -->
          <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200 dark:border-slate-800">
            <div class="flex items-center gap-2">
              <button id="backHome" class="px-3 py-1.5 rounded-lg border text-sm hover:bg-slate-50 dark:hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-brand-300">â† <span id="t-home">Î‘ÏÏ‡Î¹ÎºÎ®</span></button>
              <span id="t-searchTitle" class="font-semibold">Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…</span>
            </div>
            <!-- ÎºÏÏÎ²Î¿Ï…Î¼Îµ Ï„Î¿ â€œÎ“Î¹Î± ÎµÏ€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¯ÎµÏ‚â€ Î¼Î­ÏƒÎ± ÏƒÏ„Î· Ï†ÏŒÏÎ¼Î± -->
          </div>

          <div class="p-5 grid grid-cols-1 gap-4 sm:gap-5">
            <!-- Medicine -->
            <div class="rounded-2xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4">
              <label class="text-sm font-semibold flex items-center gap-2">
                <span class="w-6 h-6 grid place-items-center">ğŸ”</span>
                <span id="t-medname">ÎŒÎ½Î¿Î¼Î± Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…</span>
              </label>
              <div class="mt-2 relative">
                <input id="medicine-name" type="text" autocomplete="off"
                       class="w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-500/30 placeholder:text-slate-400"
                       placeholder="Ï€.Ï‡. Augmentin 875mg" />
                <div id="ac-medicine" class="ac-list hidden rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-lg"></div>
              </div>
              <p class="mt-2 text-xs text-slate-500 dark:text-slate-400" id="t-formatTip">Î£Ï…Î¼Î²Î¿Ï…Î»Î®: Î•Î¼Ï€Î¿ÏÎ¹ÎºÎ® Î¿Î½Î¿Î¼Î±ÏƒÎ¯Î± + Î´Î¿ÏƒÎ¿Î»Î¿Î³Î¯Î± (Ï€.Ï‡. â€œ500mgâ€).</p>
            </div>

            <!-- Substance -->
            <div class="rounded-2xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4">
              <label class="text-sm font-semibold flex items-center gap-2">
                <span class="w-6 h-6 grid place-items-center">ğŸ§ª</span>
                <span id="t-substance">Î”ÏÎ±ÏƒÏ„Î¹ÎºÎ® ÎŸÏ…ÏƒÎ¯Î±</span> <span class="text-slate-400 ml-1" id="t-optional">(Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬)</span>
              </label>
              <div class="mt-2 relative">
                <input id="active-substance" type="text" autocomplete="off"
                       class="w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-500/30 placeholder:text-slate-400"
                       placeholder="Ï€.Ï‡. Î Î±ÏÎ±ÎºÎµÏ„Î±Î¼ÏŒÎ»Î·" />
                <div id="ac-substance" class="ac-list hidden rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-lg"></div>
              </div>
              <p class="mt-2 text-xs text-slate-500 dark:text-slate-400" id="t-doseEx">Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î´Î¿ÏƒÎ¿Î»Î¿Î³Î¯Î±Ï‚: Paracetamol 500mg.</p>
            </div>

            <!-- Type + Quantity -->
            <div class="grid sm:grid-cols-2 gap-4">
              <div class="rounded-2xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4">
                <label class="text-sm font-semibold flex items-center gap-2">
                  <span class="w-6 h-6 grid place-items-center">ğŸ’Š</span>
                  <span id="t-type">Î¤ÏÏ€Î¿Ï‚ Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…</span>
                </label>
                <select id="medicine-type"
                        class="mt-2 w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-500/30">
                  <option value="">â€” <span id="t-select">Î•Ï€Î¹Î»Î¿Î³Î®</span> â€”</option>
                  <option>Î£ÎºÏŒÎ½Î·</option><option>Î¥Î³ÏÏŒ</option><option>Î§Î¬Ï€Î¹</option>
                  <option>Î”ÎµÏÎ¼Î±Ï„Î¹ÎºÎ® ÎšÏÎ­Î¼Î±</option><option>Î‘Î»Î¿Î¹Ï†Î®</option>
                  <option>Î Î­Î½Î± (Ï€ÏÎ¿Î³ÎµÎ¼Î¹ÏƒÎ¼Î­Î½Î·)</option><option>Î•Ï€Î¯Î¸ÎµÎ¼Î±</option>
                </select>
              </div>

              <div class="rounded-2xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4">
                <label class="text-sm font-semibold flex items-center gap-2">
                  <span class="w-6 h-6 grid place-items-center">ğŸ“¦</span>
                  <span id="t-qty">Î Î¿ÏƒÏŒÏ„Î·Ï„Î± (Ï„ÎµÎ¼Î¬Ï‡Î¹Î±/ÎºÎ¿Ï…Ï„Î¹Î¬)</span>
                </label>
                <input id="quantity" type="number" min="1" value="1" required
                       class="mt-2 w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-500/30" />
              </div>
            </div>

            <!-- Generic (polite) -->
            <div class="rounded-2xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4">
              <p class="text-sm font-semibold flex items-center gap-2">
                <span class="w-6 h-6 grid place-items-center">âœ…</span>
                <span id="t-genericQ">Î‘Î½ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Ï„Î¿ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ ÎµÎ¼Ï€Î¿ÏÎ¹ÎºÏŒ, ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹Ï‚ Î½Î± ÏƒÎ¿Ï… Ï€ÏÎ¿Ï„ÎµÎ¯Î½Î¿Ï…Î¼Îµ Î¹ÏƒÎ¿Î´ÏÎ½Î±Î¼Î¿ (Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿);</span>
              </p>
              <div class="mt-3 flex gap-4">
                <label class="inline-flex items-center gap-2"><input type="radio" name="allow-generic" value="YES" class="size-4 accent-brand-600" checked><span id="t-yes">ÎÎ‘Î™</span></label>
                <label class="inline-flex items-center gap-2"><input type="radio" name="allow-generic" value="NO" class="size-4 accent-brand-600"><span id="t-no">ÎŸÎ§Î™</span></label>
              </div>
            </div>

            <!-- City -->
            <div class="rounded-2xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4">
              <label class="text-sm font-semibold flex items-center gap-2">
                <span class="w-6 h-6 grid place-items-center">ğŸ“</span>
                <span id="t-city">Î ÏŒÎ»Î·</span>
              </label>
              <select id="city" required
                      class="mt-2 w-full px-3 py-3 rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:outline-none focus:ring-4 focus:ring-brand-500/30">
                <option value="">â€” <span id="t-select2">Î•Ï€Î¹Î»Î¿Î³Î®</span> â€”</option>
                <option>Î‘Î³ÏÎ¯Î½Î¹Î¿</option><option>Î‘Î»ÎµÎ¾Î±Î½Î´ÏÎ¿ÏÏ€Î¿Î»Î·</option><option>Î‘Î¸Î®Î½Î±</option>
                <option>Î’Î­ÏÎ¿Î¹Î±</option><option>Î’ÏŒÎ»Î¿Ï‚</option><option>Î“Î»Ï…Ï†Î¬Î´Î±</option>
                <option>Î”ÏÎ¬Î¼Î±</option><option>Î•Î»ÎµÏ…ÏƒÎ¯Î½Î±</option><option>Î—ÏÎ¬ÎºÎ»ÎµÎ¹Î¿</option>
                <option>Î˜ÎµÏƒÏƒÎ±Î»Î¿Î½Î¯ÎºÎ·</option><option>Î™Ï‰Î¬Î½Î½Î¹Î½Î±</option><option>ÎšÎ±Î²Î¬Î»Î±</option>
                <option>ÎšÎ±Î»Î±Î¼Î¬Ï„Î±</option><option>ÎšÎ±Ï„ÎµÏÎ¯Î½Î·</option><option>ÎšÎ­ÏÎºÏ…ÏÎ±</option>
                <option>ÎšÎ¿Î¶Î¬Î½Î·</option><option>ÎšÎ¿Î¼Î¿Ï„Î·Î½Î®</option><option>ÎšÏŒÏÎ¹Î½Î¸Î¿Ï‚</option>
                <option>Î›Î±Î¼Î¯Î±</option><option>Î›Î¬ÏÎ¹ÏƒÎ±</option><option>ÎœÏ…Ï„Î¹Î»Î®Î½Î·</option>
                <option>ÎÎ±ÏÏ€Î»Î¹Î¿</option><option>ÎÎ¬Î½Î¸Î·</option><option>Î Î¬Ï„ÏÎ±</option>
                <option>Î ÏÏÎ³Î¿Ï‚</option><option>Î¡Î­Î¸Ï…Î¼Î½Î¿</option><option>Î¡ÏŒÎ´Î¿Ï‚</option>
                <option>Î£Î­ÏÏÎµÏ‚</option><option>Î¤ÏÎ¯ÎºÎ±Î»Î±</option><option>Î§Î±Î»ÎºÎ¯Î´Î±</option>
                <option>Î§Î±Î½Î¹Î¬</option>
              </select>
            </div>

            <!-- GDPR + Submit -->
            <div class="rounded-2xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4">
              <label class="inline-flex items-start gap-3">
                <input id="gdpr-checkbox" type="checkbox" required class="mt-0.5 size-5 accent-brand-600">
                <span class="text-sm"><span id="t-accept">Î‘Ï€Î¿Î´Î­Ï‡Î¿Î¼Î±Î¹ Ï„Î¿Ï…Ï‚</span> <button type="button" id="gdpr-open" class="underline text-brand-700">ÎŒÏÎ¿Ï…Ï‚ Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚ & GDPR</button>.</span>
              </label>
              <div class="mt-4 flex justify-end">
                <button id="submitBtn" class="px-5 py-3 rounded-2xl bg-gradient-to-r from-brand-500 to-brand-600 text-white font-semibold shadow-soft hover:opacity-95 focus:outline-none focus:ring-2 focus:ring-brand-300">
                  <span id="t-submit">Î¥Ï€Î¿Î²Î¿Î»Î® Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚</span>
                </button>
              </div>
            </div>

            <!-- Sticky Pending (hidden initially) -->
            <section id="pending" class="hidden sticky top-2 z-30">
              <div class="rounded-xl px-4 py-3 border border-amber-300/70 bg-amber-50 text-amber-900 dark:bg-amber-900/30 dark:text-amber-50 flex items-center gap-3 shadow">
                <span class="spin-hourglass" aria-hidden="true">â³</span>
                <p id="t-pending" class="text-sm">Î ÎµÏÎ¹Î¼Î­Î½Î¿Ï…Î¼Îµ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ Ï„Î± ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±â€¦</p>
              </div>
            </section>

            <!-- Results -->
            <section id="results" class="hidden">
              <h2 class="text-xl font-bold mb-3" id="t-results">Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±</h2>

              <!-- Skeletons -->
              <div id="skeletons" class="grid gap-3">
                <div class="rounded-xl p-4 border bg-white/70 dark:bg-slate-800/60 animate-pulse">
                  <div class="h-4 w-40 bg-slate-200 dark:bg-slate-700 rounded mb-2"></div>
                  <div class="h-3 w-24 bg-slate-200 dark:bg-slate-700 rounded"></div>
                </div>
                <div class="rounded-xl p-4 border bg-white/70 dark:bg-slate-800/60 animate-pulse">
                  <div class="h-4 w-44 bg-slate-200 dark:bg-slate-700 rounded mb-2"></div>
                  <div class="h-3 w-20 bg-slate-200 dark:bg-slate-700 rounded"></div>
                </div>
              </div>

              <div class="grid gap-3 mt-0" id="resultsList"></div>

              <button id="newSearch" class="mt-4 px-4 py-2 rounded-xl border hover:bg-slate-100 dark:hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-brand-300"><span id="t-newSearch">ÎÎ­Î± Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·</span></button>
            </section>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- HOW modal -->
  <div id="modal-how" class="fixed inset-0 hidden items-center justify-center bg-black/40 p-4 z-40">
    <div class="w-full max-w-2xl rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 shadow-soft">
      <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200 dark:border-slate-800">
        <h3 class="text-lg font-bold" id="t-howTitle">Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï„Î¿ MediRadar</h3>
        <button id="how-close" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl">âœ•</button>
      </div>
      <div id="how-body" class="p-5 leading-relaxed text-slate-700 dark:text-slate-300"></div>
      <div class="px-5 pb-5 flex justify-end">
        <button id="how-ok" class="px-4 py-2 rounded-xl bg-brand-600 text-white font-semibold hover:opacity-95 focus:outline-none focus:ring-2 focus:ring-brand-300"><span id="t-continue">Î£Ï…Î½Î­Ï‡ÎµÎ¹Î±</span></button>
      </div>
    </div>
  </div>

  <!-- GDPR modal -->
  <div id="gdpr-modal" class="fixed inset-0 hidden items-center justify-center bg-black/40 p-4 z-40">
    <div class="w-full max-w-3xl rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 shadow-soft">
      <div class="flex items-center justify-between px-5 py-4 border-b">
        <h3 class="text-lg font-bold" id="t-gdprTitle">Î Î¿Î»Î¹Ï„Î¹ÎºÎ® Î ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚ Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ & ÎŒÏÎ¿Î¹ Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚</h3>
        <button id="gdpr-close" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl">âœ•</button>
      </div>
      <div id="gdpr-body" class="p-5 text-sm text-slate-700 dark:text-slate-300 space-y-3" style="max-height:62vh; overflow:auto"></div>
      <div class="px-5 pb-5 flex justify-end">
        <button id="gdpr-ok" class="px-4 py-2 rounded-xl bg-brand-600 text-white font-semibold hover:opacity-95 focus:outline-none focus:ring-2 focus:ring-brand-300">OK</button>
      </div>
    </div>
  </div>

  <!-- Pharmacy details modal -->
  <div id="pharm-modal" class="fixed inset-0 hidden items-center justify-center bg-black/40 p-4 z-40">
    <div class="w-full max-w-lg rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 shadow-soft">
      <div class="flex items-center justify-between px-5 py-4 border-b">
        <h3 class="text-lg font-bold" id="pm-title">Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿</h3>
        <button id="pm-close" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl">âœ•</button>
      </div>
      <div class="p-5 space-y-2 text-sm">
        <div id="pm-address">Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·:</div>
        <div id="pm-phone">Î¤Î·Î»Î­Ï†Ï‰Î½Î¿:</div>
        <div id="pm-hours" class="text-slate-600 dark:text-slate-400"></div>
      </div>
      <div class="px-5 pb-5 flex gap-2 justify-end">
        <a id="pm-call" class="px-4 py-2 rounded-xl bg-emerald-600 text-white font-semibold hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-300">ÎšÎ»Î®ÏƒÎ·</a>
        <a id="pm-maps" target="_blank" rel="noopener" class="px-4 py-2 rounded-xl bg-indigo-600 text-white font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-300">Î†Î½Î¿Î¹Î³Î¼Î± ÏƒÎµ Î§Î¬ÏÏ„ÎµÏ‚</a>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 hidden px-4 py-3 rounded-xl bg-slate-900 text-white text-sm shadow-xl z-50" aria-live="polite"></div>

  <!-- Confetti canvas -->
  <canvas id="confetti" class="fixed inset-0 pointer-events-none z-50" style="display:none"></canvas>

  <script>
    /* ---------- Theme ---------- */
    const html = document.documentElement;
    const themeBtn = document.getElementById('theme-toggle');
    const iconSun = document.getElementById('icon-sun');
    const iconMoon = document.getElementById('icon-moon');
    function setTheme(mode){
      const dark = mode==='dark';
      html.classList.toggle('dark', dark);
      iconSun.classList.toggle('hidden', !dark);
      iconMoon.classList.toggle('hidden', dark);
      localStorage.setItem('mediradar-theme', dark?'dark':'light');
    }
    setTheme(localStorage.getItem('mediradar-theme') || (matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light'));
    themeBtn.addEventListener('click',()=> setTheme(html.classList.contains('dark')?'light':'dark'));

    /* ---------- i18n ---------- */
    const strings = {
      el:{
        hero:'Î†Î¼ÎµÏƒÎ· ÎµÏÏÎµÏƒÎ· Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚ Ï†Î±ÏÎ¼Î¬ÎºÏ‰Î½ ÏƒÎµ ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±.',
        searchBTN:'Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…', howBTN:'Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯', signinBTN:'Î£ÏÎ½Î´ÎµÏƒÎ·', installBTN:'Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·',
        searchTitle:'Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…', home:'Î‘ÏÏ‡Î¹ÎºÎ®', medname:'ÎŒÎ½Î¿Î¼Î± Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…',
        formatTip:'Î£Ï…Î¼Î²Î¿Ï…Î»Î®: Î•Î¼Ï€Î¿ÏÎ¹ÎºÎ® Î¿Î½Î¿Î¼Î±ÏƒÎ¯Î± + Î´Î¿ÏƒÎ¿Î»Î¿Î³Î¯Î± (Ï€.Ï‡. â€œ500mgâ€).',
        substance:'Î”ÏÎ±ÏƒÏ„Î¹ÎºÎ® ÎŸÏ…ÏƒÎ¯Î±', optional:'(Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬)', doseEx:'Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î´Î¿ÏƒÎ¿Î»Î¿Î³Î¯Î±Ï‚: Paracetamol 500mg.',
        type:'Î¤ÏÏ€Î¿Ï‚ Î¦Î±ÏÎ¼Î¬ÎºÎ¿Ï…', qty:'Î Î¿ÏƒÏŒÏ„Î·Ï„Î± (Ï„ÎµÎ¼Î¬Ï‡Î¹Î±/ÎºÎ¿Ï…Ï„Î¹Î¬)', select:'Î•Ï€Î¹Î»Î¿Î³Î®',
        genericQ:'Î‘Î½ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Ï„Î¿ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ ÎµÎ¼Ï€Î¿ÏÎ¹ÎºÏŒ, ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹Ï‚ Î½Î± ÏƒÎ¿Ï… Ï€ÏÎ¿Ï„ÎµÎ¯Î½Î¿Ï…Î¼Îµ Î¹ÏƒÎ¿Î´ÏÎ½Î±Î¼Î¿ (Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿);',
        yes:'ÎÎ‘Î™', no:'ÎŸÎ§Î™', city:'Î ÏŒÎ»Î·', accept:'Î‘Ï€Î¿Î´Î­Ï‡Î¿Î¼Î±Î¹ Ï„Î¿Ï…Ï‚', submit:'Î¥Ï€Î¿Î²Î¿Î»Î® Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·Ï‚',
        results:'Î‘Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î±', newSearch:'ÎÎ­Î± Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ·', pro:'Î“Î¹Î± ÎµÏ€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¯ÎµÏ‚',
        howTitle:'Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï„Î¿ MediRadar', continue:'Î£Ï…Î½Î­Ï‡ÎµÎ¹Î±',
        pending:'Î ÎµÏÎ¹Î¼Î­Î½Î¿Ï…Î¼Îµ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ Ï„Î± ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±â€¦',
        gdprHTML:`<p><strong>Î¥Ï€ÎµÏÎ¸Ï…Î½Î¿Ï‚ Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚:</strong> MediRadar (ÏƒÏ…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î±).</p>
          <p><strong>Î£ÎºÎ¿Ï€ÏŒÏ‚:</strong> Î”Î¹Î±Î²Î¯Î²Î±ÏƒÎ· Î±Î¹Ï„Î·Î¼Î¬Ï„Ï‰Î½ Î³Î¹Î± ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ Ï€ÎµÏÎ¯ Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚.</p>
          <p><strong>ÎÎ¿Î¼Î¹ÎºÎ­Ï‚ Î²Î¬ÏƒÎµÎ¹Ï‚:</strong> GDPR 6(1)(b) ÎºÎ±Î¹ 6(1)(a) Î³Î¹Î± Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬.</p>
          <p><strong>Î”ÎµÎ´Î¿Î¼Î­Î½Î±:</strong> Î¿Î½Î¿Î¼Î±ÏƒÎ¯Î±, Î´ÏÎ±ÏƒÏ„Î¹ÎºÎ® (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬), Ï„ÏÏ€Î¿Ï‚, Ï€Î¿ÏƒÏŒÏ„Î·Ï„Î±, Ï€ÏŒÎ»Î·, ÎµÏ€Î¹Î»Î¿Î³Î® Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿Ï….</p>
          <p><strong>Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎ·:</strong> Î­Ï‰Ï‚ 30 Î·Î¼Î­ÏÎµÏ‚, ÎºÎ±Ï„ÏŒÏ€Î¹Î½ Î±Î½Ï‰Î½Ï…Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎ·/Î´Î¹Î±Î³ÏÎ±Ï†Î®.</p>
          <p><strong>Î”Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±:</strong> Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·, Î´Î¹ÏŒÏÎ¸Ï‰ÏƒÎ·, Î´Î¹Î±Î³ÏÎ±Ï†Î®, Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚, ÎµÎ½Î±Î½Ï„Î¯Ï‰ÏƒÎ·, Ï†Î¿ÏÎ·Ï„ÏŒÏ„Î·Ï„Î±.</p>`
      },
      en:{
        hero:'Instant availability check at nearby pharmacies.',
        searchBTN:'Medicine Search', howBTN:'How it works', signinBTN:'Sign in', installBTN:'Install',
        searchTitle:'Medicine Search', home:'Home', medname:'Medicine Name',
        formatTip:'Tip: Brand name + dosage (e.g. â€œ500mgâ€).',
        substance:'Active Substance', optional:'(optional)', doseEx:'Dosage example: Paracetamol 500mg.',
        type:'Medicine Type', qty:'Quantity (units/boxes)', select:'Select',
        genericQ:'If the specific brand is unavailable, may we suggest an equivalent (generic)?',
        yes:'YES', no:'NO', city:'City', accept:'I accept the', submit:'Submit Search',
        results:'Results', newSearch:'New search', pro:'For professionals',
        howTitle:'How MediRadar works', continue:'Continue',
        pending:'Waiting for responses from nearby pharmaciesâ€¦',
        gdprHTML:`<p><strong>Controller:</strong> MediRadar (fill in details).</p>
          <p><strong>Purpose:</strong> Forwarding requests to inform about availability only.</p>
          <p><strong>Legal bases:</strong> GDPR 6(1)(b) and 6(1)(a) for optional data.</p>
          <p><strong>Data:</strong> name, substance (optional), type, quantity, city, generic preference.</p>
          <p><strong>Retention:</strong> up to 30 days, then anonymization/deletion.</p>
          <p><strong>Rights:</strong> access, rectification, erasure, restriction, objection, portability.</p>`
      }
    };
    const state = { lang: localStorage.getItem('mediradar-lang') || 'el' };
    function t(k){ return strings[state.lang][k]; }
    function setText(id, txt){ const el=document.getElementById(id); if(el) el.textContent=txt; }
    function setHTML(id, html){ const el=document.getElementById(id); if(el) el.innerHTML=html; }
    function applyLang(){
      document.documentElement.lang = state.lang;
      setText('t-hero', t('hero'));
      setText('t-searchBTN', t('searchBTN')); setText('t-howBTN', t('howBTN')); setText('t-signinBTN', t('signinBTN')); setText('t-installBTN', t('installBTN'));
      setText('t-searchTitle', t('searchTitle')); setText('t-home', t('home'));
      setText('t-medname', t('medname')); setText('t-formatTip', t('formatTip'));
      setText('t-substance', t('substance')); setText('t-optional', t('optional')); setText('t-doseEx', t('doseEx'));
      setText('t-type', t('type')); setText('t-qty', t('qty'));
      setText('t-genericQ', t('genericQ')); setText('t-yes', t('yes')); setText('t-no', t('no'));
      setText('t-city', t('city')); setText('t-accept', t('accept')); setText('t-submit', t('submit'));
      setText('t-results', t('results')); setText('t-newSearch', t('newSearch')); setText('t-pending', t('pending'));
      setText('t-howTitle', t('howTitle')); setText('t-continue', t('continue'));
      setHTML('gdpr-body', t('gdprHTML'));
      document.getElementById('medicine-name').placeholder = state.lang==='el'?'Ï€.Ï‡. Augmentin 875mg':'e.g. Augmentin 875mg';
      document.getElementById('active-substance').placeholder = state.lang==='el'?'Ï€.Ï‡. Paracetamol':'e.g. Paracetamol';
      localStorage.setItem('mediradar-lang', state.lang);
    }
    document.getElementById('lang-el').addEventListener('click', ()=>{ state.lang='el'; applyLang(); });
    document.getElementById('lang-en').addEventListener('click', ()=>{ state.lang='en'; applyLang(); });

    /* ---------- Navigation ---------- */
    const splash = document.getElementById('splash');
    const searchModal = document.getElementById('searchModal');
    const linkPro = document.getElementById('link-pro');

    function openSearch(){
      splash.classList.add('hidden');
      searchModal.classList.remove('hidden');
      linkPro.classList.add('hidden'); // ÎºÏÏÎ²Î¿Ï…Î¼Îµ â€œÎ“Î¹Î± ÎµÏ€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¯ÎµÏ‚â€ Î¼Î­ÏƒÎ± ÏƒÏ„Î· Ï†ÏŒÏÎ¼Î±
      window.scrollTo({ top: 0, behavior:'smooth' });
    }
    function backToHome(){
      searchModal.classList.add('hidden');
      splash.classList.remove('hidden');
      linkPro.classList.remove('hidden');
      // ÎºÎ±Î¸Î¬ÏÎ¹ÏƒÎµ Î¼ÏŒÎ½Î¿ Î¿Î¸ÏŒÎ½Î· Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î¬Ï„Ï‰Î½/ÎºÎ»ÎµÏˆÏÎ´ÏÎ±Ï‚
      document.getElementById('pending').classList.add('hidden');
      document.getElementById('results').classList.add('hidden');
    }

    document.getElementById('cta-search').addEventListener('click', openSearch);
    document.getElementById('closeSearch').addEventListener('click', backToHome);
    document.getElementById('backHome').addEventListener('click', (e)=>{ e.preventDefault(); backToHome(); });

    // How modal
    const modalHow = document.getElementById('modal-how');
    document.getElementById('cta-how').onclick = ()=> { 
      modalHow.classList.remove('hidden'); modalHow.classList.add('flex'); 
      const body = state.lang==='el' ? `<ol class="list-decimal pl-5 space-y-2">
          <li>Î Î»Î·ÎºÏ„ÏÎ¿Î»ÏŒÎ³Î·ÏƒÎµ Ï„Î¹ ÏˆÎ¬Ï‡Î½ÎµÎ¹Ï‚ (ÎµÎ¼Ï€Î¿ÏÎ¹ÎºÎ® Î¿Î½Î¿Î¼Î±ÏƒÎ¯Î± Î®/ÎºÎ±Î¹ Î´ÏÎ±ÏƒÏ„Î¹ÎºÎ® Î¿Ï…ÏƒÎ¯Î±).</li>
          <li>Î— Î±Î¯Ï„Î·ÏƒÎ· ÏƒÏ„Î­Î»Î½ÎµÏ„Î±Î¹ ÏƒÏ„Î± ÎºÎ¿Î½Ï„Î¹Î½Î¬ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±.</li>
          <li>ÎŒÏ€Î¿Î¹Î¿ Î­Ï‡ÎµÎ¹ <strong>Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±</strong> Î±Ï€Î±Î½Ï„Î¬ Î¸ÎµÏ„Î¹ÎºÎ¬Â· Î±Î½ Î­Ï‡ÎµÎ¹ Î¼ÏŒÎ½Î¿ Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿, Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ Î¼Îµ ÎµÎ¹Î´Î¹ÎºÏŒ ÏƒÎ®Î¼Î±.</li>
          <li>Î•Ï€Î¹Î»Î­Î³ÎµÎ¹Ï‚ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ ÎºÎ±Î¹ Ï€Î±Ï‚ Î³Î¹Î± <strong>self pick-up</strong>.</li>
          <li>Î”ÎµÎ½ ÏƒÏ…Î»Î»Î­Î³Î¿Ï…Î¼Îµ Ï„Î¹Î¼Î­Ï‚Â· Î¼ÏŒÎ½Î¿ Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±.</li></ol>`
        : `<ol class="list-decimal pl-5 space-y-2">
          <li>Type what you need (brand / active).</li>
          <li>Your request goes to nearby pharmacies.</li>
          <li>Those with <strong>availability</strong> reply â€œAvailableâ€; generics show with a badge.</li>
          <li>Pick a pharmacy and go for <strong>self pick-up</strong>.</li>
          <li>No pricesâ€”availability only.</li></ol>`;
      document.getElementById('how-body').innerHTML = body;
    };
    document.getElementById('how-close').onclick = ()=> modalHow.classList.add('hidden');
    document.getElementById('how-ok').onclick    = ()=> modalHow.classList.add('hidden');

    // GDPR modal
    const modalGdpr = document.getElementById('gdpr-modal');
    document.getElementById('gdpr-open').onclick = ()=> { modalGdpr.classList.remove('hidden'); modalGdpr.classList.add('flex'); };
    document.getElementById('gdpr-close').onclick= ()=> modalGdpr.classList.add('hidden');
    document.getElementById('gdpr-ok').onclick   = ()=> modalGdpr.classList.add('hidden');

    /* ---------- Toast ---------- */
    const toast = document.getElementById('toast');
    function showToast(msg){
      toast.textContent = msg;
      toast.classList.remove('hidden');
      setTimeout(()=> toast.classList.add('hidden'), 2400);
    }

    /* ---------- Autocomplete (demo) ---------- */
    const AC_MEDICINES = ['Augmentin 875mg/125mg','Depon 500mg','Panadol 500mg','Nurofen 400mg','Algofren 400mg','Zylapour 300mg','Salospir 100mg','Plavix 75mg','Zyrtec 10mg','Vibramycin 100mg'];
    const AC_SUBSTANCES = ['Paracetamol 500mg','Ibuprofen 400mg','Amoxicillin 500mg','Amoxicillin/Clavulanate 875/125mg','Cetirizine 10mg','Aspirin 100mg'];
    function attachAutocomplete(inputId, listId, data){
      const input = document.getElementById(inputId);
      const list = document.getElementById(listId);
      let idx = -1;
      function render(items){
        list.innerHTML = items.map((x,i)=>`<div class="ac-item px-3 py-2 text-sm hover:bg-brand-50 dark:hover:bg-slate-800 ${i===idx?'bg-brand-50 dark:bg-slate-800':''}" data-val="${x}">${x}</div>`).join('');
        list.classList.toggle('hidden', items.length===0);
      }
      function filter(q){ if(!q){ render([]); return; } render(data.filter(s=>s.toLowerCase().includes(q.toLowerCase())).slice(0,6)); }
      input.addEventListener('input', ()=>{ idx=-1; filter(input.value.trim()); });
      input.addEventListener('keydown', (e)=>{
        const items = [...list.querySelectorAll('.ac-item')]; if(!items.length) return;
        if(e.key==='ArrowDown'){ idx=(idx+1)%items.length; render(items.map(n=>n.dataset.val)); e.preventDefault(); }
        else if(e.key==='ArrowUp'){ idx=(idx-1+items.length)%items.length; render(items.map(n=>n.dataset.val)); e.preventDefault(); }
        else if(e.key==='Enter'){ if(idx>=0){ input.value = items[idx].dataset.val; render([]); } }
        else if(e.key==='Escape'){ render([]); }
      });
      list.addEventListener('click', (e)=>{ const item = e.target.closest('.ac-item'); if(!item) return; input.value = item.dataset.val; list.classList.add('hidden'); });
      document.addEventListener('click', (e)=>{ if(!list.contains(e.target) && e.target!==input){ list.classList.add('hidden'); }});
    }
    attachAutocomplete('medicine-name','ac-medicine',AC_MEDICINES);
    attachAutocomplete('active-substance','ac-substance',AC_SUBSTANCES);

    /* ---------- Submit: Pending -> Results ---------- */
    const pending = document.getElementById('pending');
    const results = document.getElementById('results');
    const skeletons = document.getElementById('skeletons');
    const list = document.getElementById('resultsList');

    function showPending(){ document.getElementById('t-pending').textContent = t('pending'); pending.classList.remove('hidden'); }
    function hidePending(){ pending.classList.add('hidden'); }

    // Confetti mini engine
    const confettiCanvas = document.getElementById('confetti');
    const ctx = confettiCanvas.getContext('2d');
    function fireConfetti(duration=3500){
      confettiCanvas.width = innerWidth; confettiCanvas.height = innerHeight;
      confettiCanvas.style.display = 'block';
      const particles = Array.from({length: 160}, ()=> ({
        x: Math.random()*innerWidth, y: -20,
        vx: (Math.random()-.5)*2, vy: Math.random()*3+2,
        size: Math.random()*6+3,
        color: ['#F78DA7','#84C5F4','#C3A6F4','#FFE08A','#9DE0D6'][Math.floor(Math.random()*5)],
        rot: Math.random()*360, vr:(Math.random()-.5)*10
      }));
      let start = performance.now();
      function tick(ts){
        const elapsed = ts - start;
        ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
        particles.forEach(p=>{
          p.x += p.vx; p.y += p.vy; p.vy += 0.05; p.rot += p.vr;
          ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot*Math.PI/180);
          ctx.fillStyle = p.color; ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
          ctx.restore();
        });
        if(elapsed < duration){ requestAnimationFrame(tick); } else { confettiCanvas.style.display='none'; }
      }
      requestAnimationFrame(tick);
    }

    document.getElementById('submitBtn').addEventListener('click', (e)=>{
      e.preventDefault();
      // basic validation
      if(!document.getElementById('gdpr-checkbox').checked){ showToast(state.lang==='el'?'Î Î±ÏÎ±ÎºÎ±Î»Ï Î±Ï€Î¿Î´Î­Î¾Î¿Ï… Ï„Î¿Ï…Ï‚ ÏŒÏÎ¿Ï…Ï‚.':'Please accept the terms.'); return; }
      if(!document.getElementById('medicine-name').value.trim()){ showToast(state.lang==='el'?'Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ ÏŒÎ½Î¿Î¼Î± Ï†Î±ÏÎ¼Î¬ÎºÎ¿Ï….':'Enter medicine name.'); return; }
      if(!document.getElementById('medicine-type').value){ showToast(state.lang==='el'?'Î•Ï€Î¯Î»ÎµÎ¾Îµ Ï„ÏÏ€Î¿ Ï†Î±ÏÎ¼Î¬ÎºÎ¿Ï….':'Choose medicine type.'); return; }
      if(!document.getElementById('city').value){ showToast(state.lang==='el'?'Î•Ï€Î¯Î»ÎµÎ¾Îµ Ï€ÏŒÎ»Î·.':'Choose a city.'); return; }

      showPending();
      results.classList.remove('hidden');
      skeletons.classList.remove('hidden');
      list.innerHTML = '';
      fireConfetti(3500); // 3.5s

      // simulate network + pharmacy answers
      setTimeout(()=>{
        skeletons.classList.add('hidden');
        // render results (no countdown yet; Î¸Î± Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÎ¹ Î±Ï†Î¿Ï ÎµÏ€Î¹Î»Î­Î¾ÎµÎ¹ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿)
        const allowGeneric = (document.querySelector('input[name="allow-generic"]:checked')?.value==='YES');
        const items = [
          { name:'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ Î™Î¬ÎºÏ‰Î²Î¿Ï‚', dist:'2.1km', generic: allowGeneric, addr:'Î™Ï€Ï€Î¿ÎºÏÎ¬Ï„Î¿Ï…Ï‚ 12, Î‘Î¸Î®Î½Î±', tel:'+30 210 1234567', lat:37.984, lng:23.735, open:'ğŸ•’ ÎšÎ»ÎµÎ¯Î½ÎµÎ¹ ÏƒÏ„Î¹Ï‚ 17:00' },
          { name:'Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ ÎÎ¯ÎºÎ·', dist:'3.0km', generic:false, addr:'Î£ÏŒÎ»Ï‰Î½Î¿Ï‚ 90, Î‘Î¸Î®Î½Î±', tel:'+30 210 7654321', lat:37.983, lng:23.732, open:'ğŸ”´ ÎšÎ»ÎµÎ¹ÏƒÏ„ÏŒ Ï„ÏÏÎ±' }
        ];
        items.forEach(it=>{
          const card = document.createElement('div');
          card.className = 'rounded-xl bg-white/90 dark:bg-slate-900/60 backdrop-blur border border-slate-200 dark:border-slate-800 p-4 flex items-center justify-between';
          card.innerHTML = `
            <div>
              <div class="font-semibold">${it.name}</div>
              <div class="text-xs text-slate-600 dark:text-slate-400">${it.dist} Â· ${it.open}</div>
            </div>
            <div class="flex items-center gap-2">
              ${it.generic ? `<span class="badge bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-200">ğŸ§¬ Î“ÎµÎ½ÏŒÏƒÎ·Î¼Î¿</span>` : ''}
              <button class="px-3 py-2 rounded-lg border hover:bg-slate-100 dark:hover:bg-slate-800 text-sm pharm-details">Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚</button>
              <a class="px-3 py-2 rounded-lg bg-indigo-600 text-white text-sm hover:bg-indigo-700 open-maps">Maps</a>
            </div>`;
          card.dataset.addr = it.addr;
          card.dataset.tel = it.tel;
          card.dataset.name = it.name;
          card.dataset.lat = it.lat;
          card.dataset.lng = it.lng;
          list.appendChild(card);
        });
        window.scrollTo({ top: 0, behavior:'smooth' });
      }, 1200);
    });

    document.getElementById('newSearch').addEventListener('click', ()=>{
      results.classList.add('hidden'); hidePending();
      document.getElementById('medicine-name').focus();
    });

    // Details + Maps
    const pm = document.getElementById('pharm-modal');
    const pmTitle = document.getElementById('pm-title');
    const pmAddr  = document.getElementById('pm-address');
    const pmPhone = document.getElementById('pm-phone');
    const pmHours = document.getElementById('pm-hours');
    const pmCall  = document.getElementById('pm-call');
    const pmMaps  = document.getElementById('pm-maps');
    document.getElementById('pm-close').onclick = ()=> pm.classList.add('hidden');

    document.getElementById('resultsList').addEventListener('click', (e)=>{
      const card = e.target.closest('.rounded-xl'); if(!card) return;
      if(e.target.classList.contains('pharm-details')){
        const name = card.dataset.name, addr = card.dataset.addr, tel = card.dataset.tel;
        pmTitle.textContent = name;
        pmAddr.textContent  = 'Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·: ' + addr;
        pmPhone.textContent = 'Î¤Î·Î»Î­Ï†Ï‰Î½Î¿: ' + tel;
        pmHours.textContent = 'Î©ÏÎ¬ÏÎ¹Î¿: Î´ÎµÎ¯Î³Î¼Î± (Î¿ÏÎ¹ÏƒÏ„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· ÏƒÏ„Î¿ portal Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Ï‰Î½)';
        pmCall.href = `tel:${tel.replace(/\s+/g,'')}`;
        pmMaps.href = `https://www.google.com/maps?q=${encodeURIComponent(addr)}`;
        pm.classList.remove('hidden'); pm.classList.add('flex');
      }
      if(e.target.classList.contains('open-maps')){
        const addr = card.dataset.addr;
        e.target.setAttribute('href', `https://www.google.com/maps?q=${encodeURIComponent(addr)}`);
      }
    });

    /* ---------- PWA: SW + install prompt ---------- */
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('/service-worker.js').catch(()=>{});
    }
    let deferredPrompt=null;
    const installBtn = document.getElementById('cta-install');
    window.addEventListener('beforeinstallprompt', (e)=>{
      e.preventDefault(); deferredPrompt = e; installBtn.classList.remove('hidden');
    });
    installBtn.addEventListener('click', async ()=>{
      if(!deferredPrompt) return;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt=null; installBtn.classList.add('hidden');
    });
    window.addEventListener('appinstalled', ()=>{ installBtn.classList.add('hidden'); });

    /* ---------- Init ---------- */
    applyLang();
  </script>
</body>
</html>
