<!DOCTYPE html>
<html lang="el" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="description" content="MediRadar - Î’ÏÎµÎ¯Ï„Îµ Ï†Î¬ÏÎ¼Î±ÎºÎ± Î¬Î¼ÎµÏƒÎ± ÎºÎ±Î¹ Ï„Î¿Ï€Î¹ÎºÎ¬.">
    <meta name="theme-color" content="#0d9488">
    <title>MediRadar App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { fontFamily: { sans: ['Inter', 'sans-serif'] }, colors: { primary: '#0d9488', secondary: '#0f172a' }, animation: { 'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite', 'fade-in': 'fadeIn 0.3s ease-out forwards', 'slide-up': 'slideUp 0.3s ease-out forwards' }, keyframes: { fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } }, slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } } } } } }
    </script>

    <style>
        /* iOS Fixes */
        html, body { width: 100%; height: 100%; margin: 0; padding: 0; overflow-x: hidden; -webkit-tap-highlight-color: transparent; } 
        body { overscroll-behavior-y: none; display: flex; flex-direction: column; min-height: 100dvh; padding-bottom: env(safe-area-inset-bottom); }
        
        .emoji-bg { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; overflow: hidden; z-index: -1; pointer-events: none; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); } html.dark .emoji-bg { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
        .emoji { position: absolute; bottom: -100px; font-size: 2rem; opacity: 0.4; animation: floatUp 15s linear infinite; z-index: -1; } @keyframes floatUp { 0% { transform: translateY(0) rotate(0deg); opacity: 0; } 10% { opacity: 0.5; } 90% { opacity: 0.5; } 100% { transform: translateY(-110vh) rotate(360deg); opacity: 0; } }
        
        /* Glassmorphism with iOS support */
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.8); box-shadow: 0 10px 40px -10px rgba(0,0,0,0.1); position: relative; z-index: 10; transition: all 0.3s ease; } html.dark .glass-card { background: rgba(30, 41, 59, 0.95); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 10px 40px -10px rgba(0,0,0,0.3); }
        
        .tab-content { display: none; animation: fadeIn 0.3s ease-out; } .tab-content.active { display: block; }
        #drug-suggestions, #city-suggestions { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #e2e8f0; border-radius: 0.75rem; max-height: 200px; overflow-y: auto; z-index: 50; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); display: none; margin-top: 4px; } html.dark #drug-suggestions, html.dark #city-suggestions { background: #1e293b; border-color: #334155; }
        .suggestion-item { padding: 0.75rem 1rem; cursor: pointer; font-size: 0.875rem; border-bottom: 1px solid #f1f5f9; } html.dark .suggestion-item { border-color: #334155; color: #e2e8f0; } .suggestion-item:hover { background-color: #f0f9ff; } html.dark .suggestion-item:hover { background-color: #334155; }
        
        /* Modal Fixes for iOS Z-Index */
        .modal-backdrop { display: none; position: fixed; inset: 0; z-index: 9999; background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px); align-items: center; justify-content: center; padding: 1rem; } 
        .modal-backdrop.active { display: flex; animation: fadeIn 0.2s ease-out; }
        .modal-content { width: 100%; max-width: 400px; border-radius: 1.5rem; padding: 2rem; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); transform: scale(0.95); opacity: 0; position: relative; z-index: 10000; max-height: 85vh; overflow-y: auto; } 
        .modal-backdrop.active .modal-content { animation: slideUp 0.3s ease-out forwards; }
        
        *:focus-visible { outline: 2px solid #0d9488; outline-offset: 2px; }
        .item-badge { animation: fadeIn 0.3s ease-out; }
        /* iOS Click Fix */
        button, .cursor-pointer { cursor: pointer; touch-action: manipulation; }
    </style>
</head>
<body class="text-slate-800 dark:text-slate-100 antialiased relative">

    <div id="emoji-container" class="emoji-bg" aria-hidden="true"></div>

    <nav class="w-full max-w-lg mx-auto p-4 flex justify-between items-center z-20 relative pt-safe" aria-label="ÎšÏÏÎ¹Î± Ï€Î»Î¿Î®Î³Î·ÏƒÎ·">
        <div class="flex gap-2" id="user-nav-container">
            <button onclick="openModal('user')" class="bg-white/90 dark:bg-slate-800/90 px-3 py-2 rounded-xl text-xs font-bold text-primary border border-primary/20 shadow-sm hover:shadow-md transition-all flex items-center gap-1 active:scale-95">
                <i class="ph ph-user text-lg"></i> Î•Î¯ÏƒÎ¿Î´Î¿Ï‚
            </button>
        </div>
        <div class="flex gap-2">
            <button onclick="toggleLang()" class="bg-white/60 dark:bg-slate-700/60 w-10 h-10 rounded-full flex items-center justify-center text-xl shadow-sm hover:scale-110 transition-transform border border-white/50 active:scale-95"><span id="lang-flag">ğŸ‡¬ğŸ‡·</span></button>
            <button onclick="toggleTheme()" class="bg-white/60 dark:bg-slate-700/60 w-10 h-10 rounded-full flex items-center justify-center text-xl shadow-sm transition-transform border border-white/50 hover:scale-110 active:scale-95"><i id="theme-icon" class="ph ph-moon-stars"></i></button>
        </div>
    </nav>

    <main id="main-content" class="w-full max-w-lg mx-auto p-4 pb-6 flex-grow z-10 relative">
        <header class="text-center mb-6">
            <div class="inline-flex items-center justify-center bg-white/70 dark:bg-slate-700/70 p-4 rounded-2xl mb-3 shadow-sm backdrop-blur-sm border border-white/50"><i class="ph ph-magnifying-glass text-4xl text-primary"></i></div>
            <h1 class="text-3xl font-bold text-primary bg-clip-text text-transparent bg-gradient-to-r from-teal-600 to-cyan-500 drop-shadow-sm">MediRadar</h1>
            <p class="text-slate-500 dark:text-slate-400 text-sm mt-1 font-medium" data-lang-key="subtitle">Î’ÏÎµÏ‚ Ï„Î¿ Ï†Î¬ÏÎ¼Î±ÎºÏŒ ÏƒÎ¿Ï… Î¬Î¼ÎµÏƒÎ± & Ï„Î¿Ï€Î¹ÎºÎ¬.</p>
        </header>

        <div class="flex p-1.5 bg-slate-200/80 dark:bg-slate-800/80 rounded-2xl mb-6 glass-card" role="tablist">
            <button onclick="switchTab('search')" id="btn-search" role="tab" class="flex-1 py-3 rounded-xl text-sm font-bold transition-all bg-white dark:bg-slate-700 shadow-sm text-primary dark:text-teal-300 ring-1 ring-black/5" data-lang-key="search_tab">Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·</button>
            <button onclick="switchTab('how')" id="btn-how" role="tab" class="flex-1 py-3 rounded-xl text-sm font-bold text-slate-500 dark:text-slate-400 hover:bg-white/50 dark:hover:bg-slate-700/50 transition-all" data-lang-key="how_tab">Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯</button>
        </div>

        <div id="tab-search" class="tab-content active" role="tabpanel">
            <div class="glass-card rounded-3xl p-6 relative overflow-visible">
                <form id="request-form" class="space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-1"><label class="text-[10px] font-bold text-slate-500 uppercase ml-1">ÎŸÎ½Î¿Î¼Î±Ï„ÎµÏ€Ï‰Î½Ï…Î¼Î¿ <span class="text-red-500">*</span></label><input id="full-name" type="text" placeholder="Ï€.Ï‡. ÎœÎ±ÏÎ¯Î± Î Î±Ï€Î±Î´Î¿Ï€Î¿ÏÎ»Î¿Ï…" oninput="saveUserData()" class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all text-slate-900 dark:text-white font-medium" required></div>
                        <div class="space-y-1 relative"><label class="text-[10px] font-bold text-slate-500 uppercase ml-1">ÎšÎ¹Î½Î·Ï„Î¿ <span class="text-red-500">*</span></label><div class="relative"><input id="phone" type="tel" placeholder="69... Î® +30..." oninput="validatePhoneUI(this)" class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all text-slate-900 dark:text-white font-bold tracking-wider" required><div id="phone-status" class="absolute right-3 top-3 text-lg hidden"></div></div></div>
                    </div>
                    <div class="space-y-1 relative"><label class="text-[10px] font-bold text-slate-500 uppercase ml-1">Î ÎµÏÎ¹Î¿Ï‡Î· <span class="text-red-500">*</span></label><div class="relative"><input id="city" type="text" placeholder="Î ÎµÏÎ¹Î¿Ï‡Î®..." oninput="saveUserData()" class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-xl px-4 py-3 pr-32 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all text-slate-900 dark:text-white font-medium" required><div id="city-suggestions" role="listbox"></div><button type="button" onclick="getLocation()" class="absolute right-2 top-2 bottom-2 px-3 bg-teal-100 dark:bg-teal-900/40 text-teal-800 dark:text-teal-200 border border-teal-200 dark:border-teal-700 rounded-lg text-[10px] font-bold hover:bg-teal-200 transition-colors flex items-center gap-1 shadow-sm active:scale-95"><i class="ph ph-navigation-arrow text-sm"></i> <span data-lang-key="near_me">ÎšÎ¿Î½Ï„Î¬ Î¼Î¿Ï…</span></button></div></div>
                    <div class="border-t-2 border-dashed border-slate-200 dark:border-slate-700 my-2"></div>
                    
                    <div class="bg-slate-50 dark:bg-slate-800/50 p-4 rounded-2xl border-2 border-slate-200 dark:border-slate-700 space-y-4">
                        <div class="flex justify-between items-center mb-1">
                            <label class="text-xs font-bold text-slate-700 dark:text-slate-300 uppercase flex items-center gap-2"><i class="ph ph-list-plus text-primary text-lg"></i> Î›Î¹ÏƒÏ„Î± Î¦Î±ÏÎ¼Î±ÎºÏ‰Î½ <span class="text-red-500">*</span></label>
                            <span class="text-[10px] bg-teal-100 dark:bg-teal-900 text-teal-800 dark:text-teal-200 px-2 py-1 rounded-full font-bold" id="items-count-badge">0 ÎµÎ¯Î´Î·</span>
                        </div>
                        <div id="items-list-display" class="space-y-2 mb-2 empty:hidden max-h-40 overflow-y-auto pr-1"></div>
                        <div class="bg-white dark:bg-slate-900 p-3 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm relative">
                            <div class="relative mb-3">
                                <label class="text-[10px] font-bold text-slate-400 uppercase mb-1 block">ÎŸÎ½Î¿Î¼Î±ÏƒÎ¹Î± Î•Î¹Î´Î¿Ï…Ï‚</label>
                                <input id="medicine" type="text" placeholder="Ï€.Ï‡. Depon" class="w-full bg-slate-100 dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg pl-3 pr-10 py-2 text-sm font-semibold focus:ring-2 focus:ring-primary/50 outline-none dark:text-white" autocomplete="off" enterkeyhint="next">
                                <button type="button" onclick="startVoiceInput()" class="absolute right-1 top-6 w-8 h-8 rounded-full flex items-center justify-center text-slate-400 hover:text-primary transition-colors active:scale-95"><i class="ph ph-microphone text-lg"></i></button>
                                <div id="drug-suggestions" role="listbox"></div>
                            </div>
                            <div class="grid grid-cols-2 gap-3 mb-3">
                                <div><label class="text-[10px] font-bold text-slate-400 uppercase mb-1 block">ÎšÎ±Ï„Î·Î³Î¿ÏÎ¹Î±</label><div class="relative"><select id="med-type" class="w-full bg-slate-100 dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg px-2 py-2 text-sm appearance-none outline-none focus:border-primary cursor-pointer"><option value="pills">ğŸ’Š Î§Î¬Ï€Î¹Î±</option><option value="syrup">ğŸ§´ Î£Î¹ÏÏŒÏ€Î¹</option><option value="cream">ğŸ©¹ Î‘Î»Î¿Î¹Ï†Î®</option><option value="inject">ğŸ’‰ Î•Î½Î­ÏƒÎ¹Î¼Î¿</option><option value="spray">ğŸ’¨ Î£Ï€ÏÎ­Î¹</option><option value="baby">ğŸ¼ Î’ÏÎµÏ†Î¹ÎºÎ¬</option><option value="cosmetic">ğŸ’„ ÎšÎ±Î»Î»Ï…Î½Ï„Î¹ÎºÎ¬</option><option value="device">ğŸ©º Î£Ï…ÏƒÎºÎµÏ…Î­Ï‚</option><option value="other">â“ Î†Î»Î»Î¿</option></select><i class="ph ph-caret-down absolute right-2 top-2.5 text-slate-400 pointer-events-none"></i></div></div>
                                <div><label class="text-[10px] font-bold text-slate-400 uppercase mb-1 block">Î Î¿ÏƒÎ¿Ï„Î·Ï„Î±</label><div class="flex items-center"><button type="button" onclick="adjustQty(-1)" class="bg-slate-200 w-8 h-9 rounded-l-lg text-slate-600 hover:bg-slate-300 font-bold">-</button><input id="quantity" type="number" min="1" value="1" class="w-full bg-slate-100 border-y border-slate-200 h-9 text-center text-sm font-bold outline-none dark:bg-slate-800 dark:border-slate-600"><button type="button" onclick="adjustQty(1)" class="bg-slate-200 w-8 h-9 rounded-r-lg text-slate-600 hover:bg-slate-300 font-bold">+</button></div></div>
                            </div>
                            <button type="button" onclick="addItemToList()" class="w-full bg-teal-600 hover:bg-teal-700 text-white rounded-lg py-2.5 flex items-center justify-center gap-2 font-bold text-sm shadow-md transition-transform active:scale-[0.98]"><i class="ph ph-plus-circle text-lg"></i> Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÏ„Î· Î›Î¯ÏƒÏ„Î±</button>
                        </div>
                        <div class="mt-4"><p class="text-[10px] font-bold text-slate-400 uppercase mb-2 text-center">Î”ÎµÎ½ Î¾ÎµÏÎµÏ„Îµ Ï„Î¿ Î¿Î½Î¿Î¼Î±;</p>
                            <div class="grid grid-cols-2 gap-3">
                                <input id="request-image" type="file" accept="image/*" capture="environment" class="hidden" onchange="handleFileSelect(this)">
                                <button type="button" onclick="document.getElementById('request-image').click()" class="flex flex-col items-center justify-center bg-white dark:bg-slate-700 border-2 border-slate-200 dark:border-slate-600 rounded-xl p-3 hover:border-blue-400 transition-all group active:scale-95"><i class="ph ph-camera text-2xl text-slate-600 dark:text-slate-300 mb-1 group-hover:text-blue-500 transition-colors"></i><span class="text-[10px] font-bold text-slate-700 dark:text-slate-200">Î¦Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î±</span></button>
                                <button type="button" onclick="toggleScanner()" class="flex flex-col items-center justify-center bg-white dark:bg-slate-700 border-2 border-slate-200 dark:border-slate-600 rounded-xl p-3 hover:border-teal-400 transition-all group active:scale-95"><i class="ph ph-barcode text-2xl text-slate-600 dark:text-slate-300 mb-1 group-hover:text-teal-500 transition-colors"></i><span class="text-[10px] font-bold text-slate-700 dark:text-slate-200">Scan Barcode</span></button>
                            </div>
                        </div>
                        <div id="scanner-container" class="hidden mt-2 rounded-xl overflow-hidden relative bg-black border-2 border-primary h-48 shadow-lg"><div id="reader" style="width:100%;height:100%;"></div></div>
                        <div id="media-preview" class="hidden mt-2 text-xs text-teal-600 font-bold text-center bg-teal-50 p-2 rounded-lg"><i class="ph ph-check"></i> Î¦Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î± Ï€ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ!</div>
                    </div>

                    <div class="space-y-2"><label class="text-[10px] font-bold text-slate-500 dark:text-slate-400 uppercase ml-1">Î£Î·Î¼ÎµÎ¹Ï‰ÏƒÎµÎ¹Ï‚ (Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¿)</label><textarea id="notes" rows="2" placeholder="..." class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-2xl px-4 py-3.5 text-base resize-none focus:ring-2 focus:ring-primary/50 outline-none dark:text-white"></textarea></div>
                    <div class="space-y-3 pt-2">
                        <label class="flex items-start gap-3 px-3 cursor-pointer group bg-slate-50 dark:bg-slate-800/50 p-2 rounded-xl active:bg-slate-100 dark:active:bg-slate-800"><input type="checkbox" id="accept-generic" class="mt-1 w-5 h-5 text-primary rounded border-gray-300 focus:ring-offset-0" checked><span class="text-xs text-slate-600 dark:text-slate-300"><span data-lang-key="accept_text">Î”Î­Ï‡Î¿Î¼Î±Î¹ Î½Î± Î¼Î¿Ï… Ï€ÏÎ¿Ï„ÎµÎ¯Î½Î¿Ï…Î½</span> <a href="#" onclick="openModal('generic'); return false;" class="font-bold underline decoration-dotted text-primary hover:text-teal-700">Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿</a>.</span></label>
                        <label class="flex items-start gap-3 px-3 cursor-pointer"><input type="checkbox" id="gdpr-check" class="mt-0.5 w-5 h-5 text-primary rounded border-gray-300 focus:ring-offset-0" required><span class="text-xs text-slate-500 dark:text-slate-400"><span data-lang-key="terms_agree">Î‘Ï€Î¿Î´Î­Ï‡Î¿Î¼Î±Î¹ Ï„Î¿Ï…Ï‚</span> <a href="#" onclick="openModal('terms'); return false;" class="underline text-primary font-semibold">ÎŒÏÎ¿Ï…Ï‚ Î§ÏÎ®ÏƒÎ·Ï‚</a> & <a href="#" onclick="openModal('gdpr'); return false;" class="underline text-primary font-semibold">GDPR</a>.</span></label>
                    </div>
                    <button type="submit" class="w-full bg-gradient-to-r from-cyan-500 to-teal-500 hover:from-cyan-600 hover:to-teal-600 text-white text-lg font-bold py-4 rounded-2xl shadow-lg shadow-teal-500/30 transform active:scale-[0.98] transition-all flex items-center justify-center gap-2 focus:outline-none focus:ring-4 focus:ring-teal-200"><i class="ph ph-paper-plane-right text-xl"></i> <span data-lang-key="send">Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®</span></button>
                </form>
            </div>
        </div>

        <div id="tab-results" class="tab-content" role="tabpanel">
            <div class="glass-card rounded-3xl p-6 min-h-[50vh] text-center">
                <div id="loading-state" role="status" aria-live="polite">
                    <div class="flex justify-center gap-4 mb-6 text-4xl"><span class="animate-bounce delay-100">ğŸ’Š</span><span class="animate-bounce delay-200">ğŸ©¹</span><span class="animate-bounce delay-300">ğŸ©º</span></div>
                    <h2 id="loading-text" class="text-xl font-bold text-primary mb-2">Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·...</h2>
                    <p class="text-sm text-slate-500 dark:text-slate-400 mb-6">Î•Î¹Î´Î¿Ï€Î¿Î¹Î¿ÏÎ¼Îµ Ï„Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± ÎºÎ¿Î½Ï„Î¬ ÏƒÎ±Ï‚.</p>
                    <button onclick="resetApp()" class="mt-4 text-red-400 text-sm font-bold hover:text-red-500 active:scale-95 border border-red-200 rounded-lg px-4 py-2">Î‘ÎºÏÏÏ‰ÏƒÎ·</button>
                </div>
                <div id="responses-list" class="space-y-4 text-left hidden mt-4 pb-20" aria-live="polite"></div>
            </div>
        </div>

        <div id="pickup-view" class="hidden animate-fadeIn" role="region">
            <div class="glass-card rounded-3xl p-8 text-center border-2 border-teal-500 dark:border-teal-700">
                <div class="w-24 h-24 bg-teal-100 dark:bg-teal-900/50 rounded-full flex items-center justify-center mx-auto mb-6 shadow-xl ring-8 ring-teal-50 dark:ring-teal-900/20"><i class="ph ph-check-circle text-4xl text-primary"></i></div>
                <h2 class="text-2xl font-bold text-slate-800 dark:text-white mb-1">ÎšÏÎ±Ï„Î®Î¸Î·ÎºÎµ!</h2>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-6">ÎŸ Ï†Î±ÏÎ¼Î±ÎºÎ¿Ï€Î¿Î¹ÏŒÏ‚ ÎµÎ½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎµ.</p>
                <div id="missing-items-alert" class="hidden mb-6 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-xl p-4 text-left">
                    <h4 class="text-sm font-bold text-orange-700 dark:text-orange-400 flex items-center gap-2"><i class="ph ph-warning"></i> Î•ÎºÎºÏÎµÎ¼ÏŒÏ„Î·Ï„ÎµÏ‚</h4>
                    <p class="text-xs text-slate-600 dark:text-slate-300 mt-1 mb-2">Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ ÏƒÏ„Î¿ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿:</p>
                    <div id="missing-items-list" class="flex flex-wrap gap-2 mb-3"></div>
                    <button onclick="reSearchMissing()" class="w-full bg-orange-500 hover:bg-orange-600 text-white text-xs font-bold py-2 rounded-lg shadow active:scale-95 flex items-center justify-center gap-2"><i class="ph ph-magnifying-glass"></i> ÎÎ­Î± Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î³Î¹Î± Ï„Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î±</button>
                </div>
                <div class="bg-white dark:bg-slate-700 rounded-2xl p-4 mb-6 shadow-inner border border-slate-200 dark:border-slate-600"><p class="text-xs text-slate-500 dark:text-slate-300 font-bold uppercase mb-1">Î§ÏÎ¿Î½Î¿Ï‚ Î Î±ÏÎ±Î»Î±Î²Î·Ï‚</p><div id="timer-display" class="text-5xl font-mono font-bold text-primary dark:text-teal-400 tracking-tighter">60:00</div></div>
                <div class="border-t border-dashed border-slate-300 dark:border-slate-600 my-4 pt-4"><p class="text-xs text-slate-500 dark:text-slate-300 font-bold uppercase mb-2">ÎšÏ‰Î´Î¹ÎºÎ¿Ï‚ Î Î±ÏÎ±Î»Î±Î²Î·Ï‚</p><div id="pickup-code" class="text-3xl font-mono font-bold text-slate-800 dark:text-white tracking-[0.2em] bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-600 py-3 rounded-xl">------</div></div>
                <button onclick="openGoogleMaps()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl mb-3 flex items-center justify-center gap-2 shadow-lg active:scale-95"><i class="ph ph-map-trifold text-lg"></i> Î§Î¬ÏÏ„Î·Ï‚</button>
                <button onclick="resetApp()" class="text-slate-400 text-sm underline hover:text-slate-600 active:scale-95">ÎŸÎ»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ·</button>
            </div>
        </div>
        
        <div id="tab-how" class="tab-content" role="tabpanel"><div class="glass-card rounded-3xl p-6"><h3 class="text-xl font-bold mb-6 text-slate-800 dark:text-white flex items-center gap-2"><i class="ph ph-info text-primary"></i> Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯;</h3><ul class="space-y-6"><li class="flex gap-4 items-start"><div class="bg-teal-100 dark:bg-teal-900 text-teal-700 dark:text-teal-300 w-10 h-10 rounded-full flex items-center justify-center font-bold flex-shrink-0 text-lg shadow-sm">1</div><div><h4 class="font-bold text-slate-800 dark:text-slate-200">Î‘Î¯Ï„Î·Î¼Î±</h4><p class="text-slate-600 dark:text-slate-400 text-sm mt-1">Î£Ï…Î¼Ï€Î»Î·ÏÏÎ½ÎµÎ¹Ï‚ Ï„Î· Î»Î¯ÏƒÏ„Î± Ï†Î±ÏÎ¼Î¬ÎºÏ‰Î½.</p></div></li><li class="flex gap-4 items-start"><div class="bg-teal-100 dark:bg-teal-900 text-teal-700 dark:text-teal-300 w-10 h-10 rounded-full flex items-center justify-center font-bold flex-shrink-0 text-lg shadow-sm">2</div><div><h4 class="font-bold text-slate-800 dark:text-slate-200">Î•Î¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ·</h4><p class="text-slate-600 dark:text-slate-400 text-sm mt-1">Î¤Î¿ MediRadar ÏˆÎ¬Ï‡Î½ÎµÎ¹ ÏƒÏ„Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±.</p></div></li><li class="flex gap-4 items-start"><div class="bg-teal-100 dark:bg-teal-900 text-teal-700 dark:text-teal-300 w-10 h-10 rounded-full flex items-center justify-center font-bold flex-shrink-0 text-lg shadow-sm">3</div><div><h4 class="font-bold text-slate-800 dark:text-slate-200">ÎšÏÎ¬Ï„Î·ÏƒÎ·</h4><p class="text-slate-600 dark:text-slate-400 text-sm mt-1">Î’Î»Î­Ï€ÎµÎ¹Ï‚ Ï„Î¹ Î²ÏÎ­Î¸Î·ÎºÎµ ÎºÎ±Î¹ ÎºÎ¬Î½ÎµÎ¹Ï‚ ÎºÏÎ¬Ï„Î·ÏƒÎ·.</p></div></li></ul></div></div>
    </main>

    <footer class="mt-auto py-8 bg-slate-100 dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800 z-10" role="contentinfo">
        <div class="max-w-lg mx-auto px-6 text-center">
            <div class="flex justify-center gap-6 mb-6">
                <a href="#" class="text-slate-400 hover:text-primary transition-colors"><i class="ph ph-facebook-logo text-2xl"></i></a>
                <a href="#" class="text-slate-400 hover:text-primary transition-colors"><i class="ph ph-instagram-logo text-2xl"></i></a>
                <a href="#" class="text-slate-400 hover:text-primary transition-colors"><i class="ph ph-twitter-logo text-2xl"></i></a>
            </div>
            <div class="flex flex-wrap justify-center gap-4 text-xs font-bold text-slate-500 mb-6">
                <a href="#" onclick="openModal('terms'); return false;" class="hover:text-primary">ÎŒÏÎ¿Î¹ Î§ÏÎ®ÏƒÎ·Ï‚</a><span class="text-slate-300">|</span><a href="#" onclick="openModal('gdpr'); return false;" class="hover:text-primary">GDPR</a><span class="text-slate-300">|</span><a href="#" onclick="openModal('pro'); return false;" class="hover:text-primary text-teal-600 dark:text-teal-400">Î¦Î±ÏÎ¼Î±ÎºÎ¿Ï€Î¿Î¹Î¿Î¯ (Pro)</a>
            </div>
            <p class="text-[10px] text-slate-400 uppercase tracking-widest">Â© 2025 MediRadar Hellas</p>
        </div>
    </footer>

    <div id="modal-safety" class="modal-backdrop">
        <div class="modal-content bg-white dark:bg-slate-800 text-center relative glass-card !opacity-100 !transform-none animate-slide-up">
            <div class="w-16 h-16 bg-teal-50 dark:bg-teal-900/30 rounded-full flex items-center justify-center mx-auto mb-4 text-primary ring-4 ring-teal-50 dark:ring-teal-900/20">
                <i class="ph ph-shield-check text-3xl"></i>
            </div>
            <h3 class="text-xl font-bold mb-4 text-slate-900 dark:text-white">ÎŸÎ»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ· ÎšÏÎ¬Ï„Î·ÏƒÎ·Ï‚</h3>
            <div class="bg-slate-50 dark:bg-slate-700/50 border border-slate-100 dark:border-slate-600 p-4 rounded-xl mb-6 text-left space-y-3">
                <div class="flex gap-3 items-start">
                    <i class="ph ph-info text-secondary mt-0.5 flex-shrink-0"></i>
                    <p class="text-xs text-slate-600 dark:text-slate-300 leading-relaxed"><strong>Î”Î­ÏƒÎ¼ÎµÏ…ÏƒÎ·:</strong> Î— ÎºÏÎ¬Ï„Î·ÏƒÎ· Î¹ÏƒÏ‡ÏÎµÎ¹ Î³Î¹Î± <span class="font-bold text-slate-800 dark:text-white">60 Î»ÎµÏ€Ï„Î¬</span>. ÎœÎµÏ„Î¬ Ï„Î¿ Ï€Î­ÏÎ±Ï‚ Ï„Î¿Ï… Ï‡ÏÏŒÎ½Î¿Ï…, Ï„Î± Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Î± Î±Ï€Î¿Î´ÎµÏƒÎ¼ÎµÏÎ¿Î½Ï„Î±Î¹.</p>
                </div>
                <div class="flex gap-3 items-start">
                    <i class="ph ph-currency-eur text-secondary mt-0.5 flex-shrink-0"></i>
                    <p class="text-xs text-slate-600 dark:text-slate-300 leading-relaxed"><strong>Î Î»Î·ÏÏ‰Î¼Î®:</strong> Î— ÏƒÏ…Î½Î±Î»Î»Î±Î³Î® ÎºÎ±Î¹ Î¿ Î­Î»ÎµÎ³Ï‡Î¿Ï‚ Ï„Ï‰Î½ Ï†Î±ÏÎ¼Î¬ÎºÏ‰Î½ Î³Î¯Î½Î¿Î½Ï„Î±Î¹ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ ÏƒÏ„Î¿ Ï„Î±Î¼ÎµÎ¯Î¿ Ï„Î¿Ï… Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï….</p>
                </div>
            </div>
            <button onclick="confirmBooking()" class="w-full bg-gradient-to-r from-teal-600 to-emerald-600 hover:from-teal-700 hover:to-emerald-700 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-teal-500/20 transition-all active:scale-95 mb-3 flex items-center justify-center gap-2"><span>ÎˆÏ‡Ï‰ ÎµÎ½Î·Î¼ÎµÏÏ‰Î¸ÎµÎ¯ & Î£Ï…Î½ÎµÏ‡Î¯Î¶Ï‰</span> <i class="ph ph-arrow-right"></i></button>
            <button onclick="closeModal('safety')" class="text-slate-500 hover:text-red-500 text-sm font-bold transition-colors py-2">Î‘ÎºÏÏÏ‰ÏƒÎ·</button>
        </div>
    </div>

    <div id="modal-user" class="modal-backdrop"><div class="modal-content bg-white dark:bg-slate-800 text-center relative glass-card !opacity-100 !transform-none animate-slide-up"><button onclick="closeModal('user')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 dark:hover:text-white active:scale-90"><i class="ph ph-x text-xl"></i></button><div class="w-16 h-16 bg-teal-100 dark:bg-teal-900/50 rounded-full flex items-center justify-center mx-auto mb-4 text-primary ring-4 ring-teal-50 dark:ring-teal-900/20"><i class="ph ph-user-circle text-3xl"></i></div><h3 class="text-xl font-bold mb-1 text-slate-800 dark:text-white">Î•Î¯ÏƒÎ¿Î´Î¿Ï‚ / Î•Î³Î³ÏÎ±Ï†Î®</h3><p class="text-sm text-slate-500 dark:text-slate-400 mb-4">Î§Ï‰ÏÎ¯Ï‚ ÎºÏ‰Î´Î¹ÎºÎ¿ÏÏ‚! Î£Î±Ï‚ ÏƒÏ„Î­Î»Î½Î¿Ï…Î¼Îµ Î­Î½Î± link ÏƒÏ„Î¿ email.</p><form id="magic-link-form" class="space-y-3" onsubmit="handleMagicLink(event)"><div class="text-left"><label for="user-email" class="text-xs font-bold text-slate-500 ml-2 uppercase">Email</label><input id="user-email" type="email" placeholder="onoma@email.com" required class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-xl px-4 py-3.5 text-base focus:outline-none focus:ring-2 focus:ring-primary/50 dark:text-white transition-all font-medium"></div><button type="submit" class="w-full bg-primary hover:bg-teal-700 text-white font-bold py-3.5 rounded-xl flex items-center justify-center gap-2 shadow-lg shadow-teal-500/20 transition-all transform active:scale-[0.98]"><i class="ph ph-paper-plane-tilt text-lg"></i> Î£Ï„ÎµÎ¯Î»Ï„Îµ Î¼Î¿Ï… Link</button></form><div class="flex justify-center mt-4"><button onclick="window.location.href='pharmacy.html'" class="text-xs text-teal-600 font-bold underline">Î•Î¯ÏƒÏ„Îµ Î¦Î±ÏÎ¼Î±ÎºÎ¿Ï€Î¿Î¹ÏŒÏ‚;</button></div></div></div>
    <div id="modal-pro" class="modal-backdrop"><div class="modal-content bg-white dark:bg-slate-800 text-center relative glass-card !opacity-100 !transform-none animate-slide-up !max-w-md"><button onclick="closeModal('pro')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 dark:hover:text-white active:scale-90"><i class="ph ph-x text-xl"></i></button><h3 class="text-xl font-bold mb-4 text-slate-800 dark:text-white">Î•Î¯ÏƒÎ¿Î´Î¿Ï‚ Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿Ï…</h3><div class="w-20 h-20 bg-teal-100 dark:bg-teal-900 text-teal-600 dark:text-teal-300 rounded-full flex items-center justify-center mx-auto mb-6 text-4xl"><i class="ph ph-first-aid-kit"></i></div><p class="text-sm text-slate-600 dark:text-slate-300 mb-6">ÎœÎµÏ„Î±Î²ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ ÎµÎ¹Î´Î¹ÎºÏŒ Portal Î³Î¹Î± ÎµÏ€Î±Î³Î³ÎµÎ»Î¼Î±Ï„Î¯ÎµÏ‚ Ï…Î³ÎµÎ¯Î±Ï‚.</p><button onclick="window.location.href='pharmacy.html'" class="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-3 rounded-xl transition-all shadow-lg flex items-center justify-center gap-2"><span>ÎœÎµÏ„Î¬Î²Î±ÏƒÎ· ÏƒÏ„Î¿ Portal</span> <i class="ph ph-arrow-right"></i></button></div></div>
    <div id="modal-generic" class="modal-backdrop"><div class="modal-content bg-white dark:bg-slate-800 text-center relative glass-card !opacity-100 !transform-none"><button onclick="closeModal('generic')" class="absolute top-4 right-4 text-slate-400"><i class="ph ph-x text-xl"></i></button><h3 class="text-lg font-bold mb-2 dark:text-white">Î¤Î¹ ÎµÎ¯Î½Î±Î¹ Ï„Î¿ Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿;</h3><p class="text-sm text-slate-600 dark:text-slate-300 mb-4 text-left">ÎˆÎ½Î± Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿ Ï†Î¬ÏÎ¼Î±ÎºÎ¿ ÎµÎ¯Î½Î±Î¹ Î­Î½Î± Ï†Î±ÏÎ¼Î±ÎºÎµÏ…Ï„Î¹ÎºÏŒ Ï€ÏÎ¿ÏŠÏŒÎ½ Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ Î³Î¹Î± Î½Î± ÎµÎ¯Î½Î±Î¹ Î¯Î´Î¹Î¿ Î¼Îµ Î­Î½Î± Î®Î´Î· ÎºÏ…ÎºÎ»Î¿Ï†Î¿ÏÎ¿ÏÎ½ ÎµÏ€ÏÎ½Ï…Î¼Î¿ Ï†Î¬ÏÎ¼Î±ÎºÎ¿ ÏƒÏ„Î· Î¼Î¿ÏÏ†Î® Î´Î¿ÏƒÎ¿Î»Î¿Î³Î¯Î±Ï‚, Ï„Î·Î½ Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±, Ï„Î·Î½ Î¹ÏƒÏ‡Ï, Ï„Î·Î½ Î¿Î´ÏŒ Ï‡Î¿ÏÎ®Î³Î·ÏƒÎ·Ï‚, Ï„Î·Î½ Ï€Î¿Î¹ÏŒÏ„Î·Ï„Î±, Ï„Î± Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÎ¬ Î±Ï€ÏŒÎ´Î¿ÏƒÎ·Ï‚ ÎºÎ±Î¹ Ï„Î·Î½ Ï€ÏÎ¿Î¿ÏÎ¹Î¶ÏŒÎ¼ÎµÎ½Î· Ï‡ÏÎ®ÏƒÎ·. <br><br><strong>ÎŸÏ…ÏƒÎ¹Î±ÏƒÏ„Î¹ÎºÎ¬:</strong> ÎŠÎ´Î¹Î± Î´ÏÎ±ÏƒÏ„Î¹ÎºÎ® Î¿Ï…ÏƒÎ¯Î±, Î¯Î´Î¹Î± Î¸ÎµÏÎ±Ï€ÎµÏ…Ï„Î¹ÎºÎ® Î´ÏÎ¬ÏƒÎ·, ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Ï‡Î±Î¼Î·Î»ÏŒÏ„ÎµÏÎ· Ï„Î¹Î¼Î®.</p><button onclick="closeModal('generic')" class="bg-blue-600 text-white px-6 py-2 rounded-xl text-sm font-bold shadow-lg">ÎšÎ±Ï„Î¬Î»Î±Î²Î±</button></div></div>
    <div id="modal-terms" class="modal-backdrop"><div class="modal-content bg-white dark:bg-slate-800 relative p-6 h-[80vh] overflow-y-auto"><button onclick="closeModal('terms')" class="absolute top-4 right-4 text-slate-500"><i class="ph ph-x text-xl"></i></button><h3 class="font-bold text-xl mb-4 dark:text-white">ÎŒÏÎ¿Î¹ Î§ÏÎ®ÏƒÎ·Ï‚</h3><p class="text-sm text-slate-600 dark:text-slate-300 space-y-2"><strong>1. Î•Î¹ÏƒÎ±Î³Ï‰Î³Î®</strong><br>ÎšÎ±Î»ÏÏ‚ Î®ÏÎ¸Î±Ï„Îµ ÏƒÏ„Î¿ MediRadar. Î— Ï‡ÏÎ®ÏƒÎ· Ï„Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚ ÏƒÏ…Î½ÎµÏ€Î¬Î³ÎµÏ„Î±Î¹ Ï„Î·Î½ Î±Ï€Î¿Î´Î¿Ï‡Î® Ï„Ï‰Î½ Ï€Î±ÏÏŒÎ½Ï„Ï‰Î½ ÏŒÏÏ‰Î½.<br><br><strong>2. Î¦ÏÏƒÎ· Î¥Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚</strong><br>Î¤Î¿ MediRadar Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï‰Ï‚ Î¼ÎµÏƒÎ¬Î¶Ï‰Î½ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯Î±Ï‚ Î¼ÎµÏ„Î±Î¾Ï Ï‡ÏÎ·ÏƒÏ„ÏÎ½ ÎºÎ±Î¹ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Ï‰Î½ Î³Î¹Î± Ï„Î· Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î± Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Ï‰Î½. Î”Î•Î Ï€Ï‰Î»ÎµÎ¯ Ï†Î¬ÏÎ¼Î±ÎºÎ±, Î”Î•Î ÎµÎºÏ„ÎµÎ»ÎµÎ¯ ÏƒÏ…Î½Ï„Î±Î³Î­Ï‚ Î´Î¹Î±Î´Î¹ÎºÏ„Ï…Î±ÎºÎ¬ ÎºÎ±Î¹ Î”Î•Î Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Î¹Î±Ï„ÏÎ¹ÎºÎ­Ï‚ ÏƒÏ…Î¼Î²Î¿Ï…Î»Î­Ï‚.<br><br><strong>3. Î•Ï…Î¸ÏÎ½Î· Î§ÏÎ®ÏƒÏ„Î·</strong><br>ÎŸ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î¿Ï†ÎµÎ¯Î»ÎµÎ¹ Î½Î± Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Î±Î»Î·Î¸Î® ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± ÎºÎ±Î¹ Î½Î± Ï€ÏÎ¿ÏƒÎ­ÏÏ‡ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ Î³Î¹Î± Ï„Î·Î½ Ï€Î±ÏÎ±Î»Î±Î²Î® ÎºÎ±Î¹ Ï„Î¿Î½ Î­Î»ÎµÎ³Ï‡Î¿ Ï„Ï‰Î½ Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Ï‰Î½.<br><br><strong>4. Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î•Ï…Î¸ÏÎ½Î·Ï‚</strong><br>Î— ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Î´ÎµÎ½ ÎµÏ…Î¸ÏÎ½ÎµÏ„Î±Î¹ Î³Î¹Î± Ï„Ï…Ï‡ÏŒÎ½ ÎµÎ»Î»ÎµÎ¯ÏˆÎµÎ¹Ï‚ Î±Ï€Î¿Î¸ÎµÎ¼Î¬Ï„Ï‰Î½ Ï€Î¿Ï… Ï€ÏÎ¿ÎºÏÏˆÎ¿Ï…Î½ ÏƒÏ„Î¿ Î¼ÎµÏƒÎ¿Î´Î¹Î¬ÏƒÏ„Î·Î¼Î± Î¼Î­Ï‡ÏÎ¹ Ï„Î·Î½ Ï€ÏÎ¿ÏƒÎ­Î»ÎµÏ…ÏƒÎ· Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î·.</p></div></div>
    <div id="modal-gdpr" class="modal-backdrop"><div class="modal-content bg-white dark:bg-slate-800 relative p-6 h-[80vh] overflow-y-auto"><button onclick="closeModal('gdpr')" class="absolute top-4 right-4 text-slate-500"><i class="ph ph-x text-xl"></i></button><h3 class="font-bold text-xl mb-4 dark:text-white">Î Î¿Î»Î¹Ï„Î¹ÎºÎ® Î‘Ï€Î¿ÏÏÎ®Ï„Î¿Ï… (GDPR)</h3><p class="text-sm text-slate-600 dark:text-slate-300 space-y-2"><strong>1. Î”ÎµÎ´Î¿Î¼Î­Î½Î± Ï€Î¿Ï… ÏƒÏ…Î»Î»Î­Î³Î¿Ï…Î¼Îµ</strong><br>Î£Ï…Î»Î»Î­Î³Î¿Ï…Î¼Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î±, Ï„Î¿ Ï„Î·Î»Î­Ï†Ï‰Î½Î¿, Ï„Î·Î½ Ï€ÎµÏÎ¹Î¿Ï‡Î® ÏƒÎ±Ï‚ ÎºÎ±Î¹ Ï„Î· Î»Î¯ÏƒÏ„Î± Ï†Î±ÏÎ¼Î¬ÎºÏ‰Î½ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ Î³Î¹Î± Ï„Î·Î½ ÎµÎ¾Ï…Ï€Î·ÏÎ­Ï„Î·ÏƒÎ· Ï„Î¿Ï… Î±Î¹Ï„Î®Î¼Î±Ï„ÏŒÏ‚ ÏƒÎ±Ï‚.<br><br><strong>2. Î§ÏÎ®ÏƒÎ· Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½</strong><br>Î¤Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏƒÎ±Ï‚ ÎºÎ¿Î¹Î½Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ Î¼ÏŒÎ½Î¿ ÏƒÏ„Î± ÏƒÏ…Î½ÎµÏÎ³Î±Î¶ÏŒÎ¼ÎµÎ½Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î± Ï„Î·Ï‚ Ï€ÎµÏÎ¹Î¿Ï‡Î®Ï‚ Ï€Î¿Ï… ÎµÏ€Î¹Î»Î­Î¾Î±Ï„Îµ Î³Î¹Î± Î½Î± Î»Î¬Î²ÎµÏ„Îµ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·.<br><br><strong>3. Î”Î¹Î±Î³ÏÎ±Ï†Î® Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½</strong><br>Î¤Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Ï„Ï‰Î½ Î±Î¹Ï„Î·Î¼Î¬Ï„Ï‰Î½ Î±Î½Ï‰Î½Ï…Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ Î® Î´Î¹Î±Î³ÏÎ¬Ï†Î¿Î½Ï„Î±Î¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ ÎµÏÎ»Î¿Î³Î¿ Ï‡ÏÎ¿Î½Î¹ÎºÏŒ Î´Î¹Î¬ÏƒÏ„Î·Î¼Î±. ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î¶Î·Ï„Î®ÏƒÎµÏ„Îµ Ï„Î· Î´Î¹Î±Î³ÏÎ±Ï†Î® Ï„Ï‰Î½ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Ï‰Î½ ÏƒÎ±Ï‚ ÏƒÏ„Î­Î»Î½Î¿Î½Ï„Î±Ï‚ email ÏƒÏ„Î¿ info@mediradar.gr.</p></div></div>

    <div id="toast-container" class="fixed bottom-5 right-5 z-50 flex flex-col gap-2"></div>

    <script>
        const SB_URL = "https://qzerrisyowkfkmcyxmav.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF6ZXJyaXN5b3drZmttY3l4bWF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwMTcxODQsImV4cCI6MjA3NTU5MzE4NH0.alkvHkOQPBTwY3daUcKAEsf4nt0kizuU3rYI2c2InPk";

        const citiesData = ["Î‘Î¸Î®Î½Î±", "Î˜ÎµÏƒÏƒÎ±Î»Î¿Î½Î¯ÎºÎ·", "Î Î¬Ï„ÏÎ±", "Î—ÏÎ¬ÎºÎ»ÎµÎ¹Î¿", "Î›Î¬ÏÎ¹ÏƒÎ±", "Î’ÏŒÎ»Î¿Ï‚", "Î™Ï‰Î¬Î½Î½Î¹Î½Î±", "Î¤ÏÎ¯ÎºÎ±Î»Î±", "Î§Î±Î»ÎºÎ¯Î´Î±", "Î£Î­ÏÏÎµÏ‚", "Î‘Î»ÎµÎ¾Î±Î½Î´ÏÎ¿ÏÏ€Î¿Î»Î·", "ÎÎ¬Î½Î¸Î·", "ÎšÎ±Ï„ÎµÏÎ¯Î½Î·", "ÎšÎ±Î»Î±Î¼Î¬Ï„Î±", "ÎšÎ±Î²Î¬Î»Î±", "Î§Î±Î½Î¹Î¬", "Î›Î±Î¼Î¯Î±", "ÎšÎ¿Î¼Î¿Ï„Î·Î½Î®", "Î¡ÏŒÎ´Î¿Ï‚", "Î‘Î³ÏÎ¯Î½Î¹Î¿"];
        const medicinesData = ["Depon", "Panadol", "Algofren", "Mesulid", "Voltaren", "Augmentin", "Ponstan", "Amoxil", "Klaricid", "Imodium", "Buscopan", "Aerolin", "Flixotide", "Zirtek", "Xozal", "Neurobion"];
        
        const translations = { el: { search_tab: "Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·", how_tab: "Î ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯", name: "ÎŒÎ½Î¿Î¼Î±", phone: "Î¤Î·Î»Î­Ï†Ï‰Î½Î¿", area: "Î ÎµÏÎ¹Î¿Ï‡Î®", near_me: "ÎšÎ¿Î½Ï„Î¬ Î¼Î¿Ï…", notes: "Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚", accept_text: "Î”Î­Ï‡Î¿Î¼Î±Î¹ Î½Î± Î¼Î¿Ï… Ï€ÏÎ¿Ï„ÎµÎ¯Î½Î¿Ï…Î½", accept_link: "Î³ÎµÎ½ÏŒÏƒÎ·Î¼Î¿", terms_agree: "Î‘Ï€Î¿Î´Î­Ï‡Î¿Î¼Î±Î¹ Ï„Î¿Ï…Ï‚", terms_link: "ÎŒÏÎ¿Ï…Ï‚ Î§ÏÎ®ÏƒÎ·Ï‚", gdpr_link: "GDPR", send: "Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®", subtitle: "Î’ÏÎµÏ‚ Ï„Î¿ Ï†Î¬ÏÎ¼Î±ÎºÏŒ ÏƒÎ¿Ï… Î¬Î¼ÎµÏƒÎ± & Ï„Î¿Ï€Î¹ÎºÎ¬." }, en: { search_tab: "Search", how_tab: "How it works", name: "Name", phone: "Phone", area: "City / Area", near_me: "Near Me", notes: "Notes", accept_text: "I accept suggestions for", accept_link: "generics", terms_agree: "I accept the", terms_link: "Terms", gdpr_link: "GDPR", send: "Send Request", subtitle: "Find your medicine instantly & locally." } };
        
        let currentLang = 'el';
        let userLocation = { lat: null, lon: null };
        let currentRequestId = null;
        let currentUser = null;
        let requestItems = []; 
        let pendingPharmacyId = null;
        let intervalId = null;
        let responsePoller = null;
        let itemsNotReserved = [];
        let isPhoneValid = false;
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let html5QrcodeScanner = null;
        let tempImageBase64 = null;
        
        // NEW: Global Storage for Responses (iOS Fix)
        let responseStore = {};

        const typeIcons = {'pills': 'ğŸ’Š', 'syrup': 'ğŸ§´', 'cream': 'ğŸ©¹', 'inject': 'ğŸ’‰', 'spray': 'ğŸ’¨', 'baby': 'ğŸ¼', 'cosmetic': 'ğŸ’„', 'device': 'ğŸ©º', 'other': 'â“'};
        const typeLabels = {'pills': 'Î§Î¬Ï€Î¹Î±', 'syrup': 'Î£Î¹ÏÏŒÏ€Î¹', 'cream': 'Î‘Î»Î¿Î¹Ï†Î®', 'inject': 'Î•Î½Î­ÏƒÎ¹Î¼Î¿', 'spray': 'Î£Ï€ÏÎ­Î¹', 'baby': 'Î’ÏÎµÏ†Î¹ÎºÎ¬', 'cosmetic': 'ÎšÎ±Î»Î»Ï…Î½Ï„Î¹ÎºÎ¬', 'device': 'Î£Ï…ÏƒÎºÎµÏ…Î­Ï‚', 'other': 'Î†Î»Î»Î¿'};

        window.onload = async function() {
            createEmojis();
            setupAutocomplete('city', 'city-suggestions', citiesData);
            setupAutocomplete('medicine', 'drug-suggestions', medicinesData);
            loadUserData();
            window.db = window.supabase.createClient(SB_URL, SB_KEY);
            const { data, error } = await window.db.auth.signInAnonymously();
            if(!error) currentUser = data.user;
            if(window.db) { window.db.auth.onAuthStateChange((event, session) => { if(session) { currentUser = session.user; updateNavForUser(session.user); } }); }
            document.getElementById('request-form').addEventListener('submit', handleFormSubmit);
            document.getElementById('medicine').addEventListener('keypress', function (e) { if (e.key === 'Enter') { e.preventDefault(); addItemToList(); } });
        };

        function validatePhoneUI(input) {
            const val = input.value.replace(/[^0-9+]/g, ''); 
            input.value = val;
            const statusDiv = document.getElementById('phone-status'); 
            statusDiv.classList.remove('hidden');
            if (/^(\+|00)?\d{10,15}$/.test(val)) { 
                input.classList.remove('border-red-500', 'focus:ring-red-200'); 
                input.classList.add('border-green-500', 'focus:ring-green-200'); 
                statusDiv.innerHTML = 'âœ…'; 
                isPhoneValid = true; 
            } 
            else { 
                input.classList.remove('border-green-500', 'focus:ring-green-200'); 
                input.classList.add('border-red-500', 'focus:ring-red-200'); 
                statusDiv.innerHTML = 'âŒ'; 
                isPhoneValid = false; 
            }
            saveUserData();
        }

        function adjustQty(amount) { const el = document.getElementById('quantity'); let val = parseInt(el.value) || 1; val = Math.max(1, val + amount); el.value = val; }
        
        function addItemToList() {
            const name = document.getElementById('medicine').value.trim(); const qty = document.getElementById('quantity').value; const type = document.getElementById('med-type').value;
            if(!name) return showToast("Î“ÏÎ¬ÏˆÏ„Îµ ÏŒÎ½Î¿Î¼Î± Ï†Î±ÏÎ¼Î¬ÎºÎ¿Ï… Î® ÏƒÎºÎ±Î½Î¬ÏÎµÏ„Îµ", "error");
            
            const item = { name: name, quantity: qty, type: type };
            if(tempImageBase64) {
                item.image = tempImageBase64;
                tempImageBase64 = null; 
                document.getElementById('media-preview').classList.add('hidden');
            }
            
            requestItems.push(item); updateItemsUI();
            document.getElementById('medicine').value = ''; document.getElementById('quantity').value = '1'; document.getElementById('med-type').value = 'pills'; document.getElementById('medicine').focus();
        }
        
        function removeItem(index) { requestItems.splice(index, 1); updateItemsUI(); }
        function updateItemsUI() {
            const list = document.getElementById('items-list-display'); document.getElementById('items-count-badge').innerText = `${requestItems.length} ÎµÎ¯Î´Î·`;
            list.innerHTML = requestItems.map((item, i) => `
                <div class="item-badge flex justify-between items-center bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 p-2 rounded-xl shadow-sm">
                    <div class="flex items-center gap-3 overflow-hidden flex-1">
                        <div class="bg-slate-100 dark:bg-slate-800 w-8 h-8 rounded-lg flex items-center justify-center text-lg shadow-inner">
                            ${item.image ? '<i class="ph ph-image text-blue-500"></i>' : typeIcons[item.type]}
                        </div>
                        <div class="flex flex-col min-w-0">
                            <span class="text-sm font-bold text-slate-800 dark:text-slate-200 truncate">${item.name}</span>
                            <span class="text-[10px] text-slate-500 dark:text-slate-400">${typeLabels[item.type]} â€¢ x${item.quantity} ${item.image ? 'â€¢ ÎœÎµ Ï†Ï‰Ï„ÏŒ' : ''}</span>
                        </div>
                    </div>
                    <button type="button" onclick="removeItem(${i})" class="text-slate-400 hover:text-red-500 p-2"><i class="ph ph-trash text-lg"></i></button>
                </div>`).join('');
        }

        async function handleFormSubmit(e) {
            e.preventDefault();
            if(!currentUser) return showToast("Î Î±ÏÎ±ÎºÎ±Î»Ï Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÏ„Îµ...", "error");
            const phoneVal = document.getElementById('phone').value;
            if(!/^(\+|00)?\d{10,15}$/.test(phoneVal)) { 
                document.getElementById('phone').focus(); 
                return showToast("Î¤Î¿ ÎºÎ¹Î½Î·Ï„ÏŒ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î­Î³ÎºÏ…ÏÎ¿ (10-15 ÏˆÎ·Ï†Î¯Î±)", "error"); 
            }
            if(requestItems.length === 0) { if(document.getElementById('medicine').value.trim()) addItemToList(); else return showToast("Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ Î­Î½Î± Ï†Î¬ÏÎ¼Î±ÎºÎ¿!", "error"); }
            const btn = e.target.querySelector('button[type="submit"]'); const oldText = btn.innerHTML; btn.innerHTML = '<i class="ph ph-spinner animate-spin text-xl"></i> Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®...'; btn.disabled = true;
            
            const formData = { user_id: currentUser.id, customer_name: document.getElementById('full-name').value, phone: phoneVal, location: document.getElementById('city').value, items: requestItems, medicine_name: requestItems.map(i => `${i.name}`).join(', '), quantity: requestItems.length, notes: document.getElementById('notes').value, status: 'pending', lat: userLocation.lat, lon: userLocation.lon, accepts_generic: document.getElementById('accept-generic').checked };
            const { data, error } = await window.db.from('requests').insert([formData]).select().single();
            if(error) { showToast("Î£Ï†Î¬Î»Î¼Î±: " + error.message, "error"); btn.innerHTML = oldText; btn.disabled = false; } 
            else {
                currentRequestId = data.id; saveUserData(); confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors: ['#0d9488', '#38bdf8'] }); switchTab('results');
                let i = 0; const texts = ["Î•Î¹Î´Î¿Ï€Î¿Î¹Î¿ÏÎ¼Îµ Ï„Î± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î±...", "ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Ï€Î¿Î¸Î­Î¼Î±Ï„Î¿Ï‚...", "Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· ÏƒÎµ ÎµÎ¾Î­Î»Î¹Î¾Î·..."];
                intervalId = setInterval(() => { i = (i + 1) % texts.length; document.getElementById('loading-text').innerText = texts[i]; }, 2500);
                startResponsePolling(data.id);
            }
        }

        function startResponsePolling(reqId) {
            if(responsePoller) clearInterval(responsePoller);
            responsePoller = setInterval(async () => {
                const { data } = await window.db.from('responses').select('*').eq('request_id', reqId);
                if (data && data.length > 0) {
                    data.forEach(displayResponse);
                }
            }, 3000);
        }

        function displayResponse(resp) {
            clearInterval(intervalId);
            // 1. STORE RESPONSE IN GLOBAL MEMORY (The iOS Fix)
            responseStore[resp.id] = resp;

            const list = document.getElementById('responses-list'); document.getElementById('loading-state').classList.add('hidden'); list.classList.remove('hidden');
            let foundBadges = ''; let missingBadges = ''; let isPerfectMatch = true; let missingCount = 0;
            const responseMap = new Map();
            if(resp.found_items && Array.isArray(resp.found_items)) resp.found_items.forEach(i => responseMap.set(i.name, parseInt(i.quantity)));

            requestItems.forEach(reqItem => {
                const reqQty = parseInt(reqItem.quantity); const foundQty = responseMap.get(reqItem.name) || 0;
                if (foundQty >= reqQty) foundBadges += `<span class="text-[10px] bg-green-100 text-green-700 px-2 py-1 rounded-md font-bold mr-1 mb-1 inline-block">âœ… ${reqItem.name} (x${foundQty})</span>`;
                else if (foundQty > 0) { isPerfectMatch = false; missingCount++; foundBadges += `<span class="text-[10px] bg-yellow-100 text-yellow-700 px-2 py-1 rounded-md font-bold mr-1 mb-1 inline-block">âš ï¸ ${reqItem.name} (x${foundQty}/${reqQty})</span>`; }
                else { isPerfectMatch = false; missingCount++; missingBadges += `<span class="text-[10px] bg-red-50 text-red-500 px-2 py-1 rounded-md font-bold border border-red-100 mr-1 mb-1 inline-block">âŒ ${reqItem.name}</span>`; }
            });

            if(document.getElementById(`resp-card-${resp.id}`)) return; 
            const borderClass = isPerfectMatch ? 'border-teal-500 ring-2 ring-teal-500/10' : 'border-orange-400';
            const btnClass = isPerfectMatch ? 'bg-teal-600 hover:bg-teal-700' : 'bg-orange-500 hover:bg-orange-600';
            const btnText = isPerfectMatch ? 'ÎšÏÎ¬Ï„Î·ÏƒÎ· ÎŒÎ»Ï‰Î½ (Î¤Î­Î»ÎµÎ¹Î± Î•Ï€Î¹Î»Î¿Î³Î®)' : 'ÎšÏÎ¬Ï„Î·ÏƒÎ· Ï„Ï‰Î½ Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Ï‰Î½';
            const method = isPerfectMatch ? 'afterbegin' : 'beforeend';

            // 2. USE ID IN ONCLICK (NOT THE WHOLE OBJECT)
            const html = `
                <div id="resp-card-${resp.id}" class="glass-card bg-white p-5 rounded-2xl border-l-4 ${borderClass} animate-slide-up shadow-lg relative z-50 mb-4">
                    <div class="flex justify-between items-start">
                        <div><h4 class="font-bold text-lg text-slate-800 flex items-center gap-2">${isPerfectMatch ? 'ğŸ† ÎŒÎ»Î± Î”Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î±!' : 'âš ï¸ ÎœÎµÏÎ¹ÎºÎ® Î”Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±'}</h4><p class="text-xs text-slate-500 mb-2">Î‘Ï€ÏŒÏƒÏ„Î±ÏƒÎ·: <span class="font-mono font-bold text-slate-700">${resp.distance} Ï‡Î»Î¼</span></p>
                        <div class="mt-2"><p class="text-[10px] font-bold text-slate-400 uppercase mb-1">Î’ÏÎµÎ¸Î·ÎºÎ±Î½:</p><div class="flex flex-wrap">${foundBadges}</div></div>
                        ${missingBadges ? `<div class="mt-2"><p class="text-[10px] font-bold text-slate-400 uppercase mb-1">Î›ÎµÎ¹Ï€Î¿Ï…Î½:</p><div class="flex flex-wrap">${missingBadges}</div></div>` : ''}</div>
                        <div class="text-right"><div class="text-[10px] text-slate-400 bg-slate-100 px-2 py-1 rounded">${resp.response_type === 'generic' ? 'Î“ÎµÎ½ÏŒÏƒÎ·Î¼Î±' : 'Î ÏÏ‰Ï„ÏŒÏ„Ï…Ï€Î±'}</div></div>
                    </div>
                    <div class="mt-4 text-xs text-slate-500 bg-slate-50 p-2 rounded border border-slate-100 italic">"${resp.message}"</div>
                    <button onclick="handleBookingClick('${resp.id}')" class="w-full mt-4 ${btnClass} text-white font-bold py-3 rounded-xl shadow-md active:scale-95 transition-all">${btnText}</button>
                </div>
            `;
            list.insertAdjacentHTML(method, html);
            try { new Audio('https://cdn.freesound.org/previews/536/536108_10463375-lq.mp3').play().catch(e=>{}); } catch(e){}
        }

        // 3. NEW HANDLER FUNCTION
        function handleBookingClick(responseId) {
            const resp = responseStore[responseId];
            if (!resp) return showToast("Î£Ï†Î¬Î»Î¼Î± Î±Î½Î¬ÎºÏ„Î·ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½", "error");
            
            pendingPharmacyId = resp.pharmacist_id;
            const foundItems = resp.found_items || [];
            
            const responseMap = new Map(); 
            foundItems.forEach(i => responseMap.set(i.name, parseInt(i.quantity)));
            itemsNotReserved = [];
            requestItems.forEach(reqItem => {
                const reqQty = parseInt(reqItem.quantity); const foundQty = responseMap.get(reqItem.name) || 0;
                if (foundQty < reqQty) itemsNotReserved.push({ name: reqItem.name, type: reqItem.type, quantity: reqQty - foundQty });
            });
            openModal('safety');
        }

        async function confirmBooking() {
            if(!currentRequestId || !pendingPharmacyId) return; closeModal('safety'); clearInterval(responsePoller);
            const { error } = await window.db.from('requests').update({ status: 'reserved', winner_pharmacy_id: pendingPharmacyId }).eq('id', currentRequestId);
            if(error) showToast(error.message, 'error');
            else {
                document.getElementById('pickup-view').classList.remove('hidden'); document.getElementById('tab-results').classList.remove('active'); document.getElementById('pickup-code').innerText = currentRequestId.substring(0, 6);
                if(itemsNotReserved.length > 0) {
                    const alertBox = document.getElementById('missing-items-alert'); const missingList = document.getElementById('missing-items-list');
                    alertBox.classList.remove('hidden'); missingList.innerHTML = itemsNotReserved.map(i => `<span class="bg-red-100 text-red-700 px-2 py-1 rounded text-[10px] font-bold">${i.name} (x${i.quantity})</span>`).join('');
                } else document.getElementById('missing-items-alert').classList.add('hidden');
                startTimer();
            }
        }

        function reSearchMissing() {
            document.getElementById('pickup-view').classList.add('hidden'); 
            document.getElementById('responses-list').innerHTML = ''; 
            document.getElementById('responses-list').classList.add('hidden'); 
            document.getElementById('loading-state').classList.remove('hidden'); 
            document.getElementById('missing-items-alert').classList.add('hidden');
            requestItems = itemsNotReserved; 
            updateItemsUI(); 
            switchTab('search'); 
            const submitBtn = document.querySelector('#request-form button[type="submit"]');
            if(submitBtn) {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="ph ph-paper-plane-right text-xl"></i> <span data-lang-key="send">Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®</span>';
            }
            showToast("Î— Î»Î¯ÏƒÏ„Î± ÎµÎ½Î·Î¼ÎµÏÏÎ¸Î·ÎºÎµ Î¼Îµ Ï„Î± ÎµÎ¯Î´Î· Ï€Î¿Ï… Î­Î»ÎµÎ¹Ï€Î±Î½!", 'info');
        }

        function startTimer() { let duration = 3600; const el = document.getElementById('timer-display'); const pickupTimer = setInterval(() => { const m = Math.floor(duration / 60); const s = duration % 60; el.innerText = `${m}:${s<10?'0':''}${s}`; if(--duration < 0) { clearInterval(pickupTimer); el.innerText = "Î•Î›Î—ÎÎ•"; el.classList.add('text-red-500'); } }, 1000); }
        
        function handleFileSelect(input) { 
            if(input.files[0]) { 
                const reader = new FileReader();
                reader.onload = function(e) {
                    tempImageBase64 = e.target.result; 
                    document.getElementById('media-preview').classList.remove('hidden'); 
                    showToast("Î— Ï†Ï‰Ï„Î¿Î³ÏÎ±Ï†Î¯Î± Ï€ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ! Î Î±Ï„Î®ÏƒÏ„Îµ 'Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÏ„Î· Î›Î¯ÏƒÏ„Î±'", 'success'); 
                };
                reader.readAsDataURL(input.files[0]);
            } 
        }
        
        function toggleScanner() { const c = document.getElementById('scanner-container'); if(!c.classList.contains('hidden')) { if(html5QrcodeScanner) html5QrcodeScanner.stop().then(() => { c.classList.add('hidden'); html5QrcodeScanner.clear(); }); return; } c.classList.remove('hidden'); setTimeout(() => { html5QrcodeScanner = new Html5Qrcode("reader"); html5QrcodeScanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, (t) => { html5QrcodeScanner.stop().then(() => c.classList.add('hidden')); document.getElementById('medicine').value = t; showToast("Barcode Scanned!", 'success'); }, (e) => {}); }, 100); }
        function startVoiceInput() { if (!SpeechRecognition) return showToast("Î”ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÏ„Î±Î¹.", 'error'); const recognition = new SpeechRecognition(); recognition.lang = currentLang === 'el' ? 'el-GR' : 'en-US'; recognition.onstart = () => showToast("ÎœÎ¹Î»Î®ÏƒÏ„Îµ Ï„ÏÏÎ±...", 'info'); recognition.onresult = (e) => { document.getElementById('medicine').value = e.results[0][0].transcript; showToast("Î•Î¯Ï€Î±Ï„Îµ: " + e.results[0][0].transcript, 'success'); }; recognition.start(); }
        function switchTab(id) { document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active')); document.getElementById('tab-' + id).classList.add('active'); if(id !== 'results') document.getElementById('pickup-view').classList.add('hidden'); }
        function openModal(t){document.getElementById(`modal-${t}`).classList.add('active');}
        function closeModal(t){document.getElementById(`modal-${t}`).classList.remove('active');}
        function createEmojis() { const c = document.getElementById('emoji-container'); const em = ['ğŸ’Š','ğŸ©º','ğŸ¥','ğŸ©¹','ğŸ§ª','ğŸ§¬','ğŸ§´']; for(let i=0; i<15; i++){ const e = document.createElement('div'); e.innerText = em[Math.floor(Math.random() * em.length)]; e.classList.add('emoji'); e.style.left = Math.random() * 100 + '%'; e.style.animationDuration = (12 + Math.random() * 20) + 's'; e.style.animationDelay = (Math.random() * 10) + 's'; c.appendChild(e); } }
        function setupAutocomplete(id, boxId, data) { const inp = document.getElementById(id); const box = document.getElementById(boxId); inp.addEventListener('input', (e) => { const v = e.target.value.toLowerCase(); if(v.length < 1) { box.style.display = 'none'; return; } const m = data.filter(i => i.toLowerCase().includes(v)); box.innerHTML = m.map(i => `<div class="suggestion-item" onclick="document.getElementById('${id}').value='${i}'; document.getElementById('${boxId}').style.display='none'">${i}</div>`).join(''); box.style.display = m.length ? 'block' : 'none'; }); document.addEventListener('click', (e) => { if(!inp.contains(e.target)) box.style.display = 'none'; }); }
        function toggleTheme() { document.documentElement.classList.toggle('dark'); }
        function saveUserData() { localStorage.setItem('mr_user', JSON.stringify({ n: document.getElementById('full-name').value, p: document.getElementById('phone').value, c: document.getElementById('city').value })); }
        function loadUserData() { const d = JSON.parse(localStorage.getItem('mr_user') || '{}'); if(d.n) document.getElementById('full-name').value = d.n; if(d.p) document.getElementById('phone').value = d.p; if(d.c) document.getElementById('city').value = d.c; }
        function resetApp() { window.location.reload(); }
        function showToast(m, t='info') { const c = document.getElementById('toast-container'); const e = document.createElement('div'); e.className = `p-3 rounded-xl shadow-lg text-white text-sm mb-2 ${t==='success'?'bg-green-500':t==='error'?'bg-red-500':'bg-slate-800'} animate-toast`; e.innerText = m; c.appendChild(e); setTimeout(()=>e.remove(), 3000); }
        function openGoogleMaps() { if(userLocation.lat && userLocation.lon) { window.open(`https://maps.google.com/?q=${userLocation.lat},${userLocation.lon}`, '_blank'); } else { window.open(`https://maps.google.com/?q=${document.getElementById('city').value}`, '_blank'); } }
        
        function getLocation() {
            if(!navigator.geolocation) return showToast("GPS not supported.", "error");
            const btn = document.querySelector('button[onclick="getLocation()"]');
            const originalText = btn.innerHTML; btn.innerHTML = '<i class="ph ph-spinner animate-spin"></i>'; 
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    userLocation = { lat: position.coords.latitude, lon: position.coords.longitude };
                    fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${userLocation.lat}&lon=${userLocation.lon}&addressdetails=1`)
                        .then(r => r.json()).then(d => {
                            let loc = d.address.city || d.address.town || d.address.village || "Î¤Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î± OK";
                            document.getElementById('city').value = loc; saveUserData(); showToast("Î’ÏÎ­Î¸Î·ÎºÎµ: " + loc, "success");
                        }).finally(() => { btn.innerHTML = originalText; });
                },
                () => { showToast("Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±.", "error"); btn.innerHTML = originalText; },
                { enableHighAccuracy: true, timeout: 3000 }
            );
        }
        
        function toggleLang() {
            currentLang = currentLang === 'el' ? 'en' : 'el';
            document.getElementById('lang-flag').innerText = currentLang === 'el' ? 'ğŸ‡¬ğŸ‡·' : 'ğŸ‡¬ğŸ‡§';
            document.querySelectorAll('[data-lang-key]').forEach(el => { const key = el.getAttribute('data-lang-key'); if(translations[currentLang][key]) el.innerText = translations[currentLang][key]; });
        }
        
        async function handleMagicLink(e) { e.preventDefault(); const email = document.getElementById('user-email').value; const { error } = await window.db.auth.signInWithOtp({ email, options: { emailRedirectTo: window.location.href } }); if (error) showToast("Error: "+error.message, 'error'); else { showToast("Check email!", 'success'); closeModal('user'); } }
        function updateNavForUser(user) { if (user.is_anonymous) return; const n = user.user_metadata.full_name || (user.email ? user.email.split('@')[0] : 'User'); document.getElementById('user-nav-container').innerHTML = `<div class="flex gap-2"><button class="bg-teal-50 dark:bg-teal-900 px-3 py-2 rounded-xl text-xs font-bold text-teal-700 dark:text-teal-300 border border-teal-200 shadow-sm flex items-center gap-2"><i class="ph ph-user"></i> ${n}</button></div>`; }
    </script>
</body>
</html>
