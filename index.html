<!DOCTYPE html>
<html lang="el" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MediRadar – Pharmacy Console</title>

  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#29a3a3" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            brand: { 500:'#29a3a3', 600:'#208181', 700:'#196464' }
          },
          boxShadow: { soft:'0 12px 28px rgba(15,23,42,.12)' }
        }
      }
    }
  </script>

  <style>
    .app-bg{
      background:
        radial-gradient(900px 500px at 10% -10%, rgba(132,197,244,.25), transparent 60%),
        radial-gradient(700px 420px at 110% 0%, rgba(199,166,244,.20), transparent 55%),
        radial-gradient(900px 520px at 30% 120%, rgba(247,141,167,.16), transparent 60%),
        radial-gradient(700px 420px at 120% 120%, rgba(157,224,214,.18), transparent 60%),
        linear-gradient(180deg, #f7fbfb, #f8fafc 40%, #f8fafc);
    }
  </style>
</head>
<body class="min-h-full app-bg text-slate-900">
  <header class="sticky top-0 z-40 bg-white/70 backdrop-blur border-b border-slate-200">
    <div class="max-w-3xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-2xl bg-brand-500 text-white grid place-items-center shadow-inner">
          <svg viewBox="0 0 24 24" class="w-5 h-5"><path fill="currentColor" d="M11 2h2v3.06A7 7 0 0 1 18.94 11H22v2h-3.06A7 7 0 0 1 13 18.94V22h-2v-3.06A7 7 0 0 1 5.06 13H2v-2h3.06A7 7 0 0 1 11 5.06V2Zm1 5a5 5 0 1 0 0 10a5 5 0 0 0 0-10Z"/></svg>
        </div>
        <span class="text-xl font-semibold">MediRadar – Pharmacy Console</span>
      </div>
    </div>
  </header>

  <main class="max-w-3xl mx-auto px-4 py-6">
    <section class="rounded-2xl bg-white/90 shadow-soft border border-slate-200 p-5">
      <h1 class="text-2xl font-bold mb-1">Δήλωση Διαθεσιμότητας</h1>
      <p class="text-slate-600 mb-5">Συμπλήρωσε το token του πελάτη και τα στοιχεία φαρμακείου για να δηλώσεις «Διαθέσιμο».</p>

      <form id="form" class="grid grid-cols-1 gap-4">
        <div>
          <label class="block text-sm font-medium mb-1">API Key (ασφαλές)</label>
          <input id="apiKey" type="password" required
                 class="w-full px-3 py-3 rounded-xl border border-slate-300 focus:outline-none focus:ring-4 focus:ring-brand-500/30"
                 placeholder="εισαγωγή API key" />
          <p class="text-xs text-slate-500 mt-1">Το API key ΔΕΝ αποθηκεύεται. Ζητήστε το από τον διαχειριστή.</p>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Token Αίτησης (status_token)</label>
          <input id="token" type="text" required
                 class="w-full px-3 py-3 rounded-xl border border-slate-300 focus:outline-none focus:ring-4 focus:ring-brand-500/30"
                 placeholder="π.χ. a1b2c3d4" />
        </div>

        <div class="grid sm:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium mb-1">Όνομα Φαρμακείου</label>
            <input id="pharmacy_name" type="text" required
                   class="w-full px-3 py-3 rounded-xl border border-slate-300 focus:outline-none focus:ring-4 focus:ring-brand-500/30"
                   placeholder="π.χ. Φαρμακείο Ιάκωβος" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Τηλέφωνο</label>
            <input id="phone" type="tel"
                   class="w-full px-3 py-3 rounded-xl border border-slate-300 focus:outline-none focus:ring-4 focus:ring-brand-500/30"
                   placeholder="+30 21X XXXX XXX" />
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Διεύθυνση</label>
          <input id="address" type="text"
                 class="w-full px-3 py-3 rounded-xl border border-slate-300 focus:outline-none focus:ring-4 focus:ring-brand-500/30"
                 placeholder="π.χ. Σταδίου 1, Αθήνα" />
        </div>

        <div class="grid sm:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium mb-1">Latitude (προαιρετικό)</label>
            <input id="lat" type="number" step="any"
                   class="w-full px-3 py-3 rounded-xl border border-slate-300 focus:outline-none focus:ring-4 focus:ring-brand-500/30"
                   placeholder="37.98" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Longitude (προαιρετικό)</label>
            <input id="lng" type="number" step="any"
                   class="w-full px-3 py-3 rounded-xl border border-slate-300 focus:outline-none focus:ring-4 focus:ring-brand-500/30"
                   placeholder="23.73" />
          </div>
        </div>

        <div class="flex gap-3 justify-end pt-2">
          <button type="reset" class="px-4 py-2 rounded-xl border border-slate-300 hover:bg-slate-100">Καθαρισμός</button>
          <button type="submit" class="px-5 py-2.5 rounded-xl bg-brand-600 text-white font-semibold hover:opacity-95">Δήλωση Διαθεσιμότητας</button>
        </div>
      </form>

      <div id="msg" class="mt-4 text-sm"></div>
    </section>
  </main>

  <script>
    const form = document.getElementById('form');
    const msg  = document.getElementById('msg');

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      msg.textContent = 'Αποστολή...';

      const apiKey = document.getElementById('apiKey').value.trim();
      const body = {
        token: document.getElementById('token').value.trim(),
        pharmacy_name: document.getElementById('pharmacy_name').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        address: document.getElementById('address').value.trim(),
        lat: parseFloat(document.getElementById('lat').value || '0') || null,
        lng: parseFloat(document.getElementById('lng').value || '0') || null
      };

      if(!apiKey){ msg.textContent = 'Χρειάζεται API key.'; return; }

      try{
        const res = await fetch('/.netlify/functions/pharmacy-reply', {
          method:'POST',
          headers: { 'Content-Type':'application/json', 'X-API-Key': apiKey },
          body: JSON.stringify(body)
        });
        const j = await res.json();
        if(res.ok && j.ok){
          msg.innerHTML = '<span class="text-emerald-700">✔ Η διαθεσιμότητα καταχωρήθηκε.</span>';
          form.reset();
        }else{
          msg.innerHTML = `<span class="text-rose-700">⚠ Σφάλμα: ${j.error || res.status}</span>`;
        }
      }catch(err){
        console.error(err);
        msg.innerHTML = '<span class="text-rose-700">⚠ Σφάλμα δικτύου</span>';
      }
    });
  </script>
</body>
</html>
