<!DOCTYPE html>
<html lang="el" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MediRadar App</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <!-- Barcode Scanner -->
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

    <!-- Supabase Client -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        primary: '#0d9488', // Teal-600
                        secondary: '#0f172a', // Slate-900
                    },
                    animation: {
                        'float': 'float 15s linear infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in': 'fadeIn 0.3s ease-out forwards',
                        'slide-up': 'slideUp 0.3s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        slideInUp: { /* Toast Entry */
                            '0%': { transform: 'translateY(100px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        slideOutDown: { /* Toast Exit */
                            '0%': { transform: 'translateY(0)', opacity: '1' },
                            '100%': { transform: 'translateY(100px)', opacity: '0' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Floating Emojis */
        .emoji-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            overflow: hidden; z-index: 0; pointer-events: none;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            transition: background 0.5s ease;
        }
        
        html.dark .emoji-bg {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        .emoji {
            position: absolute; bottom: -100px;
            font-size: 2rem; opacity: 0.4;
            animation: floatUp 15s linear infinite;
            z-index: 0;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            10% { opacity: 0.5; }
            90% { opacity: 0.5; }
            100% { transform: translateY(-110vh) rotate(360deg); opacity: 0; }
        }
        
        /* Glassmorphism Card - Stronger borders for visibility */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.1);
            position: relative; z-index: 10;
            transition: all 0.3s ease;
        }

        html.dark .glass-card {
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.3);
        }

        /* Modal Styles */
        .modal-backdrop {
            display: none;
            position: fixed; inset: 0; z-index: 50;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(4px);
            align-items: center; justify-content: center;
            padding: 1rem;
        }
        .modal-backdrop.active { display: flex; animation: fadeIn 0.2s ease-out; }

        .modal-content {
            width: 100%; max-width: 400px;
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            transform: scale(0.95); opacity: 0;
        }
        
        .modal-backdrop.active .modal-content {
            animation: slideUp 0.3s ease-out forwards;
        }
        
        /* Toast Animations */
        .toast-enter { animation: slideInUp 0.3s ease-out forwards; }
        .toast-exit { animation: slideOutDown 0.3s ease-in forwards; }
        
        body::-webkit-scrollbar { width: 0px; background: transparent; }

        /* Tab Animation */
        .tab-content { display: none; animation: fadeIn 0.3s ease-out; }
        .tab-content.active { display: block; }

        /* Pro Access Footer Button */
        .pro-footer-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
            padding: 0.65rem 0.95rem;
            border-radius: 9999px;
            background: linear-gradient(90deg, #0f172a 0%, #1e293b 100%);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 10px 25px -12px rgba(15, 23, 42, 0.5);
            transition: transform 0.2s ease, opacity 0.2s ease;
        }

        .pro-footer-btn:hover {
            transform: translateY(-1px);
            opacity: 0.95;
        }

        html.dark .pro-footer-btn {
            background: linear-gradient(90deg, #0d9488 0%, #14b8a6 100%);
            color: #0b172a;
        }
    </style>
</head>
<body class="text-slate-800 dark:text-slate-100 antialiased min-h-screen relative flex flex-col">

    <!-- 1. Background Animation -->
    <div id="emoji-container" class="emoji-bg"></div>

    <!-- Top Bar: Settings & Auth -->
    <nav class="w-full max-w-lg mx-auto p-4 flex justify-between items-center z-20 relative">
        <!-- Login Buttons -->
        <div class="flex gap-2">
            <button onclick="openModal('user')" class="bg-white/90 dark:bg-slate-800/90 hover:bg-white dark:hover:bg-slate-700 px-3 py-2 rounded-xl text-xs font-bold text-primary border border-primary/20 transition-all flex items-center gap-1 shadow-sm backdrop-blur-md hover:shadow-md">
                <i class="ph ph-user text-lg"></i> Είσοδος
            </button>
        </div>

        <!-- Toggles -->
        <div class="flex gap-2">
            <!-- Language Toggle -->
            <button onclick="toggleLang()" class="bg-white/60 dark:bg-slate-700/60 w-10 h-10 rounded-full flex items-center justify-center text-xl shadow-sm hover:scale-110 transition-transform border border-white/50" title="Αλλαγή Γλώσσας">
                <span id="lang-flag">🇬🇷</span>
            </button>
            
            <!-- Dark Mode Toggle -->
            <button onclick="toggleTheme()" class="bg-white/60 dark:bg-slate-700/60 w-10 h-10 rounded-full flex items-center justify-center text-slate-700 dark:text-yellow-300 shadow-sm hover:scale-110 transition-transform border border-white/50" title="Dark/Light Mode">
                <i id="theme-icon" class="ph ph-moon-stars text-xl"></i>
            </button>
        </div>
    </nav>

    <main class="w-full max-w-lg mx-auto p-4 pb-6 flex-grow z-10 relative">
        
        <!-- 2. Header -->
        <header class="text-center mb-6">
            <div class="inline-flex items-center justify-center bg-white/70 dark:bg-slate-700/70 p-4 rounded-2xl mb-3 shadow-sm backdrop-blur-sm border border-white/50">
                <i class="ph ph-magnifying-glass text-4xl text-primary"></i>
            </div>
            <h1 class="text-3xl font-bold text-primary bg-clip-text text-transparent bg-gradient-to-r from-teal-600 to-cyan-500 drop-shadow-sm">
                MediRadar
            </h1>
            <p class="text-slate-500 dark:text-slate-400 text-sm mt-1 font-medium">Βρες το φάρμακό σου άμεσα & τοπικά.</p>
        </header>

        <!-- 3. Navigation Tabs -->
        <div class="flex p-1.5 bg-slate-200/80 dark:bg-slate-800/80 rounded-2xl mb-6 glass-card">
            <button onclick="switchTab('search')" id="btn-search" class="flex-1 py-3 rounded-xl text-sm font-bold transition-all bg-white dark:bg-slate-700 shadow-sm text-primary dark:text-teal-300 ring-1 ring-black/5">
                Αναζήτηση
            </button>
            <button onclick="switchTab('how')" id="btn-how" class="flex-1 py-3 rounded-xl text-sm font-bold text-slate-500 dark:text-slate-400 hover:bg-white/50 dark:hover:bg-slate-700/50 transition-all">
                Πώς λειτουργεί
            </button>
        </div>

        <!-- 4. Search Tab Content -->
        <div id="tab-search" class="tab-content active">
            <div class="glass-card rounded-3xl p-6 relative overflow-hidden">
                
                <form id="request-form" class="space-y-6">
                    
                    <!-- Personal Info (Fields with Local Storage) -->
                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-slate-700 dark:text-slate-300 uppercase ml-1">Ονομα</label>
                            <input id="full-name" type="text" placeholder="Μαρία Π." oninput="saveUserData()"
                                   class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-2xl px-4 py-3.5 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-white placeholder-slate-400 font-medium shadow-sm" required>
                        </div>
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-slate-700 dark:text-slate-300 uppercase ml-1">Τηλεφωνο</label>
                            <input id="phone" type="tel" placeholder="69..." oninput="saveUserData()"
                                   class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-2xl px-4 py-3.5 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-white placeholder-slate-400 font-medium shadow-sm" required>
                        </div>
                    </div>

                    <!-- Location with "Near Me" (Field with Local Storage) -->
                    <div class="space-y-2 relative">
                        <label class="text-xs font-bold text-slate-700 dark:text-slate-300 uppercase ml-1">Περιοχη</label>
                        <div class="relative">
                            <input id="city" type="text" placeholder="π.χ. Κάτω Τούμπα" oninput="saveUserData()"
                                   class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-2xl px-4 py-3.5 pr-32 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-white placeholder-slate-400 font-medium shadow-sm" required>
                            <button type="button" onclick="getLocation()" class="absolute right-2 top-2 bottom-2 px-3 bg-teal-100 dark:bg-teal-900/40 text-teal-800 dark:text-teal-200 border border-teal-200 dark:border-teal-700 rounded-xl text-xs font-bold hover:bg-teal-200 dark:hover:bg-teal-900/60 transition-colors flex items-center gap-1 shadow-sm">
                                <i class="ph ph-navigation-arrow text-sm"></i> Κοντά μου
                            </button>
                        </div>
                    </div>

                    <div class="border-t-2 border-dashed border-slate-200 dark:border-slate-700 my-2"></div>

                    <!-- Medicine Info Expanded (Includes Voice Input) -->
                    <div class="space-y-4">
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-slate-700 dark:text-slate-300 uppercase ml-1">Ονομα Φαρμακου</label>
                            <div class="relative">
                                <i class="ph ph-pill absolute left-4 top-4 text-slate-400 text-xl z-10"></i>
                                <input id="medicine" type="text" placeholder="π.χ. Depon Maximum"
                                       class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-2xl pl-12 pr-12 py-3.5 text-lg font-semibold focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-white placeholder-slate-400 shadow-sm" required>

                                <!-- Microphone Button for Voice Input - IMPROVED -->
                                <button type="button" onclick="startVoiceInput()" id="voice-btn" title="Φωνητική Αναζήτηση Φαρμάκου" class="absolute right-3 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full border-2 border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 shadow-sm flex items-center justify-center text-xl text-slate-500 hover:text-primary hover:border-primary focus:outline-none focus:ring-2 focus:ring-primary/40 transition-all">
                                    <i id="mic-icon" class="ph ph-microphone text-xl"></i>
                                </button>
                            </div>
                            <p class="text-right text-xs font-semibold text-slate-500 dark:text-slate-300 flex items-center justify-end gap-1 mt-2">
                                <i class="ph ph-microphone text-sm"></i> Πατήστε να μιλήσετε
                            </p>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-2">
                                <label class="text-xs font-bold text-slate-700 dark:text-slate-300 uppercase ml-1">Δραστικη</label>
                                <input id="substance" type="text" placeholder="Προαιρετικά" 
                                       class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-2xl px-4 py-3.5 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-white placeholder-slate-400 font-medium shadow-sm text-sm">
                            </div>
                            <div class="space-y-2">
                                <label class="text-xs font-bold text-slate-700 dark:text-slate-300 uppercase ml-1">Ποσοτητα</label>
                                <input id="quantity" type="number" min="1" value="1" 
                                       class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-2xl px-4 py-3.5 text-center font-bold focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-white shadow-sm">
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label class="text-xs font-bold text-slate-700 dark:text-slate-300 uppercase ml-1">Είδος / Μορφή</label>
                            <div class="relative">
                                <select id="med-type" class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-2xl px-4 py-3.5 appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-white font-medium shadow-sm">
                                    <option value="">Επίλεξε είδος (π.χ. Χάπια)</option>
                                    <option value="pills">💊 Χάπια / Κάψουλες</option>
                                    <option value="syrup">🧴 Σιρόπι / Πόσιμο</option>
                                    <option value="cream">🧴 Αλοιφή / Κρέμα</option>
                                    <option value="inhaler">💨 Εισπνεόμενο / Σπρέι</option>
                                    <option value="injection">💉 Ενέσιμο</option>
                                    <option value="powder">🍚 Σκόνη / Φακελάκια</option>
                                    <option value="suppository">💊 Υπόθετο</option>
                                </select>
                                <i class="ph ph-caret-down absolute right-4 top-4 text-slate-500 pointer-events-none text-lg"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Unified Media Input (Professional Icons) -->
                    <div class="bg-slate-50 dark:bg-slate-800/80 rounded-2xl p-4 border-2 border-dashed border-slate-300 dark:border-slate-600 hover:border-primary/50 transition-colors">
                        <label class="text-xs font-bold text-slate-600 dark:text-slate-300 uppercase mb-3 block text-center">📸 Προσθηκη Φωτο / Barcode / Συνταγης</label>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <!-- Photo Upload Button -->
                            <input id="request-image" type="file" accept="image/*" class="hidden" onchange="handleFileSelect(this)">
                            <button type="button" onclick="document.getElementById('request-image').click()" 
                                class="flex flex-col items-center justify-center bg-white dark:bg-slate-700 hover:bg-blue-50 dark:hover:bg-slate-600 border-2 border-slate-200 dark:border-slate-600 rounded-xl p-4 transition-all hover:shadow-md group relative overflow-hidden">
                                <div class="absolute inset-0 bg-blue-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                <i class="ph ph-camera text-3xl text-slate-600 dark:text-slate-300 mb-1 group-hover:scale-110 transition-transform group-hover:text-blue-600"></i>
                                <span class="text-xs font-semibold text-slate-600 dark:text-slate-300">Φωτογραφία</span>
                            </button>

                            <!-- Scan Button -->
                            <button type="button" onclick="toggleScanner()" 
                                class="flex flex-col items-center justify-center bg-white dark:bg-slate-700 hover:bg-teal-50 dark:hover:bg-slate-600 border-2 border-slate-200 dark:border-slate-600 rounded-xl p-4 transition-all hover:shadow-md group relative overflow-hidden">
                                <div class="absolute inset-0 bg-teal-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                <i class="ph ph-barcode text-3xl text-slate-600 dark:text-slate-300 mb-1 group-hover:scale-110 transition-transform group-hover:text-teal-600"></i>
                                <span class="text-xs font-semibold text-slate-600 dark:text-slate-300">Scan Barcode</span>
                            </button>
                        </div>

                        <!-- Scanner Viewport -->
                        <div id="scanner-container" class="hidden mt-4 rounded-xl overflow-hidden relative bg-black border-2 border-primary shadow-lg">
                            <div id="reader" class="w-full h-64"></div>
                            <button type="button" onclick="stopScanner()" class="absolute top-2 right-2 bg-white/20 text-white p-1.5 rounded-full backdrop-blur-md hover:bg-white/40 transition-colors">
                                <i class="ph ph-x text-lg"></i>
                            </button>
                        </div>

                        <!-- Preview Area -->
                        <div id="media-preview" class="hidden mt-3 p-3 bg-teal-50 dark:bg-teal-900/30 border border-teal-100 dark:border-teal-800 rounded-xl flex items-center gap-3 animate-fade-in">
                            <div class="bg-teal-100 dark:bg-teal-800 p-2 rounded-lg text-xl">
                                <i class="ph ph-check-circle text-teal-600 dark:text-teal-300"></i>
                            </div>
                            <div class="flex-1 overflow-hidden">
                                <p class="text-xs text-teal-800 dark:text-teal-200 font-bold">Επιτυχία!</p>
                                <p id="preview-text" class="text-xs text-teal-600 dark:text-teal-400 truncate">Barcode: 123456</p>
                            </div>
                            <button type="button" onclick="clearMedia()" class="text-teal-400 hover:text-teal-700 dark:hover:text-teal-200 p-1">
                                <i class="ph ph-trash text-lg"></i>
                            </button>
                        </div>
                        
                        <input id="barcode-value" type="hidden">
                    </div>

                    <!-- Notes -->
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-700 dark:text-slate-300 uppercase ml-1">Σημειωσεις (Προαιρετικο)</label>
                        <textarea id="notes" rows="2" placeholder="Π.χ. Προτιμώ συγκεκριμένη εταιρεία..." 
                                  class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-2xl px-4 py-3.5 resize-none focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-white placeholder-slate-400 font-medium shadow-sm"></textarea>
                    </div>

                    <!-- Checkboxes & GDPR -->
                    <div class="space-y-3 pt-2">
                        <label class="flex items-start gap-3 p-3 rounded-xl bg-white/60 dark:bg-slate-700/40 border border-slate-200 dark:border-slate-600 hover:bg-white/80 transition-colors cursor-pointer">
                            <input type="checkbox" class="mt-1 w-4 h-4 text-primary rounded focus:ring-primary border-gray-300" checked>
                            <span class="text-xs text-slate-600 dark:text-slate-300 leading-tight">Δέχομαι να μου προτείνουν <strong>γενόσημο</strong> αν δεν υπάρχει το πρωτότυπο.</span>
                        </label>

                        <label class="flex items-start gap-3 px-3 cursor-pointer group">
                            <input type="checkbox" id="gdpr-check" class="mt-0.5 w-4 h-4 text-primary rounded focus:ring-primary border-gray-300" required>
                            <span class="text-xs text-slate-500 dark:text-slate-400 leading-tight group-hover:text-primary transition-colors">
                                Έχω διαβάσει και αποδέχομαι τους <a href="#" data-open-modal="terms" class="underline text-primary font-semibold">Όρους Χρήσης</a> και την <a href="#" data-open-modal="gdpr" class="underline text-primary font-semibold">Πολιτική Απορρήτου (GDPR)</a>.
                            </span>
                        </label>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="w-full bg-gradient-to-r from-cyan-500 to-teal-500 hover:from-cyan-600 hover:to-teal-600 text-white text-lg font-bold py-4 rounded-2xl shadow-lg shadow-teal-500/30 transform active:scale-[0.98] transition-all flex items-center justify-center gap-2">
                        <i class="ph ph-paper-plane-right text-xl"></i>
                        Αποστολή Αιτήματος
                    </button>

                </form>
            </div>
        </div>

        <!-- 5. How It Works Tab -->
        <div id="tab-how" class="tab-content">
            <div class="glass-card rounded-3xl p-6">
                <h3 class="text-xl font-bold mb-6 text-slate-800 dark:text-white flex items-center gap-2">
                    <i class="ph ph-info text-primary"></i> Πώς λειτουργεί;
                </h3>
                <ul class="space-y-6">
                    <li class="flex gap-4 items-start">
                        <div class="bg-teal-100 dark:bg-teal-900 text-teal-700 dark:text-teal-300 w-10 h-10 rounded-full flex items-center justify-center font-bold flex-shrink-0 text-lg shadow-sm">1</div>
                        <div>
                            <h4 class="font-bold text-slate-800 dark:text-slate-200">Αίτημα</h4>
                            <p class="text-slate-600 dark:text-slate-400 text-sm mt-1">Συμπληρώνεις τη φόρμα, ανεβάζεις φωτό ή σαρώνεις το barcode/συνταγή.</p>
                        </div>
                    </li>
                    <li class="flex gap-4 items-start">
                        <div class="bg-teal-100 dark:bg-teal-900 text-teal-700 dark:text-teal-300 w-10 h-10 rounded-full flex items-center justify-center font-bold flex-shrink-0 text-lg shadow-sm">2</div>
                        <div>
                            <h4 class="font-bold text-slate-800 dark:text-slate-200">Ειδοποίηση</h4>
                            <p class="text-slate-600 dark:text-slate-400 text-sm mt-1">Το MediRadar ψάχνει στα φαρμακεία κοντά στην τοποθεσία σου.</p>
                        </div>
                    </li>
                    <li class="flex gap-4 items-start">
                        <div class="bg-teal-100 dark:bg-teal-900 text-teal-700 dark:text-teal-300 w-10 h-10 rounded-full flex items-center justify-center font-bold flex-shrink-0 text-lg shadow-sm">3</div>
                        <div>
                            <h4 class="font-bold text-slate-800 dark:text-slate-200">Κράτηση</h4>
                            <p class="text-slate-600 dark:text-slate-400 text-sm mt-1">Λαμβάνεις απαντήσεις, επιλέγεις φαρμακείο και παραλαμβάνεις!</p>
                        </div>
                    </li>
                </ul>
            </div>
        </div>

        <!-- 6. Status / Pickup Timer Screen (Updated) -->
        <div id="pickup-view" class="hidden animate-fadeIn">
            <div class="glass-card rounded-3xl p-8 text-center border-teal-200 dark:border-teal-800">
                
                <!-- Pickup Deadline Timer -->
                <div class="w-24 h-24 bg-teal-100 dark:bg-teal-900/50 rounded-full flex flex-col items-center justify-center mx-auto mb-6 shadow-xl ring-8 ring-teal-50 dark:ring-teal-900/20">
                    <i class="ph ph-hourglass-high text-4xl text-primary mb-1"></i>
                    <p class="text-xs font-bold text-primary">Pickup</p>
                </div>
                
                <h2 class="text-2xl font-bold text-slate-800 dark:text-white mb-2">Χρόνος Παραλαβής</h2>
                <p class="text-slate-500 dark:text-slate-400 mb-6">Κρατήθηκε για εσάς στο φαρμακείο! Παρακαλώ παραλάβετε εντός:</p>
                
                <!-- TIMER DISPLAY -->
                <div class="bg-white dark:bg-slate-700 rounded-2xl p-4 mb-6 shadow-inner border border-slate-200 dark:border-slate-700">
                    <p id="timer-display" class="text-5xl font-extrabold text-primary dark:text-teal-400 tracking-tighter">
                        --:--
                    </p>
                    <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Λεπτά</p>
                </div>

                <!-- Extend Button & Info -->
                <div class="space-y-2 mb-4">
                    <button id="extend-btn" onclick="extendPickupTime()" disabled 
                        class="w-full bg-slate-200 dark:bg-slate-700 text-slate-500 font-bold py-3 rounded-xl transition-all flex items-center justify-center gap-2 text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="ph ph-timer text-lg"></i> Παράταση 15' (Διαθέσιμη)
                    </button>
                    <p id="extend-info" class="text-xs text-slate-500 dark:text-slate-400">
                        Μπορείτε να χρησιμοποιήσετε την παράταση μόνο μία φορά κάθε 24 ώρες.
                    </p>
                </div>
                

                <button onclick="resetApp()" class="text-sm text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 font-medium flex items-center justify-center gap-1 mx-auto">
                    <i class="ph ph-x-circle"></i> Ολοκλήρωση/Ακύρωση παραλαβής
                </button>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="mt-auto py-6 bg-white/50 dark:bg-slate-900/50 backdrop-blur-md border-t border-slate-200 dark:border-slate-800 z-10">
        <div class="max-w-lg mx-auto px-4 text-center">
            <div class="flex justify-center mb-4">
                <button onclick="openModal('pro')" class="pro-footer-btn" aria-label="Πρόσβαση Pro">
                    <i class="ph ph-briefcase text-lg"></i>
                    <span class="text-xs font-semibold tracking-wide uppercase">Pro</span>
                </button>
            </div>
            <div class="flex justify-center gap-4 mb-4">
                <a href="https://www.facebook.com/mediradar" target="_blank" rel="noreferrer" aria-label="Facebook"
                    class="w-9 h-9 rounded-full bg-[#1877F2] text-white flex items-center justify-center hover:brightness-110 transition shadow-sm">
                    <i class="ph ph-facebook-logo text-lg"></i>
                    <span class="sr-only">Facebook</span>
                </a>
                <a href="https://www.instagram.com/mediradar" target="_blank" rel="noreferrer" aria-label="Instagram"
                    class="w-9 h-9 rounded-full bg-gradient-to-br from-[#f58529] via-[#dd2a7b] to-[#8134af] text-white flex items-center justify-center hover:brightness-110 transition shadow-sm">
                    <i class="ph ph-instagram-logo text-lg"></i>
                    <span class="sr-only">Instagram</span>
                </a>
                <a href="https://www.linkedin.com/company/mediradar" target="_blank" rel="noreferrer" aria-label="LinkedIn"
                    class="w-9 h-9 rounded-full bg-[#0A66C2] text-white flex items-center justify-center hover:brightness-110 transition shadow-sm">
                    <i class="ph ph-linkedin-logo text-lg"></i>
                    <span class="sr-only">LinkedIn</span>
                </a>
            </div>
            <div class="flex flex-wrap justify-center gap-x-6 gap-y-2 text-xs text-slate-500 dark:text-slate-400 font-medium mb-4">
                <a href="#" data-open-modal="terms" class="hover:text-primary transition-colors">Όροι Χρήσης</a>
                <a href="#" data-open-modal="gdpr" class="hover:text-primary transition-colors">Πολιτική Απορρήτου (GDPR)</a>
                <a href="#" class="hover:text-primary transition-colors">FAQ</a>
                <a href="#" class="hover:text-primary transition-colors">Επικοινωνία</a>
            </div>
            <p class="text-xs text-slate-400 dark:text-slate-600">© 2023 MediRadar. All rights reserved.</p>
        </div>
    </footer>

    <!-- TOAST NOTIFICATIONS CONTAINER -->
    <div id="toast-container" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50 w-full max-w-sm px-4 space-y-2 pointer-events-none">
        <!-- Toasts will be dynamically added here -->
    </div>

    <!-- MODALS -->
    <!-- Terms of Use Modal -->
    <div id="modal-terms" class="modal-backdrop">
        <div class="modal-content bg-white dark:bg-slate-800 relative glass-card !opacity-100 !transform-none max-h-[80vh] overflow-y-auto text-left space-y-4">
            <button onclick="closeModal('terms')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors"><i class="ph ph-x text-xl"></i></button>
            <div class="space-y-2">
                <p class="text-xs uppercase tracking-wide text-primary font-semibold">Όροι Χρήσης</p>
                <h3 class="text-2xl font-bold text-slate-800 dark:text-white">Εφαρμογή Mediradar</h3>
                <p class="text-sm text-slate-500 dark:text-slate-300">Τελευταία ενημέρωση: 21 Νοεμβρίου 2025</p>
            </div>

            <div class="space-y-4 text-sm text-slate-600 dark:text-slate-300 leading-relaxed">
                <p><strong>1. Αποδοχή των Όρων</strong><br>Καλώς ήλθατε στο Mediradar. Αυτοί οι Όροι Χρήσης ("Όροι") διέπουν τη χρήση της εφαρμογής Mediradar ("Εφαρμογή"), η οποία παρέχεται από [Ονομασία Εταιρείας/Ιδιοκτήτη]. Με τη λήψη, την εγκατάσταση ή τη χρήση της Εφαρμογής, αποδέχεστε και συμφωνείτε να δεσμεύεστε από αυτούς τους Όρους. Εάν δεν συμφωνείτε με οποιοδήποτε μέρος αυτών των Όρων, δεν πρέπει να χρησιμοποιήσετε την Εφαρμογή.</p>

                <p><strong>2. Σκοπός της Εφαρμογής Mediradar</strong><br>Η εφαρμογή Mediradar έχει σχεδιαστεί για να παρέχει [Περιγραφή του σκοπού, π.χ., πληροφορίες σχετικά με φαρμακευτικά σκευάσματα, υπενθυμίσεις λήψης φαρμάκων, παρακολούθηση συμπτωμάτων].</p>

                <div class="p-4 rounded-2xl bg-amber-50 border border-amber-200 dark:bg-amber-900/20 dark:border-amber-700">
                    <p class="font-bold text-amber-800 dark:text-amber-200">ΣΗΜΑΝΤΙΚΗ ΑΠΟΠΟΙΗΣΗ ΕΥΘΥΝΗΣ (NON-MEDICAL ADVICE)</p>
                    <p class="mt-1 text-amber-800 dark:text-amber-100">Η Εφαρμογή Mediradar ΔΕΝ παρέχει ιατρικές συμβουλές. Οι πληροφορίες που παρέχονται ΔΕΝ προορίζονται να υποκαταστήσουν την επαγγελματική ιατρική διάγνωση, θεραπεία ή συμβουλή. ΠΑΝΤΑ να ζητάτε τη συμβουλή γιατρού ή άλλου εξειδικευμένου επαγγελματία υγείας για οποιεσδήποτε ερωτήσεις μπορεί να έχετε σχετικά με μια ιατρική κατάσταση.</p>
                </div>

                <p><strong>3. Δικαιώματα Πνευματικής Ιδιοκτησίας</strong><br>Όλο το περιεχόμενο, τα γραφικά, το λογισμικό και οι υπηρεσίες που περιέχονται στην Εφαρμογή αποτελούν ιδιοκτησία του [Ονομασία Εταιρείας/Ιδιοκτήτη] ή των δικαιοπαρόχων του και προστατεύονται από τη νομοθεσία περί πνευματικής ιδιοκτησίας. Σας παραχωρείται περιορισμένη, μη αποκλειστική, μη μεταβιβάσιμη άδεια χρήσης της Εφαρμογής για προσωπική, μη εμπορική χρήση.</p>

                <div class="space-y-2">
                    <p class="font-bold">4. Υποχρεώσεις Χρήστη</p>
                    <ul class="list-disc pl-6 space-y-1">
                        <li>Να παρέχει ακριβείς και πλήρεις πληροφορίες κατά την εγγραφή.</li>
                        <li>Να μην χρησιμοποιεί την Εφαρμογή για οποιονδήποτε παράνομο σκοπό ή με τρόπο που παραβιάζει τους παρόντες Όρους.</li>
                        <li>Να μην επιχειρήσει να αποκτήσει μη εξουσιοδοτημένη πρόσβαση σε οποιοδήποτε μέρος της Εφαρμογής ή των συστημάτων της.</li>
                        <li>Να είναι αποκλειστικά υπεύθυνος για την ασφάλεια του κωδικού πρόσβασης και του λογαριασμού του.</li>
                    </ul>
                </div>

                <p><strong>5. Περιορισμός Ευθύνης</strong><br>Στο μέγιστο βαθμό που επιτρέπεται από την ισχύουσα νομοθεσία, το [Ονομασία Εταιρείας/Ιδιοκτήτη] δεν φέρει ευθύνη για οποιεσδήποτε άμεσες, έμμεσες, τυχαίες, ειδικές ή αποθετικές ζημίες που προκύπτουν από τη χρήση ή την αδυναμία χρήσης της Εφαρμογής, συμπεριλαμβανομένης οποιασδήποτε εξάρτησης από τις πληροφορίες που παρέχονται από αυτήν.</p>

                <p><strong>6. Τροποποιήσεις των Όρων</strong><br>Διατηρούμε το δικαίωμα να τροποποιήσουμε αυτούς τους Όρους ανά πάσα στιγμή. Οι αλλαγές θα αναρτώνται εντός της Εφαρμογής ή στον ιστότοπό μας και η συνέχιση της χρήσης της Εφαρμογής από εσάς μετά την ανάρτηση των αλλαγών συνιστά αποδοχή των αναθεωρημένων Όρων.</p>

                <p><strong>7. Επικοινωνία</strong><br>Για οποιεσδήποτε ερωτήσεις σχετικά με τους παρόντες Όρους, παρακαλούμε επικοινωνήστε μαζί μας στη διεύθυνση: <a href="mailto:info@mediradar.com" class="text-primary font-semibold">info@mediradar.com</a>.</p>
            </div>
        </div>
    </div>

    <!-- GDPR Modal -->
    <div id="modal-gdpr" class="modal-backdrop">
        <div class="modal-content bg-white dark:bg-slate-800 relative glass-card !opacity-100 !transform-none max-h-[80vh] overflow-y-auto text-left space-y-4">
            <button onclick="closeModal('gdpr')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors"><i class="ph ph-x text-xl"></i></button>
            <div class="space-y-2">
                <p class="text-xs uppercase tracking-wide text-primary font-semibold">Πολιτική Απορρήτου &amp; GDPR</p>
                <h3 class="text-2xl font-bold text-slate-800 dark:text-white">Mediradar</h3>
                <p class="text-sm text-slate-500 dark:text-slate-300">Τελευταία ενημέρωση: 21 Νοεμβρίου 2025</p>
            </div>

            <div class="space-y-4 text-sm text-slate-600 dark:text-slate-300 leading-relaxed">
                <p><strong>1. Εισαγωγή και Υπεύθυνος Επεξεργασίας</strong><br>Η παρούσα Πολιτική Απορρήτου περιγράφει τον τρόπο με τον οποίο η εφαρμογή Mediradar ("εμείς", "μας") συλλέγει, χρησιμοποιεί και προστατεύει τα προσωπικά σας δεδομένα σύμφωνα με τον Γενικό Κανονισμό Προστασίας Δεδομένων (GDPR - Κανονισμός (ΕΕ) 2016/679).<br><br>Υπεύθυνος Επεξεργασίας: [Ονομασία Εταιρείας/Ιδιοκτήτη], [Διεύθυνση], [Στοιχεία Επικοινωνίας/Email].</p>

                <div class="space-y-2">
                    <p class="font-bold">2. Δεδομένα που Συλλέγουμε</p>
                    <p class="font-semibold">Α. Δεδομένα Χρήσης (Μη Προσωπικά)</p>
                    <ul class="list-disc pl-6 space-y-1">
                        <li>Πληροφορίες συσκευής (τύπος συσκευής, λειτουργικό σύστημα).</li>
                        <li>Δεδομένα αρχείων καταγραφής (logs), συμπεριλαμβανομένων σφαλμάτων και χρόνου χρήσης.</li>
                    </ul>
                    <p class="font-semibold">Β. Δεδομένα Εγγραφής και Επικοινωνίας</p>
                    <ul class="list-disc pl-6 space-y-1">
                        <li>Email, όνομα χρήστη (εάν παρέχονται).</li>
                    </ul>
                    <p class="font-semibold">Γ. Ειδικές Κατηγορίες Προσωπικών Δεδομένων (Δεδομένα Υγείας)</p>
                    <ul class="list-disc pl-6 space-y-1">
                        <li>Στοιχεία φαρμάκων (ονομασία, δόση, συχνότητα).</li>
                        <li>Στοιχεία ιατρικών καταστάσεων ή συμπτωμάτων που καταχωρεί ο χρήστης.</li>
                        <li>Ιστορικό υπενθυμίσεων και συμμόρφωσης στη θεραπεία.</li>
                    </ul>
                </div>

                <div class="space-y-2">
                    <p class="font-bold">3. Νομική Βάση Επεξεργασίας (GDPR Άρθρο 6 &amp; 9)</p>
                    <p><strong>Δεδομένα Υγείας (Ευαίσθητα):</strong> Ρητή Συγκατάθεση (Άρθρο 9(2)(α)) του χρήστη για τον συγκεκριμένο σκοπό παροχής της υπηρεσίας. Σκοπός: Παροχή της βασικής λειτουργικότητας της Εφαρμογής (π.χ. υπενθυμίσεις, παρακολούθηση).</p>
                    <p><strong>Δεδομένα Εγγραφής:</strong> Εκτέλεση σύμβασης (Όροι Χρήσης) (Άρθρο 6(1)(β)). Σκοπός: Διαχείριση λογαριασμού και επικοινωνία σχετικά με την υπηρεσία.</p>
                    <p><strong>Δεδομένα Χρήσης:</strong> Έννομο Συμφέρον (Άρθρο 6(1)(στ)). Σκοπός: Βελτίωση, συντήρηση και ασφάλεια της Εφαρμογής.</p>
                    <p class="text-amber-700 dark:text-amber-200"><strong>Σημαντικό για Δεδομένα Υγείας:</strong> Η επεξεργασία των δεδομένων υγείας πραγματοποιείται ΜΟΝΟ εφόσον έχετε δώσει τη ρητή και ενημερωμένη συγκατάθεσή σας. Μπορείτε να ανακαλέσετε αυτή τη συγκατάθεση ανά πάσα στιγμή.</p>
                </div>

                <div class="space-y-2">
                    <p class="font-bold">4. Ασφάλεια και Αποθήκευση Δεδομένων</p>
                    <ul class="list-disc pl-6 space-y-1">
                        <li><strong>Κρυπτογράφηση:</strong> Τα δεδομένα υγείας κρυπτογραφούνται τόσο κατά τη μεταφορά (SSL/TLS) όσο και κατά την αποθήκευση (εντός των βάσεων δεδομένων).</li>
                        <li><strong>Πρόσβαση:</strong> Η πρόσβαση στα δεδομένα περιορίζεται μόνο στο απολύτως απαραίτητο προσωπικό μας.</li>
                        <li><strong>Διατήρηση:</strong> Διατηρούμε τα προσωπικά δεδομένα μόνο για όσο διάστημα είναι απαραίτητο για την εκπλήρωση των σκοπών για τους οποίους συλλέχθηκαν, εκτός εάν απαιτείται μεγαλύτερη περίοδος διατήρησης από τη νομοθεσία. Εάν διαγράψετε τον λογαριασμό σας, τα δεδομένα υγείας σας θα διαγραφούν οριστικά εντός [Προθεσμία, π.χ., 30 ημερών], με την επιφύλαξη τυχόν νόμιμων υποχρεώσεων διατήρησης.</li>
                    </ul>
                </div>

                <div class="space-y-2">
                    <p class="font-bold">5. Τα Δικαιώματά σας (GDPR)</p>
                    <ul class="list-disc pl-6 space-y-1">
                        <li><strong>Δικαίωμα Πρόσβασης (Άρθρο 15):</strong> Να ζητήσετε αντίγραφο των προσωπικών δεδομένων που διατηρούμε για εσάς.</li>
                        <li><strong>Δικαίωμα Διόρθωσης (Άρθρο 16):</strong> Να ζητήσετε τη διόρθωση ανακριβών ή ελλιπών δεδομένων.</li>
                        <li><strong>Δικαίωμα Διαγραφής ("Δικαίωμα στη Λήθη") (Άρθρο 17):</strong> Να ζητήσετε τη διαγραφή των δεδομένων σας, υπό ορισμένες προϋποθέσεις.</li>
                        <li><strong>Δικαίωμα Περιορισμού της Επεξεργασίας (Άρθρο 18).</strong></li>
                        <li><strong>Δικαίωμα Φορητότητας Δεδομένων (Άρθρο 20):</strong> Να λάβετε τα δεδομένα σας σε δομημένο, κοινώς χρησιμοποιούμενο και αναγνώσιμο από μηχανές μορφότυπο.</li>
                        <li><strong>Δικαίωμα Εναντίωσης (Άρθρο 21):</strong> Να εναντιωθείτε στην επεξεργασία των δεδομένων σας.</li>
                        <li><strong>Δικαίωμα Υποβολής Καταγγελίας:</strong> Να υποβάλετε καταγγελία στην αρμόδια Εποπτική Αρχή (στην Ελλάδα, την Αρχή Προστασίας Δεδομένων Προσωπικού Χαρακτήρα).</li>
                    </ul>
                    <p>Για να ασκήσετε οποιοδήποτε από τα παραπάνω δικαιώματα, παρακαλούμε επικοινωνήστε μαζί μας μέσω email: <a href="mailto:info@mediradar.com" class="text-primary font-semibold">info@mediradar.com</a>.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- User Login Modal -->
    <div id="modal-user" class="modal-backdrop">
        <div class="modal-content bg-white dark:bg-slate-800 text-center relative glass-card !opacity-100 !transform-none">
            <button onclick="closeModal('user')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors"><i class="ph ph-x text-xl"></i></button>
            
            <div class="w-16 h-16 bg-teal-100 dark:bg-teal-900/50 rounded-full flex items-center justify-center mx-auto mb-4 text-primary ring-4 ring-teal-50 dark:ring-teal-900/20">
                <i class="ph ph-user text-3xl"></i>
            </div>
            <h3 class="text-xl font-bold mb-1 text-slate-800 dark:text-white">Είσοδος Χρήστη</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400 mb-6">Συνδέσου για να βλέπεις το ιστορικό σου.</p>

            <form id="magic-link-form" class="space-y-4">
                <div class="space-y-1 text-left">
                    <label for="user-email" class="text-xs font-bold text-slate-600 dark:text-slate-300 uppercase ml-1">Email</label>
                    <input id="user-email" type="email" placeholder="example@email.com" required
                           class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-xl px-4 py-3.5 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-white placeholder-slate-400 font-medium shadow-sm">
                </div>

                <button type="submit" onclick="handleMagicLink(event)" class="w-full bg-primary hover:bg-teal-700 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-all shadow-md shadow-teal-500/20">
                    <i class="ph ph-magic-wand text-lg"></i> Σύνδεση με Magic Link
                </button>
            </form>

            <button onclick="handleGoogleLogin(event)" class="w-full bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 hover:bg-slate-50 text-slate-700 dark:text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-all mt-3">
                <i class="ph ph-google-logo text-lg text-red-500"></i> Συνέχεια με Google
            </button>
            
            <p class="text-xs text-slate-400 mt-3">
                Αν είναι η πρώτη σας φορά, θα δημιουργηθεί αυτόματα λογαριασμός.<br>
                **Οδηγίες:** Ελέγξτε τα εισερχόμενά σας για τον σύνδεσμο εισόδου.
            </p>
        </div>
    </div>

    <!-- Pro Login Modal -->
    <div id="modal-pro" class="modal-backdrop">
        <div class="modal-content bg-white dark:bg-slate-800 text-center relative glass-card !opacity-100 !transform-none">
            <button onclick="closeModal('pro')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors"><i class="ph ph-x text-xl"></i></button>
            
            <div class="w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4 text-white shadow-lg shadow-slate-500/30 ring-4 ring-slate-200 dark:ring-slate-700">
                <i class="ph ph-briefcase text-3xl"></i>
            </div>
            <h3 class="text-xl font-bold mb-1 text-slate-800 dark:text-white">Είσοδος Pro</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400 mb-6">Πλατφόρμα Φαρμακοποιών & Συνεργατών.</p>

            <form class="space-y-4 text-left">
                <div class="space-y-1">
                    <label class="text-xs font-bold text-slate-600 dark:text-slate-300 uppercase ml-1">Professional Email</label>
                    <input id="pro-email" type="email" placeholder="pharmacy@example.com" required
                           class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-xl px-4 py-3.5 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-white placeholder-slate-400 font-medium shadow-sm">
                </div>
                <div class="space-y-1">
                    <label class="text-xs font-bold text-slate-600 dark:text-slate-300 uppercase ml-1">Password</label>
                    <input id="pro-password" type="password" placeholder="••••••••" required
                           class="w-full bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded-xl px-4 py-3.5 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary focus:bg-white dark:focus:bg-slate-900 transition-all text-slate-900 dark:text-white placeholder-slate-400 font-medium shadow-sm">
                </div>
                <button type="submit" onclick="handleProLogin(event)" class="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-3 rounded-xl transition-all shadow-lg mt-2">
                    Σύνδεση
                </button>
            </form>
            <p class="mt-4 text-xs text-slate-400">
                Δεν έχετε λογαριασμό; <a href="#" class="underline text-slate-600 dark:text-slate-300 font-semibold">Εγγραφή Φαρμακείου</a>.<br>
                **Οδηγίες:** Η εγγραφή απαιτεί έλεγχο ταυτοπροσωπίας και έγκριση.
            </p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/env.js"></script>
    
    <script>
        // --- 0. Global Variables & Persistence ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition = null;
        let isListening = false;
        let timerInterval = null;
        let pickupDeadline = null; // Stored as Unix Timestamp
        const STATUS_STORAGE_KEY = 'mr:pickupStatus';
        const USER_STORAGE_KEY = 'mr:pickupUserId';

        const EXTENSION_COOLDOWN_MS = 24 * 60 * 60 * 1000; // 24 hours

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const userId = (() => {
            const existing = localStorage.getItem(USER_STORAGE_KEY);
            if (existing) return existing;
            const generated = crypto.randomUUID();
            localStorage.setItem(USER_STORAGE_KEY, generated);
            return generated;
        })();

        let pickupStatus = loadPickupStatus();

        function loadPickupStatus() {
            try {
                const raw = localStorage.getItem(STATUS_STORAGE_KEY);
                return raw ? JSON.parse(raw) : null;
            } catch (e) {
                console.warn('Failed to load pickup status', e);
                return null;
            }
        }

        function savePickupStatus(status) {
            try {
                if (status) {
                    localStorage.setItem(STATUS_STORAGE_KEY, JSON.stringify(status));
                } else {
                    localStorage.removeItem(STATUS_STORAGE_KEY);
                }
            } catch (e) {
                console.warn('Failed to persist pickup status', e);
            }
        }

        function updatePickupStatus(patch) {
            pickupStatus = { ...(pickupStatus || {}), ...patch };
            savePickupStatus(pickupStatus);
        }

        function clearPickupStatus() {
            pickupStatus = null;
            savePickupStatus(null);
        }

        window.addEventListener('storage', (event) => {
            if (event.key === STATUS_STORAGE_KEY) {
                pickupStatus = loadPickupStatus();
                if (pickupStatus?.deadlineTimestamp) {
                    pickupDeadline = pickupStatus.deadlineTimestamp;
                    updateTimerDisplay(pickupDeadline, pickupStatus.lastExtendedTimestamp || 0);
                }
            }
        });
        
        // --- 1. UI Toggles & Modals ---
        function toggleTheme() {
            const html = document.documentElement;
            const icon = document.getElementById('theme-icon');
            if(html.classList.contains('dark')) {
                html.classList.remove('dark');
                icon.classList.replace('ph-sun', 'ph-moon-stars');
                icon.classList.remove('text-yellow-400');
            } else {
                html.classList.add('dark');
                icon.classList.add('dark');
                icon.classList.replace('ph-moon-stars', 'ph-sun');
                icon.classList.add('text-yellow-400');
            }
        }

        function toggleLang() {
            const flag = document.getElementById('lang-flag');
            if(flag.innerText === '🇬🇷') {
                flag.innerText = '🇬🇧';
                // Here would go the text change logic
            } else {
                flag.innerText = '🇬🇷';
            }
        }

        function openModal(type) {
            document.getElementById(`modal-${type}`).classList.add('active');
        }

        function closeModal(type) {
            document.getElementById(`modal-${type}`).classList.remove('active');
        }

        // Open Terms / GDPR modals
        document.querySelectorAll('[data-open-modal]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const type = link.getAttribute('data-open-modal');
                openModal(type);
            });
        });

        // Close modal on backdrop click
        document.querySelectorAll('.modal-backdrop').forEach(bg => {
            bg.addEventListener('click', (e) => {
                if(e.target === bg) bg.classList.remove('active');
            });
        });

        // --- 2. Toast Notifications ---
        function showToast(message, type = 'info', duration = 4000) {
            const container = document.getElementById('toast-container');
            const id = 'toast-' + Date.now();
            
            let iconClass = '';
            let colorClass = '';

            switch(type) {
                case 'success':
                    iconClass = 'ph-check-circle text-green-500';
                    colorClass = 'bg-green-50 dark:bg-green-900/40 border-green-200 dark:border-green-800';
                    break;
                case 'error':
                    iconClass = 'ph-x-circle text-red-500';
                    colorClass = 'bg-red-50 dark:bg-red-900/40 border-red-200 dark:border-red-800';
                    break;
                case 'warning':
                    iconClass = 'ph-warning-circle text-yellow-500';
                    colorClass = 'bg-yellow-50 dark:bg-yellow-900/40 border-yellow-200 dark:border-yellow-800';
                    break;
                case 'info':
                default:
                    iconClass = 'ph-info text-primary';
                    colorClass = 'bg-teal-50 dark:bg-teal-900/40 border-teal-200 dark:border-teal-800';
                    break;
            }

            // Create the toast element
            const toastElement = document.createElement('div');
            toastElement.id = id;
            toastElement.className = `toast-enter p-4 rounded-xl shadow-lg flex items-center gap-3 ${colorClass} border transition-all duration-300 opacity-0 pointer-events-auto`;
            toastElement.innerHTML = `
                <i class="ph ${iconClass} text-2xl flex-shrink-0"></i>
                <p class="text-sm font-medium text-slate-800 dark:text-slate-100">${message}</p>
            `;
            container.appendChild(toastElement);

            // Set timeout for removal
            setTimeout(() => {
                toastElement.classList.remove('toast-enter');
                toastElement.classList.add('toast-exit');
                toastElement.addEventListener('animationend', () => toastElement.remove());
            }, duration);
        }

        // --- 3. Login Logic ---
        let supabaseClient = null;

        function getSupabaseClient() {
            if (supabaseClient) return supabaseClient;

            if (window.mediradarSupabase) {
                supabaseClient = window.mediradarSupabase;
                return supabaseClient;
            }

            if (window.supabase && window.SUPABASE_URL && window.SUPABASE_ANON_KEY) {
                supabaseClient = window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);
                return supabaseClient;
            }

            console.warn('Supabase client is not configured.');
            showToast('Η σύνδεση με τον διακομιστή απέτυχε. Ελέγξτε τα κλειδιά Supabase.', 'error');
            return null;
        }

        async function handleMagicLink(e) {
            e.preventDefault(); // Prevent form submission
            const email = document.getElementById('user-email').value;

            if(!email) {
                showToast("Παρακαλώ εισάγετε το email σας.", 'warning');
                return;
            }

            const client = getSupabaseClient();
            if (!client) return;

            const { error } = await client.auth.signInWithOtp({
                email,
                options: { emailRedirectTo: window.location.origin }
            });

            if (error) {
                showToast(error.message || 'Αποτυχία αποστολής συνδέσμου.', 'error');
                return;
            }

            showToast("Ο σύνδεσμος εισόδου στάλθηκε στο " + email, 'success');
            closeModal('user');
        }

        async function handleProLogin(e) {
            e.preventDefault(); // Prevent form submission
            const email = document.getElementById('pro-email').value;
            const password = document.getElementById('pro-password').value;

            if(!email || !password) {
                showToast("Παρακαλώ συμπληρώστε όλα τα πεδία.", 'warning');
                return;
            }

            const client = getSupabaseClient();
            if (!client) return;

            const { data, error } = await client.auth.signInWithPassword({ email, password });

            if (error) {
                showToast(error.message || 'Αποτυχία σύνδεσης. Δοκιμάστε ξανά.', 'error');
                return;
            }

            const userEmail = data?.user?.email || email;
            showToast(`Καλώς ήρθες, ${userEmail}!`, 'success');
            closeModal('pro');
        }

        async function handleGoogleLogin(e) {
            e.preventDefault();
            const client = getSupabaseClient();
            if (!client) return;

            const { data, error } = await client.auth.signInWithOAuth({
                provider: 'google',
                options: { redirectTo: window.location.origin }
            });

            if (error) {
                showToast(error.message || 'Η σύνδεση με Google απέτυχε.', 'error');
                return;
            }

            if (data?.url) {
                window.location.href = data.url;
            }
        }


        // --- 4. Geolocation (Updated to use Toast) ---
        function getLocation() {
            const cityInput = document.getElementById('city');
            if (navigator.geolocation) {
                cityInput.value = "Εντοπισμός...";
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                showToast("Η εντοπισμός γεωγραφικής θέσης δεν υποστηρίζεται σε αυτή τη συσκευή.", 'error');
            }
        }

        function showPosition(position) {
            const lat = position.coords.latitude.toFixed(4);
            const lon = position.coords.longitude.toFixed(4);
            const cityInput = document.getElementById('city');
            cityInput.value = `📍 ${lat}, ${lon}`;
            saveUserData();
            showToast("Η τοποθεσία σας βρέθηκε με επιτυχία!", 'success');
        }

        function showError(error) {
            document.getElementById('city').value = "";
            showToast("Δεν ήταν δυνατός ο εντοπισμός της τοποθεσίας σας. Πληκτρολογήστε χειροκίνητα.", 'warning');
        }

        // --- 5. Floating Emojis (Background Logic) ---
        const emojis = ['💊', '🩺', '🏥', '🩹', '🧪', '🧬', '🧴', '🔬', '🚑', '🦷'];
        const container = document.getElementById('emoji-container');

        function createEmojis() {
            container.innerHTML = '';
            for(let i=0; i<15; i++) {
                const el = document.createElement('div');
                el.innerText = emojis[Math.floor(Math.random() * emojis.length)];
                el.classList.add('emoji');
                el.style.left = Math.random() * 100 + '%';
                el.style.animationDuration = (12 + Math.random() * 20) + 's'; 
                el.style.animationDelay = (Math.random() * 10) + 's';
                el.style.fontSize = (1.5 + Math.random() * 2.5) + 'rem';
                container.appendChild(el);
            }
        }
        createEmojis();

        // --- 6. Tab Switching ---
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tabName).classList.add('active');
            
            const btnSearch = document.getElementById('btn-search');
            const btnHow = document.getElementById('btn-how');
            
            const activeClass = "flex-1 py-3 rounded-xl text-sm font-bold transition-all bg-white dark:bg-slate-700 shadow-sm text-primary dark:text-teal-300 ring-1 ring-black/5";
            const inactiveClass = "flex-1 py-3 rounded-xl text-sm font-bold text-slate-500 dark:text-slate-400 hover:bg-white/50 dark:hover:bg-slate-700/50 transition-all";

            if(tabName === 'search') {
                btnSearch.className = activeClass;
                btnHow.className = inactiveClass;
                document.getElementById('pickup-view').classList.add('hidden');
            } else {
                btnHow.className = activeClass;
                btnSearch.className = inactiveClass;
                document.getElementById('pickup-view').classList.add('hidden');
            }
        }

        // --- 7. Scanner, File Upload & Preview ---
        let html5QrcodeScanner = null;
        function toggleScanner() {
            const container = document.getElementById('scanner-container');
            if (!container.classList.contains('hidden')) {
                stopScanner();
                return;
            }
            container.classList.remove('hidden');
            html5QrcodeScanner = new Html5Qrcode("reader");
            html5QrcodeScanner.start(
                { facingMode: "environment" }, 
                { fps: 10, qrbox: { width: 250, height: 150 } },
                onScanSuccess,
                (error) => { }
            ).catch(err => {
                showToast("Δεν βρέθηκε κάμερα ή δεν δόθηκε άδεια.", 'error');
                container.classList.add('hidden');
            });
        }

        function stopScanner() {
            if (html5QrcodeScanner) {
                html5QrcodeScanner.stop().then(() => {
                    document.getElementById('scanner-container').classList.add('hidden');
                    html5QrcodeScanner.clear();
                    html5QrcodeScanner = null;
                });
            } else {
                document.getElementById('scanner-container').classList.add('hidden');
            }
        }

        function onScanSuccess(decodedText) {
            stopScanner();
            if(navigator.vibrate) navigator.vibrate(200);
            document.getElementById('barcode-value').value = decodedText;
            showPreview(`Barcode: ${decodedText}`);
            showToast("Το Barcode σαρώθηκε επιτυχώς!", 'success');
        }

        function handleFileSelect(input) {
            if (input.files && input.files[0]) {
                showPreview(`Φωτογραφία: ${input.files[0].name}`);
                showToast("Η φωτογραφία φορτώθηκε.", 'success');
            }
        }

        function showPreview(text) {
            document.getElementById('media-preview').classList.remove('hidden');
            document.getElementById('preview-text').textContent = text;
        }

        function clearMedia() {
            document.getElementById('media-preview').classList.add('hidden');
            document.getElementById('request-image').value = '';
            document.getElementById('barcode-value').value = '';
            showToast("Τα μέσα ενημέρωσης διαγράφηκαν.", 'info');
        }
        
        // --- 8. Local Storage for User Data ---
        const LS_KEYS = { NAME: 'mediRadar_user_name', PHONE: 'mediRadar_user_phone', CITY: 'mediRadar_user_city' };
        function loadUserData() {
            try {
                document.getElementById('full-name').value = localStorage.getItem(LS_KEYS.NAME) || '';
                document.getElementById('phone').value = localStorage.getItem(LS_KEYS.PHONE) || '';
                document.getElementById('city').value = localStorage.getItem(LS_KEYS.CITY) || '';
            } catch (e) { console.error("Could not load user data from Local Storage:", e); }
        }
        function saveUserData() {
            try {
                localStorage.setItem(LS_KEYS.NAME, document.getElementById('full-name').value);
                localStorage.setItem(LS_KEYS.PHONE, document.getElementById('phone').value);
                localStorage.setItem(LS_KEYS.CITY, document.getElementById('city').value);
            } catch (e) { console.error("Could not save user data to Local Storage:", e); }
        }

        // --- 9. Speech Recognition (Voice Input) ---
        function startVoiceInput() {
            if (!SpeechRecognition) {
                showToast("Η φωνητική αναζήτηση δεν υποστηρίζεται σε αυτή τη συσκευή.", 'error');
                return;
            }
            
            const btn = document.getElementById('voice-btn');
            const icon = document.getElementById('mic-icon');
            const input = document.getElementById('medicine');

            if (isListening) {
                recognition.stop();
                return; 
            }

            recognition = new SpeechRecognition();
            recognition.lang = 'el-GR';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.onstart = () => {
                isListening = true;
                icon.classList.replace('ph-microphone', 'ph-speaker-high');
                btn.classList.add('animate-pulse-slow', 'text-red-500', 'scale-110');
                showToast("Ακούω... Παρακαλώ πείτε το όνομα του φαρμάκου καθαρά.", 'info', 3000);
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                input.value = transcript.trim();
                showToast(`Αναγνωρίστηκε: "${transcript}"`, 'success');
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error', event.error);
                let errorMessage = "Σφάλμα φωνητικής αναγνώρισης.";
                if (event.error === 'not-allowed') {
                    errorMessage = "Δεν δόθηκε άδεια χρήσης μικροφώνου.";
                } else if (event.error === 'no-speech') {
                    errorMessage = "Δεν ανιχνεύτηκε ομιλία. Προσπαθήστε ξανά.";
                }
                showToast(errorMessage, 'error');
            };

            recognition.onend = () => {
                isListening = false;
                icon.classList.replace('ph-speaker-high', 'ph-microphone');
                btn.classList.remove('animate-pulse-slow', 'text-red-500', 'scale-110');
            };

            try {
                recognition.start();
            } catch (e) {
                console.warn("Recognition start error (likely already running):", e);
            }
        }
        
        // --- 10. Timer and Extension Logic (local persistence) ---
        function updateTimerDisplay(deadline, lastExtendedTimestamp) {
            stopTimer(); // Clear existing interval if any
            
            if (deadline && deadline > Date.now()) {
                document.getElementById('pickup-view').classList.remove('hidden');
                document.getElementById('tab-search').classList.remove('active');
                
                // Check extension button status
                const now = Date.now();
                const canExtend = now - lastExtendedTimestamp >= EXTENSION_COOLDOWN_MS;
                const extendBtn = document.getElementById('extend-btn');
                
                extendBtn.disabled = !canExtend;
                extendBtn.classList.toggle('bg-gradient-to-r', canExtend);
                extendBtn.classList.toggle('from-cyan-500', canExtend);
                extendBtn.classList.toggle('to-teal-500', canExtend);
                extendBtn.classList.toggle('hover:from-cyan-600', canExtend);
                extendBtn.classList.toggle('hover:to-teal-600', canExtend);
                extendBtn.classList.toggle('text-white', canExtend);
                extendBtn.classList.toggle('bg-slate-200', !canExtend);
                extendBtn.classList.toggle('dark:bg-slate-700', !canExtend);
                extendBtn.classList.toggle('text-slate-500', !canExtend);

                if (canExtend) {
                    extendBtn.innerHTML = '<i class="ph ph-timer text-lg"></i> Παράταση 15\'';
                } else {
                    extendBtn.innerHTML = '<i class="ph ph-timer-fill text-lg"></i> Παράταση 15\' (Χρησιμοποιήθηκε)';
                }


                timerInterval = setInterval(() => {
                    const remainingMs = deadline - Date.now();
                    const timerEl = document.getElementById('timer-display');
                    
                    if (remainingMs <= 0) {
                        timerEl.textContent = "00:00";
                        stopTimer();
                        showToast("Ο χρόνος παραλαβής έληξε. Παρακαλώ επικοινωνήστε με το φαρμακείο.", 'error', 10000);
                        // Optional: Reset status in Firestore here if expired
                    } else {
                        const totalSeconds = Math.floor(remainingMs / 1000);
                        const minutes = Math.floor(totalSeconds / 60);
                        const seconds = totalSeconds % 60;
                        
                        const minStr = String(minutes).padStart(2, '0');
                        const secStr = String(seconds).padStart(2, '0');
                        timerEl.textContent = `${minStr}:${secStr}`;
                    }
                }, 1000);
                
            } else {
                // Deadline passed or not set, ensure timer is stopped
                stopTimer();
            }
        }
        
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }
        
        async function extendPickupTime() {
            const extendBtn = document.getElementById('extend-btn');
            if (extendBtn.disabled) {
                showToast("Μπορείτε να χρησιμοποιήσετε την παράταση μόνο μία φορά κάθε 24 ώρες.", 'warning');
                return;
            }

            extendBtn.disabled = true; // Disable immediately

            try {
                const now = Date.now();
                const currentDeadline = pickupDeadline || now;

                // Add 15 minutes (900,000 milliseconds)
                const newDeadline = currentDeadline + (15 * 60 * 1000);

                updatePickupStatus({
                    deadlineTimestamp: newDeadline,
                    lastExtendedTimestamp: now,
                    appId,
                    userId,
                });

                pickupDeadline = newDeadline; // Update local state immediately
                updateTimerDisplay(pickupDeadline, now); // Refresh timer and button state

                showToast("Επιτυχία! Προστέθηκαν 15 λεπτά στην προθεσμία σας.", 'success');

            } catch (e) {
                console.error("Error extending pickup time:", e);
                showToast("Σφάλμα στην αποθήκευση της παράτασης. Προσπαθήστε ξανά.", 'error');
                extendBtn.disabled = false; // Re-enable on error
            }
        }

        // --- 11. Submit ---
        const form = document.getElementById('request-form');
        
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            if(!document.getElementById('gdpr-check').checked) {
                showToast("Πρέπει να αποδεχτείτε τους όρους χρήσης για να συνεχίσετε.", 'error'); 
                return;
            }

            saveUserData();

            // Calculate new deadline: 60 minutes from now
            const initialDeadline = Date.now() + (60 * 60 * 1000);

            // Set initial pickup status locally
            try {
                updatePickupStatus({
                    deadlineTimestamp: initialDeadline,
                    lastExtendedTimestamp: 0,
                    medicineName: document.getElementById('medicine').value,
                    requestTime: Date.now(),
                    city: document.getElementById('city').value,
                    appId,
                    userId,
                });

                pickupDeadline = initialDeadline;
                updateTimerDisplay(pickupDeadline, 0);

                document.getElementById('tab-search').classList.remove('active');

                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#0d9488', '#38bdf8', '#ffffff']
                });
                showToast("Το αίτημά σας στάλθηκε με επιτυχία! Ξεκινάει ο χρόνος παραλαβής.", 'success');
                
            } catch (e) {
                console.error("Error setting initial request:", e);
                showToast("Αποτυχία αποστολής του αιτήματος. Δοκιμάστε ξανά.", 'error');
            }
        });

        async function resetApp() {
            stopTimer();
            clearPickupStatus();
            document.getElementById('pickup-view').classList.add('hidden');
            document.getElementById('tab-search').classList.add('active');
            clearMedia();
            showToast("Η αναζήτηση ολοκληρώθηκε/ακυρώθηκε.", 'warning');
        }

        // --- 12. Initialization ---
        window.onload = function() {
            loadUserData();
            if (pickupStatus?.deadlineTimestamp) {
                pickupDeadline = pickupStatus.deadlineTimestamp;
                updateTimerDisplay(pickupDeadline, pickupStatus.lastExtendedTimestamp || 0);
            }
        };
    </script>
</body>
</html>
